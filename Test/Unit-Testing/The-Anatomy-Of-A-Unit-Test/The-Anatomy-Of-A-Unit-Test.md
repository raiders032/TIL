# 1 단위 테스트 구조



## 1.1 AAA 패턴

* AAA 패턴은 각 테스트를 준비(Arrange), 실행(Act), 검증(Assert)이라는 세 부분으로 나눈다
* AAA 패턴은 스위트 내 모든 테스트가 단순하고 균일한 구조를 갖는 데 도움이 된다
* 일단 익숙해지면 쉽게 읽을 수 있고 이해할 수 있어 유지 보수 비용이 줄어든다
* 준비, 실행, 검증 구절이 여러개 있는 테스트는 문제가 있다
  * 여러 개의 동작 단위를 검증하는 테스트를 뜻함
  * 이는 더 이상 단위 테스트가 아니라 통합 테스트이다
  * 통합 테스트에서는 실행 구절을 여러개 두는 것이 괜찮을 경우도 있는데 이는 속도를 높이기 위해 여러 개의 통합 테스트를 단일한 테스트로 묶는 것이다

**준비(Arrange)**

* 테스트 대상 시스템(SUT)과 해당 의존성을 원하는 상태로 만든다
* 일반적으로 준비 구절이 세 구절 중 가장 크다
  * 실행과 검증을 합친 것 보다 훨씬 크면 같은 테스트 클래스 내 비공개 메서드 또는 별도의 팩토리 클래스로 도출하는 것이 좋다
  * 준비 구절 코드 재사용에 도움이 되는 패턴으로 오브젝트 마더와 테스트 데이터 빌터 패턴이 있다

**실행(Act)**

* 실행 구절에서는 SUT에서 메서드를 호출하고 준비된 의존성을 전달하며 출력 값을 캡쳐한다
* 보통 실행 구절은 코드 한 줄이다
* 실행 구절이 두 줄 이상인 경우 SUT의 공개 API에 문제가 있음을 시사한다
  * 한번의 메서드 호출로 같은 기능을 하도록 캡슐화를 생각해보자

**검증(Assert)**

* 검증 구절에서는 결과를 검증한다
* 결과는 반환값이나 SUT와 협력자의 최종 상태, SUT가 협력자에 호출한 메서드 등으로 표시될 수 있다

**given-when-then 패턴**

* 테스트 구성 측면에서 AAA패턴과 차이는 없다
* given-when-then 구조가 더 읽기 쉬워 비기술자들과 공유하기 더 적합하다