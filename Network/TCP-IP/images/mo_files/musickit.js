!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).MusicKit={})}(this,(function(t){"use strict";var n=void 0!==typeof self?self:this,extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var l in n)n.hasOwnProperty(l)&&(t[l]=n[l])})(t,n)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function __extends(t,n){function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function(t){for(var n,l=1,d=arguments.length;l<d;l++)for(var p in n=arguments[l])Object.prototype.hasOwnProperty.call(n,p)&&(t[p]=n[p]);return t}).apply(this,arguments)};function __decorate(t,n,l,d){var p,h=arguments.length,f=h<3?n:null===d?d=Object.getOwnPropertyDescriptor(n,l):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(t,n,l,d);else for(var y=t.length-1;y>=0;y--)(p=t[y])&&(f=(h<3?p(f):h>3?p(n,l,f):p(n,l))||f);return h>3&&f&&Object.defineProperty(n,l,f),f}function __metadata(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function __awaiter(t,n,l,d){return new(l||(l=Promise))((function(p,h){function fulfilled(t){try{step(d.next(t))}catch(e){h(e)}}function rejected(t){try{step(d.throw(t))}catch(e){h(e)}}function step(t){var n;t.done?p(t.value):(n=t.value,n instanceof l?n:new l((function(t){t(n)}))).then(fulfilled,rejected)}step((d=d.apply(t,n||[])).next())}))}function __generator(t,n){var l,d,p,h,f={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(h){return function(y){return function(h){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(p=2&h[0]?d.return:h[0]?d.throw||((p=d.return)&&p.call(d),0):d.next)&&!(p=p.call(d,h[1])).done)return p;switch(d=0,p&&(h=[2&h[0],p.value]),h[0]){case 0:case 1:p=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,d=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(p=f.trys,(p=p.length>0&&p[p.length-1])||6!==h[0]&&2!==h[0])){f=0;continue}if(3===h[0]&&(!p||h[1]>p[0]&&h[1]<p[3])){f.label=h[1];break}if(6===h[0]&&f.label<p[1]){f.label=p[1],p=h;break}if(p&&f.label<p[2]){f.label=p[2],f.ops.push(h);break}p[2]&&f.ops.pop(),f.trys.pop();continue}h=n.call(t,f)}catch(e){h=[6,e],d=0}finally{l=p=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,y])}}}function __read(t,n){var l="function"==typeof Symbol&&t[Symbol.iterator];if(!l)return t;var d,p,h=l.call(t),f=[];try{for(;(void 0===n||n-- >0)&&!(d=h.next()).done;)f.push(d.value)}catch(error){p={error:error}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(p)throw p.error}}return f}function __spread(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(__read(arguments[n]));return t}function formatArtworkURL(t,n,l){return n=n||t.height||100,l=l||t.width||100,window.devicePixelRatio>=1.5&&(l*=2,n*=2),t.url.replace("{h}",""+n).replace("{w}",""+l).replace("{f}","jpeg")}var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,n){return t(n={exports:{}},n.exports),n.exports}var d=createCommonjsModule((function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)})),p=createCommonjsModule((function(t){var n=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)})),h=(p.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),_anObject=function(t){if(!h(t))throw TypeError(t+" is not an object!");return t},_fails=function(t){try{return!!t()}catch(e){return!0}},f=!_fails((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),y=d.document,v=h(y)&&h(y.createElement),g=!f&&!_fails((function(){return 7!=Object.defineProperty((t="div",v?y.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),m=Object.defineProperty,_={f:f?Object.defineProperty:function(t,n,l){if(_anObject(t),n=function(t,n){if(!h(t))return t;var l,d;if(n&&"function"==typeof(l=t.toString)&&!h(d=l.call(t)))return d;if("function"==typeof(l=t.valueOf)&&!h(d=l.call(t)))return d;if(!n&&"function"==typeof(l=t.toString)&&!h(d=l.call(t)))return d;throw TypeError("Can't convert object to primitive value")}(n,!0),_anObject(l),g)try{return m(t,n,l)}catch(e){}if("get"in l||"set"in l)throw TypeError("Accessors not supported!");return"value"in l&&(t[n]=l.value),t}},b=f?function(t,n,l){return _.f(t,n,function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}(1,l))}:function(t,n,l){return t[n]=l,t},P={}.hasOwnProperty,_has=function(t,n){return P.call(t,n)},k=0,T=Math.random(),_uid=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++k+T).toString(36))},S=createCommonjsModule((function(t){var n=d["__core-js_shared__"]||(d["__core-js_shared__"]={});(t.exports=function(t,l){return n[t]||(n[t]=void 0!==l?l:{})})("versions",[]).push({version:p.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})})),A=S("native-function-to-string",Function.toString),w=createCommonjsModule((function(t){var n=_uid("src"),l=(""+A).split("toString");p.inspectSource=function(t){return A.call(t)},(t.exports=function(t,p,h,f){var y="function"==typeof h;y&&(_has(h,"name")||b(h,"name",p)),t[p]!==h&&(y&&(_has(h,n)||b(h,n,t[p]?""+t[p]:l.join(String(p)))),t===d?t[p]=h:f?t[p]?t[p]=h:b(t,p,h):(delete t[p],b(t,p,h)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[n]||A.call(this)}))})),_ctx=function(t,n,l){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===n)return t;switch(l){case 1:return function(l){return t.call(n,l)};case 2:return function(l,d){return t.call(n,l,d)};case 3:return function(l,d,p){return t.call(n,l,d,p)}}return function(){return t.apply(n,arguments)}},$export=function(t,n,l){var h,f,y,v,g=t&$export.F,m=t&$export.G,_=t&$export.S,P=t&$export.P,k=t&$export.B,T=m?d:_?d[n]||(d[n]={}):(d[n]||{}).prototype,S=m?p:p[n]||(p[n]={}),A=S.prototype||(S.prototype={});for(h in m&&(l=n),l)y=((f=!g&&T&&void 0!==T[h])?T:l)[h],v=k&&f?_ctx(y,d):P&&"function"==typeof y?_ctx(Function.call,y):y,T&&w(T,h,y,t&$export.U),S[h]!=y&&b(S,h,v),P&&A[h]!=y&&(A[h]=y)};d.core=p,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var I,E,R=$export,C={}.toString,O=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return C.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},_defined=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},_toIobject=function(t){return O(_defined(t))},M=Math.ceil,D=Math.floor,_toInteger=function(t){return isNaN(t=+t)?0:(t>0?D:M)(t)},N=Math.min,L=Math.max,U=Math.min,B=S("keys"),j=(I=!1,function(t,n,l){var d,p,h=_toIobject(t),f=(d=h.length)>0?N(_toInteger(d),9007199254740991):0,y=function(t,n){return(t=_toInteger(t))<0?L(t+n,0):U(t,n)}(l,f);if(I&&n!=n){for(;f>y;)if((p=h[y++])!=p)return!0}else for(;f>y;y++)if((I||y in h)&&h[y]===n)return I||y||0;return!I&&-1}),F=B[E="IE_PROTO"]||(B[E]=_uid(E)),K="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),V=Object.keys||function(t){return function(t,n){var l,d=_toIobject(t),p=0,h=[];for(l in d)l!=F&&_has(d,l)&&h.push(l);for(;n.length>p;)_has(d,l=n[p++])&&(~j(h,l)||h.push(l));return h}(t,K)},$={f:Object.getOwnPropertySymbols},H={f:{}.propertyIsEnumerable},_toObject=function(t){return Object(_defined(t))},z=Object.assign,W=!z||_fails((function(){var t={},n={},l=Symbol(),d="abcdefghijklmnopqrst";return t[l]=7,d.split("").forEach((function(t){n[t]=t})),7!=z({},t)[l]||Object.keys(z({},n)).join("")!=d}))?function(t,n){for(var l=_toObject(t),d=arguments.length,p=1,h=$.f,y=H.f;d>p;)for(var v,g=O(arguments[p++]),m=h?V(g).concat(h(g)):V(g),_=m.length,b=0;_>b;)v=m[b++],f&&!y.call(g,v)||(l[v]=g[v]);return l}:z;R(R.S+R.F,"Object",{assign:W});p.Object.assign;var Y="URLSearchParams"in self,q="Symbol"in self&&"iterator"in Symbol,G="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),Q="FormData"in self,J="ArrayBuffer"in self;if(J)var X=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Z=ArrayBuffer.isView||function(t){return t&&X.indexOf(Object.prototype.toString.call(t))>-1};function normalizeName(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function normalizeValue(t){return"string"!=typeof t&&(t=String(t)),t}function iteratorFor(t){var n={next:function(){var n=t.shift();return{done:void 0===n,value:n}}};return q&&(n[Symbol.iterator]=function(){return n}),n}function Headers$1(t){this.map={},t instanceof Headers$1?t.forEach((function(t,n){this.append(n,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(n){this.append(n,t[n])}),this)}function consumed(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function fileReaderReady(t){return new Promise((function(n,l){t.onload=function(){n(t.result)},t.onerror=function(){l(t.error)}}))}function readBlobAsArrayBuffer(t){var n=new FileReader,l=fileReaderReady(n);return n.readAsArrayBuffer(t),l}function bufferClone(t){if(t.slice)return t.slice(0);var n=new Uint8Array(t.byteLength);return n.set(new Uint8Array(t)),n.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(t){var n;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:G&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:Q&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Y&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():J&&G&&((n=t)&&DataView.prototype.isPrototypeOf(n))?(this._bodyArrayBuffer=bufferClone(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):J&&(ArrayBuffer.prototype.isPrototypeOf(t)||Z(t))?this._bodyArrayBuffer=bufferClone(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Y&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},G&&(this.blob=function(){var t=consumed(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var t,n,l,d=consumed(this);if(d)return d;if(this._bodyBlob)return t=this._bodyBlob,n=new FileReader,l=fileReaderReady(n),n.readAsText(t),l;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var n=new Uint8Array(t),l=new Array(n.length),d=0;d<n.length;d++)l[d]=String.fromCharCode(n[d]);return l.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Q&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers$1.prototype.append=function(t,n){t=normalizeName(t),n=normalizeValue(n);var l=this.map[t];this.map[t]=l?l+", "+n:n},Headers$1.prototype.delete=function(t){delete this.map[normalizeName(t)]},Headers$1.prototype.get=function(t){return t=normalizeName(t),this.has(t)?this.map[t]:null},Headers$1.prototype.has=function(t){return this.map.hasOwnProperty(normalizeName(t))},Headers$1.prototype.set=function(t,n){this.map[normalizeName(t)]=normalizeValue(n)},Headers$1.prototype.forEach=function(t,n){for(var l in this.map)this.map.hasOwnProperty(l)&&t.call(n,this.map[l],l,this)},Headers$1.prototype.keys=function(){var t=[];return this.forEach((function(n,l){t.push(l)})),iteratorFor(t)},Headers$1.prototype.values=function(){var t=[];return this.forEach((function(n){t.push(n)})),iteratorFor(t)},Headers$1.prototype.entries=function(){var t=[];return this.forEach((function(n,l){t.push([l,n])})),iteratorFor(t)},q&&(Headers$1.prototype[Symbol.iterator]=Headers$1.prototype.entries);var ee=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request$1(t,n){var l,d,p=(n=n||{}).body;if(t instanceof Request$1){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,n.headers||(this.headers=new Headers$1(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,p||null==t._bodyInit||(p=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=n.credentials||this.credentials||"same-origin",!n.headers&&this.headers||(this.headers=new Headers$1(n.headers)),this.method=(l=n.method||this.method||"GET",d=l.toUpperCase(),ee.indexOf(d)>-1?d:l),this.mode=n.mode||this.mode||null,this.signal=n.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&p)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(p)}function decode(t){var n=new FormData;return t.trim().split("&").forEach((function(t){if(t){var l=t.split("="),d=l.shift().replace(/\+/g," "),p=l.join("=").replace(/\+/g," ");n.append(decodeURIComponent(d),decodeURIComponent(p))}})),n}function Response(t,n){n||(n={}),this.type="default",this.status=void 0===n.status?200:n.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in n?n.statusText:"OK",this.headers=new Headers$1(n.headers),this.url=n.url||"",this._initBody(t)}Request$1.prototype.clone=function(){return new Request$1(this,{body:this._bodyInit})},Body.call(Request$1.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers$1(this.headers),url:this.url})},Response.error=function(){var t=new Response(null,{status:0,statusText:""});return t.type="error",t};var te=[301,302,303,307,308];Response.redirect=function(t,n){if(-1===te.indexOf(n))throw new RangeError("Invalid status code");return new Response(null,{status:n,headers:{location:t}})};var re=self.DOMException;try{new re}catch(hu){(re=function(t,n){this.message=t,this.name=n;var l=Error(t);this.stack=l.stack}).prototype=Object.create(Error.prototype),re.prototype.constructor=re}function fetch$1(t,n){return new Promise((function(l,d){var p=new Request$1(t,n);if(p.signal&&p.signal.aborted)return d(new re("Aborted","AbortError"));var h=new XMLHttpRequest;function abortXhr(){h.abort()}h.onload=function(){var t,n,d={status:h.status,statusText:h.statusText,headers:(t=h.getAllResponseHeaders()||"",n=new Headers$1,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var l=t.split(":"),d=l.shift().trim();if(d){var p=l.join(":").trim();n.append(d,p)}})),n)};d.url="responseURL"in h?h.responseURL:d.headers.get("X-Request-URL");var p="response"in h?h.response:h.responseText;l(new Response(p,d))},h.onerror=function(){d(new TypeError("Network request failed"))},h.ontimeout=function(){d(new TypeError("Network request failed"))},h.onabort=function(){d(new re("Aborted","AbortError"))},h.open(p.method,p.url,!0),"include"===p.credentials?h.withCredentials=!0:"omit"===p.credentials&&(h.withCredentials=!1),"responseType"in h&&G&&(h.responseType="blob"),p.headers.forEach((function(t,n){h.setRequestHeader(n,t)})),p.signal&&(p.signal.addEventListener("abort",abortXhr),h.onreadystatechange=function(){4===h.readyState&&p.signal.removeEventListener("abort",abortXhr)}),h.send(void 0===p._bodyInit?null:p._bodyInit)}))}fetch$1.polyfill=!0,self.fetch||(self.fetch=fetch$1,self.Headers=Headers$1,self.Request=Request$1,self.Response=Response)
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */;var ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var l in n)n.hasOwnProperty(l)&&(t[l]=n[l])};function __extends$1(t,n){function __(){this.constructor=t}ie(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var ne=Object.assign||function(t){for(var n,l=1,d=arguments.length;l<d;l++)for(var p in n=arguments[l])Object.prototype.hasOwnProperty.call(n,p)&&(t[p]=n[p]);return t};function __awaiter$1(t,n,l,d){return new(l||(l=Promise))((function(p,h){function fulfilled(t){try{step(d.next(t))}catch(e){h(e)}}function rejected(t){try{step(d.throw(t))}catch(e){h(e)}}function step(t){t.done?p(t.value):new l((function(n){n(t.value)})).then(fulfilled,rejected)}step((d=d.apply(t,n||[])).next())}))}function __generator$1(t,n){var l,d,p,h,f={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(h){return function(y){return function(h){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(p=d[2&h[0]?"return":h[0]?"throw":"next"])&&!(p=p.call(d,h[1])).done)return p;switch(d=0,p&&(h=[0,p.value]),h[0]){case 0:case 1:p=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,d=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(p=f.trys,(p=p.length>0&&p[p.length-1])||6!==h[0]&&2!==h[0])){f=0;continue}if(3===h[0]&&(!p||h[1]>p[0]&&h[1]<p[3])){f.label=h[1];break}if(6===h[0]&&f.label<p[1]){f.label=p[1],p=h;break}if(p&&f.label<p[2]){f.label=p[2],f.ops.push(h);break}p[2]&&f.ops.pop(),f.trys.pop();continue}h=n.call(t,f)}catch(e){h=[6,e],d=0}finally{l=p=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,y])}}}function __read$1(t,n){var l="function"==typeof Symbol&&t[Symbol.iterator];if(!l)return t;var d,p,h=l.call(t),f=[];try{for(;(void 0===n||n-- >0)&&!(d=h.next()).done;)f.push(d.value)}catch(error){p={error:error}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(p)throw p.error}}return f}function __spread$1(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(__read$1(arguments[n]));return t}var oe="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(t){return function(){for(var n=[],l=0;l<arguments.length;l++)n[l]=arguments[l];for(var d="",p=n.length;p--;){var h=n[p];d+=h===Object(h)?JSON.stringify(h):h,t._memoized||(t._memoized={})}return d in t._memoized?t._memoized[d]:t._memoized[d]=t.apply(void 0,n)}}function isObject(t){return!!t&&"object"==typeof t&&!Array.isArray(t)}function generateUUID(){for(var t=strRandomizer()+strRandomizer();t.length<16;)t+=strRandomizer();return t.slice(0,16)}function strRandomizer(){return Math.random().toString(16).substring(2)}var ae=memoize((function(t){return/^[a|i|l|p]{1}\.[a-zA-Z0-9]+$/.test(t)})),se=memoize((function(t){return/^(a\.)?[a-zA-Z0-9]+$/.test(t)}));function isNodeEnvironment(t){var isDefined=function(t){return null!=t};return 0===arguments.length&&"undefined"!=typeof process&&(t=process),isDefined(t)&&isDefined(t.versions)&&isDefined(t.versions.node)||"undefined"!=typeof FastBoot}var ue=memoize(isNodeEnvironment()?function(t){return oe.from(t,"base64").toString("binary")}:function(t){return window.atob(t)});memoize(isNodeEnvironment()?function(t){return oe.from(t).toString("base64")}:function(t){return window.btoa(t)});var addPathToURL=function(t,n){return void 0===t||""===t?n||"":void 0===n?t:(t.endsWith("/")&&(t=t.slice(0,-1)),n.startsWith("/")&&(n=n.slice(1)),t+"/"+n)},addQueryParamsToURL=function(t,n){var l=urlEncodeParameters(n);return""===l?t:t.endsWith("&")||t.endsWith("?")?""+t+l:t.includes("?")?t+"&"+l:t+"?"+l},ce="undefined"!=typeof Headers,headersToDict=function(t){var n,l={};return n=t,ce&&n instanceof Headers?t.forEach((function(t,n){return l[n]=t})):Array.isArray(t)?t.forEach((function(t){var n=__read$1(t,2),d=n[0],p=n[1];return l[d]=p})):l=t,l},mergeFetchOptions=function(t,n){var l,d;if(t||n)return(null==t?void 0:t.headers)&&(null==n?void 0:n.headers)?ne(ne(ne({},t),n),{headers:(l=t.headers,d=n.headers,void 0===l&&(l={}),void 0===d&&(d={}),ne(ne({},headersToDict(l)),headersToDict(d)))}):ne(ne({},t),n)};function parseQueryParams(t){var n;if(!t||t.startsWith("http")&&!t.includes("?"))return{};try{return(null!==(n=t.split("?")[1])&&void 0!==n?n:t).split("&").reduce((function(t,n){var l=__read$1(n.split("="),2),d=l[0],p=l[1];return""===d&&void 0===p||(t[decodeURIComponent(d)]=decodeURIComponent(p)),t}),{})}catch($t){return{}}}var recursiveEncodeParameters=function(t,n){return Object.keys(t).reduce((function(l,d){var p=t[d],h=n?n+"["+encodeURIComponent(d)+"]":encodeURIComponent(d);return l+(l?"&":"")+(isObject(p)?recursiveEncodeParameters(p,h):h+"="+encodeURIComponent(p))}),"")};function urlEncodeParameters(t){return t?recursiveEncodeParameters(t):""}function isLive(t){return!!t&&!!t.attributes&&!!t.attributes.isLive}function isStream(t){var n,l;return"stream"===(null===(l=null===(n=null==t?void 0:t.attributes)||void 0===n?void 0:n.playParams)||void 0===l?void 0:l.format)}function isLiveRadioStation(t){return isLive(t)&&isStream(t)}function isBroadcastRadio(t){return isLive(t)&&isStream(t)&&void 0!==t.attributes.stationProviderName&&"Shoutcast"===t.attributes.streamingRadioSubType}function getFilterFromFlags(t){var n=t.includes("radio-live"),l=t.includes("radio-aod"),d=t.includes("radio-broadcast");return function(t){return(!n||n&&!isLiveRadioStation(t))&&(!l||l&&!function(t){return!isLive(t)&&isStream(t)&&"Episode"===t.attributes.streamingRadioSubType}(t))&&(!d||d&&!isBroadcastRadio(t))}}var le={album:"albums",albums:"albums",artist:"artists",artists:"artists",song:"songs",songs:"songs"};var de=memoize((function(t){for(var n=new Uint16Array(t),l=n.length,d="",p=0;p<l;p++)d+=String.fromCharCode(n[p]);return d})),pe=memoize((function(t){var n=ue(t);return he(n)}));function ensureArray(t){return void 0===t&&(t=[]),Array.isArray(t)?t:[t]}var he=memoize((function(t){for(var n=t.length,l=new ArrayBuffer(n),d=new Uint8Array(l),p=0;p<n;p++)d[p]=t.charCodeAt(p);return d})),fe=memoize((function(t){for(var n=t.length,l=new ArrayBuffer(2*n),d=new Uint16Array(l),p=0;p<n;p++)d[p]=t.charCodeAt(p);return d})),ye=memoize((function(t){for(var n,l,d,p,h,f,y,v=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m="";v<t.length;)p=(n=t[v++])>>2,h=(3&n)<<4|(l=v<t.length?t[v++]:Number.NaN)>>4,f=(15&l)<<2|(d=v<t.length?t[v++]:Number.NaN)>>6,y=63&d,isNaN(l)?f=y=64:isNaN(d)&&(y=64),m+=g.charAt(p)+g.charAt(h)+g.charAt(f)+g.charAt(y);return m})),ve=Object.prototype.hasOwnProperty;function get(t,n){return n.split(".").reduce((function(t,n){if(void 0!==t)return t[n]}),t)}function transform(t,n,l){return void 0===l&&(l=!1),l&&(t=Object.keys(t).reduce((function(n,l){return n[t[l]]=l,n}),{})),Object.keys(t).reduce((function(l,d){var p,h=t[d];return(p="function"==typeof h?h():get(n,h))&&function(t,n,l){n.split(".").reduce((function(n,d,p,h){var f=p===h.length-1,y=n.hasOwnProperty(d),v=n[d]instanceof Object,g=null===n[d];if(!f&&y&&(!v||g))throw new TypeError("Value at "+h.slice(0,p+1).join(".")+" in keypath is not an Object.");return f?(n[d]=l,t):y?n[d]:n[d]={}}),t)}(l,d,p),l}),{})}function transformKeys(t,n){return Object.keys(t).reduce((function(l,d){return l[n(d)]=t[d],l}),{})}var ge=function(){function Notifications(t,n){var l=this;void 0===t&&(t=[]),this._eventRegistry={},t.forEach((function(t){l._eventRegistry[t]=[]})),n&&n.namespace&&(this.dispatchNamespace="com.apple."+n.namespace),this.shouldStorageDispatch&&window.addEventListener("storage",this._handleGlobalStorageEvent)}return Object.defineProperty(Notifications.prototype,"shouldStorageDispatch",{get:function(){return"undefined"!=typeof window&&"undefined"!=typeof sessionStorage&&this.dispatchNamespace},enumerable:!0,configurable:!0}),Notifications.prototype.addEventListener=function(t,n){Array.isArray(this._eventRegistry[t])&&this._eventRegistry[t].push(n)},Notifications.prototype.dispatchEvent=function(t,n){Array.isArray(this._eventRegistry[t])&&this._eventRegistry[t].forEach((function(t){return t(n)}))},Notifications.prototype.dispatchDistributedEvent=function(t,n){if(this.dispatchEvent(t,n),this.shouldStorageDispatch){var l=this.dispatchNamespace+":"+t;sessionStorage.setItem(l,JSON.stringify(n))}},Notifications.prototype.removeEventListener=function(t,n){if(Array.isArray(this._eventRegistry[t])){var l=this._eventRegistry[t].indexOf(n);this._eventRegistry[t].splice(l,1)}},Notifications.prototype._handleGlobalStorageEvent=function(t){var n;if(this.dispatchNamespace&&(null===(n=t.key)||void 0===n?void 0:n.startsWith(this.dispatchNamespace+":"))){var l=t.key.substring(this.dispatchNamespace.length+1);this.dispatchEvent(l,JSON.parse(t.newValue))}},Notifications}(),isMergeableObject=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var n=Object.prototype.toString.call(t);return"[object RegExp]"===n||"[object Date]"===n||function(t){return t.$$typeof===_e}(t)}(t)};var me,_e="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(t,n){return!1!==n.clone&&n.isMergeableObject(t)?deepmerge((l=t,Array.isArray(l)?[]:{}),t,n):t;var l}function defaultArrayMerge(t,n,l){return t.concat(n).map((function(t){return cloneUnlessOtherwiseSpecified(t,l)}))}function getKeys(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(n){return t.propertyIsEnumerable(n)})):[]}(t))}function mergeObject(t,n,l){var d={};return l.isMergeableObject(t)&&getKeys(t).forEach((function(n){d[n]=cloneUnlessOtherwiseSpecified(t[n],l)})),getKeys(n).forEach((function(p){l.isMergeableObject(n[p])&&t[p]?d[p]=function(t,n){if(!n.customMerge)return deepmerge;var l=n.customMerge(t);return"function"==typeof l?l:deepmerge}(p,l)(t[p],n[p],l):d[p]=cloneUnlessOtherwiseSpecified(n[p],l)})),d}function deepmerge(t,n,l){(l=l||{}).arrayMerge=l.arrayMerge||defaultArrayMerge,l.isMergeableObject=l.isMergeableObject||isMergeableObject;var d=Array.isArray(n);return d===Array.isArray(t)?d?l.arrayMerge(t,n,l):mergeObject(t,n,l):cloneUnlessOtherwiseSpecified(n,l)}deepmerge.all=function(t,n){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,l){return deepmerge(t,l,n)}),{})},function(t){t.dataRecordDidDelete="dataRecordDidDelete",t.dataRecordWillDelete="dataRecordWillDelete",t.dataRecordDidMaterialize="dataRecordDidMaterialize",t.dataRecordDidPopulate="dataRecordDidPopulate",t.dataRecordWillPopulate="dataRecordWillPopulate"}(me||(me={}));var isDataRecord=function(t){return!(!t||"function"!=typeof t.hasAttributes||"function"!=typeof t.hasRelationships||"function"!=typeof t.hasViews||"function"!=typeof t.serialize)},be=function(){function DataRecord(t,n,l){void 0===l&&(l={}),this.type=t,this.id=n,this._mjs={attributes:[],relationships:[],views:[]},this._meta={},this._mjs=ne(ne({},this._mjs),l)}return DataRecord.prototype.hasProperties=function(t){return!t||(t.attributes||t.relationships||t.views?!(t.attributes&&!this.hasAttributes(t.attributes))&&(!(t.relationships&&!this.hasRelationships(t.relationships))&&!(t.views&&!this.hasViews(t.views))):this.hasAttributes()||this.hasRelationships()||this.hasViews())},DataRecord.prototype.hasAttributes=function(t){return this._hasProperties(this._mjs.attributes,t)},DataRecord.prototype.hasRelationships=function(t){return this._hasProperties(this._mjs.relationships,t)},DataRecord.prototype.hasViews=function(t){return this._hasProperties(this._mjs.views,t)},DataRecord.prototype.meta=function(t){return t?this._meta[t]:this._meta},DataRecord.prototype.serialize=function(t,n){var l=this;void 0===t&&(t=!0),void 0===n&&(n={});var d={id:this.id,type:this.type};return n[this.type+"-"+this.id]?d:(n[this.type+"-"+this.id]=!0,this.hasAttributes()&&(d.attributes=this._mjs.attributes.reduce((function(t,n){return t[n]=l[n],t}),{})),this._mjs.relationships.length>0&&(d.relationships=this._serializeRelatedData(this._mjs.relationships,n)),this._mjs.views.length>0&&(d.views=this._serializeRelatedData(this._mjs.views,n)),t?{data:d}:d)},DataRecord.prototype.setProperty=function(t,n,l,d){function isMergeableObject(t){return!(!t||"object"!=typeof t||t instanceof DataRecord)}void 0===l&&(l="attributes"),void 0===d&&(d={}),this.hasOwnProperty(t)||(this._mjs[l]||(this._mjs[l]=[]),this._mjs[l].push(t));var setDescriptor=function(t){return{value:t,writable:!0,configurable:!0,enumerable:!0}};this[t]&&n&&"object"==typeof this[t]&&"object"==typeof n?"attributes"===l?Object.defineProperty(this,t,setDescriptor(deepmerge(this[t],n,{arrayMerge:function(t,n,l){return n},isMergeableObject:isMergeableObject}))):"relationships"===l&&Array.isArray(this[t])&&d.extendRelationships?Object.defineProperty(this,t,setDescriptor(deepmerge(this[t],n,{isMergeableObject:isMergeableObject}))):Object.defineProperty(this,t,setDescriptor(n)):Object.defineProperty(this,t,setDescriptor(n))},DataRecord.prototype.removeRelative=function(t,n){this[t]&&(Array.isArray(this[t])?this[t]=this[t].filter((function(t){return t.id!==n})):delete this[t])},DataRecord.prototype.setParent=function(t){var n=this._mjs.parents,l=n&&n.length>0;this._mjs.parents=l?n.concat(t):t},DataRecord.prototype._hasProperties=function(t,n){return!!t&&(n?ensureArray(n).every((function(n){return t.includes(n)})):t.length>0)},DataRecord.prototype._serializeRelatedData=function(t,n){var l=this;return void 0===n&&(n={}),t.reduce((function(t,d){var p=l[d];return Array.isArray(p)?t[d]={data:p.map((function(t){return"function"==typeof t.serialize?t.serialize(!1,n):t}))}:t[d]=p&&"function"==typeof p.serialize?p.serialize(!1,n):p,t}),{})},DataRecord}(),Pe=function(t){function DataStore(n){void 0===n&&(n={});var l=t.call(this,[me.dataRecordDidDelete,me.dataRecordWillDelete,me.dataRecordDidMaterialize,me.dataRecordWillPopulate,me.dataRecordDidPopulate])||this;return l._removeOnExpiration=!1,l._records={},l._expiryRecords=new Set,l._removeOnExpiration=!!n.removeOnExpiration,l._mapping=n.mapping,l.filter=n.filter,l}return __extends$1(DataStore,t),Object.defineProperty(DataStore.prototype,"mapping",{get:function(){return this._mapping},set:function(t){this._mapping=t},enumerable:!0,configurable:!0}),DataStore.prototype.clear=function(){this._records={},this._expiryRecords=new Set},DataStore.prototype.peek=function(t,n,l){var d=this;if(this._checkForExpiredRecords(),!this._records[t])return n?null:[];if(!n)return Object.values(this._records[t]);if(Array.isArray(n))return n.map((function(n){var p=d._records[t][n];if(p&&p.hasProperties(l))return p}));var p=this._records[t][n];return p&&p.hasProperties(l)?p:null},DataStore.prototype.populateDataRecords=function(t,n,l){var d=this;if(void 0===n&&(n={}),void 0===l&&(l={}),!t.data)return[];if(!Array.isArray(t.data))return this.populateDataRecord(t.data,n,l);var p=[];return t.data.forEach((function(t,h){var f=ne(ne({},l),{parents:l.parents?[ne(ne({},l.parents[0]),{position:h})]:[]});l.parents&&(l.parents[0].position=h);var y=d.populateDataRecord(t,n,f);p.push(y)})),p},DataStore.prototype.populateDataRecord=function(t,n,l){var d=this;void 0===n&&(n={});var p=l.filter||this.filter,h=l.mapping||this.mapping;if(!p||p(t)){if(h){var f="function"==typeof h?h(t):transform(h,t);Object.assign(t,f)}var y=this._materializeRecord(n,ne({id:t.id,type:t.type},l));return t.meta&&(y._meta=t.meta),t.attributes&&t.attributes.cachingPolicy&&t.attributes.cachingPolicy.maxAge&&(y._mjs.expiration=Date.now()+1e3*t.attributes.cachingPolicy.maxAge,this._removeOnExpiration&&this._expiryRecords.add(y)),this._populateDataAttributes(t,y),"object"==typeof t.relationships&&Object.keys(t.relationships).forEach((function(p){var f=t.relationships[p];f&&"data"in f&&(f=d.populateDataRecords(f,n,{mapping:h,parents:[{relationshipName:p,parentType:y.type,parentId:y.id}]}),y.setProperty(p,f,"relationships",l))})),"object"==typeof t.views&&Object.keys(t.views).forEach((function(l){var p=t.views[l];if(p.attributes||p.data){var f=new be("view",l);if(d._populateDataAttributes(p,f),p.data){var v=d.populateDataRecords(p,n,h);f.setProperty("data",v,"relationships")}y.setProperty(l,f,"views")}})),y}},DataStore.prototype.query=function(t,n){this._checkForExpiredRecords();var includeRecord=function(t){return!1};return"string"==typeof t&&n?includeRecord=function(l){return get(l,t)===n}:"function"==typeof t?includeRecord=function(n){try{return t(n)}catch(e){return!1}}:"object"==typeof t&&(includeRecord=function(n){var l=Object.keys(t),d=0;return l.forEach((function(l){get(n,l)===t[l]&&d++})),l.length===d}),Object.values(this._records).reduce((function(t,n){return Object.values(n).forEach((function(n){includeRecord(n)&&t.push(n)})),t}),[])},DataStore.prototype.remove=function(t,n){var l=this;if(setTimeout(this._checkForExpiredRecords.bind(this),0),this._records.hasOwnProperty(t)){var d=this.peek(t,n);d&&(this.dispatchEvent(me.dataRecordWillDelete,[t,n]),d._mjs.parents&&d._mjs.parents.length>0&&d._mjs.parents.forEach((function(t){var n=t.relationshipName,p=t.parentType,h=t.parentId;l.peek(p,h).removeRelative(n,d.id)})),delete this._records[t][n],this.dispatchEvent(me.dataRecordDidDelete,[t,n]))}},DataStore.prototype.save=function(t,n){return void 0===n&&(n={}),setTimeout(this._checkForExpiredRecords.bind(this),0),this.populateDataRecords(t,this._records,n)},DataStore.prototype._populateDataAttributes=function(t,n){"object"==typeof t.attributes&&(this.dispatchEvent(me.dataRecordWillPopulate,[n.type,n.id]),Object.keys(t.attributes).forEach((function(l){n.setProperty(l,t.attributes[l],"attributes")})),this.dispatchEvent(me.dataRecordDidPopulate,[n.type,n.id]))},DataStore.prototype._materializeRecord=function(t,n){var l=n.type,d=n.id,p=function(t,n){var l={};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&n.indexOf(d)<0&&(l[d]=t[d]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var p=0;for(d=Object.getOwnPropertySymbols(t);p<d.length;p++)n.indexOf(d[p])<0&&(l[d[p]]=t[d[p]])}return l}(n,["type","id"]);return t[l]=t[l]||{},t[l][d]?t[l][d].setParent(p.parents||[]):t[l][d]=new be(l,d,p),this.dispatchEvent(me.dataRecordDidMaterialize,[l,d]),t[l][d]},DataStore.prototype._checkForExpiredRecords=function(){var t=this,n=[];this._expiryRecords.forEach((function(l){Date.now()>l._mjs.expiration&&(n.push([l.type,l.id]),t._expiryRecords.delete(l))})),n.forEach((function(n){t.remove.apply(t,__spread$1(n))}))},DataStore}(ge),ke={400:"REQUEST_ERROR",401:"UNAUTHORIZED_ERROR",403:"ACCESS_DENIED",404:"NOT_FOUND",405:"NOT_FOUND",413:"REQUEST_ERROR",414:"REQUEST_ERROR",429:"QUOTA_EXCEEDED",500:"SERVER_ERROR",501:"NOT_FOUND",503:"SERVICE_UNAVAILABLE"},Te={"-1004":"DEVICE_LIMIT",1010:ke[404],2002:"AUTHORIZATION_ERROR",2034:"TOKEN_EXPIRED",3059:"DEVICE_LIMIT",3063:"SUBSCRIPTION_ERROR",3076:"CONTENT_UNAVAILABLE",3082:"CONTENT_RESTRICTED",3084:"STREAM_UPSELL",5002:ke[500],180202:"PLAYREADY_CBC_ENCRYPTION_ERROR"},Se=[],Ae=new Set(["UNSUPPORTED_ERROR","CONTENT_EQUIVALENT","CONTENT_UNAVAILABLE","CONTENT_UNSUPPORTED","SERVER_ERROR","SUBSCRIPTION_ERROR"]),we=function(t){function MKError(n,l){var d=t.call(this)||this;return d.errorCode="UNKNOWN_ERROR",n&&Ae.has(n)?(d.name=d.errorCode=n,d.message=d.description=l||n):l||"string"!=typeof n?(d.name=d.errorCode=n||"UNKNOWN_ERROR",l&&(d.message=d.description=l)):(d.name=d.errorCode="UNKNOWN_ERROR",d.message=d.description=n),Se.push(d),Error.captureStackTrace&&Error.captureStackTrace(d,MKError),d}return __extends$1(MKError,t),Object.defineProperty(MKError,"errors",{get:function(){return Se},enumerable:!0,configurable:!0}),MKError.playActivityError=function(t){return new this("PLAY_ACTIVITY",t)},MKError.parseError=function(t){return new this("PARSE_ERROR",t)},MKError.responseError=function(t){var n=t.status,l=t.statusText;return new this(ke[n]||"NETWORK_ERROR",l||""+n)},MKError.serverError=function(t){var n=t.status,l=t.dialog,d=t.failureType,p=t.customerMessage,h=t.errorMessage,f=t.message;l&&(f=l.message||l.customerMessage||l.errorMessage,l.message=f);var y=Te[d]||Te[n]||"UNKNOWN_ERROR",v=new this(y,f||p||h);return"STREAM_UPSELL"===y&&l&&l.okButtonAction&&l.okButtonAction.url&&(l.okButtonAction.url=l.okButtonAction.url.replace(/\&(?:challenge|key-system|uri|user-initiated)=[^\&]+/gim,"")),v.dialog=l,v},MKError.internalError=function(t){return new this(MKError.INTERNAL_ERROR,t)},MKError.ACCESS_DENIED=ke[403],MKError.AGE_VERIFICATION="AGE_VERIFICATION",MKError.AUTHORIZATION_ERROR=Te[2002],MKError.CONFIGURATION_ERROR="CONFIGURATION_ERROR",MKError.CONTENT_EQUIVALENT="CONTENT_EQUIVALENT",MKError.CONTENT_RESTRICTED=Te[3082],MKError.CONTENT_UNAVAILABLE=Te[3076],MKError.CONTENT_UNSUPPORTED="CONTENT_UNSUPPORTED",MKError.DEVICE_LIMIT=Te[3059],MKError.INVALID_ARGUMENTS="INVALID_ARGUMENTS",MKError.PLAYREADY_CBC_ENCRYPTION_ERROR="PLAYREADY_CBC_ENCRYPTION_ERROR",MKError.MEDIA_CERTIFICATE="MEDIA_CERTIFICATE",MKError.MEDIA_DESCRIPTOR="MEDIA_DESCRIPTOR",MKError.MEDIA_LICENSE="MEDIA_LICENSE",MKError.MEDIA_KEY="MEDIA_KEY",MKError.MEDIA_PLAYBACK="MEDIA_PLAYBACK",MKError.MEDIA_SESSION="MEDIA_SESSION",MKError.NETWORK_ERROR="NETWORK_ERROR",MKError.NOT_FOUND=Te[1010],MKError.PARSE_ERROR="PARSE_ERROR",MKError.PLAY_ACTIVITY="PLAY_ACTIVITY",MKError.QUOTA_EXCEEDED=ke[429],MKError.REQUEST_ERROR=ke[400],MKError.SERVER_ERROR=Te[5002],MKError.SERVICE_UNAVAILABLE=ke[503],MKError.STREAM_UPSELL=Te[3084],MKError.SUBSCRIPTION_ERROR=Te[3063],MKError.TOKEN_EXPIRED=Te[2034],MKError.UNAUTHORIZED_ERROR=ke[401],MKError.UNKNOWN_ERROR="UNKNOWN_ERROR",MKError.UNSUPPORTED_ERROR="UNSUPPORTED_ERROR",MKError.INTERNAL_ERROR="INTERNAL_ERROR",MKError.OUTPUT_RESTRICTED="OUTPUT_RESTRICTED",MKError}(Error);var Ie,Ee,Re,Ce,Oe,Me,De,Ne,Le,xe,Ue,Be,je,Fe,Ke=function(){function PubSub(){this.events={}}return PubSub.prototype.publish=function(t,n){var l=this.getSubscribersForType(t);void 0!==l&&l.forEach((function(l){l(t,n)}))},PubSub.prototype.subscribe=function(t,n){this.getSubscribersForType(t,!0).push(n)},PubSub.prototype.subscribeOnce=function(t,n){var l=this,onceCallback=function(t,d){l.unsubscribe(t,onceCallback),n(t,d)};this.subscribe(t,onceCallback)},PubSub.prototype.unsubscribe=function(t,n){var l=this.getSubscribersForType(t);if(void 0!==l)for(var d in l)if(l[d]===n){delete l[d];break}},PubSub.prototype.clear=function(t){void 0===t?this.events={}:delete this.events[t]},PubSub.prototype.getSubscribersForType=function(t,n){return void 0===n&&(n=!1),!this.events.hasOwnProperty(t)&&n&&(this.events[t]=[]),this.events[t]},PubSub}();!function(t){t.MUSICKIT="music_kit-integration",t.OTHER="other",t.MINI="mini",t.SONG="song",t.ALBUM="album",t.ALBUM_CLASSICAL="album-classical",t.ARTIST="artist",t.COMPILATION="compilation",t.COMPILATION_CLASSICAL="compilation-classical",t.PLAYLIST="playlist",t.PLAYLIST_CLASSICAL="playlist-classical",t.SEARCH="search",t.STATION="station"}(Ie||(Ie={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.RADIO=1]="RADIO",t[t.PLAYLIST=2]="PLAYLIST",t[t.ALBUM=3]="ALBUM",t[t.ARTIST=4]="ARTIST"}(Ee||(Ee={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.STATIC=1]="STATIC",t[t.TIME_SYNCED=2]="TIME_SYNCED"}(Re||(Re={})),function(t){t[t.REPEAT_UNKNOWN=0]="REPEAT_UNKNOWN",t[t.REPEAT_OFF=1]="REPEAT_OFF",t[t.REPEAT_ONE=2]="REPEAT_ONE",t[t.REPEAT_ALL=3]="REPEAT_ALL"}(Ce||(Ce={})),function(t){t[t.SHUFFLE_UNKNOWN=0]="SHUFFLE_UNKNOWN",t[t.SHUFFLE_OFF=1]="SHUFFLE_OFF",t[t.SHUFFLE_ON=2]="SHUFFLE_ON"}(Oe||(Oe={})),function(t){t[t.AUTO_UNKNOWN=0]="AUTO_UNKNOWN",t[t.AUTO_OFF=1]="AUTO_OFF",t[t.AUTO_ON=2]="AUTO_ON",t[t.AUTO_ON_CONTENT_UNSUPPORTED=3]="AUTO_ON_CONTENT_UNSUPPORTED"}(Me||(Me={})),(De=t.PlayActivityEndReasonType||(t.PlayActivityEndReasonType={}))[De.NOT_APPLICABLE=0]="NOT_APPLICABLE",De[De.OTHER=1]="OTHER",De[De.TRACK_SKIPPED_FORWARDS=2]="TRACK_SKIPPED_FORWARDS",De[De.PLAYBACK_MANUALLY_PAUSED=3]="PLAYBACK_MANUALLY_PAUSED",De[De.PLAYBACK_SUSPENDED=4]="PLAYBACK_SUSPENDED",De[De.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM=5]="MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM",De[De.PLAYBACK_PAUSED_DUE_TO_INACTIVITY=6]="PLAYBACK_PAUSED_DUE_TO_INACTIVITY",De[De.NATURAL_END_OF_TRACK=7]="NATURAL_END_OF_TRACK",De[De.PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT=8]="PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT",De[De.TRACK_BANNED=9]="TRACK_BANNED",De[De.FAILED_TO_LOAD=10]="FAILED_TO_LOAD",De[De.PAUSED_ON_TIMEOUT=11]="PAUSED_ON_TIMEOUT",De[De.SCRUB_BEGIN=12]="SCRUB_BEGIN",De[De.SCRUB_END=13]="SCRUB_END",De[De.TRACK_SKIPPED_BACKWARDS=14]="TRACK_SKIPPED_BACKWARDS",De[De.NOT_SUPPORTED_BY_CLIENT=15]="NOT_SUPPORTED_BY_CLIENT",De[De.QUICK_PLAY=16]="QUICK_PLAY",De[De.EXITED_APPLICATION=17]="EXITED_APPLICATION",function(t){t[t.NOT_SPECIFIED=0]="NOT_SPECIFIED",t[t.CONTAINER_CHANGED=1]="CONTAINER_CHANGED"}(Ne||(Ne={})),function(t){t[t.PLAY_END=0]="PLAY_END",t[t.PLAY_START=1]="PLAY_START",t[t.LYRIC_DISPLAY=2]="LYRIC_DISPLAY"}(Le||(Le={})),function(t){t[t.INVALID=0]="INVALID",t[t.ITUNES_STORE_CONTENT=1]="ITUNES_STORE_CONTENT",t[t.NON_SONG_CLIP=2]="NON_SONG_CLIP",t[t.AD=3]="AD",t[t.STREAM=4]="STREAM",t[t.AUDIO_AD=5]="AUDIO_AD",t[t.VIDEO_AD=6]="VIDEO_AD",t[t.TIMED_METADATA_PING=7]="TIMED_METADATA_PING",t[t.ARTIST_UPLOADED_CONTENT=8]="ARTIST_UPLOADED_CONTENT",t[t.AGGREGATE_NON_CATALOG_PLAY_TIME=9]="AGGREGATE_NON_CATALOG_PLAY_TIME",t[t.ORIGINAL_CONTENT_MOVIES=10]="ORIGINAL_CONTENT_MOVIES",t[t.ORIGINAL_CONTENT_SHOWS=11]="ORIGINAL_CONTENT_SHOWS"}(xe||(xe={})),function(t){t[t.AUDIO=0]="AUDIO",t[t.VIDEO=1]="VIDEO"}(Ue||(Ue={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(Be||(Be={})),function(t){t[t.WEBPLAYER=8]="WEBPLAYER",t[t.MUSICKIT=10]="MUSICKIT",t[t.THIRD_PARTY_TV=18]="THIRD_PARTY_TV"}(je||(je={})),function(t){t[t.EPISODE=1]="EPISODE",t[t.SHOUTCAST=2]="SHOUTCAST"}(Fe||(Fe={}));
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var extendStatics$2=function(t,n){return(extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var l in n)n.hasOwnProperty(l)&&(t[l]=n[l])})(t,n)};function __extends$2(t,n){function __(){this.constructor=t}extendStatics$2(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var Ve,__assign$2=function(){return(__assign$2=Object.assign||function(t){for(var n,l=1,d=arguments.length;l<d;l++)for(var p in n=arguments[l])Object.prototype.hasOwnProperty.call(n,p)&&(t[p]=n[p]);return t}).apply(this,arguments)};function __awaiter$2(t,n,l,d){return new(l||(l=Promise))((function(p,h){function fulfilled(t){try{step(d.next(t))}catch(e){h(e)}}function rejected(t){try{step(d.throw(t))}catch(e){h(e)}}function step(t){t.done?p(t.value):new l((function(n){n(t.value)})).then(fulfilled,rejected)}step((d=d.apply(t,n||[])).next())}))}function __generator$2(t,n){var l,d,p,h,f={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(h){return function(y){return function(h){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(p=2&h[0]?d.return:h[0]?d.throw||((p=d.return)&&p.call(d),0):d.next)&&!(p=p.call(d,h[1])).done)return p;switch(d=0,p&&(h=[2&h[0],p.value]),h[0]){case 0:case 1:p=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,d=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(p=f.trys,(p=p.length>0&&p[p.length-1])||6!==h[0]&&2!==h[0])){f=0;continue}if(3===h[0]&&(!p||h[1]>p[0]&&h[1]<p[3])){f.label=h[1];break}if(6===h[0]&&f.label<p[1]){f.label=p[1],p=h;break}if(p&&f.label<p[2]){f.label=p[2],f.ops.push(h);break}p[2]&&f.ops.pop(),f.trys.pop();continue}h=n.call(t,f)}catch(e){h=[6,e],d=0}finally{l=p=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,y])}}}function __values$1(t){var n="function"==typeof Symbol&&t[Symbol.iterator],l=0;return n?n.call(t):{next:function(){return t&&l>=t.length&&(t=void 0),{value:t&&t[l++],done:!t}}}}function __read$2(t,n){var l="function"==typeof Symbol&&t[Symbol.iterator];if(!l)return t;var d,p,h=l.call(t),f=[];try{for(;(void 0===n||n-- >0)&&!(d=h.next()).done;)f.push(d.value)}catch(error){p={error:error}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(p)throw p.error}}return f}!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(Ve||(Ve={}));var $e={type:"xstate.init"};function e(t){return void 0===t?[]:[].concat(t)}function r(t){return{type:"xstate.assign",assignment:t}}function i(t,n){return"string"==typeof(t="string"==typeof t&&n&&n[t]?n[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function o(t){return function(n){return t===n}}function a(t){return"string"==typeof t?{type:t}:t}function u(t,n){return{value:t,context:n,actions:[],changed:!1,matches:o(t)}}function c(t,n){void 0===n&&(n={});var l={config:t,_options:n,initialState:{value:t.initial,actions:e(t.states[t.initial].entry).map((function(t){return i(t,n.actions)})),context:t.context,matches:o(t.initial)},transition:function(n,d){var p,h,f="string"==typeof n?{value:n,context:t.context}:n,y=f.value,v=f.context,g=a(d),m=t.states[y];if(m.on){var _=e(m.on[g.type]),x=function(n){if(void 0===n)return{value:u(y,v)};var d="string"==typeof n?{target:n}:n,p=d.target,h=void 0===p?y:p,f=d.actions,_=void 0===f?[]:f,b=d.cond,P=v;if((void 0===b?function(){return!0}:b)(v,g)){var k=t.states[h],T=!1,S=[].concat(m.exit,_,k.entry).filter((function(t){return t})).map((function(t){return i(t,l._options.actions)})).filter((function(t){if("xstate.assign"===t.type){T=!0;var n=Object.assign({},P);return"function"==typeof t.assignment?n=t.assignment(P,g):Object.keys(t.assignment).forEach((function(l){n[l]="function"==typeof t.assignment[l]?t.assignment[l](P,g):t.assignment[l]})),P=n,!1}return!0}));return{value:{value:h,context:P,actions:S,changed:h!==y||S.length>0||T,matches:o(h)}}}};try{for(var b=function(t){var n="function"==typeof Symbol&&t[Symbol.iterator],l=0;return n?n.call(t):{next:function(){return t&&l>=t.length&&(t=void 0),{value:t&&t[l++],done:!t}}}}(_),P=b.next();!P.done;P=b.next()){var k=x(P.value);if("object"==typeof k)return k.value}}catch(t){p={error:t}}finally{try{P&&!P.done&&(h=b.return)&&h.call(b)}finally{if(p)throw p.error}}}return u(y,v)}};return l}var s=function(t,n){return t.actions.forEach((function(l){var d=l.exec;return d&&d(t.context,n)}))};function f$3(t){var n=t.initialState,l=Ve.NotStarted,d=new Set,p={_machine:t,send:function(p){l===Ve.Running&&(n=t.transition(n,p),s(n,a(p)),d.forEach((function(t){return t(n)})))},subscribe:function(t){return d.add(t),t(n),{unsubscribe:function(){return d.delete(t)}}},start:function(){return l=Ve.Running,s(n,$e),p},stop:function(){return l=Ve.Stopped,d.clear(),p},get state(){return n},get status(){return l}};return p}var createInvocableResolver=function(t){return function(n){return null==n||t(n)?n:n()}},He=createInvocableResolver((function(t){return"string"==typeof t})),ze=createInvocableResolver((function(t){return"boolean"==typeof t})),We=/(?:st|ra)\.([0-9]+)/,Ye=/st\.([0-9]+)/,qe=function(){function PlayActivitySender(t){var n,l,d,p;this.mode=Be.AUTO,this._isQA=!1,this._logInfo=!1,this._preferDSID=!1,this._accessToken=t.accessToken,this._clientId=t.clientId,this._eventType=t.eventType,this._fetch=null!==(n=t.fetch)&&void 0!==n?n:fetch,this._fetchOptions=null!==(l=t.fetchOptions)&&void 0!==l?l:{},this._headersClass=null!==(d=t.headersClass)&&void 0!==d?d:Headers,this._isQA=null!==(p=t.isQA)&&void 0!==p&&p,this._logInfo=t.logInfo||this._isQA,this._musicUserToken=t.musicUserToken,this._preferDSID=t.preferDSID,this._sourceType=t.sourceType,this._traceTag=t.traceTag}return Object.defineProperty(PlayActivitySender.prototype,"accessToken",{get:function(){return He(this._accessToken)},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivitySender.prototype,"musicUserToken",{get:function(){return He(this._musicUserToken)},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivitySender.prototype,"url",{get:function(){return this._isQA?"https://universal-activity-service.itunes.apple.com/qa/play":"https://universal-activity-service.itunes.apple.com/play"},enumerable:!0,configurable:!0}),PlayActivitySender.prototype.send=function(t){return __awaiter$2(this,void 0,void 0,(function(){var n,l;return __generator$2(this,(function(d){switch(d.label){case 0:if(0===(n={client_id:this._clientId,event_type:this._eventType,data:ensureArray(t)}).data.length)throw new Error("send() called without any data");return l=this._generateFetchOptions({method:"POST",body:JSON.stringify(n),headers:this.headers()}),[4,this._fetch(this.url,l)];case 1:return[4,d.sent().text()];case 2:return d.sent(),this._logInfo&&console.info("play activity:",13===this._sourceType?JSON.stringify(n):n),[2,n]}}))}))},PlayActivitySender.prototype.baseHeaders=function(){var t,n,l=null!==(n=null===(t=this._fetchOptions)||void 0===t?void 0:t.headers)&&void 0!==n?n:{};return l instanceof this._headersClass?new this._headersClass(Array.from(l.entries())):new this._headersClass(l)},PlayActivitySender.prototype.headers=function(){var t=this._preferDSID?"X-Dsid":"media-user-token",n=this.baseHeaders();return n.set("Authorization","Bearer "+this.accessToken),n.set("Content-Type","application/json"),n.set(t,""+this.musicUserToken),this._isQA&&void 0!==this._traceTag&&n.set("Data-Trace-Tag",this._traceTag),n},PlayActivitySender.prototype._generateFetchOptions=function(t){return __assign$2(__assign$2({},this._fetchOptions),t)},PlayActivitySender}(),conditionalObject=function(t,n,l){var d;return t?((d={})[n]=l,d):{}},buildObject=function(t,n){return conditionalObject(void 0!==n,t,n)};var fullAppId=function(t,n){return void 0===(null==n?void 0:n.name)?"MusicKitApp/1.0":void 0!==t?t:function(t){return t.toLowerCase().replace(/[-_]+/g," ").replace(/[^\w\s]/g,"").replace(/\b./g,(function(t){return t.toUpperCase()})).replace(/\s/g,"")}(n.name)+"/"+((null==n?void 0:n.version)||"1.0")},os=function(t){var n,l,d,p,h=t.toLowerCase(),f="Unidentified OS",y=/mobile/.test(h);return y&&/android|adr/.test(h)?(f="Android",p=h.match(/(?:android|adr)\ ((\d+[._])+\d+)/)):y&&/iphone|ipad|ipod/.test(h)?(f="iOS",p=h.match(/os\ ((\d+[._])+\d+)\ like\ mac\ os\ x/)):/tizen/.test(h)?(f="Tizen",p=h.match(/tizen (.*)/)):/web0s|webos/.test(h)?(f="WebOS",p=h.match(/[web0s|webos] (.*)/)):!y&&/cros/.test(h)?f="ChromeOS":!y&&/macintosh/.test(h)?(f="macOS",p=h.match(/os\ x\ ((\d+[._])+\d+)\b/)):!y&&/linux/.test(h)?f="Linux":!y&&/windows/.test(h)&&(f="Windows",p=h.match(/windows ([^\)]*)/)),f+"/"+(null!==(d=null===(l=null===(n=null==p?void 0:p[1])||void 0===n?void 0:n.replace)||void 0===l?void 0:l.call(n,/_/g,"."))&&void 0!==d?d:"0.0")},model=function(t){return"model/"+((null==t?void 0:t.platform)||"Unavailable")},build=function(t){var n=null==t?void 0:t.build;return void 0===n||""===n?"build/0.0.0":"build/"+n},Ge={platform:"",userAgent:""},Qe=function(){function PlayActivityBase(t,n,l,d){var p,h,f;this._accessToken=t,this._musicUserToken=n,this.storefrontId=l,this.privateEnabled=!1,this.siriInitiated=!1,this.clientId="JSCLIENT",this.eventType="JSPLAY",this.internalBuild=!1,this.preferDSID=!1,this.sourceType=je.MUSICKIT,this._utcOffset=(new Date).getTimezoneOffset(),this._userIsSubscribed=!0,d&&(this._appInfo=d.app,this._navigator=d.navigator,this._userAgent=d.userAgent,d.hasOwnProperty("utcOffset")&&isNaN(d.utcOffset)?this._utcOffsetInSeconds=-1:d.hasOwnProperty("utcOffset")&&(this._utcOffset=d.utcOffset),this.clientId=d.clientId||"JSCLIENT",this._deviceName=d.deviceName,this.guid=d.guid,this.preferDSID=null!==(p=d.preferDSID)&&void 0!==p&&p,this.sourceType=d.sourceType&&"number"==typeof d.sourceType?d.sourceType:je.MUSICKIT,this._userIsSubscribed=null===(h=d.userIsSubscribed)||void 0===h||h),this.buildVersion=function(t,n,l,d){return[fullAppId(t,n),os(d),model(l),build(n)].join(" ")}(this._appId,this._appInfo,this.navigator,this.userAgent),this.sender=new qe({accessToken:this._accessToken,clientId:this.clientId,eventType:this.eventType,fetch:null==d?void 0:d.fetch,fetchOptions:null==d?void 0:d.fetchOptions,headersClass:null===(f=null==d?void 0:d.fetch)||void 0===f?void 0:f.Headers,isQA:null==d?void 0:d.isQA,logInfo:null==d?void 0:d.logInfo,musicUserToken:this._musicUserToken,preferDSID:this.preferDSID,sourceType:this.sourceType,traceTag:null==d?void 0:d.traceTag})}return Object.defineProperty(PlayActivityBase.prototype,"accessToken",{get:function(){return He(this._accessToken)},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"appID",{get:function(){return void 0===this._appId&&(this._appId=fullAppId(this._appId,this._appInfo)),this._appId},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"musicUserToken",{get:function(){return He(this._musicUserToken)},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"navigator",{get:function(){var t;return null!==(t=this._navigator)&&void 0!==t?t:"undefined"==typeof navigator?Ge:navigator},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"userAgent",{get:function(){var t;return null!==(t=this._userAgent)&&void 0!==t?t:this.navigator.userAgent},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"userIsSubscribed",{get:function(){return ze(this._userIsSubscribed)},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivityBase.prototype,"utcOffsetInSeconds",{get:function(){if(void 0===this._utcOffsetInSeconds&&void 0!==this._utcOffset&&!isNaN(this._utcOffset)){var t=60*this._utcOffset;this._utcOffsetInSeconds=t<=0?Math.abs(t):-t}return void 0===this._utcOffsetInSeconds||isNaN(this._utcOffsetInSeconds)?-1:this._utcOffsetInSeconds},enumerable:!0,configurable:!0}),PlayActivityBase.prototype.send=function(t){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(n){return[2,this.sender.send(t)]}))}))},PlayActivityBase.prototype.buildDescriptorForPlayParams=function(t,n,l,d,p){var h="stream"===t.format?xe.STREAM:xe.ITUNES_STORE_CONTENT;return __assign$2(__assign$2(__assign$2({},t),{container:l,duration:null!=d?d:0,eventType:n,itemType:h}),p)},PlayActivityBase.prototype.buildForPlayParams=function(t,n,l,d,p,h){return void 0===d&&(d=0),void 0===p&&(p={}),void 0===h&&(h=!1),this.build(this.buildDescriptorForPlayParams(t,n,l,d,p),h)},PlayActivityBase.prototype.generateBaseActivityData=function(){return __assign$2(__assign$2(__assign$2({"build-version":this.buildVersion,"container-type":Ee.UNKNOWN,"developer-token":this.accessToken,"internal-build":this.internalBuild,offline:!1,"persistent-id":generateUUID(),"private-enabled":this.privateEnabled,"sb-enabled":this.userIsSubscribed,"siri-initiated":this.siriInitiated,"source-type":this.sourceType,"store-front":this.storefrontId,"user-agent":this.userAgent,"utc-offset-in-seconds":this.utcOffsetInSeconds},conditionalObject(!this.preferDSID,"user-token",this.musicUserToken)),buildObject("device-name",this._deviceName)),buildObject("guid",this.guid))},PlayActivityBase}(),pipe=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return n.reduce((function(t,n){return n(t)}),t)},Je=["uploadedVideo","uploadedAudio","uploaded-videos","uploaded-audios"],isAUC=function(t){return void 0!==t&&Je.includes(t)},isLiveStream=function(t){return function(t){return t.itemType===xe.STREAM}(t)&&!function(t){return t.descriptor.streamingKind===Fe.EPISODE}(t)},updatedDataByEventType=function(t,n){switch(n["event-type"]){case Le.PLAY_START:return function(t){var n={};return isLiveStream(t)&&(n["start-position-in-milliseconds"]=0),!1===t.previous&&t.isAlexa?n["event-reason-hint-type"]=Ne.NOT_SPECIFIED:n["event-reason-hint-type"]=t.containerChanged?Ne.CONTAINER_CHANGED:Ne.NOT_SPECIFIED,n}(t);case Le.PLAY_END:return function(t,n){var l,d=t.descriptor,p=d.endPositionInMilliseconds,h=d.startPositionInMilliseconds,f=t.previous;if(f&&void 0===f.position)return{};var y=n["start-position-in-milliseconds"],v={"end-position-in-milliseconds":p||y,"end-reason-type":t.endReasonType};if(isLiveStream(t))return __assign$2(__assign$2({},v),{"media-duration-in-milliseconds":0,"start-position-in-milliseconds":0});var g=y>n["media-duration-in-milliseconds"],m=f&&void 0!==f.position?Math.round(1e3*f.position):0;return __assign$2(__assign$2(__assign$2({},v),buildObject("media-duration-in-milliseconds",g?y:void 0)),{"start-position-in-milliseconds":null!==(l=null!=h?h:m)&&void 0!==l?l:0})}(t,n);default:return{}}},byEventType=function(t){var n=t.state,l=t.data;return{state:n,data:__assign$2(__assign$2({},l),updatedDataByEventType(n,l))}},byItemType=function(t){var n=t.data,l=t.state,d=l.itemType,p=__assign$2({},n);return isLiveStream(l)&&(p["media-duration-in-milliseconds"]=0),d===xe.AGGREGATE_NON_CATALOG_PLAY_TIME&&(p["start-position-in-milliseconds"]=0,p["utc-offset-in-seconds"]=0,delete p.ids,delete p["container-ids"],delete p["container-type"],delete p["reco-data"],delete p["feature-name"],p["play-mode"]&&(p["play-mode"]={"auto-play-mode":Me.AUTO_UNKNOWN,"repeat-play-mode":Ce.REPEAT_UNKNOWN,"shuffle-play-mode":Oe.SHUFFLE_UNKNOWN})),{state:l,data:p}},buildContainerIds=function(t,n){switch(t){case Ee.ALBUM:return function(t){var n={};return n["container-ids"]=ae(t.id)?{"cloud-album-id":t.id}:{"album-adam-id":t.id},n}(n);case Ee.PLAYLIST:return function(t){var n={};return t.isLibrary&&(t.catalogId||t.globalId)?(n["container-ids"]={"global-playlist-id":t.catalogId||t.globalId},void 0!==t.id&&""!==t.id&&(n["container-ids"]["universal-library-id"]=t.id)):n["container-ids"]=ae(t.id)?{"universal-library-id":t.id}:{"global-playlist-id":t.id},void 0!==t.versionHash&&""!==t.versionHash&&(n["container-ids"]["playlist-version-hash"]=t.versionHash),n}(n);case Ee.RADIO:return function(t){var n={};return n["container-ids"]={"station-id":t.id},Ye.test(t.id)&&(n["container-ids"]["station-personalized-id"]=parseInt(t.id.replace(Ye,"$1"),10)),void 0!==t.stationHash&&""!==t.stationHash&&(n["container-ids"]["station-hash"]=t.stationHash),n}(n);default:return{}}},buildDataByType=function(t){var n=function(t){var n=t.type;if("number"==typeof n)return n;switch(n){case"album":case"albums":case"library-albums":return Ee.ALBUM;case"artist":case"artists":case"library-artists":return Ee.ARTIST;case"playlist":case"playlists":case"library-playlists":return Ee.PLAYLIST;case"radio":case"radioStation":case"station":case"stations":return Ee.RADIO;default:return Ee.UNKNOWN}}(t);return 0===n?{}:__assign$2({"container-type":n},buildContainerIds(n,t))},updatedDataFromContainer=function(t){var n=t.descriptor.container;return void 0===n?{}:__assign$2({"feature-name":""+(n.name||Ie.MUSICKIT)},buildDataByType(n))},buildDataFromContainer=function(t){var n=t.data,l=t.state;return{state:l,data:__assign$2(__assign$2({},n),updatedDataFromContainer(l))}},Xe=t.PlayActivityEndReasonType,Ze={exit:Xe.EXITED_APPLICATION,next:Xe.TRACK_SKIPPED_FORWARDS,pause:Xe.PLAYBACK_MANUALLY_PAUSED,playbackfinished:Xe.NATURAL_END_OF_TRACK,playbackstopped:Xe.PLAYBACK_MANUALLY_PAUSED,previous:Xe.TRACK_SKIPPED_BACKWARDS,scrub_begin:Xe.SCRUB_BEGIN,scrub_end:Xe.SCRUB_END,stop:Xe.NATURAL_END_OF_TRACK},convertEventString=function(t,n){var l=function(t){return t.toLowerCase()}(t);return __assign$2(__assign$2({},function(t){return{eventType:"play"===t||"playbackstarted"===t?Le.PLAY_START:Le.PLAY_END}}(l)),buildObject("endReasonType",function(t,n){return null!=n?n:Ze[t]}(l,n)))},defaultCatalogId=function(t){var n=t.catalogId,l=t.container;return n||l&&l.catalogId},defaultMediaType=function(t){var n=t.kind,l=t.mediaType;if("number"==typeof l)return l;var d="string"==typeof l?l:n;return d&&/video/i.test(d)?Ue.VIDEO:Ue.AUDIO},defaultPrevious=function(t,n){var l=n;if(!1!==l&&t.eventType===Le.PLAY_END&&void 0===n)throw new Error("Cannot build() for PLAY_END descriptors without previous descriptors");return l},defaultItemType=function(t){var n=t.itemType,l=t.kind;return"stream"===t.format?xe.STREAM:isAUC(l)?xe.ARTIST_UPLOADED_CONTENT:void 0!==n?n:xe.ITUNES_STORE_CONTENT},initialBuildData=function(n,l,d,p){var h=function(t){if(void 0===t)throw new Error("build() called without a play activity descriptor");return"string"!=typeof t.eventType?t:__assign$2(__assign$2({},t),convertEventString(t.eventType,t.endReasonType))}(l),f=function(t,n,l){return{catalogId:defaultCatalogId(t),cloudId:t.cloudId,containerChanged:!1,descriptor:t,endReasonType:t.endReasonType,isAlexa:l,itemType:defaultItemType(t),mediaType:defaultMediaType(t),previous:defaultPrevious(t,n)}}(h,d,p),y=h.eventType,v=void 0===y?Le.PLAY_START:y,g=function(n){var l=n.descriptor,d={},p=__assign$2({},n),h=l.container,f=l.eventType,y=void 0===f?Le.PLAY_START:f,v=l.id,g=l.isLibrary,m=l.purchasedId,_=l.reporting;if("-1"!==v&&(void 0===_||_))We.test(v)||h&&"radioStation"===h.kind?d["radio-adam-id"]=parseInt(v.replace(We,"$1"),10):isAUC(l.kind)?d["auc-adam-id"]=l.id:g&&p.catalogId?(d["subscription-adam-id"]=p.catalogId,void 0!==v&&""!==v&&(p.cloudId=v)):g||ae(v)?p.cloudId=v:d["subscription-adam-id"]=v;else switch(y){case Le.PLAY_END:p.endReasonType=t.PlayActivityEndReasonType.NOT_APPLICABLE,p.itemType=xe.AGGREGATE_NON_CATALOG_PLAY_TIME;break;case Le.PLAY_START:"-1"===v?p.itemType=xe.INVALID:void 0!==v&&""!==v&&(p.cloudId=v)}return void 0!==p.cloudId&&(d["cloud-id"]=p.cloudId),void 0!==m&&(d["purchased-adam-id"]=m),Object.keys(d).length>0?{ids:d,newState:p}:{newState:p,ids:void 0}}(f),m=g.ids;return(f=g.newState).containerChanged=function(t,n){var l=t.container,d=n.previous;return void 0!==l&&(void 0===l.type&&void 0!==l.kind&&(l.type=l.kind),void 0===d||!1===d||void 0===d.container||d.container.id!==l.id)}(h,f),{data:__assign$2(__assign$2(__assign$2(__assign$2(__assign$2(__assign$2(__assign$2({},n),function(t){var n=t.duration,l=void 0===n?0:n,d=t.position,p=void 0===d?0:d,h=t.timestamp,f=t.startPositionInMilliseconds;return{"media-duration-in-milliseconds":Math.round(1e3*l),"milliseconds-since-play":void 0!==h?Date.now()-h:0,"start-position-in-milliseconds":f||Math.round(1e3*p)}}(f.descriptor)),function(t){var n,l,d,p=t.playMode;return void 0===p?{}:{"play-mode":{"auto-play-mode":null!==(n=p.autoPlayMode)&&void 0!==n?n:0,"repeat-play-mode":null!==(l=p.repeatPlayMode)&&void 0!==l?l:0,"shuffle-play-mode":null!==(d=p.shufflePlayMode)&&void 0!==d?d:0}}}(f.descriptor)),buildObject("guid",f.descriptor.guid)),buildObject("ids",m)),buildObject("reco-data",f.descriptor.recoData)),{"event-type":v,"media-type":f.mediaType,type:f.itemType}),state:f}},et=function(){function DeveloperToken(t){if(this.token=t,!t||!/^[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}/i.test(t))throw new Error("Invalid token.");var n=__read$1(t.split("."),2),l=n[0],d=n[1],p=this._decode(d),h=p.exp,f=p.iss;if(this.expiration=1e3*h,this.isExpired)throw new Error("Initialized with an expired token.");this.teamId=f;var y=this._decode(l).kid;this.keyId=y}return Object.defineProperty(DeveloperToken.prototype,"isExpired",{get:function(){return this.expiration<Date.now()},enumerable:!0,configurable:!0}),DeveloperToken.prototype._decode=function(t){return JSON.parse(ue(t))},DeveloperToken}(),tt=["trace","debug","info","warn","error"],isTopicLog=function(t){return"object"==typeof t&&null!==t&&"string"==typeof t.topic},Nonsole=function(){};tt.forEach((function(t){Nonsole.prototype[t]=function(){}}));var rt=new Nonsole,getConsole=function(){return"undefined"==typeof console?rt:console},it="undefined"==typeof localStorage?void 0:localStorage,getConfiguredLevel=function(t,n){return void 0===t&&(t="mk-debug"),void 0===n&&(n=tt.length),parseInt(nt(t,n),10)},nt=memoize((function(t,n){var l,d;return null!==(d=null===(l=null==it?void 0:it.getItem)||void 0===l?void 0:l.call(it,t))&&void 0!==d?d:""+n})),canLogLevel=function(t,n){return-1!==getAllowedLevels(getConfiguredLevel(n)).indexOf(t)},getAllowedLevels=function(t){return isNaN(t)||t<0?[]:tt.slice(t)},canLogTopic=function(t,n){var l,d,p=(void 0===(l=n)&&(l="mk-debug-topic"),void 0===d&&(d="*"),nt(l,d));return ot(p).some((function(n){return n.test(t)}))},ot=memoize((function(t){return t.split(/[\s,]+/).map((function(t){var n=t.replace(/\*/g,".*?");return new RegExp("^"+n+"$")}))})),trace=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return logMessage.apply(void 0,__spread$1([ne({level:"trace"},t)],n))},debug=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return logMessage.apply(void 0,__spread$1([ne({level:"debug"},t)],n))},warn=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return logMessage.apply(void 0,__spread$1([ne({level:"warn"},t)],n))},error=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return logMessage.apply(void 0,__spread$1([ne({level:"error"},t)],n))},log=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return logMessage.apply(void 0,__spread$1([t],n))},logMessage=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];var d=t.level,p=t.levelKey,h=t.topic,f=t.topicKey;if(canLogLevel(d=null!=d?d:"debug",p)&&canLogTopic(h,f)){var y=getConsole();if("function"==typeof y[d]){var v=__read$1(n),g=v[0],m=v.slice(1);void 0!==h&&(g=h+": "+g),y[d].apply(y,__spread$1([g],m))}}},at=function(){function Logger(t){var n,l,d,p;this._levelFilterKey="mk-debug","string"==typeof t?(this._levelFilterKey=t,this.level=getConfiguredLevel(this._levelFilterKey,5)):"object"==typeof t?(this._levelFilterKey=null!==(n=t.levelFilterStorageKey)&&void 0!==n?n:this._levelFilterKey,this._topicFilterKey=null!==(l=t.topicFilterStorageKey)&&void 0!==l?l:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey),this.topic=t.topic,this.level=null!==(d=t.level)&&void 0!==d?d:getConfiguredLevel(this._levelFilterKey,5)):this.level=null!=t?t:getConfiguredLevel(this._levelFilterKey,5),this._topicFilterKey=null!==(p=this._topicFilterKey)&&void 0!==p?p:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey)}return Object.defineProperty(Logger.prototype,"enabled",{get:function(){return this.level<5},set:function(t){this.level=t?1:5},enumerable:!0,configurable:!0}),Logger.prototype.debug=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];this.callLogMethod.apply(this,__spread$1([debug,t],n))},Logger.prototype.error=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];this.callLogMethod.apply(this,__spread$1([error,t],n))},Logger.prototype.log=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];this.callLogMethod.apply(this,__spread$1([log,t],n))},Logger.prototype.trace=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];this.callLogMethod.apply(this,__spread$1([trace,t],n))},Logger.prototype.warn=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];this.callLogMethod.apply(this,__spread$1([warn,t],n))},Logger.prototype.callLogMethod=function(t,n){for(var l,d,p=[],h=2;h<arguments.length;h++)p[h-2]=arguments[h];var f={levelKey:this._levelFilterKey,topicKey:this._topicFilterKey,topic:this.topic},y=n;isTopicLog(n)&&(f.topic=null!==(l=n.topic)&&void 0!==l?l:f.topic,y=null!==(d=n.message)&&void 0!==d?d:p.shift()),t.apply(void 0,__spread$1([f,y],p))},Logger.prototype.generateDefaultTopicFilterStorageKey=function(t){return t+"-topic"},Logger}(),st=function(){function FetchSession(t){void 0===t&&(t={}),this.baseURL=t.baseURL,this.baseOptions=t.baseOptions,this.fetchFunction=t.fetchFunction||fetch.bind(window)}return FetchSession.prototype.fetch=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var l=__read$1(t,2),d=l[0],p=l[1];if("undefined"!=typeof Request&&d instanceof Request)return this.fetchFunction(d,p);var h=addPathToURL(this.baseURL,d),f=mergeFetchOptions(this.baseOptions,p);return this.fetchFunction(h,f)},FetchSession}(),ut=function(){function GenericStorage(t){void 0===t&&(t={}),this.data=t}return Object.defineProperty(GenericStorage.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(GenericStorage.prototype,"length",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(GenericStorage.prototype,"keys",{get:function(){return Object.keys(this.data)},enumerable:!0,configurable:!0}),GenericStorage.prototype.getItem=function(t){return this.data[t]||null},GenericStorage.prototype.setItem=function(t,n){this.data[t]=n},GenericStorage.prototype.removeItem=function(t){delete this.data[t]},GenericStorage.prototype.clear=function(){var t=this;this.keys.forEach((function(n){return t.removeItem(n)}))},GenericStorage.prototype.key=function(t){return this.keys[t]||null},GenericStorage}();function getCookie(t,n){void 0===t&&(t=""),void 0===n&&(n=document.cookie);var l=n.match(new RegExp("(?:^|;\\s*)"+t+"=([^;]*)"));if(l)return l[1]}function setCookie(t,n,l,d,p,h){void 0===l&&(l=""),void 0===d&&(d=14);var f=new Date;p=null!=p?p:window;var y=(h=null!=h?h:/\./.test(p.location.hostname)?p.location.hostname:"").length>0?"domain="+h+"; ":"";f.setTime(f.getTime()+24*d*60*60*1e3),p.document.cookie=t+"="+n+"; expires="+f.toUTCString()+"; "+y+"path="+l}function removeCookie(t,n,l){setCookie(t,"","/",0,n,l)}var ct,DEFAULT_CACHE_KEY_FUNCTION=function(t,n){return""+n+t},lt=function(){function NetworkCache(t){void 0===t&&(t={}),this.storage=t.storage||new ut,this.prefix=t.prefix||"ï£¿",this.ttl=t.ttl||3e5,this.cacheKeyFunction=t.cacheKeyFunction||DEFAULT_CACHE_KEY_FUNCTION}return NetworkCache.prototype.getItem=function(t){var n=this.cacheKeyForPath(t),l=this.storage.getItem(n);if(null!==l){var d=JSON.parse(l),p=d.x,h=d.d;if(p>Date.now())return h;this.storage.removeItem(n)}},NetworkCache.prototype.setItem=function(t,n,l){void 0===l&&(l=this.ttl);var d=this.cacheKeyForPath(t);this.storage.setItem(d,JSON.stringify({x:Date.now()+l,d:n}))},NetworkCache.prototype.removeItem=function(t){var n=this.cacheKeyForPath(t);this.storage.removeItem(n)},NetworkCache.prototype.removeItemsMatching=function(t,n){void 0===n&&(n=!0);var l=this.cacheKeyForPath(t);this.removeItemsMatchingCacheKey(l,n)},NetworkCache.prototype.clear=function(){this.removeItemsMatchingCacheKey(this.prefix,!1)},NetworkCache.prototype.removeItemsMatchingCacheKey=function(t,n){var l=this,d=new RegExp("^"+t+(n?"$":""));(this.storage instanceof ut?this.storage.keys:Object.keys(this.storage)).forEach((function(t){t&&d.test(t)&&l.storage.removeItem(t)}))},NetworkCache.prototype.cacheKeyForPath=function(t){return this.cacheKeyFunction(t,this.prefix)},NetworkCache}();!function(t){t.JSON="application/json",t.FORM="application/x-www-form-urlencoded"}(ct||(ct={}));var dt,pt=function(t){function TokenSession(n,l,d){var p=t.call(this,n,d)||this;return p._developerToken=new et(l),p.headers.set("Authorization","Bearer "+p.developerToken),d=d||{},p.userToken=d.userToken,p.userToken&&p.headers.set("Media-User-Token",p.userToken),p}return __extends$1(TokenSession,t),Object.defineProperty(TokenSession.prototype,"developerToken",{get:function(){return this._developerToken.token},enumerable:!0,configurable:!0}),TokenSession}(function(){function URLSession(t,n){if(this.prefix="ï£¿",this.method="GET",this.url=t,(n=n||{}).storage&&n.underlyingStorage)throw new Error("only pass storage OR underlyingStorage in sessionOptions to URLSession");var l=n.underlyingStorage||{};this.storage=n.storage||new ut(l),this.networkCache=new lt({storage:this.storage,prefix:this.prefix,cacheKeyFunction:this._key.bind(this)}),this.ttl=n.ttl||3e5,this.fetchSession=new st({fetchFunction:n.fetch}),this._fetchOptions=ne({},n.fetchOptions),this.headers=this._fetchOptions.headers||new Headers,delete this._fetchOptions.headers}return URLSession.prototype.clearCacheForRequest=function(t,n){"object"==typeof t&&(n=t,t=void 0);var l=this.constructURL(t,n);this.networkCache.removeItemsMatching(l)},URLSession.prototype.request=function(t,n,l){return __awaiter$1(this,void 0,void 0,(function(){var d,p,h,f,y,v,g,m,_,b;return __generator$1(this,(function(P){switch(P.label){case 0:return l||"object"!=typeof t||(l=n||{},n=t,t=void 0),l=ne(ne({method:this.method,headers:this.headers,reload:!1},this._fetchOptions),l),d={},"object"==typeof l.queryParameters?(d=l.queryParameters,delete l.queryParameters):"GET"===l.method&&(d=n),p=this.constructURL(t,d),h=l.method,f=l.reload,y=void 0!==f&&f,v=l.useRawResponse,l.headers=this.buildHeaders(l),delete l.reload,delete l.useRawResponse,"GET"===h&&!y&&(g=this.getCacheItem(p))?[2,Promise.resolve(g)]:(n&&Object.keys(n).length&&("POST"===h||"PUT"===h)&&(l.body=l.body||n,l.contentType===ct.FORM?(l.body=urlEncodeParameters(l.body),l.headers.set("Content-Type",ct.FORM)):(l.body=JSON.stringify(l.body),l.headers.set("Content-Type",ct.JSON))),[4,this.fetchSession.fetch(p,l)]);case 1:if(!(m=P.sent()).ok)return[2,Promise.reject(m)];P.label=2;case 2:return P.trys.push([2,4,,5]),[4,m.json()];case 3:return _=P.sent(),[3,5];case 4:return P.sent(),_={},[3,5];case 5:return _.errors?[2,Promise.reject(_.errors)]:(b=v?_:_.results||_.data||_,"GET"===h&&this.setCacheItem(p,b),[2,b])}}))}))},URLSession.prototype.buildHeaders=function(t){var n=void 0===t?{}:t,l=n.headers,d=n.reload,p=void 0!==d&&d;void 0===l&&(l=this.headers);var h=function(t){return new t.constructor(t)}(l);return p&&h.set("Cache-Control","no-cache"),h},URLSession.prototype.constructURL=function(t,n){return function(t,n,l){return addQueryParamsToURL(addPathToURL(t,n),l)}(this.url,t,n)},URLSession.prototype.getCacheItem=function(t){var n=this.networkCache.storage,l=""+this.prefix+this.prefix+"cache-mut",d=n.getItem(l)||null,p=this.headers.get("Music-User-Token")||this.headers.get("Media-User-Token")||null;return p!==d&&(this.networkCache.clear(),null===p?n.removeItem(l):n.setItem(l,p)),this.networkCache.getItem(t)},URLSession.prototype.setCacheItem=function(t,n,l){void 0===l&&(l=this.ttl),this.networkCache.setItem(t,n,l)},URLSession.prototype.clearNetworkCache=function(){this.networkCache.clear()},URLSession.prototype._key=function(t,n){var l=function(t){try{var n=__read$1(t.split("?",2),2),l=n[0],d=n[1];if(void 0===d)return l;var p=d.split("&").map((function(t){return t.split("=",2)})),h=__spread$1(Array(p.length).keys());return h.sort((function(t,n){var l=p[t],d=p[n];return l<d?-1:l>d?1:t-n})),l+"?"+h.map((function(t){return p[t]})).map((function(t){var n=__read$1(t,2),l=n[0],d=n[1];return void 0!==d?l+"="+d:l})).join("&")}catch($t){return t}}(t).toLowerCase().replace(this.url,"");return""+this.prefix+l.replace(/[^-_0-9a-z]{1,}/g,".")},URLSession}()),ht=Date.now(),ft=isNodeEnvironment()?function(){var t=__read$1(process.hrtime(),2),n=t[0],l=t[1];return Math.floor(1e3*n+1e-6*l)}:function(){var t,n;return null!==(n=null===(t=null===performance||void 0===performance?void 0:performance.now)||void 0===t?void 0:t.call(performance))&&void 0!==n?n:Date.now()-ht},formatByte=function(t){return("0"+(255&t).toString(16)).slice(-2)},toHexString=function(t,n){if(void 0===n&&(n=8),!(t instanceof Uint8Array))return"";var l=Array.prototype.map.call(t,formatByte).join("");return 0===n?l:l.replace(new RegExp("(.{1,"+n+"})","g"),"$1 ").trim()},typeByTimedMetadata=function(t){var n=t.state.descriptor.itemType;return n===xe.TIMED_METADATA_PING?n:xe.STREAM},byTimedMetadata=function(n){var l=n.data,d=n.state,p=d.descriptor.timedMetadata;return void 0===p?{data:l,state:d}:function(n){var l=n.state.descriptor,d=l.endReasonType,p=l.eventType;return l.itemType===xe.TIMED_METADATA_PING||p===Le.PLAY_START||d===t.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED}({data:l,state:d})?{state:d,data:__assign$2(__assign$2({},l),{type:typeByTimedMetadata({data:l,state:d}),"timed-metadata":toHexString(p,8)})}:{data:l,state:d}},buildPlayActivityData=function(t,n,l,d){if(void 0===d&&(d=!1),void 0===n)throw new Error("called without a play activity descriptor");return pipe(initialBuildData(t,n,l,d),byEventType,buildDataFromContainer,byItemType,byTimedMetadata)},dataFromLyrics=function(t){var n=t.state.descriptor.lyricDescriptor,l=t.data.ids;return void 0===n?{}:__assign$2(__assign$2({"display-type":n.displayType,"end-position-in-milliseconds":n.duration},buildObject("lyric-language",n.language)),{ids:__assign$2(__assign$2({},l),{"lyric-id":n.id})})},forLyrics=function(t){var n=t.state,l=t.data;return{state:n,data:__assign$2(__assign$2({},l),dataFromLyrics({state:n,data:l}))}},buildPlayActivityData$1=function(t,n,l){if(void 0===n)throw new Error("called without a play activity descriptor");return pipe(buildPlayActivityData(t,n,l,!1),(d={"event-type":Le.LYRIC_DISPLAY,"feature-name":"now_playing","media-duration-in-milliseconds":0,"media-type":Ue.AUDIO,"start-position-in-milliseconds":0,"play-mode":{"auto-play-mode":0,"repeat-play-mode":0,"shuffle-play-mode":0}},function(t){var n=t.state,l=t.data;return{state:n,data:__assign$2(__assign$2({},l),d)}}),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){var l,d,p=n.state,h=n.data,f=__assign$2({},h);try{for(var y=__values$1(t),v=y.next();!v.done;v=y.next()){delete f[v.value]}}catch(g){l={error:g}}finally{try{v&&!v.done&&(d=y.return)&&d.call(y)}finally{if(l)throw l.error}}return{state:p,data:f}}}("character-display-count","event-reason-hint-type","reco-data"),forLyrics);var d};!function(t){function LyricsPlayActivity(n,l,d,p){var h=t.call(this,n,l,d,p)||this;return h._machine=f$3(c({id:"lpaf",initial:"idle",context:{initialShowTime:-1,duration:-1},states:{idle:{entry:r((function(t){return __assign$2(__assign$2({},t),{initialShowTime:void 0,duration:ft()-t.initialShowTime})})),on:{play:"playing"}},playing:{entry:r((function(t){return __assign$2(__assign$2({},t),{initialShowTime:ft()})})),on:{stop:"idle"}}}})).start(),h}__extends$2(LyricsPlayActivity,t),LyricsPlayActivity.prototype.exit=function(){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(t){return[2]}))}))},LyricsPlayActivity.prototype.play=function(t){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(n){if(this.stateMatches("playing"))throw Error("lyrics are already being displayed. Did you forget to stop them?");return this._previousDescriptor=t,this._machine.send({type:"play"}),[2]}))}))},LyricsPlayActivity.prototype.stop=function(){return __awaiter$2(this,void 0,void 0,(function(){var t,n;return __generator$2(this,(function(l){switch(l.label){case 0:if(this.stateMatches("idle"))throw Error("lyrics are not being displayed. Did you forget to display them?");if(void 0===this._previousDescriptor)throw Error("something went wrong: client can send a stop but there is no previous descriptor");this._machine.send({type:"stop"}),(t=JSON.parse(JSON.stringify(this._previousDescriptor))).lyricDescriptor=__assign$2(__assign$2({},t.lyricDescriptor),{duration:this._machine.state.context.duration}),n=this.build(t,this._previousDescriptor),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,this.send(n)];case 2:return l.sent(),[3,4];case 3:return this._previousDescriptor=t,[7];case 4:return[2]}}))}))},LyricsPlayActivity.prototype.stateMatches=function(t){return this._machine.state.matches(t)},LyricsPlayActivity.prototype.build=function(t,n){return buildPlayActivityData$1(this.generateBaseActivityData(),t,n).data}}(Qe);!function(t){t[t.ALEXA=13]="ALEXA"}(dt||(dt={}));!function(){function PlayActivity(t,n,l){this.accessToken=t,this.storefrontId=n,this.baseVersion=1,this.clientId="JSCLIENT",this.eventType="play",this.sourceType=dt.ALEXA,this.topic="xp_amp_podcasts_play",this.utcOffset=(new Date).getTimezoneOffset(),this._isQA=!1,this._logInfo=!1,this._appInfo=l.app,this._fetch=l.fetch,this._fetchOptions=l.fetchOptions,l.fetch&&l.fetch.Headers&&(this._headersClass=l.fetch.Headers),this._isQA=l.isQA||!1,this._logInfo=l.logInfo||this._isQA||!1,this._osInfo=l.os,this._userAgent=l.userAgent,void 0!==l.baseVersion&&(this.baseVersion=l.baseVersion),void 0!==l.clientId&&(this.clientId=l.clientId),this.guid=l.guid,this.ipAddress=l.ip,this.sourceType=l.sourceType||dt.ALEXA,this.utcOffset=l.utcOffset}Object.defineProperty(PlayActivity.prototype,"appName",{get:function(){return this._appInfo&&void 0!==this._appInfo.name?this._appInfo.name:"MusicKitApp"},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"appVersion",{get:function(){return this._appInfo&&void 0!==this._appInfo.version?this._appInfo.version:"1.0"},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"fetch",{get:function(){return this._fetch},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"Headers",{get:function(){return this._headersClass},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"logInfo",{get:function(){return this._logInfo},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"os",{get:function(){return this._osInfo&&void 0!==this._osInfo.name?this._osInfo.name:"Unidentified OS"},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"osVersion",{get:function(){return this._osInfo&&void 0!==this._osInfo.version?this._osInfo.version:"0.0"},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"url",{get:function(){return(this._isQA?"https://amp-mt-ingestion-service.itunes.apple.com/report/2":"https://xp.apple.com/report/2")+"/"+this.topic},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"userAgent",{get:function(){return this._userAgent},enumerable:!0,configurable:!0}),PlayActivity.prototype.buildForPlayParams=function(t,n,l,d,p){if(void 0===d&&(d=0),void 0===p&&(p={}),"play"!==n)throw new Error("buildForPlayParams() only valid on play event");var h={app:this.appName,appVersion:this.appVersion,baseVersion:this.baseVersion,clientId:this.clientId,ip:this.ipAddress,os:this.os,osVersion:this.osVersion,storeFront:this.storefrontId,timezoneOffset:this.utcOffset,topic:this.topic,userAgent:this.userAgent},f=t.actionType,y=t.durationInMilliseconds,v=t.eventTime,g=void 0===v?Date.now():v,m=t.eventVersion,_=void 0===m?"1":m,b=t.feedUrl,P=t.guid,k=t.id,T=t.itemType,S=t.mediaKind,A=t.playbackSpeed,w=t.playEndPosition,I=t.playId,E=t.playStartPosition,R=t.playStartTime,C=t.postTime,O="audio"===S||"video"===S?S:"unknown",M={actionType:f,contentGUID:P,contentId:k,contentLength:y/1e3,eventTime:g||Date.now(),eventType:n,eventVersion:_,itemType:T,language:l.language,mediaType:O,playbackSpeed:A,playDuration:d,playEndPosition:w,playId:I,playStartPosition:E,playStartTime:R,podcastFeedURL:b,podcastId:l.id,podcastState:l.state,postTime:C||g||Date.now()};return __assign$2(__assign$2(__assign$2({},h),M),p)},PlayActivity.prototype.send=function(t){return __awaiter$2(this,void 0,void 0,(function(){var n,l,d,p;return __generator$2(this,(function(h){switch(h.label){case 0:if(n=new this.Headers({Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}),l=t.postTime,delete t.postTime,0===(d={postTime:l,events:ensureArray(t)}).events.length)throw new Error("send() called without any data");return p=__assign$2({method:"POST",body:JSON.stringify(d),headers:n},void 0!==this._fetchOptions&&this._fetchOptions),[4,this.fetch(this.url,p)];case 1:return[4,h.sent().text()];case 2:return h.sent(),this._logInfo&&console.info("play activity:",this.sourceType===dt.ALEXA?JSON.stringify(d):d),[2,d]}}))}))}}();var yt,createCookieJar=function(t){switch(void 0===t&&(t="browser"),t){case"browser":return{get:getCookie,set:setCookie};case"memory":return void 0===n&&(n={}),{get:function(t){if(void 0!==t)return n[t]},set:function(t,l){n[t]=l}};default:return t}var n},empty=function(t,n){return write(t,n,[],"/",0)},read=function(t,n){var l=t.get(n);return void 0===l||""===l?[]:ensureArray(JSON.parse(atob(l)))},write=function(t,n,l,d,p,h){return t.set(n,btoa(JSON.stringify(l)),d,p,h)},update=function(t,n,l,d,p,h){return write(t,n,function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(__read$2(arguments[n]));return t}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */(read(t,n),[l]),d,p,h)},vt=Be.AUTO,gt=function(){function PlayActivityBatchableSender(t,n){this.sender=t,this.jar=n,this.mode=vt}return PlayActivityBatchableSender.prototype.flush=function(){return __awaiter$2(this,void 0,void 0,(function(){var t,n,l;return __generator$2(this,(function(d){switch(d.label){case 0:if(void 0===(t=read(this.jar,"amupaee"))||0===t.length)return[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.sender.send(t)];case 2:return d.sent(),empty(this.jar,"amupaee"),[3,4];case 3:throw n=d.sent(),l=n.message,new Error("flush: "+l);case 4:return[2]}}))}))},PlayActivityBatchableSender.prototype.send=function(n){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){return this.mode!==vt||!Array.isArray(n)&&n["end-reason-type"]===t.PlayActivityEndReasonType.EXITED_APPLICATION?(update(this.jar,"amupaee",n,"/"),[2]):[2,this.sender.send(n)]}))}))},PlayActivityBatchableSender}(),mt=function(){function Timeline(){this._events={},this._keys=[]}return Object.defineProperty(Timeline.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),Object.defineProperty(Timeline.prototype,"first",{get:function(){return this.at(0)},enumerable:!0,configurable:!0}),Object.defineProperty(Timeline.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),Object.defineProperty(Timeline.prototype,"last",{get:function(){return this.at(this.length-1)},enumerable:!0,configurable:!0}),Object.defineProperty(Timeline.prototype,"length",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(Timeline.prototype,"second",{get:function(){return this.at(1)},enumerable:!0,configurable:!0}),Timeline.prototype.at=function(t){if(t>this.length-1)throw new Error("Invalid timeline index");var n=this._keys[t];return this._events[n]},Timeline.prototype.before=function(t){if("number"!=typeof t){var n=[];for(var l in this._events)this._events.hasOwnProperty(l)&&n.push(this._events[l]);t=this._keys[n.indexOf(t)]}var d=this._keys.indexOf(t);if(-1===d)throw new Error("Key not found");if(d>0)return this._events[this._keys[d-1]]},Timeline.prototype.drain=function(){var t=this,n=this._keys.map((function(n){return t._events[n]}));return this.reset(),n},Timeline.prototype.reset=function(){this._events={},this._keys=[]},Timeline.prototype.pop=function(){return __awaiter$2(this,void 0,void 0,(function(){var t,n;return __generator$2(this,(function(l){return void 0===(t=this._keys.pop())?[2,Promise.reject("TIMELINE IS EMPTY")]:(n=this._events[t],delete this._events[t],[2,Promise.resolve(n)])}))}))},Timeline.prototype.add=function(t,n){return __awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){return[2,this.push(t,n)]}))}))},Timeline.prototype.push=function(t,n){return void 0===n&&(n=Date.now()),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){for(;-1!==this._keys.indexOf(n);)n++;return this._events[n]=t,this._keys.push(n),[2,Promise.resolve(n)]}))}))},Timeline.prototype.shift=function(){return __awaiter$2(this,void 0,void 0,(function(){var t,n;return __generator$2(this,(function(l){return void 0===(t=this._keys.shift())?[2,Promise.reject("TIMELINE IS EMPTY")]:(n=this._events[t],delete this._events[t],[2,Promise.resolve(n)])}))}))},Timeline.prototype.unshift=function(t,n){return void 0===n&&(n=Date.now()),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){for(;-1!==this._keys.indexOf(n);)n++;return this._events[n]=t,this._keys.unshift(n),[2,Promise.resolve(n)]}))}))},Timeline}(),_t=new at,fieldGetter=function(t,n){return function(l){return n in l?l[n]:l[t]}},bt=fieldGetter("eventType","event-type"),Pt=fieldGetter("endReasonType","end-reason-type"),createMPAFMachine=function(){return c({id:"mpaf",initial:"idle",context:{},states:{error:{},idle:{on:{play:"playing",scrubBegin:{target:"scrubbing",actions:r((function(t){return __assign$2(__assign$2({},t),{stateBeforeScrub:"idle"})}))},scrubEnd:{target:"error",actions:["clearStateBeforeScrub","setScrubEndError"]}}},playing:{on:{scrubBegin:{target:"scrubbing",actions:r((function(t){return __assign$2(__assign$2({},t),{stateBeforeScrub:"playing"})}))},stop:"idle",scrubEnd:{target:"error",actions:["clearStateBeforeScrub","setScrubEndError"]}}},scrubbing:{on:{scrubEnd:[{target:"idle",cond:function(t){return"idle"===t.stateBeforeScrub},actions:["clearStateBeforeScrub"]},{target:"playing",actions:["clearStateBeforeScrub"]}]}}}},{actions:{clearStateBeforeScrub:r((function(t){t.stateBeforeScrub;return function(t,n){var l={};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&n.indexOf(d)<0&&(l[d]=t[d]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var p=0;for(d=Object.getOwnPropertySymbols(t);p<d.length;p++)n.indexOf(d[p])<0&&Object.prototype.propertyIsEnumerable.call(t,d[p])&&(l[d[p]]=t[d[p]])}return l}(t,["stateBeforeScrub"])})),setScrubEndError:r((function(t){return __assign$2(__assign$2({},t),{errorMessage:"The scrub() method was called with the SCRUB_END action without a previous SCRUB_START descriptor"})}))}})},kt=function(){function MPAFStateMachine(){this.machine=createMPAFMachine(),this.machineService=f$3(this.machine).start()}return MPAFStateMachine.prototype.canSendEvent=function(t){var n;return null!==(n=this.machine.transition(this.machineService.state,t).changed)&&void 0!==n&&n},MPAFStateMachine.prototype.matches=function(t){return this.machineService.state.matches(t)},MPAFStateMachine.prototype.send=function(n){var l=function(n){var l=bt(n),d=Pt(n);switch(l){case Le.PLAY_START:return"play";case Le.PLAY_END:switch(d){case t.PlayActivityEndReasonType.SCRUB_BEGIN:return"scrubBegin";case t.PlayActivityEndReasonType.SCRUB_END:return"scrubEnd";case t.PlayActivityEndReasonType.EXITED_APPLICATION:return!1;default:return"stop"}default:return"stop"}}(n);if(!1!==l&&(this.canSendEvent({type:l})&&this.machineService.send({type:l}),this.matches("error")))throw new Error(this.machineService.state.context.errorMessage)},MPAFStateMachine}(),Tt=function(t){function StatelessPlayActivity(n,l,d,p){return t.call(this,n,l,d,p)||this}return __extends$2(StatelessPlayActivity,t),StatelessPlayActivity.prototype.build=function(t,n){return buildPlayActivityData(this.generateBaseActivityData(),t,n,"JSCLIENT"!==this.clientId).data},StatelessPlayActivity}(Qe),St=function(){function PlayActivity(t,n,l,d){this.timeline=new mt,this._paf=new Tt(t,n,l,d),this._cookieJar=createCookieJar(null==d?void 0:d.cookieJar),this.sender=new gt(this._paf.sender,this._cookieJar),this._machine=new kt}return Object.defineProperty(PlayActivity.prototype,"mode",{get:function(){return this.sender.mode},set:function(t){this.sender.mode=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlayActivity.prototype,"privateEnabled",{get:function(){return this._paf.privateEnabled},set:function(t){this._paf.privateEnabled=t},enumerable:!0,configurable:!0}),PlayActivity.prototype.activate=function(n){return void 0===n&&(n=!1),__awaiter$2(this,void 0,void 0,(function(){var l,d;return __generator$2(this,(function(p){switch(p.label){case 0:if(!n)return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.flush()];case 2:return p.sent(),[3,4];case 3:if(l=p.sent(),!function(t){switch(typeof t){case"string":return t;case"object":return t.message?"string"!=typeof t.message?"":t.message:"";default:return""}}(l).includes("send() called without any data"))throw l;return[3,4];case 4:return(d=this.timeline.last)&&d.endReasonType===t.PlayActivityEndReasonType.EXITED_APPLICATION?[2,this.timeline.pop()]:[2]}}))}))},PlayActivity.prototype.exit=function(n){return void 0===n&&(n=0),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){return[2,this.stop(n,t.PlayActivityEndReasonType.EXITED_APPLICATION)]}))}))},PlayActivity.prototype.pause=function(n){return void 0===n&&(n=0),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(l){return[2,this.stop(n,t.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED)]}))}))},PlayActivity.prototype.pingTimedMetadata=function(n,l,d){return void 0===d&&(d=this._previousDescriptor()),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(p){switch(p.label){case 0:return[4,this._addToTimeline(__assign$2(__assign$2({},d),{position:n,endReasonType:t.PlayActivityEndReasonType.NOT_APPLICABLE,eventType:Le.PLAY_END,itemType:xe.TIMED_METADATA_PING,timedMetadata:l}))];case 1:return p.sent(),[2]}}))}))},PlayActivity.prototype.play=function(n,l){return void 0===l&&(l=0),__awaiter$2(this,void 0,void 0,(function(){var d,p,h,f;return __generator$2(this,(function(y){switch(y.label){case 0:return d=this.timeline.length>0,void 0===n?d?((p=this._previousDescriptor()).eventType===Le.PLAY_END&&delete p.endReasonType,h=__assign$2(__assign$2({},p),{eventType:Le.PLAY_START,timestamp:Date.now()}),[2,this._addToTimeline(h)]):[2]:d?(p=this._previousDescriptor(),this._machine.matches("playing")?(h=__assign$2(__assign$2({},p),{eventType:Le.PLAY_END,endReasonType:t.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM,timestamp:Date.now(),position:l}),[4,this._addToTimeline(h)]):[3,2]):[3,2];case 1:y.sent(),l=0,y.label=2;case 2:return f=__assign$2(__assign$2({},n),{eventType:Le.PLAY_START,timestamp:Date.now(),position:l}),[2,this._addToTimeline(f)]}}))}))},PlayActivity.prototype.scrub=function(n,l){return void 0===n&&(n=0),void 0===l&&(l=t.PlayActivityEndReasonType.SCRUB_BEGIN),__awaiter$2(this,void 0,void 0,(function(){var t,d;return __generator$2(this,(function(p){return t=this._previousDescriptor(),d=__assign$2(__assign$2({},t),{eventType:Le.PLAY_END,endReasonType:l,timestamp:Date.now(),position:n}),[2,this._addToTimeline(d)]}))}))},PlayActivity.prototype.skip=function(n,l,d){return void 0===l&&(l=t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS),void 0===d&&(d=0),__awaiter$2(this,void 0,void 0,(function(){return __generator$2(this,(function(t){switch(t.label){case 0:return[4,this.stop(d,l)];case 1:return t.sent(),[2,this.play(n)]}}))}))},PlayActivity.prototype.stop=function(n,l){return void 0===n&&(n=0),void 0===l&&(l=t.PlayActivityEndReasonType.NATURAL_END_OF_TRACK),__awaiter$2(this,void 0,void 0,(function(){var d,p;return __generator$2(this,(function(h){switch(h.label){case 0:return(d=this._previousDescriptor()).endReasonType!==t.PlayActivityEndReasonType.EXITED_APPLICATION?[3,2]:[4,this.timeline.pop()];case 1:h.sent(),empty(this._cookieJar,"amupaee"),d=this._previousDescriptor(),h.label=2;case 2:return this._machine.matches("playing")?(p=__assign$2(__assign$2({},d),{eventType:Le.PLAY_END,timestamp:Date.now(),endReasonType:l,position:n}),[2,this._addToTimeline(p)]):[2,Promise.reject(new Error("A play stop() method was called without a previous play() descriptor"))]}}))}))},PlayActivity.prototype.build=function(t,n){if(void 0===t&&void 0===n&&_t.warn("You are calling build() from a stateful PAF client. Please, use a stateless client or exit(), pause(), play(), scrub(), skip() or stop() instead."),void 0===t){if(0===this.timeline.length)throw new Error("build() called without a play activity descriptor");t=this.timeline.last}if(void 0===n){if(void 0===(n=this.timeline.before(t))&&t.eventType===Le.PLAY_END)throw new Error("Cannot build() for PLAY_END descriptors without previous descriptors");n=null!=n&&n}return this._paf.build(t,n)},PlayActivity.prototype.addForPlayParams=function(t,n,l,d,p){void 0===d&&(d=0),void 0===p&&(p={});var h=this.buildDescriptorForPlayParams(t,n,l,d,p);return this._addToTimeline(h)},PlayActivity.prototype.buildDescriptorForPlayParams=function(t,n,l,d,p){void 0===d&&(d=0),void 0===p&&(p={});var h="stream"===t.format?xe.STREAM:xe.ITUNES_STORE_CONTENT;return __assign$2(__assign$2(__assign$2({},t),{container:l,duration:d,eventType:n,itemType:h}),p)},PlayActivity.prototype.flush=function(){return this.sender.flush()},PlayActivity.prototype._addToTimeline=function(t){return __awaiter$2(this,void 0,void 0,(function(){var n,l;return __generator$2(this,(function(d){switch(d.label){case 0:return n=this.timeline.length>0&&this.timeline.last,[4,this.timeline.add(t)];case 1:return d.sent(),l=this.build(t,n),[4,this.send(l)];case 2:return d.sent(),[2]}}))}))},PlayActivity.prototype._previousDescriptor=function(){var t=this.timeline.last;if(void 0===t)throw new Error("A method was called without a previous descriptor");return __assign$2({},t)},PlayActivity.prototype.buildForPlayParams=function(t,n,l,d,p,h){return void 0===d&&(d=0),void 0===p&&(p={}),void 0===h&&(h=!1),_t.warn("You are using buildsForPlayParams from a stateful PlayActivity. Please, use StatelessPlayActivity instead"),this._paf.buildForPlayParams(t,n,l,d,p,h)},PlayActivity.prototype.send=function(t){var n=this,l=ensureArray(t);return l.forEach((function(t){return n._machine.send(t)})),this.sender.send(l)},PlayActivity}(),At=/max-age=(\d+)/i;!function(t){t.NONE="none",t.FAIRPLAY="com.apple.fps",t.PLAYREADY="com.microsoft.playready",t.WIDEVINE="com.widevine.alpha"}(yt||(yt={}));var wt=["musicVideo","song","radioStation"];wt.push("podcast-episodes","uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo");var It=function(){function MKDialog(t,n){void 0===n&&(n=""),this._message=t,this._explanation=n,this.id="musickit-dialog",this.scrimId=this.id+"-scrim",this.styleId=this.id+"-style",this._okButtonString="OK",[this.id,this.scrimId,this.styleId].forEach((function(t){try{var n=document.getElementById(t);n.parentElement.removeChild(n)}catch(Vt){}})),this._appendStyle("\n#musickit-dialog {\n  --mk-dialog-background: rgba(255, 255, 255, 1);\n  --mk-dialog-text: rgba(0, 0, 0, 0.95);\n  --mk-dialog-border: rgba(0, 0, 0, 0.07);\n  --mk-dialog-scrim: rgba(255, 255, 255, 0.8);\n  --mk-dialog-primary: rgba(0, 122, 255, 1);\n}\n\n@media (prefers-color-scheme: dark) {\n  #musickit-dialog {\n      --mk-dialog-background: rgba(30, 30, 30, 1);\n      --mk-dialog-text: rgba(255, 255, 255, 0.85);\n      --mk-dialog-border: rgba(255, 255, 255, 0.1);\n      --mk-dialog-scrim: rgba(38, 38, 38, 0.8);\n      --mk-dialog-primary: rgba(8, 132, 255, 1);\n  }\n}\n\n#musickit-dialog-scrim {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.35);\n}\n\n#musickit-dialog * {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  -ms-touch-action: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  font-family: -apple-system, SF UI Text, Helvetica Neue, Helvetica, sans-serif;\n  font-size: 15px;\n  line-height: 20px;\n}\n\n#musickit-dialog *:focus { outline: 0; }\n\n#musickit-dialog {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  -webkit-justify-content: space-between;\n  -moz-justify-content: space-between;\n  justify-content: space-between;\n  min-width: 277px;\n  max-width: 290px;\n  min-height: 109px;\n  background: var(--mk-dialog-background);\n  box-shadow: 0px 0px 9px rgba(0, 0, 0, 0.18);\n  border-radius: 10px;\n  color: var(--mk-dialog-text);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-left: -142px;\n  margin-top: -67px;\n  z-index: 9999999999999999999999999;\n}\n\n#musickit-dialog #mk-dialog-body {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  flex-grow: 1;\n  -webkit-justify-content: space-evenly;\n  -moz-justify-content: space-evenly;\n  justify-content: space-evenly;\n  -webkit-align-items: stretch;\n  align-items: stretch;\n  padding: 10px 20px;\n  min-height: 74px;\n  text-align: center;\n}\n\n#musickit-dialog .mk-dialog h5 {\n  font-weight: 500;\n  line-height: 20px;\n  margin: 7px 0 0 0;\n  padding: 0;\n}\n\n#musickit-dialog .mk-dialog p {\n  margin: 0 0 7px 0;\n  padding: 0;\n  paddin-top: 3px;\n  line-height: 18px;\n  font-size: 13px;\n  font-weight: 300;\n}\n\n#musickit-dialog #mk-dialog-actions {\n  border-top: 1px solid var(--mk-dialog-border);\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: row;\n  -moz-flex-direction: colrowumn;\n  flex-direction: row;\n  max-height: 41px;\n  min-height: 34px;\n  -webkit-justify-self: flex-end;\n  -moz-justify-self: flex-end;\n  justify-self: flex-end;\n}\n\n#musickit-dialog #mk-dialog-actions button {\n  flex-grow: 1;\n  border: 0;\n  background: none;\n  color: var(--mk-dialog-primary);\n  padding: 0;\n  margin: 0;\n  min-height: 34px;\n  height: 41px;\n  text-align: center;\n}\n\n#musickit-dialog #mk-dialog-actions *:nth-child(2) {\n  border-left: 1px solid var(--mk-dialog-border);\n  font-weight: 500;\n}\n")}return MKDialog.presentError=function(t){var n=t.dialog;void 0!==n?MKDialog.serverDialog(n).present():new MKDialog(t.message).present()},MKDialog.serverDialog=function(t){var n=new this(t.message,t.explanation);return t.okButtonAction&&t.okButtonAction.url&&(n._okButtonActionURL=t.okButtonAction.url),t.okButtonString&&(n._okButtonString=t.okButtonString),t.cancelButtonString&&(n._cancelButtonString=t.cancelButtonString),n},MKDialog.clientDialog=function(t){var n=new this(t.message,t.explanation);return t.okButtonAction&&(n._okButtonAction=t.okButtonAction),t.cancelButtonAction&&(n._cancelButtonAction=t.cancelButtonAction),t.okButtonString&&(n._okButtonString=t.okButtonString),t.cancelButtonString&&(n._cancelButtonString=t.cancelButtonString),n},Object.defineProperty(MKDialog.prototype,"actions",{get:function(){return this.cancelButton?'<div id="mk-dialog-actions">'+this.cancelButton+this.okButton+"</div>":'<div id="mk-dialog-actions">'+this.okButton+"</div>"},enumerable:!0,configurable:!0}),Object.defineProperty(MKDialog.prototype,"cancelButton",{get:function(){if("string"==typeof this._cancelButtonString)return'<button type="button">'+this._cancelButtonString+"</button>"},set:function(t){this._cancelButtonString=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKDialog.prototype,"explanation",{get:function(){return'<p id="mk-dialog-explanation">'+this._explanation+"</p>"},enumerable:!0,configurable:!0}),Object.defineProperty(MKDialog.prototype,"hasOKButtonAction",{get:function(){return!!this._okButtonActionURL||!!this._okButtonAction},enumerable:!0,configurable:!0}),Object.defineProperty(MKDialog.prototype,"message",{get:function(){return'<h5 id="mk-dialog-title">'+this._message+"</h5>"},enumerable:!0,configurable:!0}),Object.defineProperty(MKDialog.prototype,"okButton",{get:function(){return this.hasOKButtonAction&&this._okButtonActionURL?'<button type="button" data-ok-action-url=\''+this._okButtonActionURL+"'>"+this._okButtonString+"</button>":'<button type="button">'+this._okButtonString+"</button>"},enumerable:!0,configurable:!0}),MKDialog.prototype.present=function(){var t=this,n=document.createDocumentFragment(),l=document.createElement("div");l.id=this.scrimId,n.appendChild(l);var d=document.createElement("div");d.id=this.id,d.classList.add("mk-dialog"),d.setAttribute("role","alertDialog"),d.setAttribute("aria-modal","true"),d.setAttribute("aria-labeledby","mk-dialog-title"),d.setAttribute("aria-describedby","mk-dialog-explanation");var p='\n      <div id="mk-dialog-body">\n        '+this.message+"\n        "+this.explanation+"\n      </div>";p="\n      "+p+"\n      "+this.actions+"\n    ",d.innerHTML=p,n.appendChild(d),document.body.appendChild(n),document.querySelector("#"+d.id+" #mk-dialog-actions *:first-child").focus(),setTimeout((function(){document.querySelector("#"+d.id+" #mk-dialog-actions *:first-child").addEventListener("click",(function(){t._cancelButtonAction&&t._cancelButtonAction(),d.parentElement.removeChild(d),l.parentElement.removeChild(l)})),t.hasOKButtonAction&&(t._okButtonActionURL?document.querySelector("#"+d.id+" #mk-dialog-actions *:last-child").addEventListener("click",(function(t){window.open(t.target.dataset.okActionUrl,"_blank"),d.parentElement.removeChild(d),l.parentElement.removeChild(l)})):t._okButtonAction&&document.querySelector("#"+d.id+" #mk-dialog-actions *:last-child").addEventListener("click",(function(n){t._okButtonAction(),d.parentElement.removeChild(d),l.parentElement.removeChild(l)})))}))},MKDialog.prototype._appendStyle=function(t){var n=document.createElement("style");n.id=this.styleId,n.styleSheet?n.styleSheet.cssText=t:n.innerHTML=t,document.body.appendChild(n)},MKDialog}(),Et=(isNodeEnvironment(),function(){function Browser(t){void 0===t&&(t=window.navigator.userAgent);var n=t.toLowerCase();this.isEdge=/\sedge\//.test(n),this.isChrome=!this.isEdge&&/chrome/.test(n),this.isSafari=!this.isEdge&&!this.isChrome&&/safari/.test(n),this.isFirefox=!this.isEdge&&!this.isChrome&&!this.isSafari&&/firefox/.test(n),this.isIE=!this.isEdge&&!this.isChrome&&!this.isSafari&&!this.isFirefox&&/trident|msie/.test(n),this.isMobile=/mobile/.test(n),this.isAndroid=this.isMobile&&/android/.test(n),this.isiOS=this.isMobile&&/iphone|ipad|ipod/.test(n),this.isWebView=/(webview|(iphone|ipod|ipad)(?!.*safari\/)|android.*(wv|\.0\.0\.0)|\bfb[\w_]+\/(?:messenger)?|\binstagram|\btwitter)/.test(n),this.isEdge?this.engineVersion=n.match(/(?:edge).(\d+)/):(this.version=n.match(/(?:chrome|version|firefox|msie|rv).(\d+)\.(\d+)/),this.engineVersion=n.match(/(?:applewebkit|gecko|trident).(\d+)/)),this.version&&(this.majorVersion=parseInt(this.version[1],10),this.minorVersion=parseInt(this.version[2],10)),this.engineVersion&&(this.engineMajorVersion=parseInt(this.engineVersion[1],10))}return Browser.supportsEs6=function(){if("undefined"==typeof Symbol)return!1;try{new Function('"use strict";class Foo {}')(),new Function('"use strict";var bar = (x) => x+1')()}catch(e){return!1}return!0},Browser}()),Rt=isNodeEnvironment(),Ct=Et,Ot=new Et,Mt=new at,Dt=document.createElement("video"),Nt=[],Lt=[];function deferPlayback(){fillAvailableElements("audio",Lt),fillAvailableElements("video",Nt),Mt.debug("dom-helpers: defer playback called.  There are "+Nt.length+" available video elements and "+Lt.length+" available audio elements.")}function fillAvailableElements(t,n){for(var l=10-n.length;l>0;){var d=document.createElement(t);d.load(),n.push(d),l--}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics$3=function(t,n){return(extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var l in n)n.hasOwnProperty(l)&&(t[l]=n[l])})(t,n)};function __extends$3(t,n){function __(){this.constructor=t}extendStatics$3(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var __assign$3=function(){return(__assign$3=Object.assign||function(t){for(var n,l=1,d=arguments.length;l<d;l++)for(var p in n=arguments[l])Object.prototype.hasOwnProperty.call(n,p)&&(t[p]=n[p]);return t}).apply(this,arguments)};function __metadata$1(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function __awaiter$3(t,n,l,d){return new(l||(l=Promise))((function(p,h){function fulfilled(t){try{step(d.next(t))}catch(e){h(e)}}function rejected(t){try{step(d.throw(t))}catch(e){h(e)}}function step(t){t.done?p(t.value):new l((function(n){n(t.value)})).then(fulfilled,rejected)}step((d=d.apply(t,n||[])).next())}))}function __generator$3(t,n){var l,d,p,h,f={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(h){return function(y){return function(h){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(p=2&h[0]?d.return:h[0]?d.throw||((p=d.return)&&p.call(d),0):d.next)&&!(p=p.call(d,h[1])).done)return p;switch(d=0,p&&(h=[2&h[0],p.value]),h[0]){case 0:case 1:p=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,d=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(p=f.trys,(p=p.length>0&&p[p.length-1])||6!==h[0]&&2!==h[0])){f=0;continue}if(3===h[0]&&(!p||h[1]>p[0]&&h[1]<p[3])){f.label=h[1];break}if(6===h[0]&&f.label<p[1]){f.label=p[1],p=h;break}if(p&&f.label<p[2]){f.label=p[2],f.ops.push(h);break}p[2]&&f.ops.pop(),f.trys.pop();continue}h=n.call(t,f)}catch(e){h=[6,e],d=0}finally{l=p=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,y])}}}function __read$3(t,n){var l="function"==typeof Symbol&&t[Symbol.iterator];if(!l)return t;var d,p,h=l.call(t),f=[];try{for(;(void 0===n||n-- >0)&&!(d=h.next()).done;)f.push(d.value)}catch(error){p={error:error}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(p)throw p.error}}return f}var xt={AFG:"143610",AGO:"143564",AIA:"143538",ALB:"143575",AND:"143611",ARE:"143481",ARG:"143505",ARM:"143524",ATG:"143540",AUS:"143460",AUT:"143445",AZE:"143568",BEL:"143446",BEN:"143576",BFA:"143578",BGD:"143490",BGR:"143526",BHR:"143559",BHS:"143539",BIH:"143612",BLR:"143565",BLZ:"143555",BMU:"143542",BOL:"143556",BRA:"143503",BRB:"143541",BRN:"143560",BTN:"143577",BWA:"143525",CAF:"143623",CAN:"143455",CHE:"143459",CHL:"143483",CHN:"143465",CIV:"143527",CMR:"143574",COD:"143613",COG:"143582",COL:"143501",CPV:"143580",CRI:"143495",CYM:"143544",CYP:"143557",CZE:"143489",DEU:"143443",DMA:"143545",DNK:"143458",DOM:"143508",DZA:"143563",ECU:"143509",EGY:"143516",ESP:"143454",EST:"143518",ETH:"143569",FIN:"143447",FJI:"143583",FRA:"143442",FSM:"143591",GAB:"143614",GBR:"143444",GEO:"143615",GHA:"143573",GIN:"143616",GMB:"143584",GNB:"143585",GRC:"143448",GRD:"143546",GTM:"143504",GUY:"143553",HKG:"143463",HND:"143510",HRV:"143494",HUN:"143482",IDN:"143476",IND:"143467",IRL:"143449",IRQ:"143617",ISL:"143558",ISR:"143491",ITA:"143450",JAM:"143511",JOR:"143528",JPN:"143462",KAZ:"143517",KEN:"143529",KGZ:"143586",KHM:"143579",KNA:"143548",KOR:"143466",KWT:"143493",LAO:"143587",LBN:"143497",LBR:"143588",LBY:"143567",LCA:"143549",LIE:"143522",LKA:"143486",LTU:"143520",LUX:"143451",LVA:"143519",MAC:"143515",MAR:"143620",MCO:"143618",MDA:"143523",MDG:"143531",MDV:"143488",MEX:"143468",MKD:"143530",MLI:"143532",MLT:"143521",MMR:"143570",MNE:"143619",MNG:"143592",MOZ:"143593",MRT:"143590",MSR:"143547",MUS:"143533",MWI:"143589",MYS:"143473",NAM:"143594",NER:"143534",NGA:"143561",NIC:"143512",NLD:"143452",NOR:"143457",NPL:"143484",NRU:"143606",NZL:"143461",OMN:"143562",PAK:"143477",PAN:"143485",PER:"143507",PHL:"143474",PLW:"143595",PNG:"143597",POL:"143478",PRT:"143453",PRY:"143513",PSE:"143596",QAT:"143498",ROU:"143487",RUS:"143469",RWA:"143621",SAU:"143479",SEN:"143535",SGP:"143464",SLB:"143601",SLE:"143600",SLV:"143506",SRB:"143500",STP:"143598",SUR:"143554",SVK:"143496",SVN:"143499",SWE:"143456",SWZ:"143602",SYC:"143599",TCA:"143552",TCD:"143581",THA:"143475",TJK:"143603",TKM:"143604",TON:"143608",TTO:"143551",TUN:"143536",TUR:"143480",TWN:"143470",TZA:"143572",UGA:"143537",UKR:"143492",URY:"143514",USA:"143441",UZB:"143566",VCT:"143550",VEN:"143502",VGB:"143543",VNM:"143471",VUT:"143609",WSM:"143607",XKX:"143624",YEM:"143571",ZAF:"143472",ZMB:"143622",ZWE:"143605"},Ut={AW:"ABW",AF:"AFG",AO:"AGO",AI:"AIA",AX:"ALA",AL:"ALB",AD:"AND",AE:"ARE",AR:"ARG",AM:"ARM",AS:"ASM",AQ:"ATA",TF:"ATF",AG:"ATG",AU:"AUS",AT:"AUT",AZ:"AZE",BI:"BDI",BE:"BEL",BJ:"BEN",BQ:"BES",BF:"BFA",BD:"BGD",BG:"BGR",BH:"BHR",BS:"BHS",BA:"BIH",BL:"BLM",BY:"BLR",BZ:"BLZ",BM:"BMU",BO:"BOL",BR:"BRA",BB:"BRB",BN:"BRN",BT:"BTN",BV:"BVT",BW:"BWA",CF:"CAF",CA:"CAN",CC:"CCK",CH:"CHE",CL:"CHL",CN:"CHN",CI:"CIV",CM:"CMR",CD:"COD",CG:"COG",CK:"COK",CO:"COL",KM:"COM",CV:"CPV",CR:"CRI",CU:"CUB",CW:"CUW",CX:"CXR",KY:"CYM",CY:"CYP",CZ:"CZE",DE:"DEU",DJ:"DJI",DM:"DMA",DK:"DNK",DO:"DOM",DZ:"DZA",EC:"ECU",EG:"EGY",ER:"ERI",EH:"ESH",ES:"ESP",EE:"EST",ET:"ETH",FI:"FIN",FJ:"FJI",FK:"FLK",FR:"FRA",FO:"FRO",FM:"FSM",GA:"GAB",GB:"GBR",GE:"GEO",GG:"GGY",GH:"GHA",GI:"GIB",GN:"GIN",GP:"GLP",GM:"GMB",GW:"GNB",GQ:"GNQ",GR:"GRC",GD:"GRD",GL:"GRL",GT:"GTM",GF:"GUF",GU:"GUM",GY:"GUY",HK:"HKG",HM:"HMD",HN:"HND",HR:"HRV",HT:"HTI",HU:"HUN",ID:"IDN",IM:"IMN",IN:"IND",IO:"IOT",IE:"IRL",IR:"IRN",IQ:"IRQ",IS:"ISL",IL:"ISR",IT:"ITA",JM:"JAM",JE:"JEY",JO:"JOR",JP:"JPN",KZ:"KAZ",KE:"KEN",KG:"KGZ",KH:"KHM",KI:"KIR",KN:"KNA",KR:"KOR",KW:"KWT",LA:"LAO",LB:"LBN",LR:"LBR",LY:"LBY",LC:"LCA",LI:"LIE",LK:"LKA",LS:"LSO",LT:"LTU",LU:"LUX",LV:"LVA",MO:"MAC",MF:"MAF",MA:"MAR",MC:"MCO",MD:"MDA",MG:"MDG",MV:"MDV",MX:"MEX",MH:"MHL",MK:"MKD",ML:"MLI",MT:"MLT",MM:"MMR",ME:"MNE",MN:"MNG",MP:"MNP",MZ:"MOZ",MR:"MRT",MS:"MSR",MQ:"MTQ",MU:"MUS",MW:"MWI",MY:"MYS",YT:"MYT",NA:"NAM",NC:"NCL",NE:"NER",NF:"NFK",NG:"NGA",NI:"NIC",NU:"NIU",NL:"NLD",NO:"NOR",NP:"NPL",NR:"NRU",NZ:"NZL",OM:"OMN",PK:"PAK",PA:"PAN",PN:"PCN",PE:"PER",PH:"PHL",PW:"PLW",PG:"PNG",PL:"POL",PR:"PRI",KP:"PRK",PT:"PRT",PY:"PRY",PS:"PSE",PF:"PYF",QA:"QAT",RE:"REU",RO:"ROU",RU:"RUS",RW:"RWA",SA:"SAU",SD:"SDN",SN:"SEN",SG:"SGP",GS:"SGS",SH:"SHN",SJ:"SJM",SB:"SLB",SL:"SLE",SV:"SLV",SM:"SMR",SO:"SOM",PM:"SPM",RS:"SRB",SS:"SSD",ST:"STP",SR:"SUR",SK:"SVK",SI:"SVN",SE:"SWE",SZ:"SWZ",SX:"SXM",SC:"SYC",SY:"SYR",TC:"TCA",TD:"TCD",TG:"TGO",TH:"THA",TJ:"TJK",TK:"TKL",TM:"TKM",TL:"TLS",TO:"TON",TT:"TTO",TN:"TUN",TR:"TUR",TV:"TUV",TW:"TWN",TZ:"TZA",UG:"UGA",UA:"UKR",UM:"UMI",UY:"URY",US:"USA",UZ:"UZB",VA:"VAT",VC:"VCT",VE:"VEN",VG:"VGB",VI:"VIR",VN:"VNM",VU:"VUT",WF:"WLF",WS:"WSM",XK:"XKX",YE:"YEM",ZA:"ZAF",ZM:"ZMB",ZW:"ZWE"};var Bt={af:48,sq:1,ar:34,eu:1,bg:49,be:1,ca:42,zh:19,"zh-tw":18,"zh-cn":19,"zh-hk":45,"zh-sg":19,hr:41,cs:22,da:11,nl:10,"nl-be":65,en:1,"en-us":1,"en-eg":26,"en-au":27,"en-gb":2,"en-ca":6,"en-nz":27,"en-ie":26,"en-za":26,"en-jm":26,"en-bz":26,"en-tt":26,"en-001":26,et:30,fo:1,fa:59,fi:12,fr:3,"fr-ca":5,gd:2,de:4,"de-ch":57,el:23,he:36,hi:50,hu:21,is:31,id:37,it:7,ja:9,ko:13,lv:33,lt:32,mk:1,mt:1,no:14,nb:14,nn:14,pl:20,"pt-br":15,pt:24,rm:1,ro:39,ru:16,sr:1,sk:40,sl:52,es:8,"es-mx":28,"es-419":44,sv:17,th:35,ts:1,tn:1,tr:25,uk:29,ur:55,ve:1,vi:43,xh:1,yi:1,zu:56,ms:38,iw:36,lo:46,tl:47,kk:51,ta:53,te:54,bn:58,ga:60,ht:61,la:62,pa:63,sa:64};function getLanguages(){if("undefined"==typeof navigator)return[];if(navigator.languages)return navigator.languages;var t=navigator.language||navigator.userLanguage;return t?[t]:[]}var jt=new RegExp("^https://([a-z0-9]+-)?"+"js-cdn.music.apple.com/musickit/v2/".replace(/[\.\/]/g,"\\$&"),"i"),Ft=/^([a-z]+:)?\/\//;function findScript(t){return isNodeEnvironment()||!t?null:document.querySelector('script[src*="'+t+'"]')}function determineCdnBasePrefix(){var t,n;try{for(var l=function(t){var n="function"==typeof Symbol&&t[Symbol.iterator],l=0;return n?n.call(t):{next:function(){return t&&l>=t.length&&(t=void 0),{value:t&&t[l++],done:!t}}}}("undefined"!=typeof document&&document.querySelectorAll?Array.from(document.querySelectorAll("script[src]")):[]),d=l.next();!d.done;d=l.next()){var p=d.value,h=jt.exec(p.src);if(h)return h[1]||""}}catch(f){t={error:f}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return""}function determineCdnBaseHost(){return isNodeEnvironment()?"":"//"+determineCdnBasePrefix()+"js-cdn.music.apple.com"}function getHlsJsCdnConfig(){var t={hls:"",rtc:""};if(isNodeEnvironment())return t;var n=determineCdnBaseHost(),l="1.530.7";return"undefined"!=typeof localStorage&&(l=localStorage.getItem("mk-hlsjs-version")||l),t.hls="https:"+n+"/hls.js/"+l+"/hls.js/hls.js",t.rtc="https:"+n+"/hls.js/"+l+"/rtc.js/rtc.min.js",t}function loadScript(t,n){return new Promise((function(l,d){if(isNodeEnvironment()&&d("Dynamic script loading is unsupported in Node environments."),findScript(t))return l();var p,h=document.createElement("script");(n&&Object.keys(n).forEach((function(t){h.setAttribute(t,n[t])})),h.onload=function(){l()},h.onerror=function(t){d(t)},Ft.test(t))?p=t:p=""+function(t,n){if(void 0===n&&(n=window),isNodeEnvironment())return"";if(n.localStorage.mkCDNBaseURLOverride)return n.localStorage.mkCDNBaseURLOverride;var l=findScript(t);return l?l.getAttribute("src").replace(new RegExp(t+"$"),""):determineCdnBaseHost()+"/musickit/v2/"}(t)+t;h.src=p,document.head.appendChild(h)}))}var Kt,Vt,$t,Ht=new at("sk-debug"),zt=function(){function AuthBridgeBase(){this._targetOrigin="*"}return AuthBridgeBase.prototype.init=function(t,n){var l;this._receiveWindow=t,this._sendWindow=n,this.handleMessage=this.handleMessage.bind(this),null===(l=this._receiveWindow)||void 0===l||l.addEventListener("message",this.handleMessage)},AuthBridgeBase.prototype.sendMessage=function(t,n){var l={action:"mediakit:"+t,data:n};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(l),this._targetOrigin)},AuthBridgeBase.prototype.handleMessage=function(t){if(this._isOriginAllowed(t.origin)){var n;try{n=JSON.parse(t.data)}catch(e){}if(n&&this._isNamespacedData(n)){"*"===this._targetOrigin&&(this._targetOrigin=t.origin),Ht.debug("auth-bridge: handleMessage",n);var l=n.action.replace("mediakit:","");this[l]?this[l](n.data):Ht.debug("auth-bridge: unsupported method",l)}}},AuthBridgeBase.prototype._isOriginAllowed=function(t){if(!t)return!1;var n=__read$3(t.split("://"),2),l=n[0],d=n[1],p="";return d&&(p=d.split(":")[0]),"https"===l&&!!p&&p.endsWith(".apple.com")},AuthBridgeBase.prototype._isNamespacedData=function(t){return t.action&&-1!==t.action.indexOf("mediakit:")},AuthBridgeBase}(),Wt=function(t){function AuthBridgeApp(){var n=t.call(this)||this;return n.whenFrameInited=new Promise((function(t){return n._frameInitResolve=t})),n.whenAuthCompleted=new Promise((function(t){return n._authUpdateResolve=t})),n.frame=document.createElement("iframe"),n.frame.src=n._getIframeSrc(),n.frame.style.display="none",document.body.appendChild(n.frame),n.init(window,n.frame.contentWindow),n}return __extends$3(AuthBridgeApp,t),AuthBridgeApp.prototype.requestAuthUpdate=function(){var t=this;this.whenFrameInited.then((function(){return t.sendMessage("requestAuthUpdate")}))},AuthBridgeApp.prototype.setCookieItem=function(t,n){var l=this;this.whenFrameInited.then((function(){return l.sendMessage("setCookieItem",{name:t,value:n})}))},AuthBridgeApp.prototype.clearAuth=function(){var t=this;this.whenFrameInited.then((function(){return t.sendMessage("clearAuth")}))},AuthBridgeApp.prototype.frameInit=function(){var t;null===(t=this._frameInitResolve)||void 0===t||t.call(this),this.requestAuthUpdate()},AuthBridgeApp.prototype.updateAuth=function(t){if((null==t?void 0:t.enabled)&&(null==t?void 0:t.cookies)){var n=t.cookies;Object.keys(n).forEach((function(t){var l,d=null!==(l=n[t])&&void 0!==l?l:"";d?setCookie(t,d,"/",7):removeCookie(t)}))}this._authUpdateResolve&&(this._authUpdateResolve(),this._authUpdateResolve=void 0)},AuthBridgeApp.prototype.authClearedFromOtherFrame=function(){Ht.warn("Override auth-bridge/app's authClearedFromOtherFrame to trigger app-specific sign out behavior")},AuthBridgeApp.prototype._getIframeSrc=function(){var t=determineCdnBasePrefix();return t&&(t="?env="+t.substring(0,t.length-1)),"https://mediaauth.apple.com/auth-bridge/"+t},AuthBridgeApp}(zt),Yt=new Set(["apps","books","music","podcasts","tv"]),qt=/\.apple\.com$/;function getCommerceHostname(t,n){!n&&"undefined"!=typeof location&&location.hostname&&(n=location);var l=t+".itunes.apple.com",d=localStorage.getItem("mk-auth-bridge-commerce"),p=!d||1===parseInt(d,10);if(!n||!p)return l;var h=function(t){if(t&&qt.test(t)){var n=t.split("."),l=n[n.length-3],d=l;if(l&&l.includes("-")){var p=l.split("-");l=p[p.length-1]}if(Yt.has(l))return d}}(n.hostname);return h&&(l=t+"."+h+".apple.com"),l}function buildQueryParams(t){return void 0===t&&(t={app:Kt.APP,p:Kt.P}),void 0===t.app&&(t.app=Kt.APP),void 0===t.p&&(t.p=Kt.P),Object.keys(t).map((function(n){return encodeURIComponent(n)+"="+encodeURIComponent(t[n])})).join("&")}!function(t){t.APP="music",t.P="subscribe"}(Kt||(Kt={}));var Gt,Qt=((Vt={})[2]="com.apple.onboarding.tvapp",Vt[0]="com.apple.onboarding.applemusic",Vt),Jt=(($t={})[2]="pltvcid",$t[0]="pldfltcid",$t),Xt={"com.apple.onboarding.tvapp":5,"com.apple.onboarding.applemusic":3};!function(t){t[t.ParseError=-32700]="ParseError",t[t.InvalidRequest=-32600]="InvalidRequest",t[t.MethodNotFound=-32601]="MethodNotFound",t[t.InvalidParams=-32602]="InvalidParams",t[t.InternalError=-32603]="InternalError"}(Gt||(Gt={}));var Zt,er=function(){function Dispatch(t){var n=this;void 0===t&&(t={}),this._registry={},this._sequence=0,this.handle=function(t){t.data&&"2.0"===t.data.jsonrpc&&("*"!==n.origin&&n.origin!==t.origin||(t.data.method&&n.destination?n.handleRequest(t.data).then((function(t){n.send(n.destination,t)})):(t.data.hasOwnProperty("result")||t.data.error)&&n.handleResponse(t.data)))},this.destination=t.destination,this.methods=t.methods||{},this.origin=t.origin||"*",t.source&&(this.source=t.source)}return Object.defineProperty(Dispatch.prototype,"source",{get:function(){return this._source},set:function(t){if(!t&&this._source)return this._source.removeEventListener("message",this.handle),void(this._source=void 0);t.addEventListener("message",this.handle),this._source=t},enumerable:!0,configurable:!0}),Dispatch.prototype.apply=function(t,n){var l=this;if(!this.destination)throw new Error("No destination");var d=this._sequence++,p=new Promise((function(t,n){l._registry[d]={resolve:t,reject:n}}));return this.send(this.destination,{jsonrpc:"2.0",id:d,method:t,params:n}),p},Dispatch.prototype.call=function(t){for(var n=[],l=1;l<arguments.length;l++)n[l-1]=arguments[l];return this.apply(t,n)},Dispatch.prototype.handleRequest=function(t){return __awaiter$1(this,void 0,void 0,(function(){var n,l,d,p;return __generator$1(this,(function(h){switch(h.label){case 0:if(n={jsonrpc:"2.0",id:t.id},!(l=this.methods[t.method]))return[2,Object.assign(n,{error:{code:Gt.MethodNotFound,message:"Method not found"}})];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,l.apply(null,ensureArray(t.params))];case 2:return d=h.sent(),[2,Object.assign(n,{result:d})];case 3:return p=h.sent(),[2,Object.assign(n,{error:{code:p.code||Gt.InternalError,message:p.message}})];case 4:return[2]}}))}))},Dispatch.prototype.handleResponse=function(t){var n=this._registry[t.id];delete this._registry[t.id],n&&(t.error?n.reject(Object.assign(Error(),t.error)):n.resolve(t.result))},Dispatch.prototype.send=function(t,n){t.postMessage(n,t.window===t?this.origin:void 0)},Dispatch}();function validateToken(t){var n;if("string"!=typeof t)return!1;var l=t.match(/[a-zA-Z0-9=\/+]{32,}==$/);return null!==(n=l&&l.length>0)&&void 0!==n&&n}!function(t){t[t.UNAVAILABLE=-1]="UNAVAILABLE",t[t.NOT_DETERMINED=0]="NOT_DETERMINED",t[t.DENIED=1]="DENIED",t[t.RESTRICTED=2]="RESTRICTED",t[t.AUTHORIZED=3]="AUTHORIZED"}(Zt||(Zt={}));var tr,rr="https://"+getCommerceHostname("buy")+"/commerce/account/authenticateMusicKitRequest",ir="https://authorize.music.apple.com",nr=/^https?:\/\/(.+\.)*(apple\.com|apps\.mzstatic\.com)(\/[\w\d]+)*$/;!function(t){t[t.AUTHORIZE=0]="AUTHORIZE",t[t.SUBSCRIBE=1]="SUBSCRIBE"}(tr||(tr={}));var or,ar=function(){function ServiceSetupView(t,n){void 0===n&&(n={}),this.developerToken=t,this.authenticateMethod="GET",this.target="apple-music-service-view",this.deeplinkParameters=n&&n.deeplinkParameters||{},this.iconURL=n&&n.iconURL,this.authenticateMethod=n&&n.authenticateMethod||"GET",this.isServiceView&&window.opener!==window&&(this.dispatch=new er({destination:window.opener,origin:"*",source:window}))}return Object.defineProperty(ServiceSetupView.prototype,"isServiceView",{get:function(){return/(authorize\.(.+\.)*apple\.com)/i.test(window.location.hostname)||window&&window.name===this.target||!1},enumerable:!0,configurable:!0}),ServiceSetupView.prototype.focus=function(){this._window&&window.focus&&this._window.focus()},ServiceSetupView.prototype.load=function(t){return void 0===t&&(t={action:tr.AUTHORIZE}),__awaiter$3(this,void 0,void 0,(function(){return __generator$3(this,(function(n){return t.action===tr.SUBSCRIBE?[2,this._subscribeAction(t.parameters)]:[2,this._authorizeAction(t.parameters)]}))}))},ServiceSetupView.prototype.present=function(t,n){void 0===t&&(t="");var l=this._calculateClientDimensions(),d=l.height,p=l.left,h=l.top,f=l.width,y={height:650,menubar:"no",resizable:"no",scrollbars:"no",status:"no",toolbar:"no",width:650},v=__assign$3(__assign$3(__assign$3({},y),{left:f/2-y.width/2+p,top:d/2-y.height/2+h}),n),g=Object.keys(v).map((function(t){return t+"="+v[t]})).join(",");return/trident|msie/i.test(navigator.userAgent)?(this._window=window.open(window.location.href,this.target,g)||void 0,this._window.location.href=t):this._window=window.open(t,this.target,g)||void 0,/\bedge\b/i.test(navigator.userAgent)&&(this._window.opener=self),this.focus(),this._window},ServiceSetupView.prototype._authorizeAction=function(t){var n;return void 0===t&&(t={}),__awaiter$3(this,void 0,void 0,(function(){var l,d,p,h=this;return __generator$3(this,(function(f){return p=(null===(n=window.location)||void 0===n?void 0:n.href)||"","GET"===this.authenticateMethod?d=ir+"/woa?"+buildQueryParams({a:btoa(this._thirdPartyInfo()),referrer:p}):(l=this._buildFormElement(rr),document.body.appendChild(l)),[2,new Promise((function(n,p){var f=h.present(d);h.dispatch=new er({methods:{authorize:function(t,l,d){validateToken(t)?n({restricted:l&&"1"===l,userToken:t,cid:d}):p(Zt.NOT_DETERMINED)},close:function(){},decline:function(){p(Zt.DENIED)},switchUserId:function(){p(Zt.NOT_DETERMINED)},thirdPartyInfo:function(){return h._thirdPartyInfo(h.developerToken,__assign$3(__assign$3({},h.deeplinkParameters),t))},unavailable:function(){p(Zt.UNAVAILABLE)}},origin:ir,source:window,destination:f}),l&&l.submit()}))]}))}))},ServiceSetupView.prototype._buildFormElement=function(t,n,l){void 0===n&&(n=this.target),void 0===l&&(l=this.developerToken);var d=document.createElement("form");d.setAttribute("method","post"),d.setAttribute("action",t),d.setAttribute("target",n),d.style.display="none";var p=document.createElement("input");p.setAttribute("name","jwtToken"),p.setAttribute("value",l),d.appendChild(p);var h=document.createElement("input");h.setAttribute("name","isWebPlayer"),h.setAttribute("value","true"),d.appendChild(h);var f=document.createElement("input");return f.setAttribute("name","LogoURL"),f.setAttribute("value",""),d.appendChild(f),d},ServiceSetupView.prototype._calculateClientDimensions=function(t){return void 0===t&&(t=window),{height:t.innerHeight?t.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,left:t.screenLeft?t.screenLeft:screen.availLeft||screen.left,top:t.screenTop?t.screenTop:screen.availTop||screen.top,width:t.innerWidth?t.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}},ServiceSetupView.prototype._subscribeAction=function(t){return void 0===t&&(t={}),__awaiter$3(this,void 0,void 0,(function(){var n=this;return __generator$3(this,(function(l){return Object.assign(t,this.deeplinkParameters),[2,new Promise((function(l,d){var p="https://authorize.music.apple.com/upsell?"+buildQueryParams(t);n.present(p),window.addEventListener("message",(function(t){var n=t.data,p=t.origin,h=(t.source,"string"==typeof n?JSON.parse(n):n),f=(h.closeWindow,h.launchClient);p&&!nr.test(p)||(f?0===f.supported?d("Unable to subscribe on this platform."):l(f):d("Subscribe action error."))}))}))]}))}))},ServiceSetupView.prototype._thirdPartyInfo=function(t,n){var l;void 0===t&&(t=this.developerToken);var d=this.iconURL,p=window.location.host||document.referrer,h=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(__read$3(arguments[n]));return t}([].slice.call(document.querySelectorAll('link[rel="apple-music-app-icon"]')),[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon-precomposed"]')),[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon"]')));if(h&&h[0]&&h[0].href){var f=h.find((function(t){return!!t.sizes&&"120x120"===t.sizes.value}));d=null!==(l=null==f?void 0:f.href)&&void 0!==l?l:h[0].href}return JSON.stringify({thirdPartyIconURL:d,thirdPartyName:p,thirdPartyParameters:n,thirdPartyToken:t})},ServiceSetupView}();function fetchStorefronts(t,n){return void 0===n&&(n="https://api.music.apple.com/v1"),__awaiter$3(this,void 0,void 0,(function(){var l,d;return __generator$3(this,(function(p){switch(p.label){case 0:return l=new Headers({Authorization:"Bearer "+t}),[4,fetch(n+"/storefronts",{headers:l})];case 1:return[4,p.sent().json()];case 2:return(d=p.sent()).errors?[2,Promise.reject(d.errors)]:[2,d.data]}}))}))}!function(t){t.ID="us",t.LANGUAGE_TAG="en-gb"}(or||(or={}));var sr,ur,cr=function(){function Storefront(t,n,l){this.id=t,this.attributes=n,this.type="storefronts",this.href=l||"/v1/"+this.type+"/"+t}return Storefront.inferFromLanguages=function(t,n){return void 0===n&&(n=getLanguages()),__awaiter$3(this,void 0,void 0,(function(){var l,d,p,h,f,y;return __generator$3(this,(function(v){switch(v.label){case 0:return[4,fetchStorefronts(t)];case 1:return l=v.sent(),d=l.map((function(t){return t.id})),p=n[0]||"en-US",h=__read$3(p.toLowerCase().split(/-|_/),2),h[0],f=h[1],y=d.includes(f)?f:"us",[2,l.find((function(t){return t.id===y}))]}}))}))},Storefront}();!function(t){t.DEFAULT_CID="pldfltcid",t.TV_CID="pltvcid",t.RESTRICTIONS_ENABLED="itre",t.STOREFRONT_COUNTRY_CODE="itua",t.USER_TOKEN="media-user-token"}(sr||(sr={})),function(t){t.authorizationStatusDidChange="authorizationStatusDidChange",t.authorizationStatusWillChange="authorizationStatusWillChange",t.eligibleForSubscribeView="eligibleForSubscribeView",t.needsGDPRDidChange="needsGDPRDidChange",t.storefrontCountryCodeDidChange="storefrontCountryCodeDidChange",t.storefrontIdentifierDidChange="storefrontIdentifierDidChange",t.userTokenDidChange="userTokenDidChange"}(ur||(ur={}));sr.DEFAULT_CID;var lr,dr="https://"+getCommerceHostname("buy"),pr="https://"+getCommerceHostname("play")+"/WebObjects/MZPlay.woa/wa",hr=function(t){function StoreKit(n,l){var d=t.call(this,[ur.authorizationStatusDidChange,ur.authorizationStatusWillChange,ur.eligibleForSubscribeView,ur.needsGDPRDidChange,ur.storefrontCountryCodeDidChange,ur.userTokenDidChange,ur.storefrontIdentifierDidChange])||this;d.developerToken=n,d.apiBase="https://api.music.apple.com/v1",d.iTunesBuyBase=dr,d.persist="localstorage",d.playBase=pr,d.prefix="music",d.realm=0,d.storage=window.localStorage,d._authorizationStatus=Zt.NOT_DETERMINED,d._dispatchedSubscribeView=!1,d._me=null,d._cids={},d._gdprVersion=-1,d._needsGDPR=void 0,d._dynamicUserToken=getCookie(sr.USER_TOKEN),l&&(l.apiBase&&(d.apiBase=l.apiBase),l.deeplink&&(d.deeplinkParameters=l.deeplink),l.persist&&(d.persist=l.persist),l.prefix&&(d.prefix=l.prefix),void 0!==l.realm&&(d.realm=l.realm),d.bundleId=Qt[d.realm]),d.cidNamespace=Jt[d.realm],d._developerToken=new et(n),d._serviceSetupView=new ar(n,{authenticateMethod:l&&l.authenticateMethod,iconURL:l&&l.iconURL,deeplinkParameters:d.deeplinkParameters}),d.storagePrefix=(d.prefix+"."+d._developerToken.teamId).toLocaleLowerCase();var p=d._getStorageItem(sr.USER_TOKEN);return d.userToken=p||void 0,d.developerToken&&d.userTokenIsValid&&(d._restrictedEnabled=d.restrictedEnabled,d.shouldDisplayPrivacyLink(d.bundleId).catch((function(){}))),d._storefrontCountryCode=d.storefrontCountryCode,d.whenAuthCompleted=Promise.resolve(),isNodeEnvironment()||(d._processLocationHash(window.location.hash),"cookie"!==d.persist||(null==l?void 0:l.disableAuthBridge)||(d.authBridgeApp=new Wt,d.authBridgeApp.authClearedFromOtherFrame=d.revokeUserToken.bind(d),d.whenAuthCompleted=d.authBridgeApp.whenAuthCompleted.then((function(){d.userToken=d._getStorageItem(sr.USER_TOKEN)||void 0})))),d}var n;return __extends$3(StoreKit,t),Object.defineProperty(StoreKit.prototype,"authorizationStatus",{get:function(){return this._authorizationStatus},set:function(t){this._authorizationStatus!==t&&(this._getIsActiveSubscription.updateCache(void 0),this.dispatchEvent(ur.authorizationStatusWillChange,{authorizationStatus:this._authorizationStatus,newAuthorizationStatus:t}),this._authorizationStatus=t,this.dispatchEvent(ur.authorizationStatusDidChange,{authorizationStatus:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"cid",{get:function(){if(!this._cids[this.cidNamespace]){var t=this._getStorageItem(this.cidNamespace);this._cids[this.cidNamespace]=t||void 0}return this._cids[this.cidNamespace]},set:function(t){t?this._setStorageItem(this.cidNamespace,t):this._removeStorageItem(this.cidNamespace),this._cids[this.cidNamespace]=t},enumerable:!0,configurable:!0}),StoreKit.prototype.eligibleForSubscribeView=function(){return __awaiter$3(this,void 0,void 0,(function(){var t;return __generator$3(this,(function(n){switch(n.label){case 0:return[4,this.hasMusicSubscription()];case 1:return t=n.sent(),[2,(!this.hasAuthorized||this.hasAuthorized&&!t)&&!this._dispatchedSubscribeView]}}))}))},Object.defineProperty(StoreKit.prototype,"hasAuthorized",{get:function(){return this.authorizationStatus>Zt.DENIED},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"logoutURL",{get:function(){return this.iTunesBuyBase+"/account/web/logout"},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"parentalControls",{get:function(){return this._parentalControls},set:function(t){this._parentalControls=t,t&&(0===this.realm?this.restrictedEnabled=t.musicParentalControlsEnabled:2===this.realm&&t.videoContentRestrictions&&(this.authorizationStatus=Zt.RESTRICTED))},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"_pldfltcid",{get:function(){return this._cids[sr.DEFAULT_CID]},set:function(t){this._cids[sr.DEFAULT_CID]=t},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"privacyAcknowledgements",{get:function(){return this._privacyAcknowledgements},set:function(t){if(this._privacyAcknowledgements=t,!t)return this._gdprVersion=-1,void(this._needsGDPR=void 0);this.bundleId&&(this._gdprVersion=t[this.bundleId]||0,this._needsGDPR=this._gdprVersion<(Xt[this.bundleId]||0),this._needsGDPR&&this.dispatchEvent(ur.needsGDPRDidChange,{GDPRVersion:this._gdprVersion,needsGDPR:this._needsGDPR}))},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"restrictedEnabled",{get:function(){if(this.userToken&&"boolean"!=typeof this._restrictedEnabled){var t=this._getStorageItem(sr.RESTRICTIONS_ENABLED);if(t)this._restrictedEnabled="0"!==t;else if(this._storefrontCountryCode){this._restrictedEnabled=-1!==["br","ch","gt","hu","id","in","it","kr","la","lt","my","ru","sg","tr"].indexOf(this._storefrontCountryCode)||void 0}}return this._restrictedEnabled},set:function(t){this.userToken&&void 0!==t&&this._setStorageItem(sr.RESTRICTIONS_ENABLED,t?"1":"0"),this._restrictedEnabled=t,t&&(this.authorizationStatus=Zt.RESTRICTED)},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"storefrontCountryCode",{get:function(){if(!this._storefrontCountryCode){var t=this._getStorageItem(sr.STOREFRONT_COUNTRY_CODE);this._storefrontCountryCode=(null==t?void 0:t.toLowerCase())||or.ID}return this._storefrontCountryCode},set:function(t){t&&this.userToken?this._setStorageItem(sr.STOREFRONT_COUNTRY_CODE,t):this._removeStorageItem(sr.STOREFRONT_COUNTRY_CODE),this._storefrontCountryCode=t,this.dispatchEvent(ur.storefrontCountryCodeDidChange,{storefrontCountryCode:t})},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"storefrontIdentifier",{get:function(){return this._storefrontIdentifier},set:function(t){this._storefrontIdentifier=t,this.dispatchEvent(ur.storefrontIdentifierDidChange,{storefrontIdentifier:t})},enumerable:!0,configurable:!0}),StoreKit.prototype.runTokenValidations=function(t,n){void 0===n&&(n=!0),t&&validateToken(t)?(n&&this._setStorageItem(sr.USER_TOKEN,t),this.authorizationStatus=this.restrictedEnabled?Zt.RESTRICTED:Zt.AUTHORIZED):(this._removeStorageItem(sr.USER_TOKEN),this.authorizationStatus=Zt.NOT_DETERMINED)},StoreKit.prototype.wrapDynamicUserTokenForChanges=function(t,n){var l=this;if(void 0===n&&(n=He(t)),"function"!=typeof t)return t;var d=n;return function(){var n=He(t);return d!==n&&(d=n,l.runTokenValidations(n,!1),l.dispatchEvent(ur.userTokenDidChange,{userToken:n})),n||""}},Object.defineProperty(StoreKit.prototype,"dynamicUserToken",{get:function(){return this._dynamicUserToken},set:function(t){var n=He(t);this._dynamicUserToken=this.wrapDynamicUserTokenForChanges(t,n),this.runTokenValidations(n,"function"!=typeof t),this.dispatchEvent(ur.userTokenDidChange,{userToken:n})},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"userToken",{get:function(){return He(this.dynamicUserToken)},set:function(t){this.dynamicUserToken=t},enumerable:!0,configurable:!0}),Object.defineProperty(StoreKit.prototype,"userTokenIsValid",{get:function(){return validateToken(this.userToken)},enumerable:!0,configurable:!0}),StoreKit.prototype.deeplinkURL=function(t){return void 0===t&&(t={}),"https://finance-app.itunes.apple.com/deeplink?"+buildQueryParams(t=__assign$3(__assign$3({},this.deeplinkParameters||{}),t))},StoreKit.prototype.itunesDeeplinkURL=function(t){return void 0===t&&(t={p:"browse"}),"https://itunes.apple.com/deeplink?"+buildQueryParams(t=__assign$3(__assign$3({},this.deeplinkParameters||{}),t))},StoreKit.prototype.pldfltcid=function(){return __awaiter$3(this,void 0,void 0,(function(){return __generator$3(this,(function(t){switch(t.label){case 0:if(this._cids[sr.DEFAULT_CID])return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.infoRefresh()];case 2:return t.sent(),[3,4];case 3:return t.sent(),[2,void 0];case 4:return[2,this._cids[sr.DEFAULT_CID]]}}))}))},StoreKit.prototype.renewUserToken=function(){return __awaiter$3(this,void 0,void 0,(function(){var t,n,l;return __generator$3(this,(function(d){switch(d.label){case 0:return this.userToken?(t=new Headers({Authorization:"Bearer "+this.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+this.userToken}),[4,fetch(this.playBase+"/renewMusicToken",{method:"POST",headers:t})]):[2,this.requestUserToken()];case 1:return 401!==(n=d.sent()).status?[3,3]:[4,this.revokeUserToken()];case 2:return d.sent(),[2,Promise.reject(new Error("Renew token"))];case 3:return[4,n.json()];case 4:return(l=d.sent())["music-token"]&&(this.userToken=l["music-token"]),[2,this.userToken]}}))}))},StoreKit.prototype.requestStorefrontCountryCode=function(){return __awaiter$3(this,void 0,void 0,(function(){var t,n,l,d,p;return __generator$3(this,(function(h){switch(h.label){case 0:return this.authorizationStatus<=Zt.DENIED?[2,Promise.reject("Not authorized: "+this.authorizationStatus)]:(t=new Headers({Authorization:"Bearer "+this.developerToken,"Music-User-Token":this.userToken||""}),[4,fetch(this.apiBase+"/me/storefront",{headers:t})]);case 1:return(n=h.sent())&&!n.ok?(this._reset(),[2,Promise.reject("Storefront Country Code error.")]):[4,n.json()];case 2:return(l=h.sent()).errors?[2,Promise.reject(l.errors)]:(d=__read$3(l.data,1),(p=d[0])&&p.id?(this.storefrontCountryCode=p.id,[2,this.storefrontCountryCode]):[2,Promise.reject("Storefront Country Code error.")])}}))}))},StoreKit.prototype.requestStorefrontIdentifier=function(){return __awaiter$3(this,void 0,void 0,(function(){var t;return __generator$3(this,(function(n){switch(n.label){case 0:return this.storefrontIdentifier?[3,2]:[4,cr.inferFromLanguages(this.developerToken)];case 1:t=n.sent(),this.storefrontIdentifier=t.id,n.label=2;case 2:return[2,this.storefrontIdentifier]}}))}))},StoreKit.prototype.requestUserToken=function(){return __awaiter$3(this,void 0,void 0,(function(){var t,n;return __generator$3(this,(function(l){switch(l.label){case 0:if(this._serviceSetupView.isServiceView)return[2,this.userToken||""];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this._serviceSetupView.load({action:tr.AUTHORIZE})];case 2:return t=l.sent(),this.cid=t.cid,this.userToken=t.userToken,this.restrictedEnabled=t.restricted,[3,4];case 3:return n=l.sent(),this._reset(),this.authorizationStatus=n,[2,Promise.reject(n)];case 4:return[2,this.userToken]}}))}))},StoreKit.prototype.revokeUserToken=function(){var t;return __awaiter$3(this,void 0,void 0,(function(){return __generator$3(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._webPlayerLogout()];case 1:return n.sent(),[3,3];case 2:return n.sent(),[3,3];case 3:return null===(t=this.authBridgeApp)||void 0===t||t.clearAuth(),this.dispatchEvent(ur.authorizationStatusWillChange,{authorizationStatus:this.authorizationStatus,newAuthorizationStatus:Zt.NOT_DETERMINED}),this._reset(),this.dispatchEvent(ur.authorizationStatusDidChange,{authorizationStatus:this.authorizationStatus}),this.dispatchEvent(ur.userTokenDidChange,{userToken:this.userToken}),[2]}}))}))},StoreKit.prototype.setCids=function(t){var n=this;this._cids=__assign$3(__assign$3({},this._cids),t),Object.keys(this._cids).forEach((function(t){n._setStorageItem(t,n._cids[t])}))},StoreKit.prototype.shouldDisplayPrivacyLink=function(t){return __awaiter$3(this,void 0,void 0,(function(){return __generator$3(this,(function(n){switch(n.label){case 0:return t||(t=this.bundleId),void 0!==this._needsGDPR?[2,this._needsGDPR]:[4,this.me()];case 1:return n.sent(),[2,this._needsGDPR]}}))}))},StoreKit.prototype.hasMusicSubscription=function(){return __awaiter$3(this,void 0,void 0,(function(){return __generator$3(this,(function(t){return this.hasAuthorized?[2,this._getIsActiveSubscription()]:[2,!1]}))}))},StoreKit.prototype._getIsActiveSubscription=function(){var t;return __awaiter$3(this,void 0,void 0,(function(){var n;return __generator$3(this,(function(l){switch(l.label){case 0:return[4,this.me()];case 1:return n=l.sent(),[2,!!(null===(t=n.subscription)||void 0===t?void 0:t.active)]}}))}))},StoreKit.prototype.resetSubscribeViewEligibility=function(){this._dispatchedSubscribeView=!1},StoreKit.prototype.presentSubscribeViewForEligibleUsers=function(t,n){return void 0===t&&(t={}),void 0===n&&(n=!0),__awaiter$3(this,void 0,void 0,(function(){var l,d;return __generator$3(this,(function(p){switch(p.label){case 0:return[4,this.eligibleForSubscribeView()];case 1:if(l=p.sent(),this._serviceSetupView.isServiceView||!l)return[2];if(!n)return this.dispatchEvent(ur.eligibleForSubscribeView,t),this._dispatchedSubscribeView=!0,[2];p.label=2;case 2:return p.trys.push([2,4,,5]),[4,this._serviceSetupView.load({action:tr.SUBSCRIBE})];case 3:return d=p.sent(),this._dispatchedSubscribeView=!0,[2,d];case 4:return p.sent(),[2,this.revokeUserToken()];case 5:return[2]}}))}))},StoreKit.prototype.infoRefresh=function(){return __awaiter$3(this,void 0,void 0,(function(){var t,n;return __generator$3(this,(function(l){switch(l.label){case 0:if(this.authorizationStatus<=Zt.DENIED)return[2,Promise.reject("Not authorized: "+this.authorizationStatus)];if(2!==this.realm)return[3,5];t=new Headers({Authorization:"Bearer "+this.developerToken,"Music-User-Token":this.userToken||""}),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,fetch(this.iTunesBuyBase+"/account/web/infoRefresh",{credentials:"include",headers:t})];case 2:return[4,l.sent().json()];case 3:return n=l.sent(),this.setCids(n),[3,5];case 4:return l.sent(),[3,5];case 5:return[2]}}))}))},StoreKit.prototype.me=function(){var t=this;return this.authorizationStatus<=Zt.DENIED?Promise.reject("Not authorized: "+this.authorizationStatus):(this._me||(this._me=new Promise((function(n,l){return __awaiter$3(t,void 0,void 0,(function(){var t,d,p,h,f,y,v;return __generator$3(this,(function(g){switch(g.label){case 0:return t=new Headers({Authorization:"Bearer "+this.developerToken,"Music-User-Token":this.userToken||""}),[4,fetch(this.apiBase+"/me/account?meta=subscription",{headers:t})];case 1:return(d=g.sent())&&!d.ok?(2!==this.realm&&this._reset(),[2,l("Account error.")]):[4,d.json()];case 2:if((p=g.sent()).errors)return[2,l(p.errors)];if(h=p.data,!(f=p.meta)||!f.subscription)return[2,l("Account error.")];this.storefrontCountryCode=f.subscription.storefront,y={subscription:f.subscription},h&&h.length&&(y.attributes=h[0].attributes),g.label=3;case 3:return g.trys.push([3,13,,14]),[4,fetch(this.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:t})];case 4:return[4,g.sent().json()];case 5:if(p=g.sent(),this.parentalControls=p.parentalControlsData,this.privacyAcknowledgements=p.privacyAcknowledgement,!function(t){if("object"!=typeof t)throw new TypeError("Source is not an Object");for(var n in t)if(ve.call(t,n))return!1;return!0}(this.privacyAcknowledgements||{}))return[3,12];g.label=6;case 6:return g.trys.push([6,8,,9]),[4,this.infoRefresh()];case 7:return g.sent(),[3,9];case 8:return g.sent(),n(y),[3,9];case 9:return[4,fetch(this.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:t})];case 10:return[4,g.sent().json()];case 11:p=g.sent(),this.parentalControls=p.parentalControlsData,this.privacyAcknowledgements=p.privacyAcknowledgement,g.label=12;case 12:return y.info=p,[3,14];case 13:return v=g.sent(),console.warn("Failed to fetch privacyAcknowledgements",v),[3,14];case 14:return[2,n(y)]}}))}))})).then((function(n){var l;return t._getIsActiveSubscription.updateCache((null===(l=n.subscription)||void 0===l?void 0:l.active)||!1),t._me=null,n})).catch((function(n){return t._me=null,Promise.reject(n)}))),this._me)},StoreKit.prototype.musicSubscriptionOffers=function(t,n){return void 0===n&&(n=getLanguages()),__awaiter$3(this,void 0,void 0,(function(){var l,d,p,h,f,y,v;return __generator$3(this,(function(g){switch(g.label){case 0:return this.hasAuthorized?[4,this.me()]:[3,2];case 1:return d=g.sent(),l=d.info.storeFrontISO3A,[3,5];case 2:return t?[3,4]:[4,cr.inferFromLanguages(this.developerToken,n)];case 3:p=g.sent(),t=null==p?void 0:p.id,g.label=4;case 4:l=t&&Ut[t.toUpperCase()]||"USA",g.label=5;case 5:return h=function(t){void 0===t&&(t="en-US");var n=Bt[t.toLowerCase()];if(n)return n;if(t.includes("-")){var l=t.split("-")[0],d=Bt[l.toLowerCase()];if(d)return d}return Bt["en-us"]}(n[0]),f=xt[l],h&&f?(y=new Headers({"X-Apple-Store-Front":f+"-"+h+",8"}),this.userToken&&(y.set("Authorization","Bearer "+this.developerToken),y.set("Music-User-Token",this.userToken)),[4,fetch(this.iTunesBuyBase+"/commerce/web/subscription/offers/music",{headers:y})]):[2,[]];case 6:return(v=g.sent()).ok?[4,v.json()]:[2,Promise.reject(v.status)];case 7:return[2,g.sent().offers]}}))}))},StoreKit.prototype._getStorageItem=function(t){if(t)return"cookie"===this.persist?getCookie(t):"localstorage"===this.persist?this.storage.getItem(this.storagePrefix+"."+t):void 0},StoreKit.prototype._processLocationHash=function(t){var n=/^\#([a-zA-Z0-9+\/]{200,}={0,2})$/;if(n.test(t)){var l=t.replace(n,"$1");try{var d=JSON.parse(atob(l)),p=d.itre,h=d.musicUserToken,f=d.cid;this.restrictedEnabled=p&&"1"===p,this.userToken=h,this.cid=f}catch($t){}history.replaceState(null,document.title," ")}},StoreKit.prototype._removeStorageItem=function(t){if("cookie"===this.persist)this._removeCookieFromDomains(t);else if("localstorage"===this.persist)return this.storage.removeItem(this.storagePrefix+"."+t)},StoreKit.prototype._removeCookieFromDomains=function(t,n){void 0===n&&(n=window),removeCookie(t);var l=n.location.hostname.split(".");if(l.length&&(l.shift(),l.length>2))for(var d=l.length;d>2;d--){var p=l.join(".");l.shift(),removeCookie(t,n,p)}},StoreKit.prototype._reset=function(t){var n=this;void 0===t&&(t=Zt.NOT_DETERMINED),this._authorizationStatus=t,this._cids={},this._dispatchedSubscribeView=!1,this._restrictedEnabled=void 0,this._storefrontCountryCode=void 0,this._getIsActiveSubscription.updateCache(void 0),Object.keys(Jt).forEach((function(t){n._removeStorageItem(Jt[t])})),this._removeStorageItem(sr.RESTRICTIONS_ENABLED),this._removeStorageItem(sr.USER_TOKEN),this._removeStorageItem(sr.STOREFRONT_COUNTRY_CODE),this._dynamicUserToken=void 0,this._me=null,this.privacyAcknowledgements=void 0},StoreKit.prototype._setStorageItem=function(t,n){var l;return"cookie"===this.persist?(null===(l=this.authBridgeApp)||void 0===l||l.setCookieItem(t,n),setCookie(t,n,"/",180)):"localstorage"===this.persist?this.storage.setItem(this.storagePrefix+"."+t,n):void 0},StoreKit.prototype._webPlayerLogout=function(){return __awaiter$3(this,void 0,void 0,(function(){var t,n;return __generator$3(this,(function(l){switch(l.label){case 0:return(t=new Headers({Authorization:"Bearer "+this.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+this.userToken})).delete("X-Apple-Music-User-Token"),t.append("Music-User-Token",this.userToken||""),[4,fetch(this.logoutURL,{method:"POST",headers:t,credentials:"include"})];case 1:return(n=l.sent())&&!n.ok?[2,Promise.reject(n.status)]:[2,n.json()]}}))}))},function(t,n,l,d){var p,h=arguments.length,f=h<3?n:null===d?d=Object.getOwnPropertyDescriptor(n,l):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(t,n,l,d);else for(var y=t.length-1;y>=0;y--)(p=t[y])&&(f=(h<3?p(f):h>3?p(n,l,f):p(n,l))||f);h>3&&f&&Object.defineProperty(n,l,f)}([(n=900,void 0===n&&(n=300),function(t,l,d){if(void 0===d||"function"!=typeof d.value)throw new TypeError("Only methods can be decorated with @CachedResult, but "+l+" is not a method.");return{configurable:!0,get:function(){var t,p=d.value,h=1e3*n,f=-1;function cachedResultMethod(){for(var n=[],l=0;l<arguments.length;l++)n[l]=arguments[l];return __awaiter$1(this,void 0,void 0,(function(){var l;return __generator$1(this,(function(d){switch(d.label){case 0:return l=Date.now(),void 0===t||-1===f||f>0&&l>f+h?(f=l,[4,p.apply(this,n)]):[3,2];case 1:t=d.sent(),d.label=2;case 2:return[2,t]}}))}))}return cachedResultMethod.updateCache=function(n){f=Date.now(),t=n},cachedResultMethod.getCachedValue=function(){return t},Object.defineProperty(this,l,{value:cachedResultMethod,configurable:!0,writable:!0}),cachedResultMethod}}}),__metadata$1("design:type",Function),__metadata$1("design:paramtypes",[]),__metadata$1("design:returntype",Promise)],StoreKit.prototype,"_getIsActiveSubscription",null),StoreKit}(ge),fr={configured:"musickitconfigured",loaded:"musickitloaded",audioTrackAdded:"audioTrackAdded",audioTrackChanged:"audioTrackChanged",audioTrackRemoved:"audioTrackRemoved",authorizationStatusDidChange:ur.authorizationStatusDidChange,authorizationStatusWillChange:ur.authorizationStatusWillChange,bufferedProgressDidChange:"bufferedProgressDidChange",capabilitiesChanged:"capabilitiesChanged",drmUnsupported:"drmUnsupported",eligibleForSubscribeView:ur.eligibleForSubscribeView,forcedTextTrackChanged:"forcedTextTrackChanged",mediaCanPlay:"mediaCanPlay",mediaElementCreated:"mediaElementCreated",mediaItemStateDidChange:"mediaItemStateDidChange",mediaItemStateWillChange:"mediaItemStateWillChange",mediaPlaybackError:"mediaPlaybackError",mediaSkipAvailable:"mediaSkipAvailable",mediaRollEntered:"mediaRollEntered",mediaUpNext:"mediaUpNext",metadataDidChange:"metadataDidChange",needsGDPRDidChange:"needsGDPRDidChange",nowPlayingItemDidChange:"nowPlayingItemDidChange",nowPlayingItemWillChange:"nowPlayingItemWillChange",playbackBitrateDidChange:"playbackBitrateDidChange",playbackDurationDidChange:"playbackDurationDidChange",playbackProgressDidChange:"playbackProgressDidChange",playbackStateDidChange:"playbackStateDidChange",playbackStateWillChange:"playbackStateWillChange",playbackTargetAvailableDidChange:"playbackTargetAvailableDidChange",playbackTargetIsWirelessDidChange:"playbackTargetIsWirelessDidChange",playbackTimeDidChange:"playbackTimeDidChange",playbackVolumeDidChange:"playbackVolumeDidChange",playerTypeDidChange:"playerTypeDidChange",presentationModeDidChange:"presentationModeDidChange",primaryPlayerDidChange:"primaryPlayerDidChange",queueIsReady:"queueIsReady",queueItemsDidChange:"queueItemsDidChange",queueItemForStartPosition:"queueItemForStartPosition",queuePositionDidChange:"queuePositionDidChange",shuffleModeDidChange:"shuffleModeDidChange",repeatModeDidChange:"repeatModeDidChange",storefrontCountryCodeDidChange:ur.storefrontCountryCodeDidChange,storefrontIdentifierDidChange:ur.storefrontIdentifierDidChange,textTrackAdded:"textTrackAdded",textTrackChanged:"textTrackChanged",textTrackRemoved:"textTrackRemoved",timedMetadataDidChange:"timedMetadataDidChange",userTokenDidChange:ur.userTokenDidChange};!function(t){t.apiStorefrontChanged="apiStorefrontChanged",t.hlsLevelUpdated="hlsLevelUpdated",t.mediaContentComplete="mediaContentComplete",t.playbackPause="playbackPause",t.playbackPlay="playbackPlay",t.playbackScrub="playbackScrub",t.playbackSeek="playbackSeek",t.playbackSkip="playbackSkip",t.playbackStop="playbackStop",t.playerActivate="playerActivate",t.playerExit="playerExit",t.queueModified="queueModified",t.userActivityIntent="userActivityIntent",t.applicationActivityIntent="applicationActivityIntent"}(lr||(lr={}));var yr={};function adaptAddEventListener(t,n,l,d){void 0===d&&(d={});var p=d.once,h=function(t,n){var l=getCallbacksForName(t),wrappedCallback=function(t,l){n(l)};return l.push([n,wrappedCallback]),wrappedCallback}(n,l);!0===p?t.subscribeOnce(n,h):t.subscribe(n,h)}function getCallbacksForName(t){var n=yr[t];return n||(n=[],yr[t]=n),n}var vr,gr=getHlsJsCdnConfig(),mr={app:{},features:{xtrick:!0,isWeb:!0,bookmarking:!1,"safari-native-hls":!0},supportedMediaTypes:wt,unencryptedPlaybackTypes:{"uploaded-videos":!0,uploadedVideo:!0,"uploaded-audios":!0,uploadedAudio:!0,"podcast-episodes":!0},urls:{hls:gr.hls,rtc:gr.rtc,mediaApi:"https://amp-api.music.apple.com/v1",webPlayback:"https://"+getCommerceHostname("play")+"/WebObjects/MZPlay.woa/wa/webPlayback"}};var _r=function(){function Store(t,n){var l=this;void 0===n&&(n={}),this._hasAuthorized=!1,this._providedRequestUserToken=!1,this._dispatcher=n.services.dispatcher,n.precache&&(this.precache=n.precache),n.storefrontId&&(this.storefrontId=n.storefrontId),this._defaultStorefrontCountryCode=n.storefrontCountryCode,(n.affiliateToken||n.campaignToken)&&(n.linkParameters=__assign(__assign({},n.linkParameters||{}),{at:n.affiliateToken,ct:n.campaignToken})),this.storekit=new hr(t,{apiBase:mr.urls.mediaApi,authenticateMethod:mr.features["legacy-authenticate-method"]?"POST":"GET",deeplink:n.linkParameters,disableAuthBridge:n.disableAuthBridge,iconURL:mr.app.icon,persist:n.persist,realm:n.realm||0}),this.storekit.addEventListener(fr.authorizationStatusDidChange,(function(t){var n=t.authorizationStatus;l._hasAuthorized=[Zt.AUTHORIZED,Zt.RESTRICTED].includes(n)}))}return Object.defineProperty(Store.prototype,"authorizationStatus",{get:function(){return this.storekit.authorizationStatus},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"cid",{get:function(){return this.storekit.cid},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"developerToken",{get:function(){return this.storekit.developerToken},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"hasAuthorized",{get:function(){return this._hasAuthorized},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"isAuthorized",{get:function(){return this.storekit.hasAuthorized},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"isRestricted",{get:function(){return this.storekit.authorizationStatus===Zt.RESTRICTED},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"musicUserToken",{get:function(){return this.storekit.userToken},set:function(t){this.storekit.userToken=t},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"dynamicMusicUserToken",{set:function(t){this.storekit.dynamicUserToken=t},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"needsGDPR",{get:function(){Mt.error("needsGDPR has been deprecated. Plesae migrate to shouldDisplayPrivacyLink()")},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"realm",{get:function(){return this.storekit.realm},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"requestUserToken",{set:function(t){this._providedRequestUserToken=!0,this.storekit.requestUserToken=t},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"restrictedEnabled",{get:function(){return this.storekit.restrictedEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"storefrontCountryCode",{get:function(){var t;return this.isAuthorized?this.storekit.storefrontCountryCode:null!==(t=this._defaultStorefrontCountryCode)&&void 0!==t?t:this.storekit.storefrontCountryCode},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"storefrontId",{get:function(){return this._apiStorefrontId||this.storekit.storefrontCountryCode},set:function(t){t&&(t=t.toLowerCase()),t!==this._apiStorefrontId&&(this._apiStorefrontId=t,this._dispatcher.publish(lr.apiStorefrontChanged,{storefrontId:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"subscribeURL",{get:function(){return this.storekit.deeplinkURL({p:"subscribe"})},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"subscribeFamilyURL",{get:function(){return this.storekit.deeplinkURL({p:"subscribe-family"})},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"subscribeIndividualURL",{get:function(){return this.storekit.deeplinkURL({p:"subscribe-individual"})},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"subscribeStudentURL",{get:function(){return this.storekit.deeplinkURL({p:"subscribe-student"})},enumerable:!0,configurable:!0}),Object.defineProperty(Store.prototype,"userToken",{get:function(){return this.musicUserToken},enumerable:!0,configurable:!0}),Store.prototype.authorize=function(){return __awaiter(this,void 0,void 0,(function(){var t,n=this;return __generator(this,(function(l){switch(l.label){case 0:return this.storekit.userTokenIsValid?[2,this.storekit.userToken]:[4,this.storekit.requestUserToken()];case 1:return t=l.sent(),this._providedRequestUserToken&&(this.storekit.userToken=t),this.storekit.userTokenIsValid?[4,this.storekit.requestStorefrontCountryCode().catch((function(t){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.unauthorize()];case 1:return n.sent(),[2,Promise.reject(t)]}}))}))}))]:[3,3];case 2:return l.sent(),[2,t];case 3:return[2]}}))}))},Store.prototype.shouldDisplayPrivacyLink=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.storekit.shouldDisplayPrivacyLink(t)]}))}))},Store.prototype.unauthorize=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.storekit.revokeUserToken()]}))}))},Store.prototype.validateAgeVerification=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l;return __generator(this,(function(d){switch(d.label){case 0:return 2!==this.storekit.realm?[2]:[4,this.storekit.me()];case 1:return(n=d.sent()).info?n.info.webAgeVerificationData&&!n.info.webAgeVerificationData.isVerified?[2,Promise.reject(new we(we.AGE_VERIFICATION,"Age verification required"))]:t.rating&&n.info.parentalControlsData&&n.info.parentalControlsData.videoContentRestrictions&&(l=t.rating.system.replace(/[^a-z0-9]+/i,"-"),n.info.parentalControlsData.videoContentRestrictions[l]<t.rating.value)?[2,Promise.reject(new we(we.CONTENT_RESTRICTED,"Content restricted"))]:[2]:[2]}}))}))},Store}(),br=/\/([a-z]{2})\/(album|artist|episode|movie|music-video|playlist|podcast|post|show|song|station)\/(?:[^\/]*\/)?(?:id)?(\d+|[a-z]{2}\.[a-z0-9\-]+|umc.cmc.[a-zA-Z0-9]+)(?:.*(?:[\?|\&]i=(\d+)).*)?.*$/i;function formattedSeconds(t){return{hours:Math.floor(t/3600),minutes:Math.floor(t%3600/60)}}function formatMediaTime(t,n){void 0===n&&(n=":");var l=formattedSeconds(t),d=l.hours,p=l.minutes;t=Math.floor(t%3600%60);var h=[];return d?(h.push(""+d),h.push(p<10?"0"+p:""+p)):h.push(""+p),h.push(t<10?"0"+t:""+t),h.join(n)}function formattedMediaURL(t){if(!br.test(t))throw new TypeError("Invalid Media URL: "+t);var n=__read(t.match(br),5),l=n[1],d=n[2],p=n[3],h=n[4];return"music-video"===d&&(d="musicVideo"),-1!==["album","playlist"].indexOf(d)&&h?(d="song",p=h):"podcast"===d&&h&&(d="episode",p=h),{storefrontId:l,kind:d,contentId:p,isUTS:!!p&&p.startsWith("umc.")}}function hasAuthorization(t){return void 0===t&&(t=vr&&vr.storekit),void 0!==t&&t.hasAuthorized&&t.userTokenIsValid}function hasMusicSubscription(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return void 0===t&&(t=vr&&vr.storekit),[2,t.hasMusicSubscription()]}))}))}function rewriteLastUrlPath(t,n){var l=t.split("/");return l.pop(),l.push(n),l.join("/")}var Pr,kr,getUpNextStart=function(t){return parseFloat(t.hlsMetadata["up-next.start"])},getWatchedTime=function(t){return parseFloat(t.hlsMetadata["watched.time"])},fetchHLSMetadata=function(t){return __awaiter(void 0,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:if(!t.isUTS||!t.assetURL)return[2];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,fetch(t.assetURL).then((function(t){return t.text()}))];case 2:return n=p.sent(),(l=n.match(/^(?:#EXT-X-SESSION-DATA:?)DATA\-ID="([^"]+)".+VALUE="([^"]+)".*$/gm))&&l.forEach((function(n){var l=n.split(",")[0].split("com.apple.hls.")[1].replace(/"/g,""),d=n.split(",")[1].split("VALUE=")[1].replace(/"/g,"");t.hlsMetadata[l]=d})),[3,4];case 3:return d=p.sent(),Mt.log(d),[3,4];case 4:return[2]}}))}))};(Pr=t.PlaybackType||(t.PlaybackType={}))[Pr.none=0]="none",Pr[Pr.preview=1]="preview",Pr[Pr.unencryptedFull=2]="unencryptedFull",Pr[Pr.encryptedFull=3]="encryptedFull",function(t){t[t.none=0]="none",t[t.loading=1]="loading",t[t.ready=2]="ready",t[t.playing=3]="playing",t[t.ended=4]="ended",t[t.unavailable=5]="unavailable",t[t.restricted=6]="restricted",t[t.error=7]="error",t[t.unsupported=8]="unsupported"}(kr||(kr={}));var Tr,Sr,Ar,parseSkipItems=function(t){var n=parseInt(t.hlsMetadata["skip.count"],10),l=[];if(isNaN(n)||0===n)return l;for(var d=0;d<n;d++)l.push({start:parseFloat(t.hlsMetadata["skip."+d+".start"]),duration:parseFloat(t.hlsMetadata["skip."+d+".duration"]),target:parseFloat(t.hlsMetadata["skip."+d+".target"]),label:t.hlsMetadata["skip."+d+".label"]});return l},parseRollItems=function(t,n){if(void 0===n&&(n=["pre-roll","mid-roll","post-roll"]),void 0===t.hlsMetadata)return[];var l=[];return n.forEach((function(n){var d=parseInt(t.hlsMetadata[n+".count"],10);if(!isNaN(d))for(var p=0;p<d;p++){var h=n+"."+p;l.push({index:p,type:n,skippable:"true"===t.hlsMetadata[h+".skippable"],"adam-id":t.hlsMetadata[h+".adam-id"],start:Math.round(parseFloat(t.hlsMetadata[h+".start"])),duration:Math.round(parseFloat(t.hlsMetadata[h+".duration"]))})}})),l},logDeprecation=function(t,n){if(void 0===n&&(n={}),Mt&&Mt.enabled){var l=[];l.push("Deprecation warning:"),l.push(n.message||t+" has been deprecated."),void 0!==n.until&&l.push(t+" will be removed in version "+n.until+"."),Mt.warn(l.join(" "))}},Bind=function(){return function(t,n,l){if(void 0===l||"function"!=typeof l.value)throw new TypeError("Only methods can be decorated with @Bind, but "+n+" is not a method.");return{configurable:!0,get:function(){var t=l.value.bind(this);return Object.defineProperty(this,n,{value:t,configurable:!0,writable:!0}),t}}}},wr=function(){function PlaybackMonitor(t){this.isActive=!1,this.isMonitoring=!1,this.watchers=[],this.handlePlaybackThreshold=this.handlePlaybackThreshold.bind(this),this.playbackController=t.controller,this.dispatcher=t.services.dispatcher,this.dispatcher.subscribe(fr.nowPlayingItemDidChange,this.handleMediaItemChange),this.apiManager=t.services.apiManager}return PlaybackMonitor.prototype.activate=function(){this.isActive=!0,this.startMonitor()},PlaybackMonitor.prototype.deactivate=function(){this.isActive=!1,this.clearMonitor()},PlaybackMonitor.prototype.clearMonitor=function(){this.isMonitoring&&(this.watchers.forEach((function(t){return t.stopMonitor()})),this.isMonitoring=!1)},PlaybackMonitor.prototype.shouldMonitor=function(){return this.isActive},PlaybackMonitor.prototype.startMonitor=function(){this.shouldMonitor()&&(this.watchers.forEach((function(t){return t.startMonitor()})),this.isMonitoring=!0)},PlaybackMonitor.prototype.handleMediaItemChange=function(){this.isActive&&(this.clearMonitor(),this.shouldMonitor()&&this.startMonitor())},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],PlaybackMonitor.prototype,"handleMediaItemChange",null),PlaybackMonitor}(),Ir=function(){function SpanWatcher(t,n,l,d,p){void 0===p&&(p=!1),this.dispatcher=t,this.callback=n,this.start=l,this.stop=d,this.allowMultiple=p,this.inWatchSpan=!1}return SpanWatcher.prototype.startMonitor=function(){this.dispatcher.unsubscribe(fr.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(fr.playbackTimeDidChange,this.handleTimeChange)},SpanWatcher.prototype.stopMonitor=function(){this.dispatcher.unsubscribe(fr.playbackTimeDidChange,this.handleTimeChange)},SpanWatcher.prototype.handleTimeChange=function(t,n){var l=n.currentPlaybackTime;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return!Number.isFinite(l)||l<this.start||l>this.stop?(this.inWatchSpan=!1,[2]):this.inWatchSpan?[2]:(this.allowMultiple||this.stopMonitor(),this.inWatchSpan=!0,[4,this.callback(l,this)]);case 1:return t.sent(),[2]}}))}))},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],SpanWatcher.prototype,"handleTimeChange",null),SpanWatcher}(),Er=function(t){function RollMonitor(n){var l=t.call(this,n)||this;return l.rollMap=new Map,l}return __extends(RollMonitor,t),RollMonitor.prototype.handlePlaybackThreshold=function(t,n){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(l){return this.rollMap.has(n)?(t=this.rollMap.get(n),this.dispatcher.publish(fr.mediaRollEntered,t),this.rollMap.delete(n),[2]):[2]}))}))},RollMonitor.prototype.shouldMonitor=function(){return!!t.prototype.shouldMonitor.call(this)&&this.getRollMetadata().length>0},RollMonitor.prototype.startMonitor=function(){this.setupWatchers(this.getRollMetadata()),t.prototype.startMonitor.call(this)},RollMonitor.prototype.getRollMetadata=function(){var t=this.playbackController.nowPlayingItem;return void 0===t?[]:parseRollItems(t,["pre-roll","post-roll"])},RollMonitor.prototype.setupWatchers=function(t){var n=this,l=[];t.forEach((function(t){var d=t.start,p=t.duration,h=new Ir(n.dispatcher,n.handlePlaybackThreshold,d,d+p);l.push(h),n.rollMap.set(h,t)})),this.watchers=l},RollMonitor}(wr),Rr=function(t){function SkipAvailable(n){var l=t.call(this,n)||this;return l.skipMap=new Map,l}return __extends(SkipAvailable,t),SkipAvailable.prototype.handlePlaybackThreshold=function(t,n){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(l){return this.skipMap.has(n)?(t=this.skipMap.get(n),this.dispatcher.publish(fr.mediaSkipAvailable,t),this.skipMap.delete(n),[2]):[2]}))}))},SkipAvailable.prototype.shouldMonitor=function(){return!!t.prototype.shouldMonitor.call(this)&&this.getNowPlayingMetadata().length>0},SkipAvailable.prototype.startMonitor=function(){this.setupWatchers(this.getNowPlayingMetadata()),t.prototype.startMonitor.call(this)},SkipAvailable.prototype.getNowPlayingMetadata=function(){var t=this.playbackController.nowPlayingItem;return void 0===t?[]:parseSkipItems(t)},SkipAvailable.prototype.setupWatchers=function(t){var n=this,l=[];t.forEach((function(t){var d=t.start,p=t.duration,h=new Ir(n.dispatcher,n.handlePlaybackThreshold,d,d+p);l.push(h),n.skipMap.set(h,t)})),this.watchers=l},SkipAvailable}(wr),Cr=function(t){function UpNextMonitor(n){var l=t.call(this,n)||this,d=l.handlePlaybackThreshold;return l.watchers=[{startMonitor:function(){l.dispatcher.unsubscribe(lr.mediaContentComplete,d),l.dispatcher.subscribe(lr.mediaContentComplete,d)},stopMonitor:function(){l.dispatcher.unsubscribe(lr.mediaContentComplete,d)}}],l}return __extends(UpNextMonitor,t),UpNextMonitor.prototype.handlePlaybackThreshold=function(){var t,n,l,d;return __awaiter(this,void 0,void 0,(function(){var p,h,f,y,v=this;return __generator(this,(function(g){switch(g.label){case 0:if("Episode"!==(null==(p=this.playbackController.nowPlayingItem)?void 0:p.type))return[3,5];h=void 0,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,null===(t=this.apiManager.utsAPI)||void 0===t?void 0:t.showEpisodeNextepisode({showId:null===(n=null==p?void 0:p.attributes)||void 0===n?void 0:n.showId,episodeId:null==p?void 0:p.id})];case 2:return h=g.sent(),[3,4];case 3:return g.sent(),[3,4];case 4:if(h&&this.isAppleOriginal(h))return this.dispatcher.publish(fr.mediaUpNext,{item:h,isNextEpisode:!0}),[2];g.label=5;case 5:return[4,null===(l=this.apiManager.utsAPI)||void 0===l?void 0:l.getPostPlayShelf(null==p?void 0:p.id)];case 6:return(null==(f=g.sent())?void 0:f.items)?[3,8]:[4,null===(d=this.apiManager.utsAPI)||void 0===d?void 0:d.watchlistContinueWatching()];case 7:f=g.sent(),g.label=8;case 8:return(null==f?void 0:f.items)&&Array.isArray(f.items)?((y=f.items.find((function(t){return v.isAppleOriginal(t)&&"Show"!==t.type})))&&this.dispatcher.publish(fr.mediaUpNext,{item:y}),[2]):[2]}}))}))},UpNextMonitor.prototype.shouldMonitor=function(){return!!t.prototype.shouldMonitor.call(this)&&(void 0!==this.playbackController.nowPlayingItem&&(n=this.playbackController.nowPlayingItem,!isNaN(getUpNextStart(n))&&!isNaN(getWatchedTime(n))));var n},UpNextMonitor.prototype.isAppleOriginal=function(t){var n;return t.isAppleOriginal||(null===(n=t.content)||void 0===n?void 0:n.isAppleOriginal)},UpNextMonitor}(wr);(Tr=t.PlaybackBitrate||(t.PlaybackBitrate={}))[Tr.STANDARD=64]="STANDARD",Tr[Tr.HIGH=256]="HIGH",(Sr=t.PlaybackStates||(t.PlaybackStates={}))[Sr.none=0]="none",Sr[Sr.loading=1]="loading",Sr[Sr.playing=2]="playing",Sr[Sr.paused=3]="paused",Sr[Sr.stopped=4]="stopped",Sr[Sr.ended=5]="ended",Sr[Sr.seeking=6]="seeking",Sr[Sr.waiting=8]="waiting",Sr[Sr.stalled=9]="stalled",Sr[Sr.completed=10]="completed",(Ar=t.PresentationMode||(t.PresentationMode={}))[Ar.pictureinpicture=0]="pictureinpicture",Ar[Ar.inline=1]="inline";var Or,typeRequiresItem=function(t){return[lr.playbackPlay,lr.playbackSkip].includes(t)},itemIsRequired=function(t,n){return void 0!==n&&typeRequiresItem(t)},cleanContainer=function(t){var n=__assign({},t);return delete n.attributes,n},computeContainer=function(t,n){var l,d,p=function(t,n){var l;return itemIsRequired(t,n)&&(null===(l=null==n?void 0:n.container)||void 0===l?void 0:l.name)||null}(t,n),h=itemIsRequired(t,n)?__assign(__assign({},null==n?void 0:n.container),null===(d=null===(l=null==n?void 0:n.container)||void 0===l?void 0:l.attributes)||void 0===d?void 0:d.playParams):null;if(null!==p||null!==h)return{container:cleanContainer(__assign(__assign({},h),null!==p?{name:p}:{}))}},generateItemDescriptorForPAF=function(t,n){var l=__assign(__assign(__assign(__assign({},function(t,n){var l;if(!typeRequiresItem(t))return{};if(void 0===n)return{};var d=null===(l=n.attributes)||void 0===l?void 0:l.mediaKind;return __assign(__assign({},void 0!==d?{mediaType:d}:{}),n.playParams)}(t,n)),function(t,n){if(!typeRequiresItem(t)||void 0===n)return{};var l=n.context;return{recoData:(void 0===l?{}:l).reco_id}}(t,n)),function(t,n){if(!typeRequiresItem(t)||void 0===n)return{};var l=n.playbackDuration;return l?{duration:l/1e3}:{}}(t,n)),computeContainer(t,n));return Mt.trace("PAF descriptor",l),l},asCode=function(n){switch(typeof n){case"string":return n;case"undefined":return"undefined";default:return"PlayActivityEndReasonType."+t.PlayActivityEndReasonType[n]}},Mr=function(){function PAFTrackerAPI(){}return Object.defineProperty(PAFTrackerAPI.prototype,"apiService",{get:function(){if(void 0===this.service)throw new we(we.CONFIGURATION_ERROR,"Play Activity service was called before configuration.");return this.service},enumerable:!0,configurable:!0}),PAFTrackerAPI.prototype.configure=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this.service=new St(t.developerToken,t.musicUserToken,t.storefrontCountryCode,{app:{build:mr.app.build,name:mr.app.name,version:mr.app.version},fetch:!Rt&&fetch.bind(window),logInfo:Mt.enabled,sourceType:t.sourceType,services:n.services,userIsSubscribed:function(){return t.isAuthorized&&vr.storekit._getIsActiveSubscription.getCachedValue()}}),[2,this]}))}))},PAFTrackerAPI.prototype.cleanup=function(){},PAFTrackerAPI.prototype.shouldConfigure=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,void 0!==t.musicUserToken]}))}))},PAFTrackerAPI.prototype.activate=function(t){return void 0===t&&(t={}),this.apiService.activate(t.flush)},PAFTrackerAPI.prototype.exit=function(t){return void 0===t&&(t={}),Mt.debug("PAF debug","client.exit("+t.position+")"),this.apiService.exit(t.position)},PAFTrackerAPI.prototype.pause=function(t,n){return void 0===n&&(n={}),Mt.debug("PAF debug","client.pause("+n.position+")"),this.apiService.pause(n.position)},PAFTrackerAPI.prototype.play=function(t,n){void 0===n&&(n={});var l=generateItemDescriptorForPAF(lr.playbackPlay,t);return Mt.debug("PAF debug","client.play("+JSON.stringify(l)+", "+n.position+")"),this.apiService.play(l,n.position)},PAFTrackerAPI.prototype.scrub=function(t,n){return void 0===n&&(n={}),Mt.debug("PAF debug","client.scrub("+n.position+", "+asCode(n.endReasonType)+")"),this.apiService.scrub(n.position,n.endReasonType)},PAFTrackerAPI.prototype.seek=function(n,l){return void 0===l&&(l={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(d){switch(d.label){case 0:return[4,this.scrub(n,{position:l.startPosition,endReasonType:t.PlayActivityEndReasonType.SCRUB_BEGIN})];case 1:return d.sent(),[4,this.scrub(n,{position:l.position,endReasonType:t.PlayActivityEndReasonType.SCRUB_END})];case 2:return d.sent(),[2]}}))}))},PAFTrackerAPI.prototype.skip=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:l=generateItemDescriptorForPAF(lr.playbackSkip,t),Mt.debug("PAF debug","client.skip("+JSON.stringify(l)+", "+asCode(n.direction)+", "+n.position+")"),p.label=1;case 1:return p.trys.push([1,3,,7]),[4,this.apiService.skip(l,n.direction,n.position)];case 2:return p.sent(),[3,7];case 3:return"A play stop() method was called without a previous play() descriptor"!==(d=p.sent()).message?[3,5]:[4,this.play(t,n)];case 4:return p.sent(),[3,6];case 5:return[2,Promise.reject(d)];case 6:return[3,7];case 7:return[2]}}))}))},PAFTrackerAPI.prototype.stop=function(n,l){var d;return void 0===l&&(l={}),(null==n?void 0:n.isLiveRadioStation)&&l.position&&(l.position=l.position-l.startPosition),(null==n?void 0:n.isLiveRadioStation)&&(l.endReasonType=null!==(d=l.endReasonType)&&void 0!==d?d:t.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED),Mt.debug("PAF debug","client.stop("+l.position+", "+asCode(l.endReasonType)+")"),this.apiService.stop(l.position,l.endReasonType)},PAFTrackerAPI.prototype.shouldTrackPlayActivity=function(n,l){var d=hasAuthorization(),p=!l||l.playbackType!==t.PlaybackType.preview,h=this.alwaysSendForActivityType(n),f=!l||l&&this.mediaRequiresPlayActivity(l);return!(!d||!p||!h&&!f)},PAFTrackerAPI.prototype.alwaysSendForActivityType=function(t){return t===lr.playerActivate||t===lr.playerExit},PAFTrackerAPI.prototype.mediaRequiresPlayActivity=function(t){return isAUC(t.type)||-1!==["musicVideo","song","radioStation"].indexOf(t.type)},PAFTrackerAPI}(),Dr=[lr.playbackPause,lr.playbackPlay,lr.playbackScrub,lr.playbackSeek,lr.playbackSkip,lr.playbackStop,lr.playerActivate,lr.playerExit,fr.nowPlayingItemWillChange],Nr=((Or={})[lr.playbackPause]="pause",Or[lr.playbackPlay]="play",Or[lr.playbackScrub]="scrub",Or[lr.playbackSeek]="seek",Or[lr.playbackSkip]="skip",Or[lr.playbackStop]="stop",Or[lr.playerActivate]="activate",Or[lr.playerExit]="exit",Or),Lr=function(){function PlayActivityService(t,n){this.isBuffering=!1,this.apis=Array.isArray(t)?t:[t],this.dispatcher=n}return PlayActivityService.prototype.cleanup=function(){this.currentItem=void 0,this.teardownWatchers(),this.apis.forEach((function(t){return t.cleanup()}))},PlayActivityService.prototype.configure=function(t,n){return __awaiter(this,void 0,void 0,(function(){var l,d,p,h;return __generator(this,(function(f){switch(f.label){case 0:return[4,Promise.all(this.apis.map((function(n){return n.shouldConfigure(t)})))];case 1:if(l=f.sent(),0===(d=this.apis.filter((function(t,n){return l[n]}))).length)return[2];this.cleanup(),this.instance=t,p=d.map((function(l){return l.configure(t,n)})),f.label=2;case 2:return f.trys.push([2,4,5,6]),[4,Promise.all(p)];case 3:return f.sent(),[3,6];case 4:return h=f.sent(),Mt.error("Error configuring a play activity service",h),[3,6];case 5:return this.setupWatchers(),this.clearIntention(),[7];case 6:return[2]}}))}))},PlayActivityService.prototype.getTrackerByType=function(t){return this.apis.find((function(n){return n instanceof t}))},PlayActivityService.prototype.handleEvent=function(t,n){void 0===n&&(n={});var l=n.item;void 0!==l&&(this.currentItem=l),Mt.debug(t,n);var d=Nr[t];if(void 0!==d){var p=this.addIntention(t,n);switch(delete p.item,t){case lr.playbackPause:case lr.playbackPlay:case lr.playbackScrub:case lr.playbackSeek:case lr.playbackSkip:case lr.playbackStop:return this.callApis(t,d,this.currentItem,p);case lr.playerActivate:p.flush="boolean"==typeof n.isPlaying?!n.isPlaying:void 0;case lr.playerExit:return this.callApis(t,d,p);case fr.nowPlayingItemWillChange:this.currentItem=l}}},PlayActivityService.prototype.addIntention=function(t,n){var l=__assign({},n);return this.shouldAddIntention(t)?(l=__assign(__assign(__assign({},this.lastUserIntent),this.lastApplicationIntent),l),this.clearIntention(),l):l},PlayActivityService.prototype.callApis=function(t,n){for(var l=[],d=2;d<arguments.length;d++)l[d-2]=arguments[d];return __awaiter(this,void 0,void 0,(function(){var d,p=this;return __generator(this,(function(h){return d=this.apis.map((function(d){if("function"==typeof d[n]&&d.shouldTrackPlayActivity(t,p.currentItem))return d[n].apply(d,__spread(l))})),[2,Promise.all(d)]}))}))},PlayActivityService.prototype.clearIntention=function(){this.lastUserIntent=void 0,this.lastApplicationIntent=void 0},PlayActivityService.prototype.onPlaybackStateChange=function(n,l){return __awaiter(this,void 0,void 0,(function(){var n,d;return __generator(this,(function(p){return n=l.state,d={position:this.instance.currentPlaybackTime},n===t.PlaybackStates.waiting?(this.isBuffering=!0,[2,this.callApis("bufferStart","bufferStart",this.currentItem,d)]):n===t.PlaybackStates.playing&&this.isBuffering?(this.isBuffering=!1,[2,this.callApis("bufferEnd","bufferEnd",this.currentItem,d)]):[2]}))}))},PlayActivityService.prototype.recordApplicationIntent=function(t,n){this.lastApplicationIntent=n},PlayActivityService.prototype.recordUserIntent=function(t,n){this.lastUserIntent=n},PlayActivityService.prototype.shouldAddIntention=function(t){return[lr.playbackPause,lr.playbackStop].includes(t)},PlayActivityService.prototype.setupWatchers=function(){var t=this;Dr.forEach((function(n){t.dispatcher.subscribe(n,t.handleEvent)})),this.dispatcher.subscribe(lr.userActivityIntent,this.recordUserIntent),this.dispatcher.subscribe(lr.applicationActivityIntent,this.recordApplicationIntent),this.dispatcher.subscribe(fr.playbackStateDidChange,this.onPlaybackStateChange)},PlayActivityService.prototype.teardownWatchers=function(){var t=this;Dr.forEach((function(n){t.dispatcher.unsubscribe(n,t.handleEvent)})),this.dispatcher.unsubscribe(lr.userActivityIntent,this.recordUserIntent),this.dispatcher.unsubscribe(lr.applicationActivityIntent,this.recordApplicationIntent),this.dispatcher.unsubscribe(fr.playbackStateDidChange,this.onPlaybackStateChange)},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",void 0)],PlayActivityService.prototype,"handleEvent",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],PlayActivityService.prototype,"onPlaybackStateChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],PlayActivityService.prototype,"recordApplicationIntent",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],PlayActivityService.prototype,"recordUserIntent",null),PlayActivityService}(),xr={setDelegate:!0};function isDefinedNonNull(t){return function(t){return void 0!==t}(t)&&null!==t}function isFunction(t){return"function"==typeof t}function isNumber(t){return"number"==typeof t}function isInteger(t){return isNumber(t)&&t%1==0}function isArray(t){return t&&t.constructor===Array}function extend(t){var n=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return copyKeysAndValues.apply(null,n)}function copyKeysAndValues(t,n,l,d){for(var p,h=l&&d||{},f=3;f<arguments.length;f++)for(var y in p=arguments[f])if(Object.prototype.hasOwnProperty.call(p,y)){var v=p[y];(t||null!=v)&&(n||"function"!=typeof v)&&(h[y]=v)}return h}function attachDelegate(t,n){var l=!1;if(t&&n&&t!==n){var d={};Object.keys(n).forEach((function(n){t[n]||(d[n]=!0)})),extend(d,xr),l=attachMethods(t,n,null,d)}return l}function attachMethods(t,n,l,d){var p=!1;if(t&&n){d=d||{},l=l||n;var captureFunction=function(t,n,l,d){var returnValue=function(){return l[d].apply(t,arguments)};return n&&(returnValue.origFunction=n),returnValue};for(var h in n)if(!(h in d)&&n[h]&&isFunction(n[h])){var f=t[h],y=f&&isFunction(f)?f.bind(t):null;t[h]=captureFunction(l,y,n,h),p=!0}}return p}function setDelegates(t,n){var l={};for(var d in t)n[d]&&isFunction(t[d].setDelegate)&&(l[d]=t[d].setDelegate(n[d]));return l}function exceptionString(t,n){return"The function "+t+"."+n+"() must be overridden with a platform-specific delegate function.If you have no data for this function, have your delegate return null or undefined (no 'return')"}var Ur={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(t){return attachDelegate(this,t)},execute:function(t,n,l){var d=t.levelStringToIntMap[n];if(t.level()!==t.NONE&&t.level()<=d){var p=Array.prototype.slice.call(l),h=Ur.nonFlagLogArguments(p),f=Ur.logOptions(t,d,p),y=f.includeCallStack?(new Error).stack:null,v=y?h.concat("\n"+y):h;if(t[n]._lastLog=v,f.mirrorToServer&&Ur.sendToServer(t,n,h,y),f.throwInsteadOfPrint)throw new Error(h.toString());f.suppressClientOutput||(console[n]?console[n].apply(console,v):console.log.apply(console,v))}},isFlagObject:function(t){return t&&t===Ur.flagArguments[t.constructor.name]},nonFlagLogArguments:function(t){return t.filter((function(t){return!Ur.isFlagObject(t)}))},logOptions:function(t,n,l){var d,p={};return l.forEach((function(t){Ur.isFlagObject(t)&&(d=function(t,n){var l="";if(t)for(var d,p=t.toLowerCase().split("_"),h=0;h<p.length;h++)d=p[h][0],(0!==h||n)&&(d=d.toUpperCase()),l+=d+p[h].slice(1);return l}(t.constructor.name),p[d]=!0)})),isFunction(t.mirrorToServerLevel)&&t.mirrorToServerLevel()!==t.NONE&&t.mirrorToServerLevel()<=n&&(p.mirrorToServer=!0),t.throwLevel()!==t.NONE&&t.throwLevel()<=n&&(p.throwInsteadOfPrint=!0),p},sendToServer:function(t,n,l,d){}},Br={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},jr={loggerName:"defaultLogger",level:Br.INFO,throwLevel:Br.NONE},Fr=!1,Kr={};function Logger$1(t){this._loggerName=t,this._level,this._throwLevel,Fr||(Fr=!0,extend(Logger$1.prototype,Br),extend(Logger$1.prototype,Ur.flagArguments))}function loggerNamed(t){var n=Kr[t=t||jr.loggerName];return n||(n=new Logger$1(t),Kr[t]=n),n}Logger$1.level=function(){return jr.level},Logger$1.throwLevel=function(){return jr.throwLevel},Logger$1.prototype.setDelegate=function(t){return attachDelegate(this,t)},Logger$1.prototype.loggerName=function(){return this._loggerName},Logger$1.prototype.levelParameterAsInt=function(t){var n,l,d=null;return"string"==typeof(l=t)||l instanceof String?n=this.levelStringToIntMap[t.toLowerCase()]:isNumber(t)&&(n=t),n>=this.MIN_LEVEL&&n<=this.MAX_LEVEL&&(d=n),d},Logger$1.prototype.setLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._level=n)},Logger$1.prototype.setThrowLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._throwLevel=n)},Logger$1.prototype.level=function(){var t=this._level;return isNumber(t)?t:Logger$1.level()},Logger$1.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},Logger$1.prototype.throwLevel=function(){var t=this._throwLevel;return isNumber(t)?t:Logger$1.throwLevel()},Logger$1.prototype.debug=function(){Ur.execute(this,"debug",arguments)},Logger$1.prototype.info=function(){Ur.execute(this,"info",arguments)},Logger$1.prototype.warn=function(){Ur.execute(this,"warn",arguments)},Logger$1.prototype.error=function(){Ur.execute(this,"error",arguments)},Logger$1.prototype.lastLog=function(t){return this[t]?this[t]._lastLog:null};var Vr={LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage"},_storageObject=function(t){var n=null,l=!1;return function(){return t?n=t:(l||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),l=!0),n||(n={storage:{},getItem:function(t){return this.storage[t]},setItem:function(t,n){this.storage[t]=n},removeItem:function(t){delete this.storage[t]}})),n}};function _defaultStorageObject(t){var n=null,l=t===Vr.LOCAL_STORAGE;try{n="undefined"!==(l?typeof localStorage:typeof sessionStorage)?l?localStorage:sessionStorage:null}catch(e){n=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+e)}return n}var $r=_storageObject(_defaultStorageObject(Vr.LOCAL_STORAGE)),Hr=_storageObject(_defaultStorageObject(Vr.SESSION_STORAGE));function saveObjectToStorage(t,n,l){var d=null;if(l)try{t.setItem(n,JSON.stringify(l)),d=l}catch(e){}else d=t.removeItem(n);return d}function objectFromStorage(t,n){var l=null,d=t.getItem(n);if(d)try{l=JSON.parse(d)}catch(e){l=void 0}return l}var zr={maxWait:1500,initialDelay:100,factor:2},ExponentialStrategy=function(t,n,l){this.delay=t||zr.initialDelay,this.maxWait=isNumber(n)?n:zr.maxWait,this.factor=l||zr.factor,this.timeWaited=0};function exponentialBackoff(t,n,l,d,p,h){!function _backoff(t,n,l,d){n.call(n,l,(function(){var p=t.nextDelay();p?setTimeout(_backoff.bind(null,t,n,l,d),p):d.apply(d,arguments)}))}(new ExponentialStrategy(d,p,h),t,n,l)}function _valueForKeyPath(t,n,l){var d=n;if(t&&n)for(var p=t.split("."),h=0;d&&h<p.length;h++){var f=p[h];!(f in d)&&l&&(d[f]={}),d=f in d?d[f]:null}return d}function valueForKeyPath(t){var n=null;if(t&&arguments.length>1)for(var l=sourcesArray(Array.prototype.slice.call(arguments,1)),d=l.length-1;d>=0;d--){var p=l[d];if(isDefinedNonNull(n=_valueForKeyPath(t,p)))break}return n}function sourcesArray(t){var n=[],l=[];l=l.concat(t),arguments&&arguments.length>1&&(l=l.concat(Array.prototype.slice.call(arguments,1)));for(var d=0;d<l.length;d++){var p=l[d];n=n.concat(p)}return n}function makeAjaxRequest(t,n,l,d,p,h){var f=new XMLHttpRequest;l=l||void 0,h=h||{},d=isFunction(d)?d:function(){},p=isFunction(p)?p:function(){};var y=!1!==h.async;h.timeout&&y&&(f.timeout=h.timeout),f.onload=function(){f.status>=200&&f.status<300?d(f.response):p(new Error("XHR error: server responded with status "+f.status+" "+f.statusText),f.status)},f.onerror=function(){p(new Error("XHR error"))},f.open(n,t,y),f.withCredentials=!0,f.setRequestHeader("Content-type","application/json"),f.send(l)}ExponentialStrategy.prototype.nextDelay=function(){var t=null,n=this.maxWait-this.timeWaited;return n>0&&(this.delay=Math.min(this.delay,n),this.timeWaited+=this.delay),(0===this.maxWait||n>0)&&(t=this.delay,this.delay=this.delay*this.factor),t};var Wr={setDelegate:function(t){return attachDelegate(this,t)},localStorageObject:$r,sessionStorageObject:Hr},Yr={setDelegate:function(t){return attachDelegate(this,t)},makeAjaxRequest:makeAjaxRequest},qr={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"https://xp.apple.com/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"https://xp.apple.com/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},Gr={},_appendSectionAndSubsectionToConfigSources=function(t,n,l){if(l){t.push(l);var d=l[n];d&&function(t){for(var n in t)if(t.hasOwnProperty(n))return!0}(d)&&t.push(d)}},Config=function(t){this._topic=t,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+qr.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+qr.compoundSeparator+this._topic};function disabled(t){return!!this.value("disabled",t)}function blacklistedEvents(t){return this.value("blacklistedEvents",t)||[]}function blacklistedFields(t){return this.value("blacklistedFields",t)||[]}function removeBlacklistedFields(t,n){if(t)for(var l=blacklistedFields.call(this,n),d=0;d<l.length;d++){var p=l[d];p&&p in t&&delete t[p]}return t}function metricsDisabledOrBlacklistedEvent(t,n){return disabled.call(this,n)||!!t&&blacklistedEvents.call(this,n).indexOf(t)>-1}Config.createConfig=function(t,n,l,d){var p=Config.getConfig(t);return t&&"noTopicConfig"!==t&&!p._initCalled&&p.init(n,l,d),p},Config.getConfig=function(t){var n=Gr[t=t||"noTopicConfig"];return n||(n=new Config(t),Gr[t]=n),n},Config.defaultConfig=function(){return Config.getConfig()},Config.value=function(t,n){var l=n&&Gr[n]||Config.defaultConfig();return l.value.call(l,t)},Config.environment=Wr,Config.logger=loggerNamed("mt-client-config"),Config.network=Yr,Config.prototype._defaults=function(){return qr},Config.prototype._setInitialized=function(t){this._initialized=t},Config.prototype._setInitCalled=function(t){this._initCalled=t},Config.prototype._setShowedDebugWarning=function(t){this._showedDebugWarning=t},Config.prototype._setShowedNoProvidedSourceWarning=function(t){this._showedNoProvidedSourceWarning=t},Config.prototype.setDelegate=function(t){return attachDelegate(this,t)},Config.prototype.topic=function(){return this._topic},Config.prototype.configHostname=function(){},Config.prototype.configUrl=function(){var t,n=this.configHostname();return t=n?"https://"+n+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?t+="/"+this.topic():Config.logger.error("config.configUrl(): Topic must be provided"),t},Config.prototype.sources=function(){},Config.prototype.value=function(t){var n,l=this.cachedSource(),d=this.serviceSource(),p=this.sources(),h=this.debugSource(),f=l||d||p||h;return p||d||t in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,Config.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),h&&(this._showedDebugWarning||(this._showedDebugWarning=!0,Config.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),isArray(p)||(p=[p]),n=0===t.indexOf("blacklisted")?f?[l,d,p,h]:[qr]:[qr,l,d,p,h],n=this.configSourcesWithOverrides(n,this.topic()),valueForKeyPath.apply(null,[t].concat(n))},Config.prototype.configSourcesWithOverrides=function(t,n){var l=t;if(t&&t.length&&n){l=[];for(var d=0;d<t.length;d++){var p=t[d];if(p)if(isArray(p)&&p.length){for(var h=[],f=0;f<p.length;f++)_appendSectionAndSubsectionToConfigSources(h,n,p[f]);l.push(h)}else _appendSectionAndSubsectionToConfigSources(l,n,p)}}return l},Config.prototype.setDebugSource=function(t){return this._debugSource=t||null,saveObjectToStorage(Wr.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},Config.prototype.debugSource=function(){return this._debugSource||(this._debugSource=objectFromStorage(Wr.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},Config.prototype.setCachedSource=function(t){return this._cachedSource=t||null,saveObjectToStorage(Wr.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},Config.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=objectFromStorage(Wr.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},Config.prototype.setServiceSource=function(t){return this._serviceSource=t,this._serviceSource},Config.prototype.serviceSource=function(){return this._serviceSource},Config.prototype.fetchConfig=function(t,n,l){l=l||function(){};exponentialBackoff(Yr.makeAjaxRequest.bind(Yr,t,"GET",null),(function(t){var d;try{t=JSON.parse(t),d=!0}catch(e){l.call(l,e)}d&&n&&n.call(n,t)}),l)},Config.prototype.init=function(t,n,l){if(!this._initCalled){this._initCalled=!0,n=n||function(){};var d=function(){this._initialized=!0,n.call(n)}.bind(this);if(t)this.setDelegate({sources:t}),d();else{this.setCachedSource(this.cachedSource());var p=this.configUrl(),h=function(t){this.setCachedSource(t),this.setServiceSource(t),d()}.bind(this);this.fetchConfig(p,h,l)}}},Config.prototype.initialize=function(t,n,l){return this.init.apply(this,Array.prototype.slice.call(arguments))},Config.prototype.initialized=function(){return this._initialized};function recordEvent(t,n,l){var d=null;return l&&!metricsDisabledOrBlacklistedEvent.call(Config,l.eventType,n)&&(removeBlacklistedFields.call(Config,l,n),t.apply(null,Array.prototype.slice.call(arguments,1)),d=l),d}var Qr=1e4,Jr="events",Xr="1.0",Zr=2;function enrichAndSerializeEvents(t){var n=null;if(t&&t.length){var l={};l.deliveryVersion=Xr,l.postTime=Date.now(),l[Jr]=t;try{n=JSON.stringify(l)}catch(e){loggerNamed("mt-event-queue").error("Error stringifying events as JSON: "+e)}}return n}function _immediateRecordEvent(t,n){var l=enrichAndSerializeEvents([n]);l&&makeAjaxRequest(function(t){return Config.value("metricsUrl",t)+"/"+Zr+"/"+t}(t),"POST",l,null,null,{timeout:function(t){var n=Config.value("requestTimeout",t)||Qr;return n=Math.min(n,Config.value("postFrequency",t))}(t)})}var ei,ti,ri,ii={recordEvent:function(t,n){return recordEvent.apply(null,[_immediateRecordEvent].concat(Array.prototype.slice.call(arguments)))},sendMethod:function(){return"javascript"}},ni={_document:function(){if("undefined"!=typeof document)return document;throw"metricskit-delegates-html.environment HTML delegate 'document' object not found"},_window:function(){if("undefined"!=typeof window)return window;throw"metricskit-delegates-html.environment HTML delegate 'window' object not found"},cookie:function(){return ni._window().document.cookie},pageUrl:function(){return ni._window().location.href},parentPageUrl:function(){var t,n=ni._window(),l=n.parent;if(l!==n)try{t=l.location.href}catch(e){t=ni._document().referrer}return t},pixelRatio:function(){return ni._window().devicePixelRatio},screenHeight:function(){return ni._window().screen.height},screenWidth:function(){return ni._window().screen.width},userAgent:function(){return ni._window().navigator.userAgent},windowInnerHeight:function(){return ni._window().innerHeight},windowInnerWidth:function(){return ni._window().innerWidth},windowOuterHeight:function(){return ni._window().outerHeight},windowOuterWidth:function(){return ni._window().outerWidth},timeOriginOffset:function(){var t=null,n=ni._window().performance;return n&&n.timing&&(t=n.timing.navigationStart),t},app:function(){},appVersion:function(){},capacityData:function(){},capacityDataAvailable:function(){},capacityDisk:function(){},capacitySystem:function(){},capacitySystemAvailable:function(){},connectionType:function(){},dsId:function(){},hardwareBrand:function(){},hardwareFamily:function(){},hardwareModel:function(){},hostApp:function(){},hostAppVersion:function(){},os:function(){},osBuildNumber:function(){},osLanguages:function(){},osVersion:function(){},resourceRevNum:function(){},storeFrontCountryCode:function(){},storeFrontHeader:function(){},userType:function(){}};function mergeAndCleanEventFields(t){for(var n=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),l=[],d=0;d<n.length;d++){var p=n[d];if(p&&p.constructor===Array)for(var h=0;h<p.length;h++)l.push(p[h]);else l.push(p)}return copyKeysAndValues.apply(null,l)}function processMetricsData(t,n,l,d){var p=mergeAndCleanEventFields(d),h=p;if(t&&n){var f={};if(l||(n=n.filter((function(t){return t in p}))),n.length)for(var y=0;y<n.length;y++){var v=n[y],g=t[v];isFunction(g)&&(f[v]=g.call(t,p))}h=mergeAndCleanEventFields(h,f)}return h}function applyFieldsMap(t,n,l,d){var p,h,f,y;if(t&&n&&l){var v,g;if(h={},p=valueForKeyPath(n,l,l.custom))if(isArray(p))for(v=0;v<p.length;++v)isDefinedNonNull(g=t[p[v]])&&(h[p[v]]=g);else if((y=p)&&y.constructor===Object){for(var m in p)for(v=0;v<p[m].length;++v)if(isDefinedNonNull(g=valueForKeyPath(p[m][v],t))){h[m]=g;break}}else f="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else f="metrics: unable to get "+n+" section from fieldsMap"}else{var _=[];t||_.push("data"),n||_.push("sectionName"),l||_.push("fieldsMap"),f="metrics: missing argument(s): "+_.join(",")+" not provided to applyFieldsMap"}return f&&isFunction(d)&&d(f),h}function environmentBaseFieldNames(){return ti||(ti=["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].concat(["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"])),ti}function Base(t){this.setDelegate({topic:t}),ri||(ri=!0,environmentBaseFieldNames().forEach(function(t){Base.prototype[t]=function(n){return n&&n.hasOwnProperty(t)?n[t]:this.environment()[t]()}.bind(this)}.bind(this)))}Base._className="eventHandlers.base",Base.prototype.setDelegate=function(t){return attachDelegate(this,t)},Base.prototype.topic=function(){throw exceptionString(Base._className,"topic")},Base.prototype.environment=function(){throw exceptionString(Base._className,"environment")},Base.prototype.eventRecorder=function(){throw exceptionString(Base._className,"eventRecorder")},Base.prototype.metricsData=function(){throw exceptionString(Base._className,"metricsData")},Base.prototype.processMetricsData=function(){throw exceptionString(Base._className,"processMetricsData")},Base.prototype.knownFields=function(){return ei||(ei=environmentBaseFieldNames().concat(["baseVersion","clientEventId","connection","eventTime","eventType","eventVersion","timezoneOffset","xpPostFrequency","xpSendMethod"])),ei},Base.prototype.baseVersion=function(){return 1},Base.prototype.clientEventId=function(t){return t&&t.clientEventId||function(t){var l;if(16777215==Math.floor(4294967295/256)){var d,p,h,f,y,v=n.crypto||n.msCrypto;if(v&&v.getRandomValues)d=v.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),y=!0;else if(v&&v.randomBytes){var g=v.randomBytes(16);d=new Uint32Array(g.buffer,g.byteOffset,g.byteLength/Uint32Array.BYTES_PER_ELEMENT),y=!0}else for(d=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),p=0;p<d.length;p++)d[p]=Math.floor(Math.random()*Math.floor(4294967295));if(d){for(l="",p=0;p<d.length;p++)for(f=d[p],h=0;h<6;h++)l+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[f%62],f=Math.floor(f/62);t&&(l="1_"+(y?"1":"2")+"_"+l)}}return l}(!0)},Base.prototype.connection=function(t){return t&&t.connection||this.environment().connectionType()},Base.prototype.dsId=function(t){return t&&t.dsId||this.environment().dsId()},Base.prototype.eventTime=function(t){return t&&t.eventTime||Date.now()},Base.prototype.eventVersion=function(t){return t&&t.eventVersion||null},Base.prototype.timezoneOffset=function(t){return t&&t.timezoneOffset||(new Date).getTimezoneOffset()},Base.prototype.xpPostFrequency=function(t){return t&&t.xpPostFrequency||Config.value("postFrequency",this.topic())},Base.prototype.xpSendMethod=function(t){return t&&t.xpSendMethod||this.eventRecorder().sendMethod()};var oi=Base;function MetricsData(){this._eventData={}}MetricsData.prototype.updateData=function(){extend.apply(null,[this._eventData].concat(Array.prototype.slice.call(arguments)))};var ai,si,ui=MetricsData;function Environment(){ai||(ai=!0,["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].forEach((function(t){Environment.prototype[t]=function(){throw exceptionString(Environment._className,t)}})),["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"].forEach((function(t){Environment.prototype[t]=function(){}})))}function topic(){return si}Environment._className="system.environment",Environment.prototype.setDelegate=function(t){return attachDelegate(this,t)},Environment.prototype.connectionType=function(){throw exceptionString(Environment._className,"connectionType")},Environment.prototype.dsId=function(){},Environment.prototype.localStorageObject=$r,Environment.prototype.sessionStorageObject=Hr;var ci="unknown",li="next",di="previous",pi="location",hi="interval",fi="playhead",yi="scrub",vi="transition",gi="interruption",mi="buffering",_i="play",bi="seek",Pi="skipIntro",ki="actionType",Ti="consumerId",Si="consumerNs",Ai="dsId",wi="eventType",Ii="eventVersion",Ei="isOffline",Ri="videoViewportHeight",Ci="videoViewportWidth",Oi={TYPE:{MANUAL:"manual",AUTOMATIC:"automatic",UNKNOWN:ci},PLAY_START_REASON:{PLAY:_i,UNPAUSE:"unpause",NEXT:li,PREVIOUS:di,SEEK:bi,TRANSITION:vi,INTERRUPTION:gi,FOREGROUND:"foreground",FOCUS:"focus",BUFFERING:mi,UNKNOWN:ci},PLAY_START_REASON_TYPE:{SKIP_INTRO:Pi},PLAY_STOP_REASON:{COMPLETE:"complete",TRANSITION:vi,PLAY_OTHER:"playOther",PAUSE:"pause",SEEK:bi,NEXT:li,INTERRUPTION:gi,BACKGROUND:"background",EXIT:"exit",INACTIVITY:"inactivity",BUFFERING:mi,ERROR:"error",FAILURE:"failure",UNKNOWN:ci,CLOSE_PLAYER:"closePlayer"},PLAY_STOP_REASON_TYPE:{SKIP_INTRO:Pi},SEEK_START_REASON:{NEXT:li,PREVIOUS:di,LOCATION:pi,INTERVAL:hi,PLAYHEAD:fi,SCRUB:yi,UNKNOWN:ci,SKIP_INTRO:Pi},SEEK_STOP_REASON:{NEXT:li,PREVIOUS:di,LOCATION:pi,INTERVAL:hi,PLAYHEAD:fi,SCRUB:yi,UNKNOWN:ci,SKIP_INTRO:Pi}},Mi={ACTIVITY_TYPE:{PLAY:_i,SEEK:bi},ACTION_TYPE:{START:"start",STOP:"stop"},EVENT_TYPE:{PLAY_ACTIVITY:"playActivity",SEEK_ACTIVITY:"seekActivity"}},Di={INCLUDES_START_POSITIONS:"includesStartPositions",INCLUDES_END_POSITIONS:"includesEndPositions"};function VPAFKitEnvironment(){Environment.apply(this,arguments)}VPAFKitEnvironment.prototype=new Environment,VPAFKitEnvironment.prototype.constructor=VPAFKitEnvironment,VPAFKitEnvironment.prototype.consumerId=function(){},VPAFKitEnvironment.prototype.consumerNs=function(){},VPAFKitEnvironment.prototype.isOffline=function(){},VPAFKitEnvironment.prototype.videoViewportHeight=function(){},VPAFKitEnvironment.prototype.videoViewportWidth=function(){};var Ni={setDelegate:function(t){return attachDelegate(this,t)},recordEvent:function(t,n){throw exceptionString("system.eventRecorder","recordEvent")},sendMethod:function(){throw exceptionString("system.eventRecorder","sendMethod")},flushUnreportedEvents:function(t){}},Li={};Li.environment=new VPAFKitEnvironment,Li.eventRecorder=Ni,Li.logger=loggerNamed("mt-vpafkit");var xi=oi,VPAFKitBase=function(){xi.apply(this,arguments)};(VPAFKitBase.prototype=new xi).constructor=VPAFKitBase,VPAFKitBase.prototype.environment=function(){return Li.environment},VPAFKitBase.prototype.eventRecorder=function(){return Li.eventRecorder},VPAFKitBase.prototype.knownFields=function(){var t=xi.prototype.knownFields().concat([ki,Ti,Si,Ai,Ei,Ri,Ci]);return t},VPAFKitBase.prototype.consumerId=function(t){var n=Ti;return t&&n in t?t[n]:this.environment().consumerId()},VPAFKitBase.prototype.consumerNs=function(t){var n=Si;return t&&n in t?t[n]:this.environment().consumerNs()},VPAFKitBase.prototype.isOffline=function(t){var n=Ei;return t&&n in t?t[n]:this.environment().isOffline()},VPAFKitBase.prototype.videoViewportHeight=function(t){var n=Ri;return t&&n in t?t[n]:this.environment().videoViewportHeight()},VPAFKitBase.prototype.videoViewportWidth=function(t){var n=Ci;return t&&n in t?t[n]:this.environment().videoViewportWidth()};var Ui=new VPAFKitBase((function(){return topic()}));Ui.metricsData=function(){return Ui.processMetricsData.apply(Ui,[null].concat(Array.prototype.slice.call(arguments)))},Ui.processMetricsData=function(t){var n=null;if(!Config.metricsDisabledOrBlacklistedEvent(t,topic())){var l=Array.prototype.slice.call(arguments,1);if(this!==Ui){var d=Ui.metricsData.apply(Ui,l);l=[d].concat(l)}n=processMetricsData(this,this.knownFields(),!0,l)}return Config.removeBlacklistedFields(n,topic()),n};var MediaActivity=function(t,n){this._defaultEventType=t,this._reasonConstants=n,this._defaultActionType};extend(MediaActivity,Mi),Object.defineProperties(MediaActivity.prototype,{TYPE:{get:function(){return Oi.TYPE}},REASON:{get:function(){return this._reasonConstants}}}),MediaActivity.prototype.setDelegate=function(t){return attachDelegate(this,t)},MediaActivity.prototype.knownFields=function(){var t=[ki,wi,Ii];return t},MediaActivity.prototype.eventType=function(t){return this._defaultEventType},MediaActivity.prototype.eventVersion=function(t){var n=Ui.eventVersion(t);return null!==n?n:1},MediaActivity.prototype.actionType=function(t){return this._defaultActionType};var StartMediaActivity=function(t,n){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.START};(StartMediaActivity.prototype=new MediaActivity).constructor=StartMediaActivity,StartMediaActivity.prototype.metricsData=function(t,n,l,d){var p=this.eventType(),h={position:t,overallPosition:n,startType:l,startReason:d},f=Array.prototype.slice.call(arguments,4);return Ui.processMetricsData.apply(this,[p,h].concat(f))};var StopMediaActivity=function(t,n){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.STOP};(StopMediaActivity.prototype=new MediaActivity).constructor=StopMediaActivity,StopMediaActivity.prototype.metricsData=function(t,n,l,d,p){var h=this.eventType(),f={position:t,overallPosition:n,stopType:l,stopReason:d,startPosition:(p=p||{}).position,startOverallPosition:p.overallPosition,startTime:p.eventTime,startType:p.startType,startReason:p.startReason,startReasonType:p.startReasonType};h===MediaActivity.EVENT_TYPE.SEEK_ACTIVITY&&(f.startAssetId=p.assetId);var y=Array.prototype.slice.call(arguments,5);return Ui.processMetricsData.apply(this,[h,f].concat(y))};var Bi=new StartMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,Oi.PLAY_START_REASON),ji=new StopMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,Oi.PLAY_STOP_REASON),Fi=new StartMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,Oi.SEEK_START_REASON),Ki=new StopMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,Oi.SEEK_STOP_REASON),Vi=Object.freeze({__proto__:null,base:Ui,playStart:Bi,playStop:ji,seekStart:Fi,seekStop:Ki}),MediaActivity$1=function(t){this._activityType=t,this._startMetricsData=null,this._isStopped=!1};MediaActivity$1.ACTIVITY_TYPE=Mi.ACTIVITY_TYPE,Object.defineProperties(MediaActivity$1.prototype,{isStopped:{get:function(){return this._isStopped}},type:{get:function(){return this._activityType}},startOverallPosition:{get:function(){return this._startMetricsData?this._startMetricsData.overallPosition:null}}}),extend(MediaActivity$1.prototype,Oi),MediaActivity$1.prototype.started=function(t,n,l,d){var p=this._startEventHandler();p&&(this._startMetricsData=p.metricsData.apply(p,arguments),this.type!=MediaActivity$1.ACTIVITY_TYPE.SEEK&&Ni.recordEvent(topic(),this._startMetricsData))},MediaActivity$1.prototype.stopped=function(t,n,l,d){var p=this._stopEventHandler();if(p){this._isStopped=!0;var h=[t,n,l,d,this._startMetricsData].concat(Array.prototype.slice.call(arguments,4)),f=p.metricsData.apply(p,h);Ni.recordEvent(topic(),f)}},MediaActivity$1.prototype._startEventHandler=function(){var t;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:t=Bi;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:t=Fi}return t},MediaActivity$1.prototype._stopEventHandler=function(){var t;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:t=ji;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:t=Ki}return t};var TimeTracker=function(t,n){this._date=new Date,this._position=n,this._validatePlaybackRate(t),this._playbackRate=t};Object.defineProperties(TimeTracker.prototype,{playbackRate:{get:function(){return this._playbackRate}}}),TimeTracker.prototype.update=function(t,n){this._date=new Date,this._position=n,this._validatePlaybackRate(t),this._playbackRate=t},TimeTracker.prototype.estimatedTime=function(t){var n;isInteger(t)?n=t:(Li.logger.error("VPAFKit error: position should be an integer"),n=Math.round(t));var l=(n-this._position)/(0==this.playbackRate?1:this.playbackRate);return this._date.getTime()+Math.round(l)},TimeTracker.prototype._validatePlaybackRate=function(t){0==t&&Li.logger.error("VPAFKit error: playbackRate should not be zero.")};var $i=ui,Hi=Di.INCLUDES_START_POSITIONS,zi=Di.INCLUDES_END_POSITIONS,MediaActivityTracker=function(t){$i.apply(this,arguments),this._playlist=t,this._playActivity=null,this._playStartPlaylistItem=null,this._seekActivity=null,this._timeTracker=null,this._shouldGenerateTransitions=!0};(MediaActivityTracker.prototype=new $i).constructor=MediaActivityTracker,extend(MediaActivityTracker.prototype,Oi),Object.defineProperties(MediaActivityTracker.prototype,{shouldGenerateTransitions:{get:function(){return this._shouldGenerateTransitions},set:function(t){this._shouldGenerateTransitions=t}}}),MediaActivityTracker.prototype.setDelegate=function(t){return attachDelegate(this,t)},MediaActivityTracker.prototype.playStarted=function(t,n,l){return this.playStartedWithPlaybackRate.apply(this,[1].concat(Array.prototype.slice.call(arguments)))},MediaActivityTracker.prototype.playStartedWithPlaybackRate=function(t,n,l,d){if(this._hasUnstoppedActivity(this._playActivity))this._error("inconsistent state: did you forget to call playStopped?");else{var p=this._playlistItem(n,Hi);p&&(this._playStarted.apply(this,[p].concat(Array.prototype.slice.call(arguments,1))),this.shouldGenerateTransitions&&(this._timeTracker=new TimeTracker(t,n)))}},MediaActivityTracker.prototype.playStopped=function(t,n,l){this._generatePlaylistTransitionsIfNecessary(t),this._hasUnstoppedActivity(this._playActivity)?this._playStopped.apply(this,Array.prototype.slice.call(arguments)):this._error("inconsistent state: did you forget to call playStarted?"),this._playStartPlaylistItem=null,this._timeTracker=null},MediaActivityTracker.prototype.playTransitioned=function(t){this.playStopped.apply(this,[t,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1))),this.playStarted.apply(this,[t,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1)))},MediaActivityTracker.prototype.seekStarted=function(t,n,l){if(this._hasUnstoppedActivity(this._seekActivity))this._error("inconsistent state: did you forget to call seekStopped?");else{var d=this._playlistItem(t,Hi);if(d){var p=this._activityArguments.apply(this,[d].concat(Array.prototype.slice.call(arguments)));this._seekActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.SEEK),this._seekActivity.started.apply(this._seekActivity,p)}}},MediaActivityTracker.prototype.seekStopped=function(t,n,l){var d=this._playlistItem(t,zi);if(d&&this._hasUnstoppedActivity(this._seekActivity)){var p=this._activityArguments.apply(this,[d].concat(Array.prototype.slice.call(arguments)));this._seekActivity.stopped.apply(this._seekActivity,p)}else this._error("inconsistent state: did you forget to call seekStarted?")},MediaActivityTracker.prototype.synchronize=function(t,n){if(this.shouldGenerateTransitions){var l=t>0,d=this._hasUnstoppedActivity(this._playActivity);d&&l?(this._generatePlaylistTransitionsIfNecessary(n),this._timeTracker.update(t,n)):d&&!l?this._error("inconsistent state: did you forget to call playStopped?"):!d&&l&&this._error("inconsistent state: did you forget to call playStarted?")}},MediaActivityTracker.prototype._playStarted=function(t,n,l,d){var p=this._activityArguments.apply(this,[t].concat(Array.prototype.slice.call(arguments,1)));this._playStartPlaylistItem=t,this._playActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.PLAY),this._playActivity.started.apply(this._playActivity,p)},MediaActivityTracker.prototype._playStopped=function(t,n,l){var d=this._playStartPlaylistItem,p=this._activityArguments.apply(this,[d].concat(Array.prototype.slice.call(arguments)));this._playActivity.stopped.apply(this._playActivity,p)},MediaActivityTracker.prototype._playlistItem=function(t,n){var l;return this._playlist&&isFunction(this._playlist.getItem)&&(l=this._playlist.getItem(t,n)),l||this._error("unable to get item from playlist"),l},MediaActivityTracker.prototype._playlistItems=function(t,n){var l=[];return this._playlist&&isFunction(this._playlist.getItems)?l=this._playlist.getItems(t,n):this._error("unable to get items from playlist"),l},MediaActivityTracker.prototype._relativePosition=function(t,n){var l;return(n=n||this._playlistItem(t))&&isNumber(n.startOverallPosition)&&(l=t-n.startOverallPosition+(n.startPosition||0)),l},MediaActivityTracker.prototype._combineEventData=function(t,n){var l=this._playlist?this._playlist.eventData:null,d=t?t.eventData:null,p=[];return l&&p.push(l),d&&p.push(d),this._eventData&&p.push(this._eventData),n&&(p=p.concat(n)),p},MediaActivityTracker.prototype._activityArguments=function(t,n,l,d){var p=this._relativePosition(n,t),h=this._combineEventData(t,Array.prototype.slice.call(arguments,4)),f=[p,n,l,d].concat(h);return f},MediaActivityTracker.prototype._generatePlaylistTransitionsIfNecessary=function(t){if(this.shouldGenerateTransitions&&this._hasUnstoppedActivity(this._playActivity)){var n,l,d,p=this._playActivity.startOverallPosition||0,h=this._playlistItems(p,t);this._playlist._returnsOrderedItems||h.sort(this._playlistItemComparator);for(var f=0;f+1<h.length;f++)if(h[f],!((n=(l=h[f+1]).startOverallPosition)<=p)){if(n>=t)break;d={eventTime:this._timeTracker?this._timeTracker.estimatedTime(n):null},this._playStopped(n,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION,d),this._playStarted(l,n,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION,d)}}},MediaActivityTracker.prototype._hasUnstoppedActivity=function(t){return t&&!t.isStopped},MediaActivityTracker.prototype._error=function(t){Li.logger.error(this.constructor.name+" error: "+t)},MediaActivityTracker.prototype._playlistItemComparator=function(t,n){return t.startOverallPosition==n.startOverallPosition?0:t.startOverallPosition<n.startOverallPosition?-1:1};var Wi=ui,MediaPlaylistItem=function(t){Wi.apply(this,arguments),this._startOverallPosition=t,this._startPosition=0};(MediaPlaylistItem.prototype=new Wi).constructor=MediaPlaylistItem,Object.defineProperties(MediaPlaylistItem.prototype,{startOverallPosition:{get:function(){return this._startOverallPosition}},startPosition:{get:function(){return this._startPosition},set:function(t){this._startPosition=t}},eventData:{get:function(){return this._eventData}}});var HLSRollItem=function(t,n){MediaPlaylistItem.apply(this,arguments),this._duration=n};(HLSRollItem.prototype=new MediaPlaylistItem).constructor=HLSRollItem,Object.defineProperties(HLSRollItem.prototype,{duration:{get:function(){return this._duration}},endOverallPosition:{get:function(){return this.startOverallPosition+this.duration}}}),HLSRollItem.prototype.containsOverallPosition=function(t){return this.startOverallPosition<=t&&this.endOverallPosition>t};var MediaPlaylist=function(){};MediaPlaylist.prototype.RANGE_OPTIONS=Di,Object.defineProperties(MediaPlaylist.prototype,{eventData:{get:function(){}}}),MediaPlaylist.prototype.getItem=function(t,n){},MediaPlaylist.prototype.getItems=function(t,n){};var HLSVideoPlaylist=function(t){MediaPlaylist.apply(this,arguments),this._startPosition=t,this._mainFeatureMetricsData=copyKeysAndValues.apply(null,[!1,!1,!1,null].concat(Array.prototype.slice.call(arguments,1))),this._rollItems=[]};(HLSVideoPlaylist.prototype=new MediaPlaylist).constructor=HLSVideoPlaylist,HLSVideoPlaylist.prototype.setDelegate=function(t){return attachDelegate(this,t)},HLSVideoPlaylist.prototype.addRollInfoItems=function(t){t&&t.length&&t.forEach((function(t){this.addRollInfoItem(t)}),this)},HLSVideoPlaylist.prototype.addRollInfoItem=function(t){t&&this.addRollItem(1e3*t.start,1e3*t.duration,t.metricsData)},HLSVideoPlaylist.prototype.addRollItem=function(t,n){var l=new HLSRollItem(t,n);l.updateData.apply(l,Array.prototype.slice.call(arguments,2)),this._addRollItem(l)},HLSVideoPlaylist.prototype.updateMainFeatureMetricsData=function(){extend.apply(null,[this._mainFeatureMetricsData].concat(Array.prototype.slice.call(arguments)))},HLSVideoPlaylist.prototype.getItem=function(t,n){var l,d=this._indexOfLastRollItemWithStartBeforePosition(t);if(isInteger(d)){for(;n!=this.RANGE_OPTIONS.INCLUDES_START_POSITIONS&&this._rollItems[d].startOverallPosition==t&&d>0;)d--;(l=this._rollItems[d]).containsOverallPosition(t)||n==this.RANGE_OPTIONS.INCLUDES_END_POSITIONS&&l.endOverallPosition==t||(l=this._mainFeatureItemWithStartOverallPosition(l.endOverallPosition))}else l=this._mainFeatureItemWithStartOverallPosition(this._startPosition);return l},HLSVideoPlaylist.prototype.getItems=function(t,n){var l=[];if(this._rollItems.length){var d=this._indexOfLastRollItemWithStartBeforePosition(t);for(isInteger(d)||(l.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition)),d=0);d<this._rollItems.length;){var p=this._rollItems[d];if(p.startOverallPosition>n)break;if(p.endOverallPosition>=t&&l.push(p),d++,p.endOverallPosition<n)if(d<this._rollItems.length){var h=this._rollItems[d];h.startOverallPosition&&h.startOverallPosition>p.endOverallPosition&&l.push(this._mainFeatureItemWithStartOverallPosition(p.endOverallPosition))}else l.push(this._mainFeatureItemWithStartOverallPosition(p.endOverallPosition))}}else l.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition));return l},HLSVideoPlaylist.prototype._addRollItem=function(t){if(t){var n=this._insertionIndexForItemWithPosition(t.startOverallPosition);this._rollItems.splice(n,0,t)}},HLSVideoPlaylist.prototype._indexOfLastRollItemWithStartBeforePosition=function(t){var n,l=this._rollItems[0];return l&&isInteger(t)&&l.startOverallPosition<=t&&(n=this._insertionIndexForItemWithPosition(t)-1),n},HLSVideoPlaylist.prototype._insertionIndexForItemWithPosition=function(t){for(var n=0,l=this._rollItems.length;n<l;){var d=Math.floor((n+l)/2);this._rollItems[d].startOverallPosition>t?l=d:n=d+1}return n},HLSVideoPlaylist.prototype._mainFeatureItemWithStartOverallPosition=function(t){var n=new MediaPlaylistItem(t);return n.startPosition=this._featurePlayheadProgress(t),n.updateData(this._mainFeatureMetricsData),n},HLSVideoPlaylist.prototype._featurePlayheadProgress=function(t){t=t||0;var n,l,d=this._indexOfLastRollItemWithStartBeforePosition(t),p=this._startPosition||0;isInteger(d)||(d=-1);for(var h=d;h>=0;h--)n=this._rollItems[h],0===h?p+=n.startOverallPosition:(l=this._rollItems[h-1],p+=n.startOverallPosition-l.endOverallPosition);return p};var Yi=Object.freeze({__proto__:null,createTracker:function(t){var n=new MediaActivityTracker(t);return n.updateData.apply(n,Array.prototype.slice.call(arguments,1)),n},createHLSVideoPlaylist:function(t){var n=new HLSVideoPlaylist(t);return n.updateMainFeatureMetricsData.apply(n,Array.prototype.slice.call(arguments,1)),n}});var qi=Object.freeze({__proto__:null,applyFieldsMap:function(t,n){return applyFieldsMap(t,n,Config.value("fieldsMap",topic()))}}),Gi=Object.freeze({__proto__:null,eventFields:qi});function PlayActivity$2(){this.config=Config.defaultConfig(),this._initCalled=!1}PlayActivity$2.prototype._utReset=function(){this.config=Config.defaultConfig(),this._initCalled=!1},PlayActivity$2.prototype.init=function(t,n,l,d,p){if(!this._initCalled){this._initCalled=!0,l&&(setDelegates(Vi,l),setDelegates(Li,l)),function(t){si=t}(t);var h=Config.getConfig(t),f={metricsDisabledOrBlacklistedEvent:metricsDisabledOrBlacklistedEvent,removeBlacklistedFields:removeBlacklistedFields};attachMethods(h,f,h),attachMethods(Config,f,Config),function(t,n){var l=null;if(t&&n&&n.setDelegate){var d,p={};for(d in t)isFunction(t[d])&&t[d].origFunction&&(p[d]=t[d]);l=n.setDelegate(p)}}(this.config,h),h.init(n,d,p),this.config=h}},PlayActivity$2.prototype.system=Li,PlayActivity$2.prototype.eventHandlers=Vi,PlayActivity$2.prototype.mediaActivityTracker=Yi,PlayActivity$2.prototype.utils=Gi;var Qi,Ji,Xi,Zi,en,tn,rn,nn,on,an=new PlayActivity$2,sn={"ac-3":"AC3","mp4a.a5":"AC3",alac:"Apple Lossless","ec-3":"EC3","mp4a.a6":"EC3",flac:"Free Lossless","mp4a.40.2":"AAC","mp4a.40.5":"AAC","mp4a.40.29":"AAC","mp4a.40.34":"MP3","mp4a.40.42":"AAC"},un=/^[0-9]+\/JOC$/,isAtmos=function(t,n){return"EC3"===sn[t]&&function(t){return un.test(t)}(n)},cn=["dvh1.05.01","dvhe.05.06"],ln={PQ:"HDR",HLG:"HDR",SDH:"SDH"},convertToVideoColorRange=function(t,n){return function(t){return-1!==cn.indexOf(t)}(t)?"DolbyVision":function(t){var n;return null!==(n=ln[t])&&void 0!==n?n:t}(n)},getDefaultPlayable=function(t){if(hasPlayables(t))return t.playables[0]},hasPlayables=function(t){return void 0!==t.playables&&Array.isArray(t.playables)&&t.playables.length>0},dn={initial:"idle",states:{idle:{on:(Qi={},Qi.PLAY={target:"playing",context:{reason:"PLAY",manual:"MANUAL"}},Qi)},binging:{on:(Ji={},Ji.PLAY={target:"playing",context:{reason:"NEXT",manual:"~~previous~~"}},Ji)},playing:{on:(Xi={},Xi.BUFFER_START={target:"buffering",context:{reason:"BUFFERING",manual:"AUTOMATIC"}},Xi.EXIT={target:"idle",context:{reason:"EXIT"}},Xi.PAUSE={target:"paused",context:{reason:"PAUSE"}},Xi.STOP={target:"idle",context:{}},Xi.NEXT={target:"binging",context:{reason:"NEXT"}},Xi.NEW={target:"idle",context:{}},Xi)},paused:{on:(Zi={},Zi.PLAY={target:"playing",context:{reason:"UNPAUSE"}},Zi.NEW={target:"idle",context:{}},Zi)},buffering:{on:(en={},en.BUFFER_STOP={target:"playing",context:{reason:"BUFFERING",manual:"AUTOMATIC"}},en)}}},pn={manual:"UNKNOWN",reason:"UNKNOWN"},hn=function(){function VPAFStateMachine(){this.currentState=dn.initial,this.currentContext=pn}return VPAFStateMachine.prototype.isAllowedTransition=function(t){return void 0!==this.getNextState(t)},VPAFStateMachine.prototype.transition=function(t,n){void 0===n&&(n={});var l=this.getNextState(t);if(l){var d={};return n.hasOwnProperty("manual")&&(void 0!==n.manual?d.manual=n.manual?"MANUAL":"AUTOMATIC":d.manual="UNKNOWN"),void 0!==n.reason&&(d.reason=n.reason),this.currentContext=__assign(__assign(__assign(__assign({},pn),l.context),d),this.preservePreviousContext(l.context)),this.currentState=l.target,this.currentContext}},VPAFStateMachine.prototype.reset=function(){this.currentState=dn.initial,this.currentContext=pn},VPAFStateMachine.prototype.getNextState=function(t){return dn.states[this.currentState].on[t]},VPAFStateMachine.prototype.preservePreviousContext=function(t){var n=this,l={};return["manual","reason","reasonType"].forEach((function(d){"~~previous~~"===t[d]&&(l[d]=n.currentContext[d])})),l},VPAFStateMachine}(),fn=__assign(__assign({},{NEXT_ITEM:"NEXT"}),t.PlayActivityEndReasonType);!function(t){t[t.Manual=0]="Manual",t[t.Interval=1]="Interval",t[t.SkipIntro=2]="SkipIntro"}(tn||(tn={}));var yn,vn,gn,mn,_n,bn=((rn={})[lr.playbackPause]="PAUSE",rn[lr.playbackPlay]="PLAY",rn[lr.playbackStop]="STOP",rn[lr.playerExit]="EXIT",rn),Pn=((nn={})[t.PlayActivityEndReasonType.EXITED_APPLICATION]="EXIT",nn[t.PlayActivityEndReasonType.FAILED_TO_LOAD]="FAILURE",nn[t.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM]="PLAY_OTHER",nn[t.PlayActivityEndReasonType.NATURAL_END_OF_TRACK]="COMPLETE",nn[t.PlayActivityEndReasonType.PLAYBACK_PAUSED_DUE_TO_INACTIVITY]="INACTIVITY",nn[t.PlayActivityEndReasonType.SCRUB_BEGIN]="SEEK",nn[t.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS]="SEEK",nn[t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS]="SEEK",nn[fn.NEXT_ITEM]="NEXT",nn),kn={captions:"closedCaptionLocale",subtitles:"subtitleLocale"},Tn=((on={})[t.PresentationMode.pictureinpicture]="pictureInPicture",on[t.PresentationMode.inline]="foreground",on._default="foreground",on),Sn=(function(){function VPAFTrackerAPI(){this.isScrubbing=!1,this.vpafKitInited=!1,this.state=new hn,an.config.setDelegate({configHostname:function(){return"daf.xp.apple.com"}})}Object.defineProperty(VPAFTrackerAPI.prototype,"currentItem",{get:function(){return this._currentItem},set:function(t){this._currentItem=t,this.currentSkipItems=t?parseSkipItems(t):void 0},enumerable:!0,configurable:!0}),VPAFTrackerAPI.prototype.configure=function(t,n){var l,d;return __awaiter(this,void 0,void 0,(function(){var p,h=this;return __generator(this,(function(f){switch(f.label){case 0:if(this.instance=t,this.dispatcher=n.services.dispatcher,vr.storekit.cid)return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,vr.storekit.infoRefresh()];case 2:return f.sent(),[3,4];case 3:return f.sent(),[3,4];case 4:return p=null===(d=null===(l=n.services.apiManager)||void 0===l?void 0:l.utsAPI)||void 0===d?void 0:d.config,[2,new Promise((function(t,n){var l=[];navigator.languages?l=navigator.languages:navigator.language?l=[navigator.language]:navigator.userLanguage&&(l=[navigator.userLanguage]);var onSuccess=function(){return an.system.environment.setDelegate({app:function(){return"com.apple.tv"},appVersion:function(){return"1.0"},consumerId:function(){return vr.storekit.cid},consumerNs:function(){return"TV"},isOffline:function(){return!1},delegateApp:function(){return"web-tv-player"},osLanguages:function(){return l},resourceRevNum:function(){return mr.app.build},storeFrontCountryCode:function(){var t,n;return null!==(n=null===(t=null==p?void 0:p.userProps)||void 0===t?void 0:t.country)&&void 0!==n?n:""}}),h.setupListeners(),h.vpafKitInited=!0,t(h)};if(h.vpafKitInited)return onSuccess();var d={environment:ni,eventRecorder:ii};an.init("xp_amp_tv_vpaf",null,d,onSuccess,(function(t){n(t)}))}))]}}))}))},VPAFTrackerAPI.prototype.cleanup=function(){this.tracker=void 0,this.isScrubbing=!1,this.scrubStopPosition=void 0,this.teardownListeners(),this.stopSynchronizing()},VPAFTrackerAPI.prototype.shouldConfigure=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,!0]}))}))},VPAFTrackerAPI.prototype.shouldTrackPlayActivity=function(t,n){if(!n)return!1;var l=getDefaultPlayable(n);if(!l||!l.vpafMetrics)return!1;var d=bn[t];return void 0===d||this.state.isAllowedTransition(d)},VPAFTrackerAPI.prototype.activate=function(t){return Promise.resolve()},VPAFTrackerAPI.prototype.bufferStart=function(t,n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return void 0!==this.currentItem&&this.isCurrentItem(t)?[3,2]:[4,this.play(t,n)];case 1:d.sent(),d.label=2;case 2:return[4,this.shouldTrack(t)];case 3:return d.sent()?(l=this.adjustedPosition(n),this.state.transition("BUFFER_START"),this.trackEvent("playStopped",l),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.bufferEnd=function(t,n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return[4,this.shouldTrack(t)];case 1:return d.sent()?(l=this.adjustedPosition(n),this.state.transition("BUFFER_STOP"),this.trackEvent("playStarted",l),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.exit=function(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.shouldTrack()];case 1:return n.sent()?(this.state.transition("EXIT"),this.trackEvent("playStopped",this.adjustedPosition(t)),this.stopSynchronizing(),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.pause=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return l=this.adjustedPosition(n),[4,this.shouldTrack(t)];case 1:return p.sent()?(d=n.endReasonType===fn.NEXT_ITEM?"NEXT":"PAUSE",this.state.transition(d,this.getExplicitStateContext(n)),this.trackEvent("playStopped",l),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.play=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return l=this.adjustedPosition(n),d=void 0!==l?l:0,[4,this.shouldTrack(t)];case 1:return p.sent()?(this.state.transition("PLAY",this.getExplicitStateContext(n)),this.trackEvent("playStarted",d),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.scrub=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){return void 0===t||void 0===n.position?[2]:(l=this.adjustedPosition(n),this.isScrubbing&&void 0===n.endReasonType?(this.scrubStopPosition=l,[2]):(this.isScrubbing&&this.scrubEnd(t,l),[2]))}))}))},VPAFTrackerAPI.prototype.seek=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return void 0===t||void 0===n.startPosition||void 0===n.position?[2]:this.isSkippingIntro(n)||this.isSeekingInterval(n)?(l=void 0,this.isSkippingIntro(n)&&(d=this.getSkipActionName(n.position))&&(l={actionName:d}),this.trackSeekStart(t,__assign(__assign({},n),{position:n.startPosition}),l),this.trackSeekStop(t,n,l),[2]):[4,this.scrubStart(t,this.convertTime(n.startPosition))];case 1:return p.sent(),this.scrubEnd(t,this.convertTime(n.position)),[2]}}))}))},VPAFTrackerAPI.prototype.skip=function(t,n){return Promise.resolve()},VPAFTrackerAPI.prototype.stop=function(t,n){return void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return[4,this.shouldTrack(t)];case 1:return d.sent()?(l=this.adjustedPosition(n),this.state.transition("STOP",this.getExplicitStateContext(n)),this.trackEvent("playStopped",l),this.stopSynchronizing(),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.adjustedPosition=function(t){return void 0===t.position?void 0:this.convertTime(t.position)},VPAFTrackerAPI.prototype.calculateOverallLength=function(t,n,l){var d=parseFloat(t.hlsMetadata["feature.duration"]);if(isNaN(d))return this.convertTime(n.duration);var p=l.reduce((function(t,n){return t+n.duration}),d);return this.convertTime(p)},VPAFTrackerAPI.prototype.convertTime=function(t){return Math.round(1e3*t)},VPAFTrackerAPI.prototype.createTracker=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d,p,h,f,y,v;return __generator(this,(function(g){return void 0===t||this.isCurrentItem(t)?[2]:(this.state.transition("NEW"),this.currentItem=t,void 0===(n=getDefaultPlayable(t))?[2]:(l=this.getMainFeatureData(t,n),d=this.transformRollItems(t),Mt.debug("VPAF: Creating HLS Playlist",l),p=an.mediaActivityTracker.createHLSVideoPlaylist(0,l),Mt.debug("VPAF: adding roll items",d),p.addRollInfoItems(d),h=an.utils.eventFields.applyFieldsMap(n,"utsVpafPlayable"),f=an.utils.eventFields.applyFieldsMap(t.attributes,"utsVpafContent"),y=n.vpafMetrics,(v=this.getAdditionalTrackingData(n)).overallLength=this.calculateOverallLength(t,n,d),Mt.debug("VPAF: creating tracker with",[h,f,y,v]),this.tracker=an.mediaActivityTracker.createTracker(p,h,f,y,v),this.startSynchronizing(),[2,this.tracker]))}))}))},VPAFTrackerAPI.prototype.getCurrentAudioSelection=function(){var t,n,l,d,p,h=null===(l=null===(n=this.instance)||void 0===n?void 0:n.currentAudioTrack)||void 0===l?void 0:l.language;if(void 0!==h){var f="description"===(null===(p=null===(d=this.instance)||void 0===d?void 0:d.currentAudioTrack)||void 0===p?void 0:p.kind)?"audioDescriptionLocale":"audioLocale",y="audioLocale"===f?"audioDescriptionLocale":"audioLocale";return(t={})[f]=h,t[y]=void 0,t}},VPAFTrackerAPI.prototype.getMainFeatureData=function(t,n){var l,d=null===(l=null==t?void 0:t.hlsMetadata)||void 0===l?void 0:l["feature.adam-id"],p={url:t.attributes.url,assetPlacement:"feature",assetId:d};return!0===t.attributes.isAdultContent&&(p.sensitiveContentType="adult"),p},VPAFTrackerAPI.prototype.transformRollItems=function(t){return parseRollItems(t).map((function(t){return{start:t.start,duration:t.duration,metricsData:{assetPlacement:t.type.replace("-",""),assetId:t["adam-id"],isSkippable:t.skippable}}}))},VPAFTrackerAPI.prototype.getMappedStopReason=function(t){if(void 0!==t.endReasonType)return Pn[t.endReasonType]},VPAFTrackerAPI.prototype.getExplicitStateContext=function(t){return{manual:t.userInitiated,reason:this.getMappedStopReason(t)}},VPAFTrackerAPI.prototype.handleLevelUpdated=function(t,n){var l,d=n.level,p=n.channels;if(d){var h=d.audioCodec,f=d.videoRange,y=d.videoCodec;if(h&&p||f&&y){var v={};h&&p&&(v.audioFormat=function(t,n){var l,d,p=null!==(l=null==t?void 0:t.toLowerCase())&&void 0!==l?l:"";return isAtmos(p,n)?"Atmos":null!==(d=sn[p])&&void 0!==d?d:t}(h,p)),f&&y&&(v.videoColorRange=convertToVideoColorRange(y,f)),null===(l=this.tracker)||void 0===l||l.updateData(v)}}},VPAFTrackerAPI.prototype.handleAudioTrackChange=function(){var t=this.tracker;if(void 0!==t){var n=this.getCurrentAudioSelection();n&&t.updateData(n)}},VPAFTrackerAPI.prototype.handleForcedTextTrackChange=function(t,n){var l;null===(l=this.tracker)||void 0===l||l.updateData({forcedSubtitleLocale:null==n?void 0:n.language})},VPAFTrackerAPI.prototype.handlePresentationModeChange=function(t,n){var l,d,p=n.mode,h=null!==(l=Tn[p])&&void 0!==l?l:Tn._default;null===(d=this.tracker)||void 0===d||d.updateData({playbackFocus:h})},VPAFTrackerAPI.prototype.handleTargetWirelessChange=function(){var t;null===(t=this.tracker)||void 0===t||t.updateData({delegatedPlayback:this.getDelegatedPlayback()})},VPAFTrackerAPI.prototype.handleTextTrackChange=function(){var t,n=this.tracker;if(void 0!==n){var l=null===(t=this.instance)||void 0===t?void 0:t.currentTextTrack;if(l&&("captions"===l.kind||"subtitles"===(null==l?void 0:l.kind))){var d=""===l.language?void 0:l.language,p={closedCaptionLocale:"captions"===l.kind?d:void 0,subtitleLocale:"subtitles"===l.kind?d:void 0};n.updateData(p)}}},VPAFTrackerAPI.prototype.isSkippingIntro=function(t){return t.seekReasonType===tn.SkipIntro},VPAFTrackerAPI.prototype.isSeekingInterval=function(t){return t.seekReasonType===tn.Interval},VPAFTrackerAPI.prototype.shouldTrack=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.createTracker(t)];case 1:return n.sent(),[2,void 0!==this.tracker]}}))}))},VPAFTrackerAPI.prototype.isCurrentItem=function(t){return void 0!==this.currentItem&&void 0!==t&&this.currentItem.id===t.id},VPAFTrackerAPI.prototype.getAdditionalTrackingData=function(t){var n,l,d,p=this.instance,h=null===(n=null==p?void 0:p.videoContainerElement)||void 0===n?void 0:n.querySelector("video"),f=null===(l=t.primaryLocale)||void 0===l?void 0:l.locale,y=null!==(d=this.getCurrentAudioSelection())&&void 0!==d?d:void 0!==f?{audioLocale:f}:{},v=null==p?void 0:p.currentTextTrack,g={programmingType:"videoOnDemand",downloadState:"streaming",videoViewportHeight:null==h?void 0:h.clientHeight,videoViewportWidth:null==h?void 0:h.clientWidth,playbackFocus:Tn._default,delegatedPlayback:this.getDelegatedPlayback()};if(v){var m=kn[v.kind];m&&v.language&&(g[m]=v.language)}return __assign(__assign({},g),y)},VPAFTrackerAPI.prototype.getDelegatedPlayback=function(){var t;return(null===(t=this.instance)||void 0===t?void 0:t.playbackTargetIsWireless)?"Airplay":"None"},VPAFTrackerAPI.prototype.getSkipActionName=function(t){var n,l=(null!==(n=this.currentSkipItems)&&void 0!==n?n:[]).find((function(n){return n.target===t}));return null==l?void 0:l.label},VPAFTrackerAPI.prototype.onVideoComponentScrubStart=function(t){return this.scrubStart(this.currentItem,this.convertTime(t.detail.currentSeconds))},VPAFTrackerAPI.prototype.setupListeners=function(){void 0!==this.dispatcher&&(this.dispatcher.subscribe(fr.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.subscribe(fr.textTrackChanged,this.handleTextTrackChange),this.dispatcher.subscribe(fr.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.subscribe(lr.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.subscribe(fr.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.subscribe(fr.presentationModeDidChange,this.handlePresentationModeChange)),Rt||window.addEventListener("triggerSeekStart",this.onVideoComponentScrubStart)},VPAFTrackerAPI.prototype.teardownListeners=function(){void 0!==this.dispatcher&&(this.dispatcher.unsubscribe(fr.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.unsubscribe(fr.textTrackChanged,this.handleTextTrackChange),this.dispatcher.unsubscribe(fr.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.unsubscribe(lr.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.unsubscribe(fr.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.unsubscribe(fr.presentationModeDidChange,this.handlePresentationModeChange)),Rt||window.removeEventListener("triggerSeekStart",this.onVideoComponentScrubStart)},VPAFTrackerAPI.prototype.scrubEnd=function(t,n){this.trackEvent("seekStopped",n,this.tracker.TYPE.MANUAL,this.tracker.SEEK_STOP_REASON.SCRUB),"playing"===this.state.currentState&&(this.trackEvent("playStopped",this.scrubStopPosition,this.tracker.TYPE.AUTOMATIC,this.tracker.PLAY_STOP_REASON.SEEK),this.trackEvent("playStarted",n,this.tracker.TYPE.AUTOMATIC,this.tracker.PLAY_START_REASON.SEEK)),this.isScrubbing=!1,this.scrubStopPosition=void 0},VPAFTrackerAPI.prototype.scrubStart=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){switch(l.label){case 0:return[4,this.shouldTrack(t)];case 1:return l.sent()?(this.isScrubbing=!0,this.scrubStopPosition=n,this.trackEvent("seekStarted",n,this.tracker.TYPE.MANUAL,this.tracker.SEEK_START_REASON.SCRUB),[2]):[2]}}))}))},VPAFTrackerAPI.prototype.startSynchronizing=function(){void 0===this.synchronizeTimeout&&(this.synchronizeTimeout=setInterval(this.synchronize,6e4))},VPAFTrackerAPI.prototype.stopSynchronizing=function(){void 0!==this.synchronizeTimeout&&(clearInterval(this.synchronizeTimeout),this.synchronizeTimeout=void 0)},VPAFTrackerAPI.prototype.synchronize=function(){if(void 0!==this.tracker&&void 0!==this.instance){var t="paused"===this.state.currentState,n=this.instance,l=n.playbackRate,d=n.currentPlaybackTime,p=t?0:l,h=Math.round(1e3*d);Mt.debug("VPAF: synchronize rate: "+p+" and current time: "+h),this.tracker.synchronize(p,h)}else this.stopSynchronizing()},VPAFTrackerAPI.prototype.trackSeekStart=function(t,n,l){void 0===l&&(l={});var d=n.seekReasonType===tn.SkipIntro?this.tracker.SEEK_START_REASON.SKIP_INTRO:this.tracker.SEEK_START_REASON.INTERVAL,p=this.adjustedPosition(n),h=this.tracker.TYPE.MANUAL;if(this.trackEvent("seekStarted",p,h,d,l),"playing"===this.state.currentState){var f=this.isSkippingIntro(n)?__assign(__assign({},l),{stopReasonType:this.tracker.PLAY_STOP_REASON_TYPE.SKIP_INTRO}):l;this.trackEvent("playStopped",p,h,this.tracker.PLAY_STOP_REASON.SEEK,f)}},VPAFTrackerAPI.prototype.trackSeekStop=function(t,n,l){void 0===l&&(l={});var d=this.isSeekingInterval(n)?this.tracker.SEEK_STOP_REASON.INTERVAL:this.tracker.SEEK_STOP_REASON.SKIP_INTRO,p=this.adjustedPosition(n),h=this.tracker.TYPE.AUTOMATIC;if(this.trackEvent("seekStopped",p,h,d,l),"playing"===this.state.currentState){var f=this.isSkippingIntro(n)?__assign(__assign({},l),{startReasonType:this.tracker.PLAY_START_REASON_TYPE.SKIP_INTRO}):l;this.trackEvent("playStarted",p,h,this.tracker.PLAY_START_REASON.SEEK,f)}},VPAFTrackerAPI.prototype.trackEvent=function(t,n,l,d,p){void 0===l&&(l=this.tracker.TYPE[this.state.currentContext.manual]),void 0===d&&(d="playStarted"===t?this.tracker.PLAY_START_REASON[this.state.currentContext.reason]:this.tracker.PLAY_STOP_REASON[this.state.currentContext.reason]),Mt.debug("VPAF: "+t,n,l,d,p),this.tracker[t].call(this.tracker,Math.round(n),l,d,p)},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handleLevelUpdated",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handleAudioTrackChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handleForcedTextTrackChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handlePresentationModeChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handleTargetWirelessChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"handleTextTrackChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[CustomEvent]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"onVideoComponentScrubStart",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],VPAFTrackerAPI.prototype,"synchronize",null)}(),function(){}),asAsync=function(t){t.then(Sn,Sn)},An=Sn,wn="mk-player-tsid",isInFullscreen=function(t){return void 0===t&&(t=self.document),!!(t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement)},In=function(){function Fullscreen(t){this.player=t}return Fullscreen.prototype.exit=function(){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(n){return this.isInFullscreen()?[2,this.stopDispatchingEvents((function(){return t.exitFullscreen()}))]:[2]}))}))},Fullscreen.prototype.request=function(t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(l){return void 0===t?[2]:[2,this.stopDispatchingEvents((function(){return n.requestFullscreenForElement(t)}))]}))}))},Fullscreen.prototype.stopDispatchingEvents=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this.player.windowHandlers.stopListeningToVisibilityChanges(t)]}))}))},Fullscreen.prototype.exitFullscreen=function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return document.exitFullscreen?[4,document.exitFullscreen()]:[3,2];case 1:return t.sent(),[3,8];case 2:return document.webkitExitFullscreen?[4,document.webkitExitFullscreen()]:[3,4];case 3:return t.sent(),[3,8];case 4:return document.mozCancelFullScreen?[4,document.mozCancelFullScreen()]:[3,6];case 5:return t.sent(),[3,8];case 6:return document.msExitFullscreen?[4,document.msExitFullscreen()]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2]}}))}))},Fullscreen.prototype.isInFullscreen=function(){return isInFullscreen()},Fullscreen.prototype.requestFullscreenForElement=function(t){return n=t,__awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return void 0===n?[2]:n.requestFullscreen?[4,n.requestFullscreen()]:[3,2];case 1:return t.sent(),[3,8];case 2:return n.webkitRequestFullscreen?[4,n.webkitRequestFullscreen()]:[3,4];case 3:return t.sent(),[3,8];case 4:return n.mozRequestFullScreen?[4,n.mozRequestFullScreen()]:[3,6];case 5:return t.sent(),[3,8];case 6:return n.msRequestFullscreen?[4,n.msRequestFullscreen()]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2]}}))}));var n},Fullscreen}(),En=function(){function UnsupportedSeeker(){this.ended=!1}return UnsupportedSeeker.prototype.start=function(){Mt.warn("seeker.start is not supported in this playback method")},UnsupportedSeeker.prototype.end=function(){Mt.warn("seeker.end is not supported in this playback method")},UnsupportedSeeker.prototype.seekToTime=function(t){return Mt.warn("seekToTime is not supported in this playback method"),Promise.resolve()},UnsupportedSeeker}(),Rn=function(){function PlayerSeeker(t){this._ended=!1,this._lastSeekedTime=-1,this._startTime=-1,Mt.debug("seeker: new"),this._player=t}return Object.defineProperty(PlayerSeeker.prototype,"ended",{get:function(){return this._ended},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerSeeker.prototype,"isEngagedInPlayback",{get:function(){return this._player.isEngagedInPlayback},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerSeeker.prototype,"stillPlayingSameItem",{get:function(){return this._currentItem===this._player.nowPlayingItem},enumerable:!0,configurable:!0}),PlayerSeeker.prototype.end=function(){Mt.debug("seeker: end"),-1!==this._startTime?this._ended?Mt.warn("seeker: Cannot end the same seeker twice."):(this.dispatchStartEvent(),this.dispatchEndEvent()):Mt.warn("seeker: Cannot end a seeker before starting it.")},PlayerSeeker.prototype.seekToTime=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return Mt.debug("seeker: seekToTime",t),this.ended?(Mt.warn("seeker: Cannot seek once the seeker has ended"),[2]):(this.stillPlayingSameItem||(this._currentItem=this._player.nowPlayingItem,this._startTime=0),this._lastSeekedTime=t,[2,this._player.seekToTime(t)])}))}))},PlayerSeeker.prototype.start=function(){Mt.debug("seeker: start"),-1===this._startTime?(this._currentItem=this._player.nowPlayingItem,this._startTime=this._player.currentPlaybackTime,this._lastSeekedTime=this._startTime):Mt.warn("seeker: Cannot start same seeker twice")},PlayerSeeker.prototype.dispatch=function(t,n){this.isEngagedInPlayback?(Mt.debug("seeker: dispatch",t),this._player.dispatch(t,n)):Mt.debug("seeker: do not dispatch because isEngagedInPlayback",this.isEngagedInPlayback)},PlayerSeeker.prototype.dispatchStartEvent=function(){this.stillPlayingSameItem||(this._startTime=0,this._lastSeekedTime=0),this.dispatch(lr.playbackScrub,{position:this._startTime})},PlayerSeeker.prototype.dispatchEndEvent=function(){this._ended=!0,this.dispatch(lr.playbackScrub,{position:this._lastSeekedTime,endReasonType:t.PlayActivityEndReasonType.SCRUB_END})},PlayerSeeker}(),Cn=(vn="visibilitychange",gn="visibilityState",void 0!==document.mozHidden?(vn="mozvisibilitychange",gn="mozVisibilityState"):void 0!==document.msHidden?(vn="msvisibilitychange",gn="msVisibilityState"):document.webkitHidden&&(vn="webkitvisibilitychange",gn="webkitVisibilityState"),(yn={visibilityChangeEvent:vn,visibilityState:gn,unloadEventName:"onpagehide"in window?"pagehide":"unload"}).visibilityChangeEvent),On=yn.visibilityState,Mn=yn.unloadEventName,Dn=function(){function WindowHandlers(t,n){void 0===n&&(n=Ot),this.browser=n,this.dispatchVisibilityChanges=!0,this.player=t}return WindowHandlers.prototype.activate=function(t,n){void 0===t&&(t=self),void 0===n&&(n=self.document),n.addEventListener(Cn,this.visibilityChanged),t.addEventListener("storage",this.storage,!1),t.addEventListener(Mn,this.windowUnloaded)},WindowHandlers.prototype.deactivate=function(){document.removeEventListener(Cn,this.visibilityChanged),window.removeEventListener("storage",this.storage),window.addEventListener(Mn,this.windowUnloaded)},WindowHandlers.prototype.stopListeningToVisibilityChanges=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return this.dispatchVisibilityChanges=!1,[4,t()];case 1:return n=l.sent(),this.dispatchVisibilityChanges=!0,[2,n]}}))}))},WindowHandlers.prototype.dispatch=function(t,n){void 0===n&&(n={}),this.player.dispatch(t,n)},WindowHandlers.prototype.storage=function(t){var n=t.key,l=t.newValue;n===wn&&this.player.tsidChanged(l)},WindowHandlers.prototype.visibilityChanged=function(t){var n=t.target[On];Mt.log("dc visibilityState",n,t,isInFullscreen()),this.browser.isiOS&&this.dispatchVisibilityChanges&&("hidden"===n?this.dispatch(lr.playerExit,{position:this.player.currentPlaybackTime}):"visible"===n&&this.dispatch(lr.playerActivate))},WindowHandlers.prototype.windowUnloaded=function(){this.player.isPlaying&&this.dispatch(lr.playerExit,{position:this.player.currentPlaybackTime})},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],WindowHandlers.prototype,"storage",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Event]),__metadata("design:returntype",void 0)],WindowHandlers.prototype,"visibilityChanged",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],WindowHandlers.prototype,"windowUnloaded",null),WindowHandlers}(),Nn=fr.bufferedProgressDidChange,Ln=fr.mediaCanPlay,xn=fr.mediaElementCreated,Un=fr.nowPlayingItemDidChange,Bn=fr.nowPlayingItemWillChange,jn=fr.metadataDidChange,Fn=fr.primaryPlayerDidChange,Kn=fr.playbackDurationDidChange,Vn=fr.playbackProgressDidChange,$n=fr.playbackStateDidChange,Hn=fr.playbackStateWillChange,zn=fr.playbackTargetAvailableDidChange,Wn=fr.playbackTargetIsWirelessDidChange,Yn=fr.playbackTimeDidChange,qn=fr.playbackVolumeDidChange,Gn=["canplay","durationchange","ended","error","loadedmetadata","loadstart","pause","play","playing","progress","seeked","seeking","timeupdate","volumechange","waiting"],Qn=t.PlaybackStates.ended,Jn=t.PlaybackStates.loading,Xn=t.PlaybackStates.paused,Zn=t.PlaybackStates.playing,eo=t.PlaybackStates.seeking,to=t.PlaybackStates.stopped,ro=t.PlaybackStates.waiting,io=function(){function BasePlayer(n){this.privateEnabled=!1,this.siriInitiated=!1,this.previewOnly=!1,this._currentBufferedProgress=0,this._paused=!1,this._playbackState=t.PlaybackStates.none,this._stopped=!1,this._currentPlaybackProgress=0,this._hasSmartPlayed=!1,this._isPrimaryPlayer=!0,this._playbackTargetAvailable=!1,this._playbackTargetIsWireless=!1,this._serial=Date.now().toString(),this._isDestroyed=!1,this._dispatcher=n.services.dispatcher,this._timing=n.services.timing,this._context=n.context||{},this.privateEnabled=n.privateEnabled||!1,this.siriInitiated=n.siriInitiated||!1,this._bitrateCalculator=n.services.bitrateCalculator,this.windowHandlers=new Dn(this),this.fullscreen=new In(this),localStorage.setItem(wn,this._serial)}return Object.defineProperty(BasePlayer.prototype,"bitrate",{get:function(){return this._bitrateCalculator.bitrate},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"currentBufferedProgress",{get:function(){return this._currentBufferedProgress},set:function(t){this._currentBufferedProgress!==t&&(this._currentBufferedProgress=t,this._dispatcher.publish(Nn,{progress:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"_currentDuration",{get:function(){return this._targetElement.duration},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"_currentTime",{get:function(){return this._targetElement.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"currentPlaybackDuration",{get:function(){var n=this.nowPlayingItem,l=(null==n?void 0:n.playbackType)===t.PlaybackType.encryptedFull||(null==n?void 0:n.playbackType)===t.PlaybackType.unencryptedFull,d=null==n?void 0:n.playbackDuration;return l&&d?this._timing.time(d/1e3):this._timing.time(this._currentDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"currentPlaybackTime",{get:function(){var t=void 0===this.nowPlayingItem||void 0===this.nowPlayingItem.playEvent||this._hasSmartPlayed?this._currentTime:this.nowPlayingItem.playEvent.playCursorInSeconds;return this._timing.time(t)},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"currentPlaybackTimeRemaining",{get:function(){return this.currentPlaybackDuration-this.currentPlaybackTime},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"currentPlaybackProgress",{get:function(){return this._currentPlaybackProgress||0},set:function(t){this._currentPlaybackProgress!==t&&(this._currentPlaybackProgress=t,this._dispatcher.publish(Vn,{progress:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"formattedCurrentPlaybackDuration",{get:function(){return formattedSeconds(this.currentPlaybackDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"hasMediaElement",{get:function(){return this._targetElement instanceof HTMLElement&&null!==this._targetElement.parentNode},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"isEngagedInPlayback",{get:function(){return!this._stopped&&!this.isPaused()},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"isPlaying",{get:function(){return this.playbackState===Zn},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"isPrimaryPlayer",{get:function(){return this._isPrimaryPlayer},set:function(t){t!==this._isPrimaryPlayer&&(this._isPrimaryPlayer=t,this._isPrimaryPlayer?localStorage.setItem(wn,this._serial):(this._dispatcher.publish(Fn,{target:this}),this.pause({userInitiated:!1})))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"isReady",{get:function(){return 0!==this._targetElement.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"nowPlayingItem",{get:function(){return this._nowPlayingItem},set:function(t){var n;if(this._hasSmartPlayed=!1,void 0===t)return this._nowPlayingItem=t,void this._dispatcher.publish(Un,{item:t});this._nowPlayingItem&&this._nowPlayingItem.isEqual(t)||(this._dispatcher.publish(Bn,{item:t}),this.isPlaying&&this._pauseMedia(),null===(n=this.extension)||void 0===n||n.cancelPendingRenewal(),this._nowPlayingItem&&(this._nowPlayingItem.state=kr.ended,this._nowPlayingItem.endMonitoringStateDidChange(),this._nowPlayingItem.endMonitoringStateWillChange()),this._nowPlayingItem=t,this._nowPlayingItem.state=kr.playing,t&&t.info&&this._setTargetElementTitle(t.info),this._dispatcher.publish(Un,{item:t}),this._dispatcher.publish(Kn,{currentTarget:this._targetElement,duration:this.currentPlaybackDuration,target:this._targetElement,type:"durationchange"}))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"playbackRate",{get:function(){return this._targetElement.playbackRate},set:function(t){this._targetElement.playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"playbackState",{get:function(){return this._playbackState},set:function(t){if(t!==this._playbackState){var n={oldState:this._playbackState,state:t,nowPlayingItem:this.nowPlayingItem?{id:this.nowPlayingItem.id,type:this.nowPlayingItem.type}:void 0};Mt.debug("BasePlayer.playbackState is changing",n),this._dispatcher.publish(Hn,n),this._playbackState=t,this._dispatcher.publish($n,n)}},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"playbackTargetAvailable",{get:function(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetAvailable},set:function(t){t!==this._playbackTargetAvailable&&(this._playbackTargetAvailable=t,this._dispatcher.publish(zn,{available:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"playbackTargetIsWireless",{get:function(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetIsWireless},set:function(t){t!==this._playbackTargetIsWireless&&(this._playbackTargetIsWireless=t,this._dispatcher.publish(Wn,{playing:t}))},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"volume",{get:function(){return this._targetElement.volume},set:function(t){this._targetElement.volume=t},enumerable:!0,configurable:!0}),Object.defineProperty(BasePlayer.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!0,configurable:!0}),BasePlayer.prototype.initialize=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return Mt.debug("BasePlayer.initialize"),this.isPlayerSupported()?[4,this.initializeMediaElement()]:(Mt.warn("{this.constructor.name} not supported"),[2]);case 1:return t.sent(),[4,this.initializeExtension()];case 2:return t.sent(),this.initializeEventHandlers(),this._dispatcher.publish(xn,this._targetElement),[2]}}))}))},BasePlayer.prototype.initializeEventHandlers=function(){var t=this;if(this.windowHandlers.activate(),this.hasMediaElement){var n=this._targetElement;window.WebKitPlaybackTargetAvailabilityEvent&&(n.addEventListener("webkitplaybacktargetavailabilitychanged",(function(n){t.playbackTargetAvailable="available"===n.availability})),n.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",(function(n){t.playbackTargetIsWireless=n.target===t._targetElement&&!t.playbackTargetIsWireless}))),Gn.forEach((function(l){return n.addEventListener(l,t)})),this.dispatch(lr.playerActivate,{isPlaying:this.isPlaying})}},BasePlayer.prototype.removeEventHandlers=function(){var t=this;Gn.forEach((function(n){return t._targetElement.removeEventListener(n,t)})),this.windowHandlers.deactivate()},BasePlayer.prototype.isPaused=function(){return this._paused},BasePlayer.prototype.exitFullscreen=function(){return this.fullscreen.exit()},BasePlayer.prototype.requestFullscreen=function(t){return this.fullscreen.request(t)},BasePlayer.prototype.seekToTime=function(t,n){return void 0===n&&(n=tn.Manual),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this._buffer?[4,this._buffer.seek(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this._targetElement.currentTime=t,[2]}}))}))},BasePlayer.prototype.newSeeker=function(t){var n;return null===(n=this._seeker)||void 0===n||n.end(),this._seeker=new Rn(this),this._seeker},BasePlayer.prototype.stop=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return Mt.debug("BasePlayer.stop",t),[4,this._waitForPendingPlay()];case 1:return n.sent(),this.isPlaying&&this.dispatch(lr.playbackStop,__assign({position:this.currentPlaybackTime,startPosition:this._initialBufferPosition||0},t)),[4,this.stopMediaAndCleanup()];case 2:return n.sent(),[2]}}))}))},BasePlayer.prototype.stopMediaAndCleanup=function(t){return void 0===t&&(t=to),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._stopMediaElement()];case 1:return n.sent(),this._stopped=!0,this.playbackState=t,this.nowPlayingItem=void 0,this._initialBufferPosition=void 0,[2]}}))}))},BasePlayer.prototype._calculatePlaybackProgress=function(){this.currentPlaybackProgress=Math.round(100*(this.currentPlaybackTime/this.currentPlaybackDuration||0))/100},BasePlayer.prototype.destroy=function(){var t;if(Mt.debug("BasePlayer.destroy"),this._isDestroyed=!0,this.hasMediaElement){var n=this._targetElement;null===(t=this.extension)||void 0===t||t.destroy(n),this.removeEventHandlers(),this.cleanupElement(),null!==n.parentNode&&n.parentNode.removeChild(n)}},BasePlayer.prototype.handleEvent=function(n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:switch("timeupdate"!==n.type&&Mt.debug("BasePlayer.handleEvent: ",n.type,n,this.isPaused(),this._stopped),n.type){case"canplay":return[3,1];case"durationchange":return[3,2];case"ended":return[3,3];case"error":return[3,5];case"loadedmetadata":return[3,6];case"loadstart":return[3,7];case"pause":return[3,8];case"play":case"playing":return[3,9];case"progress":return[3,10];case"seeked":return[3,11];case"seeking":return[3,12];case"timeupdate":return[3,13];case"volumechange":return[3,14];case"waiting":return[3,15]}return[3,16];case 1:return this._dispatcher.publish(Ln,n),this.handleSmartPlay(),this._playbackState!==t.PlaybackStates.waiting||this._targetElement.paused||(this.playbackState=t.PlaybackStates.playing),[3,16];case 2:return this._targetElement.duration!==1/0&&(n.duration=this.currentPlaybackDuration,this._dispatcher.publish(Kn,n),this._calculatePlaybackProgress()),[3,16];case 3:return this.playbackState=Qn,this.dispatch(lr.playbackStop,{endReasonType:t.PlayActivityEndReasonType.NATURAL_END_OF_TRACK}),[4,this.stopMediaAndCleanup(Qn)];case 4:return d.sent(),[3,16];case 5:case 6:return this._dispatcher.publish(jn,n),[3,16];case 7:return this.playbackState=Jn,[3,16];case 8:return this.playbackState=this._stopped?to:Xn,[3,16];case 9:return this._paused=!1,this._stopped=!1,this.isPrimaryPlayer=!0,this.playbackState=Zn,[3,16];case 10:return l=this._targetElement.buffered,this.handleBufferStart(),1===l.length&&0===l.start(0)&&(this.currentBufferedProgress=Math.round(l.end(0)/this.currentPlaybackDuration*100)),[3,16];case 11:return this._stopped?this.playbackState=to:this._paused?this.playbackState=Xn:this.playbackState=Zn,[3,16];case 12:return this.playbackState===Xn?this._paused=!0:this.playbackState===to&&(this._stopped=!0),this.playbackState=eo,[3,16];case 13:return this._dispatcher.publish(Yn,{currentPlaybackDuration:this.currentPlaybackDuration,currentPlaybackTime:this.currentPlaybackTime,currentPlaybackTimeRemaining:this.currentPlaybackTimeRemaining}),this._calculatePlaybackProgress(),this._buffer&&(this._buffer.currentTime=this.currentPlaybackTime),[3,16];case 14:return this._dispatcher.publish(qn,n),[3,16];case 15:return this.playbackState=ro,[3,16];case 16:return[2]}}))}))},BasePlayer.prototype.handleBufferStart=function(){var t=this._targetElement;void 0!==this._initialBufferPosition||t.paused||0===t.buffered.length||(this._initialBufferPosition=t.buffered.start(0),Mt.debug("BasePlayer.handleBufferStart: setting initial buffer position ",this._initialBufferPosition))},BasePlayer.prototype.handleSmartPlay=function(){if(this._targetElement&&this.nowPlayingItem){var t=this.nowPlayingItem;t&&t.playEvent&&!t.playEvent.isDone&&!this._hasSmartPlayed&&(Mt.debug("BasePlayer.handleSmartPlay is resuming playCursor"),this._targetElement.currentTime=t.playEvent.playCursorInSeconds),this._hasSmartPlayed=!0}},BasePlayer.prototype.pause=function(t){return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._waitForPendingPlay()];case 1:return n.sent(),this.isPlaying?[4,this._pauseMedia()]:[2];case 2:return n.sent(),this._paused=!0,this.dispatch(lr.playbackPause,__assign({position:this.currentPlaybackTime},t)),[2]}}))}))},BasePlayer.prototype.play=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,(function(){var n,l,d=this;return __generator(this,(function(p){switch(p.label){case 0:if(Mt.debug("BasePlayer.play()"),!this.nowPlayingItem)return[2];p.label=1;case 1:return p.trys.push([1,3,,4]),n=function(){Mt.debug("BasePlayer.play dispatching playbackPlay"),d.dispatch(lr.playbackPlay,{userInitiated:t,position:d.currentPlaybackTime})},[4,this._playMedia(n)];case 2:return p.sent(),[3,4];case 3:return"NotAllowedError"!==(l=p.sent()).name&&"NotSupportedError"!==l.name||Mt.error("BasePlayer.play() rejected due to",l),[2];case 4:return[2]}}))}))},BasePlayer.prototype.preload=function(){return this._loadMedia()},BasePlayer.prototype.showPlaybackTargetPicker=function(){this.playbackTargetAvailable&&this._targetElement.webkitShowPlaybackTargetPicker()},BasePlayer.prototype.dispatch=function(t,n){void 0===n&&(n={}),void 0===n.item&&(n.item=this.nowPlayingItem),void 0===n.position&&(n.position=this.currentPlaybackTime),n.isPlaying=this.isPlaying,this._dispatcher.publish(t,n)},BasePlayer.prototype.tsidChanged=function(t){void 0!==t&&""!==t&&(this.isPrimaryPlayer=t===this._serial)},BasePlayer.prototype._waitForPendingPlay=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:if(!this._playPromise)return[2];n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,this._playPromise];case 2:return n.sent(),[3,5];case 3:return t=n.sent(),Mt.error("BasePlayer._waitForPendingPlay playPromise rejected",t),[3,5];case 4:return this._playPromise=void 0,[7];case 5:return[2]}}))}))},BasePlayer.prototype._loadMedia=function(){return Mt.debug("BasePlayer._loadMedia",this._targetElement),this._targetElement.load(),Promise.resolve()},BasePlayer.prototype._pauseMedia=function(){return this._targetElement.pause(),Promise.resolve()},BasePlayer.prototype._playAssetURL=function(t,n){Mt.debug("BasePlayer._playAssetURL",t),this._targetElement.src=t;var l=this._loadMedia();return n?(Mt.debug("BasePlayer.loadOnly"),l):this._playMedia()},BasePlayer.prototype.playItemFromUnencryptedSource=function(t,n,l){return(null==l?void 0:l.startTime)&&(t+="#t="+l.startTime),this._playAssetURL(t,n)},BasePlayer.prototype._playMedia=function(t){return void 0===t&&(t=An),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return Mt.debug("BasePlayer._playMedia",this._targetElement,this.extension),n=this._targetElement.play(),this._playPromise=n.then(t),[4,n];case 1:return l.sent(),[2]}}))}))},BasePlayer.prototype._setTargetElementTitle=function(t){this.hasMediaElement&&(this._targetElement.title=t)},BasePlayer.prototype._licenseError=function(){this._playPromise=void 0},BasePlayer.prototype._stopMediaElement=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.hasMediaElement&&(this._targetElement.pause(),this.cleanupElement()),[2]}))}))},BasePlayer.prototype.cleanupElement=function(){var t=this._targetElement;t&&(t.currentTime=0,t.removeAttribute("src"),t.removeAttribute("title"))},BasePlayer}();function restoreSelectedTrack(t,n){Mt.debug("MEDIA_TRACKS restoreSelectedTrack");var l=t.getPersistedTrack(),d=t.fields,p=n.currentTrack;if(l)if(p&&trackEquals(p,l,d))Mt.debug("MEDIA_TRACKS persisted track is equal to current track, not setting");else{var h=n.tracks;if(h&&h.length)for(var f=0;f<h.length;f++){var y=h[f];if(Mt.debug("MEDIA_TRACKS testing track "+y.label+" against persisted track "+JSON.stringify(l)),trackEquals(y,l,d)){Mt.debug("MEDIA_TRACKS found matching track "+y.label),n.currentTrack=y;break}}}else Mt.debug("MEDIA_TRACKS no persisted track")}function trackEquals(t,n,l){for(var d=!0,p=0;p<l.length;p++){var h=l[p];if(t[h]!==n[h]){d=!1;break}}return d}!function(t){t.playbackLicenseError="playbackLicenseError",t.playbackSessionError="playbackSessionError",t.manifestParsed="manifestParsed",t.audioCodecIdentified="audioCodecIdentified",t.audioTracksSwitched="audioTracksSwitched",t.audioTracksUpdated="audioTracksUpdated",t.textTracksSwitched="textTracksSwitched",t.textTracksUpdated="textTracksUpdated",t.levelUpdated="levelUpdated"}(mn||(mn={})),function(t){t.MP4="audio/mp4",t.AVC1="video/mp4"}(_n||(_n={}));var no=function(){function TrackPersistence(t,n){this.storageKey=t,this.fields=n}return TrackPersistence.prototype.getPersistedTrack=function(){if(!window||!window.localStorage)return!1;var t=window.localStorage.getItem(this.storageKey)||"";try{return JSON.parse(t)}catch(e){return Mt.warn("MEDIA_TRACK could not parse persisted value "+t),!1}},TrackPersistence.prototype.setPersistedTrack=function(t){if(window&&window.localStorage)if(Mt.debug("MEDIA_TRACK setPersistedTrack "+t.language+","+t.label+","+t.kind+" with keys "+this.fields),t){var n=JSON.stringify(this.extractFieldValuesFromTrack(t));Mt.debug("MEDIA_TRACK Extracted values "+n),window.localStorage.setItem(this.storageKey,n)}else window.localStorage.setItem(this.storageKey,"")},TrackPersistence.prototype.extractFieldValuesFromTrack=function(t){var n={};return this.fields.forEach((function(l){var d=t[l];null==d&&Mt.warn("MEDIA_TRACK No value for field "+l+" on track "+JSON.stringify(t)),n[l]=d})),n},TrackPersistence}(),oo=fr.audioTrackAdded,ao=fr.audioTrackChanged,so=fr.audioTrackRemoved,uo=mn.audioTracksSwitched,co=mn.audioTracksUpdated,lo=function(){function AudioTrackManager(t,n,l){if(this.mediaElement=t,this.dispatcher=n,this.extensionTracks=l,this._extensionTracks=[],this.trackPersistence=new no("mk-audio-track",["label","language","kind"]),this.extensionTracks){Mt.debug("MEDIA_TRACK Initializing audio track manager for hls track events"),this.onExtensionAudioTracksUpdated=this.onExtensionAudioTracksUpdated.bind(this),this.onExtensionAudioTrackSwitched=this.onExtensionAudioTrackSwitched.bind(this);var d=this.extensionTracks;d.addEventListener(co,this.onExtensionAudioTracksUpdated),d.addEventListener(uo,this.onExtensionAudioTrackSwitched)}else{if(!t.audioTracks)return;Mt.debug("MEDIA_TRACK Initializing audio track manager for native track events"),this.onAudioTrackAdded=this.onAudioTrackAdded.bind(this),this.onAudioTrackChanged=this.onAudioTrackChanged.bind(this),this.onAudioTrackRemoved=this.onAudioTrackRemoved.bind(this),t.audioTracks.addEventListener("addtrack",this.onAudioTrackAdded),t.audioTracks.addEventListener("change",this.onAudioTrackChanged),t.audioTracks.addEventListener("removetrack",this.onAudioTrackRemoved)}}return Object.defineProperty(AudioTrackManager.prototype,"currentTrack",{get:function(){return this.tracks.find((function(t){return t.enabled}))},set:function(t){t&&(Mt.debug("MEDIA_TRACK Setting audio track "+t.label),this.extensionTracks?(Mt.debug("MEDIA_TRACK Setting track on extension "+t.id+"-"+t.label),this.extensionTracks.audioTrack=t):t.enabled=!0,this.trackPersistence.setPersistedTrack(t))},enumerable:!0,configurable:!0}),Object.defineProperty(AudioTrackManager.prototype,"tracks",{get:function(){return this.extensionTracks?this._extensionTracks||this.extensionTracks.audioTracks||[]:Array.from(this.mediaElement.audioTracks)},enumerable:!0,configurable:!0}),AudioTrackManager.prototype.destroy=function(){if(this.extensionTracks){var t=this.extensionTracks;t.removeEventListener(co,this.onExtensionAudioTracksUpdated),t.removeEventListener(uo,this.onExtensionAudioTrackSwitched)}else{if(!this.mediaElement.audioTracks)return;this.mediaElement.audioTracks.removeEventListener("addtrack",this.onAudioTrackAdded),this.mediaElement.audioTracks.removeEventListener("change",this.onAudioTrackChanged),this.mediaElement.audioTracks.removeEventListener("removetrack",this.onAudioTrackRemoved)}},AudioTrackManager.prototype.restoreSelectedTrack=function(){return restoreSelectedTrack(this.trackPersistence,this)},AudioTrackManager.prototype.onExtensionAudioTracksUpdated=function(t){Mt.debug("MEDIA_TRACK Extension audio tracks updated "+JSON.stringify(t)),this._extensionTracks=t,this.restoreSelectedTrack(),this.dispatcher.publish(oo,t)},AudioTrackManager.prototype.onExtensionAudioTrackSwitched=function(t){if(Mt.debug("MEDIA_TRACK Extension audio track switched "+JSON.stringify(t)),this._extensionTracks){this._extensionTracks.forEach((function(n){n.enabled=t.selectedId===n.id}))}this.dispatcher.publish(ao,t)},AudioTrackManager.prototype.onAudioTrackAdded=function(t){var n,l,d,p;n=t.track,l=this.trackPersistence,d=this,(p=l.getPersistedTrack())&&trackEquals(n,p,l.fields)&&(Mt.debug("MEDIA_TRACK onTrackAdded with track that matches persisted track "+n.label),d.currentTrack=n),this.dispatcher.publish(oo,t)},AudioTrackManager.prototype.onAudioTrackChanged=function(t){this.dispatcher.publish(ao,t)},AudioTrackManager.prototype.onAudioTrackRemoved=function(t){this.dispatcher.publish(so,t)},AudioTrackManager}(),po=createCommonjsModule((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidPercentValue=function(t){return"number"==typeof t&&t>=0&&t<=100},n.isValidAlignSetting=function(t){return"string"==typeof t&&["start","center","end","left","right","middle"].includes(t)},n.isValidDirectionSetting=function(t){return"string"==typeof t&&["","rl","lr"].includes(t)},n.isValidLineAndPositionSetting=function(t){return"number"==typeof t||"auto"===t},n.isValidLineAlignSetting=function(t){return"string"==typeof t&&["start","center","end"].includes(t)},n.isValidPositionAlignSetting=function(t){return"string"==typeof t&&["line-left","center","line-right","auto","left","start","middle","end","right"].includes(t)},n.isValidScrollSetting=function(t){return["","up"].includes(t)}}));unwrapExports(po);po.isValidPercentValue,po.isValidAlignSetting,po.isValidDirectionSetting,po.isValidLineAndPositionSetting,po.isValidLineAlignSetting,po.isValidPositionAlignSetting,po.isValidScrollSetting;var ho=createCommonjsModule((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});const l={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"â","&rlm;":"â","&nbsp;":"Â "},d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},p={v:"title",lang:"lang"},h={rt:"ruby"},f={"text-combine-upright":"-webkit-text-combine:horizontal; text-orientation: mixed;"};class ParserUtility{static parseTimeStamp(t){function computeSeconds(t){const[n,l,d,p]=t.map(t=>t?parseInt(""+t):0);return 3600*n+60*l+d+p/1e3}const n=/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(t);return n?n[3]?computeSeconds([n[1],n[2],n[3].substring(1),n[4]]):parseInt(n[1])>59?computeSeconds([n[1],n[2],null,n[4]]):computeSeconds([null,n[1],n[2],n[4]]):null}static parseContent(t,n,y){let v=n.text;function nextToken(){if(!v)return null;const t=/^([^<]*)(<[^>]+>?)?/.exec(v);return n=t[1]?t[1]:t[2],v=v.substr(n.length),n;var n}function unescape1(t){return l[t]}function unescape(t){return t.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g,unescape1)}function shouldAdd(t,n){return!h[n.dataset.localName]||h[n.dataset.localName]===t.dataset.localName}function createElement(n,l,h){const v=d[n];if(!v)return null;const g=t.document.createElement(v);g.dataset.localName=v;const m=p[n];if(m&&h&&(g[m]=h.trim()),l)if(y[l]){const t=function(t){let n="";for(const l in t)n+=f[l]?f[l]:l+":"+t[l]+";";return n}(y[l]);g.setAttribute("style",t)}else console.info(`WebVTT: parseContent: Style referenced, but no style defined for '${l}'!`);return g}const g=t.document.createElement("div"),m=[];let _,b,P=g;for(;null!==(_=nextToken());)if("<"!==_[0])P.appendChild(t.document.createTextNode(unescape(_)));else{if("/"===_[1]){m.length&&m[m.length-1]===_.substr(2).replace(">","")&&(m.pop(),P=P.parentNode);continue}const n=ParserUtility.parseTimeStamp(_.substr(1,_.length-2));let l;if(n){l=t.document.createProcessingInstruction("timestamp",n.toString()),P.appendChild(l);continue}if(b=/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(_),!b)continue;if(l=createElement(b[1],b[2],b[3]),!l)continue;if(!shouldAdd(P,l))continue;b[2],m.push(b[1]),P.appendChild(l),P=l}return g}}n.default=ParserUtility}));unwrapExports(ho);var fo=createCommonjsModule((function(t,n){var d=l&&l.__decorate||function(t,n,l,d){var p,h=arguments.length,f=h<3?n:null===d?d=Object.getOwnPropertyDescriptor(n,l):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(t,n,l,d);else for(var y=t.length-1;y>=0;y--)(p=t[y])&&(f=(h<3?p(f):h>3?p(n,l,f):p(n,l))||f);return h>3&&f&&Object.defineProperty(n,l,f),f};Object.defineProperty(n,"__esModule",{value:!0});let p=class{constructor(t,n,l){this._id="",this._pauseOnExit=!1,this._region=null,this._vertical="",this._snapToLines=!0,this._line="auto",this._lineAlign="start",this._position=50,this._positionAlign="center",this._size=50,this._align="center",this.hasBeenReset=!1,this._startTime=t,this._endTime=n,this._text=l}get id(){return this._id}set id(t){this._id=""+t}get pauseOnExit(){return this._pauseOnExit}set pauseOnExit(t){this._pauseOnExit=!!t}get startTime(){return this._startTime}set startTime(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number: "+t);this._startTime=t,this.hasBeenReset=!0}get endTime(){return this._endTime}set endTime(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number: "+t);this._endTime=t,this.hasBeenReset=!0}get text(){return this._text}set text(t){this._text=""+t,this.hasBeenReset=!0}get region(){return this._region}set region(t){this._region=t,this.hasBeenReset=!0}get vertical(){return this._vertical}set vertical(t){if(!po.isValidDirectionSetting(t))throw new SyntaxError("An invalid or illegal string was specified for vertical: "+t);this._vertical=t,this.hasBeenReset=!0}get snapToLines(){return this._snapToLines}set snapToLines(t){this._snapToLines=!!t,this.hasBeenReset=!0}get line(){return this._line}set line(t){if(!po.isValidLineAndPositionSetting(t))throw new SyntaxError("An invalid number or illegal string was specified for line: "+t);this._line=t,this.hasBeenReset=!0}get lineAlign(){return this._lineAlign}set lineAlign(t){if(!po.isValidLineAlignSetting(t))throw new SyntaxError("An invalid or illegal string was specified for lineAlign: "+t);this._lineAlign=t,this.hasBeenReset=!0}get position(){return this._position}set position(t){if(!po.isValidLineAndPositionSetting(t))throw new Error("Position must be between 0 and 100 or auto: "+t);this._position=t,this.hasBeenReset=!0}get positionAlign(){return this._positionAlign}set positionAlign(t){if(!po.isValidPositionAlignSetting(t))throw new SyntaxError("An invalid or illegal string was specified for positionAlign: "+t);this._positionAlign=t,this.hasBeenReset=!0}get size(){return this._size}set size(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100: "+t);this._size=t,this.hasBeenReset=!0}get align(){return this._align}set align(t){if(!po.isValidAlignSetting(t))throw new SyntaxError("An invalid or illegal string was specified for align: "+t);this._align=t,this.hasBeenReset=!0}getCueAsHTML(){return ho.default.parseContent(window,this,{})}static create(t){if(!t.hasOwnProperty("startTime")||!t.hasOwnProperty("endTime")||!t.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");const n=new this(t.startTime,t.endTime,t.text);return Object.keys(t).forEach(l=>{n.hasOwnProperty(l)&&(n[l]=t[l])}),n}static fromJSON(t){return this.create(JSON.parse(t))}toJSON(){const t={};return Object.keys(this).forEach(n=>{this.hasOwnProperty(n)&&"getCueAsHTML"!==n&&"hasBeenReset"!==n&&"displayState"!==n&&(t[n]=this[n])}),t}};p=d([function(t){let n=t;"undefined"!=typeof window&&null!=window.VTTCue&&(n=window.VTTCue,n.create=t.create,n.fromJSON=t.fromJSON,n.prototype.toJSON=t.prototype.toJSON);return n}],p),n.VTTCue=p}));unwrapExports(fo);fo.VTTCue;var yo=createCommonjsModule((function(t,n){var d=l&&l.__decorate||function(t,n,l,d){var p,h=arguments.length,f=h<3?n:null===d?d=Object.getOwnPropertyDescriptor(n,l):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(t,n,l,d);else for(var y=t.length-1;y>=0;y--)(p=t[y])&&(f=(h<3?p(f):h>3?p(n,l,f):p(n,l))||f);return h>3&&f&&Object.defineProperty(n,l,f),f};Object.defineProperty(n,"__esModule",{value:!0});let p=class{constructor(){this._id="",this._lines=3,this._regionAnchorX=0,this._regionAnchorY=100,this._scroll="",this._viewportAnchorX=0,this._viewportAnchorY=100,this._width=100}get id(){return this._id}set id(t){if("string"!=typeof t)throw new Error("ID must be a string.");this._id=t}get lines(){return this._lines}set lines(t){if("number"!=typeof t)throw new TypeError("Lines must be set to a number.");this._lines=t}get regionAnchorX(){return this._regionAnchorX}set regionAnchorX(t){if(!po.isValidPercentValue(t))throw new TypeError("RegionAnchorX must be between 0 and 100.");this._regionAnchorX=t}get regionAnchorY(){return this._regionAnchorY}set regionAnchorY(t){if(!po.isValidPercentValue(t))throw new TypeError("RegionAnchorY must be between 0 and 100.");this._regionAnchorY=t}get scroll(){return this._scroll}set scroll(t){if("string"==typeof t){const n=t.toLowerCase();if(po.isValidScrollSetting(n))return void(this._scroll=n)}throw new SyntaxError("An invalid or illegal string was specified.")}get viewportAnchorX(){return this._viewportAnchorX}set viewportAnchorX(t){if(!po.isValidPercentValue(t))throw new TypeError("ViewportAnchorX must be between 0 and 100.");this._viewportAnchorX=t}get viewportAnchorY(){return this._viewportAnchorY}set viewportAnchorY(t){if(!po.isValidPercentValue(t))throw new TypeError("ViewportAnchorY must be between 0 and 100.");this._viewportAnchorY=t}get width(){return this._width}set width(t){if(!po.isValidPercentValue(t))throw new TypeError("Width must be between 0 and 100.");this._lines=t}toJSON(){const t={};return Object.keys(this).forEach(n=>{this.hasOwnProperty(n)&&(t[n]=this[n])}),t}static create(t){const n=new this;return Object.keys(t).forEach(l=>{n.hasOwnProperty(l)&&(n[l]=t[l])}),n}static fromJSON(t){return this.create(JSON.parse(t))}};p=d([function(t){let n=t;"undefined"!=typeof window&&null!=window.VTTRegion&&(n=window.VTTRegion,n.create=t.create,n.fromJSON=t.fromJSON,n.prototype.toJSON=t.prototype.toJSON);return n}],p),n.VTTRegion=p}));unwrapExports(yo);yo.VTTRegion;var vo=createCommonjsModule((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.VTTCue=fo.VTTCue,n.VTTRegion=yo.VTTRegion;class ParsingError extends Error{constructor(t,n){super(),this.name="ParsingError",this.code="number"==typeof t?t:t.code,n?this.message=n:t instanceof ParsingError&&(this.message=t.message)}}n.ParsingError=ParsingError,ParsingError.Errors={BadSignature:new ParsingError(0,"Malformed WebVTT signature."),BadTimeStamp:new ParsingError(1,"Malformed time stamp.")};class Settings{constructor(){this.values={}}set(t,n){this.get(t)||""===n||(this.values[t]=n)}get(t,n,l){return"object"==typeof n&&"string"==typeof l?this.has(t)?this.values[t]:n[l]:this.has(t)?this.values[t]:n}has(t){return t in this.values}alt(t,n,l){for(let d=0;d<l.length;++d)if(n===l[d]){this.set(t,n);break}}integer(t,n){/^-?\d+$/.test(n)&&this.set(t,parseInt(n,10))}percent(t,n){if(n.match(/^([\d]{1,3})(\.[\d]*)?%$/))try{const l=parseFloat(n);if(l>=0&&l<=100)return this.set(t,l),!0}catch(hu){return!1}return!1}}class WebVTTParser{constructor(t,n,l){this.window=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[],this.onStylesParsedCallback=l,this._styles={}}static StringDecoder(){return{decode:t=>{if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}}reportOrThrowError(t){if(!(t instanceof ParsingError&&"function"==typeof this.onparsingerror))throw t;this.onparsingerror(t)}parseOptions(t,n,l,d){const p=d?t.split(d):[t];for(const h of p){if("string"!=typeof h)continue;const t=h.split(l);2===t.length&&n(t[0],t[1])}}parseCue(t,n,l){const d=t,consumeTimeStamp=()=>{const n=ho.default.parseTimeStamp(t);if(null===n)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+d);return t=t.replace(/^[^\sa-zA-Z-]+/,""),n},skipWhitespace=()=>{t=t.replace(/^\s+/,"")};if(skipWhitespace(),n.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==t.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+d);t=t.substr(3),skipWhitespace(),n.endTime=consumeTimeStamp(),skipWhitespace(),((t,n)=>{const d=new Settings;this.parseOptions(t,(t,n)=>{let p,h;switch(t){case"region":for(let p=l.length-1;p>=0;p--)if(l[p].id===n){d.set(t,l[p].region);break}break;case"vertical":d.alt(t,n,["rl","lr"]);break;case"line":p=n.split(","),h=p[0],d.integer(t,h),d.percent(t,h)&&d.set("snapToLines",!1),d.alt(t,h,["auto"]),2===p.length&&d.alt("lineAlign",p[1],["start","center","end"]);break;case"position":if(p=n.split(","),d.percent(t,p[0]),2===p.length){let t=["line-left","line-right","center","auto","left","start","middle","end","right"];d.alt("positionAlign",p[1],t)}break;case"size":d.percent(t,n);break;case"align":let f=["start","center","end","left","right","middle"];d.alt(t,n,f)}},/:/,/\s/),n.region=d.get("region",null),n.vertical=d.get("vertical",""),n.line=d.get("line",void 0===n.line?"auto":n.line),n.lineAlign=d.get("lineAlign","start"),n.snapToLines=d.get("snapToLines",!0),n.size=d.get("size",100);let p=d.get("align","center");n.align="middle"===p?"center":p,n.position=d.get("position","auto");let h=d.get("positionAlign",{start:"start",left:"start",center:"center",right:"end",end:"end"},n.align);n.positionAlign={start:"start","line-left":"start",left:"start",center:"center",middle:"center","line-right":"end",right:"end",end:"end"}[h]})(t,n)}parseRegion(t){const n=new Settings;if(this.parseOptions(t,(t,l)=>{switch(t){case"id":n.set(t,l);break;case"width":n.percent(t,l);break;case"lines":n.integer(t,l);break;case"regionanchor":case"viewportanchor":{const d=l.split(",");if(2!==d.length)break;const p=new Settings;if(p.percent("x",d[0]),p.percent("y",d[1]),!p.has("x")||!p.has("y"))break;n.set(t+"X",p.get("x")),n.set(t+"Y",p.get("y"));break}case"scroll":n.alt(t,l,["up"])}},/=/,/\s/),n.has("id")){const t=new yo.VTTRegion;t.width=n.get("width",100),t.lines=n.get("lines",3),t.regionAnchorX=n.get("regionanchorX",0),t.regionAnchorY=n.get("regionanchorY",100),t.viewportAnchorX=n.get("viewportanchorX",0),t.viewportAnchorY=n.get("viewportanchorY",100),t.scroll=n.get("scroll",""),this.onregion&&this.onregion(t),this.regionList.push({id:n.get("id"),region:t})}}parseStyle(t){const parseStyles=t=>{const n={},l=t.split(";");for(let d=0;d<l.length;d++){const t=l[d].split(":",2),p=t[0].trim(),h=t[1].trim();""!==p&&""!==h&&(n[p]=h)}return n},n=t.replace(" ","").split("}");n.pop();for(const l of n){let t=null,n=null;const d=l.split("{");d[0]&&(t=d[0].trim()),d[1]&&(n=parseStyles(d[1])),t&&n&&(this._styles[t]=n)}this.onStylesParsedCallback&&this.onStylesParsedCallback(this._styles)}parseHeader(t){this.parseOptions(t,(function(t,n){switch(t){case"Region":this.parseRegion(n)}}),/:/)}parse(t){t&&(this.buffer+=this.decoder.decode(t,{stream:!0}));const collectNextLine=()=>{const t=this.buffer;let n=0;const calculateBreakPosition=(t,n)=>{const l={start:-1,length:-1};if("\r"===t[n])l.start=n,l.length=1;else if("\n"===t[n])l.start=n,l.length=1;else if("<"===t[n]&&n+1<t.length&&"b"===t[n+1]&&n+2<t.length&&"r"===t[n+2]){let d=n+2;for(;d<t.length&&">"!==t[d++];);l.start=n,l.length=d-n}return l};let l={start:t.length,length:0};for(;n<t.length;){const d=calculateBreakPosition(t,n);if(d.length>0){l=d;break}++n}const d=t.substr(0,l.start);return this.buffer=t.substr(l.start+l.length),d};try{let t;if(this.styleCollector="","INITIAL"===this.state){if(!/\r\n|\n/.test(this.buffer))return this;t=collectNextLine();const n=/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/.exec(t);if(!n||!n[0])throw new ParsingError(ParsingError.Errors.BadSignature);this.state="HEADER"}let n=!1;for(;this.buffer;){if(!/\r\n|\n/.test(this.buffer))return this;switch(n?n=!1:t=collectNextLine(),this.state){case"HEADER":t.includes(":")?this.parseHeader(t):t||(this.state="ID");continue;case"NOTE":t||(this.state="ID");continue;case"STYLE":t?this.styleCollector+=t:(this.parseStyle(this.styleCollector),this.state="ID",this.styleCollector="");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){this.state="NOTE";break}if(/^STYLE($|[ \t])/.test(t)){this.state="STYLE";break}if(!t)continue;if(this.cue=new fo.VTTCue(0,0,""),this.state="CUE",!t.includes("--\x3e")){this.cue.id=t;continue}case"CUE":try{this.parseCue(t,this.cue,this.regionList)}catch(e){this.reportOrThrowError(e),this.cue=null,this.state="BADCUE";continue}this.state="CUETEXT";continue;case"CUETEXT":{const l=t.includes("--\x3e");if(!t||l){n=!0,this.oncue&&this.oncue(this.cue),this.cue=null,this.state="ID";continue}this.cue.text&&(this.cue.text+="\n"),this.cue.text+=t;continue}case"BADCUE":t||(this.state="ID");continue}}}catch(e){this.reportOrThrowError(e),"CUETEXT"===this.state&&this.cue&&this.oncue&&this.oncue(this.cue),this.cue=null,this.state="INITIAL"===this.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}styles(){return this._styles}}n.default=WebVTTParser,n.WebVTTParser=WebVTTParser}));unwrapExports(vo);vo.VTTCue,vo.VTTRegion,vo.ParsingError,vo.WebVTTParser;var go=createCommonjsModule((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.VTTCue=fo.VTTCue;const l=[/^(::cue\()(\..*)(\))/,/^(::cue\()(#.*)(\))/,/^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/],d=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];class StyleBox{applyStyles(t,n){n=n||this.div;for(const l in t)t.hasOwnProperty(l)&&(n.style[l]=t[l])}formatStyle(t,n){return 0===t?"0":t+n}}n.StyleBox=StyleBox;class CueStyleBox extends StyleBox{constructor(t,n,l,d,p){super(),this.cue=n;let h={textAlign:{start:"left","line-left":"left",left:"left",center:"center",middle:"center","line-right":"right",right:"right",end:"right"}[n.positionAlign]||n.align,whiteSpace:"pre-line",position:"absolute"};h.direction=this.determineBidi(this.cueDiv),h.writingMode=this.directionSettingToWritingMode(n.vertical),h.unicodeBidi="plaintext",this.div=t.document.createElement("div"),this.applyStyles(h),h={backgroundColor:d.backgroundColor,display:"inline-block"},this.parseOpacity(h.backgroundColor)&&(h.padding="5px",h.borderRadius="5px"),this.backgroundDiv=t.document.createElement("div"),this.applyStyles(h,this.backgroundDiv),h={color:l.color,backgroundColor:l.backgroundColor,textShadow:l.textShadow,fontSize:l.fontSize,fontFamily:l.fontFamily,position:"relative",left:"0",right:"0",top:"0",bottom:"0",display:"inline-block",textOrientation:"upright"},h.writingMode=this.directionSettingToWritingMode(n.vertical),h.unicodeBidi="plaintext",this.cueDiv=ho.default.parseContent(t,n,p),this.applyStyles(h,this.cueDiv),this.backgroundDiv.appendChild(this.cueDiv),this.div.appendChild(this.backgroundDiv);let f=0;if("number"==typeof n.position){let t=n.positionAlign||n.align;if(t)switch(t){case"start":case"left":f=n.position;break;case"center":case"middle":f=n.position-n.size/2;break;case"end":case"right":f=n.position-n.size}}""===n.vertical?this.applyStyles({left:this.formatStyle(f,"%"),width:this.formatStyle(n.size,"%")}):this.applyStyles({top:this.formatStyle(f,"%"),height:this.formatStyle(n.size,"%")})}determineBidi(t){let n,l=[],p="";if(!t||!t.childNodes)return"ltr";function pushNodes(t,n){for(let l=n.childNodes.length-1;l>=0;l--)t.push(n.childNodes[l])}function nextTextNode(t){if(!t||!t.length)return null;let n=t.pop(),l=n.textContent||n.innerText;if(l){const n=/^.*(\n|\r)/.exec(l);return n?(t.length=0,n[0]):l}return"ruby"===n.tagName?nextTextNode(t):n.childNodes?(pushNodes(t,n),nextTextNode(t)):void 0}function isContainedInCharacterList(t,n){for(const l of n)if(t>=l[0]&&t<=l[1])return!0;return!1}for(pushNodes(l,t);p=nextTextNode(l);)for(let t=0;t<p.length;t++)if(n=p.charCodeAt(t),isContainedInCharacterList(n,d))return"rtl";return"ltr"}parseOpacity(t){if(!t||"string"!=typeof t)return null;const n=(t=t.replace(/ /g,"").replace("rgba(","").replace(")","")).split(",");return n&&n.length>=4?n[3]:null}directionSettingToWritingMode(t){return""===t?"horizontal-tb":"lr"===t?"vertical-lr":"vertical-rl"}move(t){this.applyStyles({top:this.formatStyle(t.top,"px"),bottom:this.formatStyle(t.bottom,"px"),left:this.formatStyle(t.left,"px"),right:this.formatStyle(t.right,"px"),height:this.formatStyle(t.height,"px"),width:this.formatStyle(t.width,"px")})}}n.CueStyleBox=CueStyleBox;class BoxPosition{constructor(t){var n;let l,d,p,h,f,y;if(t instanceof CueStyleBox&&t.cue?(n=t.cue)&&""!==n.vertical?this.property="width":this.property="height":t instanceof BoxPosition&&(this.property=t.property||"height"),t instanceof CueStyleBox&&t.div){p=t.div.offsetHeight,h=t.div.offsetWidth,f=t.div.offsetTop;const n=t.div.firstChild;if(y=n?n.getBoundingClientRect():t.div.getBoundingClientRect(),l=y&&y[this.property]||null,n&&n.firstChild){const t=n.firstChild;if(t&&"string"==typeof t.textContent){d=l/this.calculateNewLines(t.textContent)}}}else t instanceof BoxPosition&&(y=t);this.left=y.left,this.right=y.right,this.top=y.top||f,this.height=y.height||p,this.bottom=y.bottom||f+(y.height||p),this.width=y.width||h,this.lineHeight=null!==l?l:y.lineHeight,this.singleLineHeight=null!==d?d:y.singleLineHeight,this.singleLineHeight||(this.singleLineHeight=41)}calculateNewLines(t){let n=1;for(let l=0;l<t.length;l++)"\n"===t[l]&&n++;return n}move(t,n){switch(n=void 0!==n?n:this.singleLineHeight,t){case"+x":this.left+=n,this.right+=n;break;case"-x":this.left-=n,this.right-=n;break;case"+y":this.top+=n,this.bottom+=n;break;case"-y":this.top-=n,this.bottom-=n}}overlaps(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top}overlapsAny(t){for(const n of t)if(this.overlaps(n))return!0;return!1}within(t){return this.top>=t.top&&this.bottom<=t.bottom&&this.left>=t.left&&this.right<=t.right}moveIfOutOfBounds(t,n){switch(n){case"+x":this.left<t.left&&(this.left=t.left,this.right=this.left+this.width);break;case"-x":this.right>t.right&&(this.right=t.right,this.left=this.right-this.width);break;case"+y":this.top<t.top&&(this.top=t.top,this.bottom=this.top+this.height);break;case"-y":this.bottom>t.bottom&&(this.bottom=t.bottom,this.top=this.bottom-this.height)}}toCSSCompatValues(t){return{top:this.top-t.top,bottom:t.bottom-this.bottom,left:this.left-t.left,right:t.right-this.right,height:this.height,width:this.width}}static getSimpleBoxPosition(t){let n=null;t instanceof StyleBox&&t.div?n=t.div:t instanceof HTMLElement&&(n=t);let l=n.offsetHeight||0,d=n.offsetWidth||0,p=n.offsetTop||0,h=p+l,f=n.getBoundingClientRect();const{left:y,right:v}=f;return f.top&&(p=f.top),f.height&&(l=f.height),f.width&&(d=f.width),f.bottom&&(h=f.bottom),{left:y,right:v,top:p,height:l,bottom:h,width:d}}static getBoxPosition(t,n){if(t&&t.length>0){let l=0,d=t[0][n];for(let p=0;p<t.length;p++)n in["top","right"]?t[p][n]>d&&(l=p,d=t[p][n]):n in["bottom","left"]&&t[p][n]<d&&(l=p,d=t[p][n]);return t[l]}return null}static moveToMinimumDistancePlacement(t,n,l){"height"===t.property?"+y"===n?(t.top=l.topMostBoxPosition.bottom+0,t.bottom=t.top+t.height):"-y"===n&&(t.bottom=l.bottomMostBoxPosition.top-0,t.top=t.bottom-t.height):"width"===t.property&&("+x"===n?(t.left=l.rightMostBoxPosition.right+0,t.right=t.left+t.width):"-x"===n&&(t.right=l.leftMostBoxPosition.left-0,t.left=t.right-t.width))}static moveBoxToLinePosition(t,n,l){const d=t.cue;let p,h=new BoxPosition(t),f=function(t){if("number"==typeof t.line&&(t.snapToLines||t.line>=0&&t.line<=100))return t.line;if(!t.track||!t.track.textTrackList||!t.track.textTrackList.mediaElement)return-1;let n=0;const l=t.track,d=l.textTrackList;for(let p=0;p<d.length&&d[p]!==l;p++)"showing"===d[p].mode&&n++;return-1*++n}(d),y=[];if(d.snapToLines){let t=0;switch(d.vertical){case"":y=["+y","-y"],p="height";break;case"rl":y=["+x","-x"],p="width";break;case"lr":y=["-x","+x"],p="width"}const l=h.lineHeight,v=n[p]+l,g=y[0];if(f<0){let p=0;switch(d.vertical){case"":p=n.height-l-.05*n.height;break;case"rl":case"lr":p=-n.width+l+.05*n.width}t=p,y=y.reverse()}else{switch(d.vertical){case"":t=l*Math.round(f);break;case"rl":t=n.width-l*Math.round(f);break;case"lr":t=l*Math.round(f)}Math.abs(t)>v&&(t=t<0?-1:1,t*=Math.ceil(v/l)*l)}h.move(g,t)}else{const l=""===d.vertical?n.height:n.width,p=h.lineHeight/l*100;switch(d.lineAlign){case"center":f-=p/2;break;case"end":f-=p}switch(d.vertical){case"":t.applyStyles({top:t.formatStyle(f,"%")});break;case"rl":t.applyStyles({right:t.formatStyle(f,"%")});break;case"lr":t.applyStyles({left:t.formatStyle(f,"%")})}y=["+y","-y","+x","-x"],"+y"===d.axis?y=["+y","-y","+x","-x"]:"-y"===d.axis&&(y=["-y","+y","+x","-x"]),h=new BoxPosition(t)}const v=function(t,d){let p;for(let h=0;h<d.length;h++){t.moveIfOutOfBounds(n,d[h]);let f=0,y=!1;for(;t.overlapsAny(l)&&!(f>9);)y?t.move(d[h]):(l&&l.length>0&&(p||(p={topMostBoxPosition:BoxPosition.getBoxPosition(l,"top"),bottomMostBoxPosition:BoxPosition.getBoxPosition(l,"bottom"),leftMostBoxPosition:BoxPosition.getBoxPosition(l,"left"),rightMostBoxPosition:BoxPosition.getBoxPosition(l,"right")}),BoxPosition.moveToMinimumDistancePlacement(t,d[h],p)),y=!0),f++}return t}(h,y);t.move(v.toCSSCompatValues(n))}}n.BoxPosition=BoxPosition;class WebVTTRenderer{constructor(t,n,l=!0){if(!t)return null;this.window=t,this.overlay=n,this.loggingEnabled=l,this.foregroundStyleOptions={fontFamily:"Helvetica",fontSize:"36px",color:"rgba(255, 255, 255, 1)",textShadow:"",backgroundColor:"rgba(0, 0, 0, 0)"},this.backgroundStyleOptions={backgroundColor:"rgba(0, 0, 0, 0.5)"},this.globalStyleCollection={};const d=t.document.createElement("div");d.style.position="absolute",d.style.left="0",d.style.right="0",d.style.top="0",d.style.bottom="0",d.style.margin="1.5%",this.paddedOverlay=d,n.appendChild(this.paddedOverlay),this.initSubtitleCSS()}initSubtitleCSS(){const t=[new fo.VTTCue(0,0,"String to init CSS - Won't be visible to user")];this.paddedOverlay.style.opacity="0",this.processCues(t),this.processCues([]),this.paddedOverlay.style.opacity="1"}convertCueToDOMTree(t){return t?ho.default.parseContent(this.window,t,this.globalStyleCollection):null}setStyles(t){function applyStyles(t,n,l){for(const d in n)n.hasOwnProperty(d)&&(!0===l&&void 0!==t[d]||!1===l)&&(t[d]=n[d])}for(const n in t){let d=!1,p=null;"::cue"===n?(p=this.foregroundStyleOptions,d=!0):"::-webkit-media-text-track-display"===n&&(p=this.backgroundStyleOptions,d=!0);const h=t[n];if(!0===d)applyStyles(p,h,d);else for(let t=0;t<l.length;t++){const p=l[t].exec(n);if(p&&4===p.length){const t=p[2],n={};applyStyles(n,h,d),this.globalStyleCollection[t]=n}}}this.initSubtitleCSS(),this.loggingEnabled&&(console.log("WebVTTRenderer setStyles foregroundStyleOptions: "+JSON.stringify(this.foregroundStyleOptions)),console.log("WebVTTRenderer setStyles backgroundStyleOptions: "+JSON.stringify(this.backgroundStyleOptions)),console.log("WebVTTRenderer setStyles globalStyleCollection: "+JSON.stringify(this.globalStyleCollection)))}processCues(t){if(!t)return;for(;this.paddedOverlay.firstChild;)this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);if(!function(t){for(let n=0;n<t.length;n++)if(t[n].hasBeenReset||!t[n].displayState)return!0;return!1}(t)){for(let n=0;n<t.length;n++)this.paddedOverlay.appendChild(t[n].displayState);return}const n=[],l=BoxPosition.getSimpleBoxPosition(this.paddedOverlay);t.length>1&&(t=function(t){const n=[];let l=0;for(let d=0;d<t.length;d++){let p=t[d];if("number"!=typeof p.line)return t;l+=p.line,n.push(p)}return l/=t.length,l>50?(n.forEach((function(t){t.axis="-y"})),n.sort((t,n)=>n.line-t.line)):(n.forEach((function(t){t.axis="+y"})),n.sort((t,n)=>t.line-n.line)),n}(t));for(let d=0;d<t.length;d++){let p=t[d],h=new CueStyleBox(this.window,p,this.foregroundStyleOptions,this.backgroundStyleOptions,this.globalStyleCollection);this.paddedOverlay.appendChild(h.div),BoxPosition.moveBoxToLinePosition(h,l,n),p.displayState=h.div,n.push(BoxPosition.getSimpleBoxPosition(h))}}setSize(t,n){t&&(this.overlay.style.width=t+"px"),n&&(this.overlay.style.height=n+"px")}getOverlay(){return this.overlay}}n.default=WebVTTRenderer,n.WebVTTRenderer=WebVTTRenderer}));unwrapExports(go);go.VTTCue,go.StyleBox,go.CueStyleBox,go.BoxPosition,go.WebVTTRenderer;var mo=createCommonjsModule((function(t,n){function __export(t){for(var l in t)n.hasOwnProperty(l)||(n[l]=t[l])}Object.defineProperty(n,"__esModule",{value:!0}),__export(vo),__export(go)}));unwrapExports(mo);var _o=mo.WebVTTRenderer,bo=function(){function TrackManagerStub(){}return Object.defineProperty(TrackManagerStub.prototype,"currentTrack",{get:function(){return{}},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(TrackManagerStub.prototype,"tracks",{get:function(){return[]},enumerable:!0,configurable:!0}),TrackManagerStub.prototype.destroy=function(){},TrackManagerStub.prototype.restoreSelectedTrack=function(){},TrackManagerStub}(),Po=fr.audioTrackAdded,ko=fr.audioTrackChanged,To=fr.forcedTextTrackChanged,So=fr.textTrackAdded,Ao=fr.textTrackChanged,wo=fr.textTrackRemoved,Io=mn.textTracksSwitched,Eo=mn.textTracksUpdated,Ro=function(){function TextTrackManager(t,n,l){this.mediaElement=t,this.dispatcher=n,this.extensionTracks=l,this._tracks=[],this.trackPersistence=new no("mk-text-track",["label","language","kind"]);var d,p,h,f,y=this.trackPersistence.getPersistedTrack();if(this._tracks.push({id:-2,label:"Off",language:"",kind:"subtitles",mode:y&&"Off"===y.label?"showing":"disabled"},{id:-1,label:"Auto",language:"",kind:"subtitles",mode:y&&"Auto"!==y.label?"disabled":"showing"}),this.extensionTracks){Mt.debug("MEDIA_TRACK Initializing text track manager for HLS.js track events");var v=t.parentElement;this.renderer=new _o(window,v,!1),this.renderer.setStyles({"::cue":{fontSize:"calc(1vw + 1em)"}}),this.onExtensionTextTracksAdded=this.onExtensionTextTracksAdded.bind(this),this.onExtensionTextTrackSwitched=this.onExtensionTextTrackSwitched.bind(this),this.onCueChange=this.onCueChange.bind(this);var g=this.extensionTracks;g.addEventListener(Eo,this.onExtensionTextTracksAdded),g.addEventListener(Io,this.onExtensionTextTrackSwitched)}else Mt.debug("MEDIA_TRACK Initializing text track manager for native track events"),this.onTextTrackAdded=this.onTextTrackAdded.bind(this),this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.onTextTrackRemoved=this.onTextTrackRemoved.bind(this),this.onPlayStart=this.onPlayStart.bind(this),t.textTracks.addEventListener("addtrack",this.onTextTrackAdded),t.textTracks.addEventListener("change",this.onTextTrackChanged),t.textTracks.addEventListener("removetrack",this.onTextTrackRemoved),t.addEventListener("playing",this.onPlayStart);this.onAudioTrackAddedOrChanged=(d=this.onAudioTrackAddedOrChanged.bind(this),void 0===p&&(p=250),void 0===h&&(h={isImmediate:!1}),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var l=this,doLater=function(){f=void 0,h.isImmediate||d.apply(l,t)},y=h.isImmediate&&void 0===f;void 0!==f&&clearTimeout(f),f=setTimeout(doLater,p),y&&d.apply(l,t)}),n.subscribe(ko,this.onAudioTrackAddedOrChanged),n.subscribe(Po,this.onAudioTrackAddedOrChanged)}return Object.defineProperty(TextTrackManager.prototype,"currentTrack",{get:function(){return this.tracks.find((function(t){return"showing"===t.mode}))},set:function(t){var n;t&&(this.trackPersistence.setPersistedTrack(t),this.extensionTracks?(Mt.debug("MEDIA_TRACK Setting track on extension "+t.label),"Auto"===t.label?(this.clearCurrentlyPlayingTrack(),void 0===(n=this.extensionTracks.selectForcedTrack())&&this.onExtensionTextTrackSwitched({track:t})):this.extensionTracks.textTrack=t):(Mt.debug("MEDIA_TRACK Setting track on element "+t.label),this._tracks.forEach((function(n){n!==t&&"showing"===n.mode&&(n.mode="disabled")})),t&&(Mt.debug("MEDIA_TRACK setting track mode to showing for "+t.label),"Auto"===t.label?(this._tracks[1].mode="showing",n=this.selectNativeForcedTrack(this.mediaElement.audioTracks)):"Off"===t.label?this._tracks[0].mode="showing":t.mode="showing")),this.dispatcher.publish(fr.forcedTextTrackChanged,n))},enumerable:!0,configurable:!0}),Object.defineProperty(TextTrackManager.prototype,"tracks",{get:function(){return this._tracks},enumerable:!0,configurable:!0}),TextTrackManager.prototype.destroy=function(){if(this.clearCurrentlyPlayingTrack(),this.extensionTracks){var t=this.extensionTracks;t.removeEventListener(Eo,this.onExtensionTextTracksAdded),t.removeEventListener(Io,this.onExtensionTextTrackSwitched)}else this.mediaElement.textTracks.removeEventListener("addtrack",this.onTextTrackAdded),this.mediaElement.textTracks.removeEventListener("change",this.onTextTrackChanged),this.mediaElement.textTracks.removeEventListener("removetrack",this.onTextTrackRemoved),this.mediaElement.removeEventListener("playing",this.onPlayStart);this.dispatcher.unsubscribe(ko,this.onAudioTrackAddedOrChanged),this.dispatcher.unsubscribe(Po,this.onAudioTrackAddedOrChanged)},TextTrackManager.prototype.restoreSelectedTrack=function(){return restoreSelectedTrack(this.trackPersistence,this)},TextTrackManager.prototype.onExtensionTextTracksAdded=function(t){var n;Mt.debug("MEDIA_TRACK Extension text tracks updated "+JSON.stringify(t)),(n=this._tracks).push.apply(n,__spread(t)),this.restoreSelectedTrack(),this.dispatcher.publish(So,t)},TextTrackManager.prototype.onExtensionTextTrackSwitched=function(t){if(Mt.debug("MEDIA_TRACKS Extension text track switched "+t),this.handleVTT(t),this._tracks){this._tracks.forEach((function(n){t.track?t.track.forced&&"Auto"===n.label||"Auto"===t.track.label&&"Auto"===n.label?n.mode="showing":n.mode=t.track.persistentID===n.id?"showing":"disabled":n.mode="Off"===n.label?"showing":"disabled"}))}this.dispatcher.publish(Ao,t)},TextTrackManager.prototype.handleVTT=function(t){var n=t&&t.track&&t.track.id;if(void 0!==n&&n>=0){var l=this.filterSelectableTextTracks(this.mediaElement.textTracks)[n];this.onNativeTrackChange(l)}else this.clearCurrentlyPlayingTrack()},TextTrackManager.prototype.onAudioTrackAddedOrChanged=function(t,n){if(Mt.debug("MEDIA_TRACKS text track manager detects audio track change"),this.shouldForceSubtitle())if(this.extensionTracks){Mt.debug("MEDIA_TRACKS selecting forced text track via extension");var l=this.extensionTracks.selectForcedTrack();l?this.dispatcher.publish(To,l):this.clearCurrentlyPlayingTrack()}else Mt.debug("MEDIA_TRACKS selecting forced text track natively"),this.currentTrack=this._tracks[1]},TextTrackManager.prototype.onTextTrackAdded=function(t){this._tracks.push(t.track),this.dispatcher.publish(So,t)},TextTrackManager.prototype.onPlayStart=function(){this.restoreSelectedTrack()},TextTrackManager.prototype.onTextTrackRemoved=function(t){this.dispatcher.publish(wo,t)},TextTrackManager.prototype.onTextTrackChanged=function(t){var n=this.findNativeSelectedTextTrack(),l=this.trackPersistence.getPersistedTrack();if(l||(l=this._tracks[1]),n&&!trackEquals(n,l,this.trackPersistence.fields))if("Off"===l.label||"Auto"===l.label&&"forced"!==n.kind)this.currentTrack=l;else{var d=this.findNativeTrack(l);d&&(this.currentTrack=d)}else this.dispatcher.publish(Ao,t)},TextTrackManager.prototype.findNativeSelectedTextTrack=function(){for(var t=0;t<this.mediaElement.textTracks.length;t++){var n=this.mediaElement.textTracks[t];if("showing"===n.mode)return n}},TextTrackManager.prototype.findNativeTrack=function(t){for(var n=0;n<this.mediaElement.textTracks.length;n++){var l=this.mediaElement.textTracks[n];if(trackEquals(l,t,this.trackPersistence.fields))return l}},TextTrackManager.prototype.selectNativeForcedTrack=function(t){for(var n=0;n<t.length;n++){var l=t[n];if(l.enabled){var d=this.findNativeForcedTrack(l);return d&&"showing"!==d.mode&&(d.mode="showing"),d}}},TextTrackManager.prototype.findNativeForcedTrack=function(t){for(var n=this.mediaElement.textTracks,l=0;l<n.length;l++){var d=n[l];if("forced"===d.kind&&d.language===t.language)return d}},TextTrackManager.prototype.onNativeTrackChange=function(t){this.clearCurrentlyPlayingTrack(),this._currentlyPlayingTrack=t,t.addEventListener("cuechange",this.onCueChange)},TextTrackManager.prototype.clearCurrentlyPlayingTrack=function(){var t;void 0!==this._currentlyPlayingTrack&&("string"==typeof(t=this._currentlyPlayingTrack).id&&"removeEventListener"in t)&&(this._currentlyPlayingTrack.removeEventListener("cuechange",this.onCueChange),this.renderer.processCues({}),delete this._currentlyPlayingTrack)},TextTrackManager.prototype.onCueChange=function(t){var n=t&&t.target&&t.target.activeCues;n&&this.renderer.processCues(n)},TextTrackManager.prototype.filterSelectableTextTracks=function(t){for(var n=Array(),l=0;l<t.length;l++){var d=t[l];("captions"===d.kind||"subtitles"===d.kind||"metadata"===d.kind&&d.customTextTrackCueRenderer)&&n.push(d)}return n},TextTrackManager.prototype.shouldForceSubtitle=function(){Mt.debug("MEDIA_TRACKS Determining whether to select forced text track");var t=this.trackPersistence.getPersistedTrack();return!t||"Auto"===t.label},TextTrackManager}(),Co={"picture-in-picture":t.PresentationMode.pictureinpicture,inline:t.PresentationMode.inline},Oo={};Oo[t.PresentationMode.pictureinpicture]="picture-in-picture",Oo[t.PresentationMode.inline]="inline";var Mo=fr.presentationModeDidChange,Do=mn.playbackLicenseError,No=t.PlaybackStates.stopped,Lo=function(n){function VideoPlayer(t){var l=n.call(this,t)||this;return l.mediaPlayerType="video",l._textTrackManager=new bo,l._audioTrackManager=new bo,l.userInitiated=!1,l.services=t.services,l.restrictPlatforms=!("restrict-platforms"in mr.features)||mr.features["restrict-platforms"],l.pipEventHandler=l.pipEventHandler.bind(l),l}return __extends(VideoPlayer,n),Object.defineProperty(VideoPlayer.prototype,"audioTracks",{get:function(){return this._audioTrackManager.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(VideoPlayer.prototype,"containerElement",{get:function(){return this._context.videoContainerElement?this._context.videoContainerElement:document.getElementById("apple-music-video-container")},enumerable:!0,configurable:!0}),Object.defineProperty(VideoPlayer.prototype,"currentAudioTrack",{get:function(){return this._audioTrackManager.currentTrack},set:function(t){this._audioTrackManager.currentTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(VideoPlayer.prototype,"currentTextTrack",{get:function(){return this._textTrackManager.currentTrack},set:function(t){this._textTrackManager.currentTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(VideoPlayer.prototype,"_targetElement",{get:function(){return this.video||__assign({},document.createElement("video"))},enumerable:!0,configurable:!0}),Object.defineProperty(VideoPlayer.prototype,"textTracks",{get:function(){return this._textTrackManager.tracks},enumerable:!0,configurable:!0}),VideoPlayer.prototype.initializeExtension=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.restrictPlatforms&&Ot.isAndroid?(Mt.warn("videoPlayer.initializeExtension Not supported on the current platform"),[2]):(this.video||Mt.warn("videoPlayer.initializeExtension No video element, not initializing extension"),[2])}))}))},VideoPlayer.prototype.onPlaybackLicenseError=function(t){this._licenseError(),this._dispatcher.publish(Do,t)},VideoPlayer.prototype.setupTrackManagers=function(t){var n,l,d,p;null===(l=null===(n=this._textTrackManager)||void 0===n?void 0:n.destroy)||void 0===l||l.call(n),this._textTrackManager=new Ro(this._targetElement,this._dispatcher,t),null===(p=null===(d=this._audioTrackManager)||void 0===d?void 0:d.destroy)||void 0===p||p.call(d),this._audioTrackManager=new lo(this._targetElement,this._dispatcher,t)},VideoPlayer.prototype.destroy=function(){this._textTrackManager.destroy(),this._audioTrackManager.destroy(),n.prototype.destroy.call(this)},VideoPlayer.prototype.initializeEventHandlers=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return n.prototype.initializeEventHandlers.call(this),this.hasMediaElement?(this._targetElement.addEventListener("webkitpresentationmodechanged",this.pipEventHandler),this._targetElement.addEventListener("enterpictureinpicture",this.pipEventHandler),this._targetElement.addEventListener("leavepictureinpicture",this.pipEventHandler),[2]):[2]}))}))},VideoPlayer.prototype.removeEventHandlers=function(){if(n.prototype.removeEventHandlers.call(this),this.hasMediaElement){var t=this._targetElement;t.removeEventListener("webkitpresentationmodechanged",this.pipEventHandler),t.removeEventListener("enterpictureinpicture",this.pipEventHandler),t.removeEventListener("leavepictureinpicture",this.pipEventHandler)}},VideoPlayer.prototype.initializeMediaElement=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){return Mt.debug("videoPlayer.initializeMediaElement Initializing media element"),(t=this.containerElement)?(this.video=((l=Nt.pop())?Mt.debug("dom-helpers: retrieving video tag, "+Nt.length+" remain"):(Mt.debug("dom-helpers: no available video tags, creating one"),l=document.createElement("video")),l),this.video.autoplay=!1,this.video.controls=!1,this.video.playsInline=!0,this.video.id="apple-music-video-player",t.appendChild(this.video),[2]):(Mt.warn("videoPlayer.initializeMediaElement No video element; no container defined"),[2]);var l}))}))},VideoPlayer.prototype._stopMediaElement=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,n.prototype._stopMediaElement.call(this)];case 1:return t.sent(),this.destroy(),[2]}}))}))},VideoPlayer.prototype.isPlayerSupported=function(){return Ct.supportsEs6()},VideoPlayer.prototype.pipEventHandler=function(n){switch(n.type){case"enterpictureinpicture":this._dispatcher.publish(Mo,{mode:t.PresentationMode.pictureinpicture});break;case"leavepictureinpicture":this._dispatcher.publish(Mo,{mode:t.PresentationMode.inline});break;case"webkitpresentationmodechanged":var l=this._targetElement;this._dispatcher.publish(Mo,{mode:this._translateStringToPresentationMode(l.webkitPresentationMode)})}},VideoPlayer.prototype.playItemFromEncryptedSource=function(n,l,d){return void 0===l&&(l=!1),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(d){return Mt.debug("videoPlayer.playItemFromEncryptedSource",n,l),this.playbackState===No?(Mt.debug("video-player.playItemFromEncryptedSource aborting playback because player is stopped"),[2]):(n.playbackType=t.PlaybackType.encryptedFull,this.nowPlayingItem=n,n.state=kr.loading,this.userInitiated=l,this.playHlsStream(n.assetURL,n),[2])}))}))},VideoPlayer.prototype.playItemFromUnencryptedSource=function(t,n,l){return __awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){return Mt.debug("videoPlayer.playItemFromUnencryptedSource",t,n),this.playbackState===No?(Mt.debug("videoPlayer.playItemFromUnencryptedSource aborting playback because player is stopped"),[2]):(l=__read(t.split("?"),1),(d=l[0]).endsWith("m3u")||d.endsWith("m3u8")?(this.playHlsStream(t),[2]):[2,this._playAssetURL(t,n)])}))}))},VideoPlayer.prototype.setPresentationMode=function(n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){if((l=this._targetElement).webkitSupportsPresentationMode&&"function"==typeof l.webkitSetPresentationMode)return[2,l.webkitSetPresentationMode(this._translatePresentationModeToString(n))];if(l.requestPictureInPicture&&document.exitPictureInPicture){if(n===t.PresentationMode.pictureinpicture)return[2,l.requestPictureInPicture()];if(n===t.PresentationMode.inline)return[2,document.exitPictureInPicture()]}return[2]}))}))},VideoPlayer.prototype._translateStringToPresentationMode=function(n){var l=Co[n];return void 0===l&&(Mt.warn("videoPlayer._translateStringToPresentationMode "+n+" is not a valid presentation mode, setting to inline"),l=t.PresentationMode.inline),l},VideoPlayer.prototype._translatePresentationModeToString=function(t){var n=Oo[t];return void 0===n&&(Mt.warn("videoPlayer._translatePresentationModeToString "+t+" is not a valid presentation mode, setting to inline"),n="inline"),n},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],VideoPlayer.prototype,"onPlaybackLicenseError",null),VideoPlayer}(io),hasSessionStorage=function(){return"undefined"!=typeof window&&window.sessionStorage};function findMediaKeySystemAccess(t,n){return __awaiter(this,void 0,void 0,(function(){var l,d,p;return __generator(this,(function(h){switch(h.label){case 0:l=0,h.label=1;case 1:if(!(l<t.length))return[3,6];h.label=2;case 2:return h.trys.push([2,4,,5]),d=t[l],[4,navigator.requestMediaKeySystemAccess(d,n)];case 3:return p=h.sent(),[2,[d,p]];case 4:return h.sent(),[3,5];case 5:return l++,[3,1];case 6:return[2,[]]}}))}))}var xo,Uo=yt.NONE,Bo=yt.FAIRPLAY,jo=yt.WIDEVINE,Fo=yt.PLAYREADY;function supportsDrm(){if(!xo)throw new Error("findKeySystemPreference has not been invoked");return xo!==Uo}function potentialKeySystemsForAccess(){return hasSessionStorage()&&"true"===window.sessionStorage.getItem("mk-playready-cbcs-unsupported")?[jo]:mr.features["prefer-playready"]?[Fo,jo]:[jo,Fo]}function findKeySystemPreference(){var t,n;return __awaiter(this,void 0,void 0,(function(){var l,d,p,h;return __generator(this,(function(f){switch(f.label){case 0:return Rt?(xo=Uo,[2,void 0]):(null===(t=window.WebKitMediaKeys)||void 0===t?void 0:t.isTypeSupported(Bo+".1_0",_n.AVC1))?(xo=Bo,[3,4]):[3,1];case 1:return(null===(n=window.MSMediaKeys)||void 0===n?void 0:n.isTypeSupported(Fo,_n.AVC1))?(xo=Fo,[3,4]):[3,2];case 2:return l=Dt,hasMediaKeySupport()&&l.canPlayType('video/mp4;codecs="avc1.42E01E"')&&l.canPlayType('audio/mp4;codecs="mp4a.40.2"')?(d=[{videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}]}],[4,findMediaKeySystemAccess(potentialKeySystemsForAccess(),d)]):[3,4];case 3:p=__read.apply(void 0,[f.sent(),1]),h=p[0],xo=h,f.label=4;case 4:return[2,xo=null!=xo?xo:Uo]}}))}))}function hasMediaKeySupport(){return!!(navigator&&navigator.requestMediaKeySystemAccess&&window.MediaKeys&&window.MediaKeySystemAccess)}function createLicenseChallengeBody(t,n,l,d,p){var h,f=l.challenge||ye(l.licenseChallenge);return(h=n.isUTS?function(t,n){return void 0===n&&(n="start"),{"extra-server-parameters":t.keyServerQueryParameters,"license-action":n}}(n,t):n.isLiveRadioStation?{event:"beats1"}:function(t,n){return void 0===n&&(n=!1),{adamId:t.songId,isLibrary:t.isCloudItem,"user-initiated":n}}(n,p)).challenge=f,h["key-system"]=d,h.uri=l.keyuri,h}var Ko=function(){function License(){}return License.prototype.fetch=function(t){var n=new Headers({Authorization:"Bearer "+vr.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+vr.musicUserToken});return fetch(this.licenseUrl,{method:"POST",body:JSON.stringify(t),headers:n})},License.prototype.reset=function(){this.licenseUrl=void 0,this.mediaItem=void 0,this.data=void 0,this.initiated=void 0,this.keySystem=void 0,this.startResponse=void 0},License.prototype.start=function(t,n,l,d,p){var h;return void 0===p&&(p=!1),__awaiter(this,void 0,void 0,(function(){var f,y,v,g,m,_;return __generator(this,(function(b){switch(b.label){case 0:this.licenseUrl=t,this.mediaItem=n,this.data=l,this.keySystem=d,this.initiated=p,f=l.isRenewalRequest?"renew":"start",y=createLicenseChallengeBody(f,n,l,d,p),this.startResponse=this.fetch(y),b.label=1;case 1:return b.trys.push([1,4,,5]),[4,this.startResponse];case 2:if(!(v=b.sent()).ok)throw new we(we.MEDIA_LICENSE,"Error acquiring license");return[4,v.json()];case 3:if((g=b.sent()).status=null!==(h=g.status)&&void 0!==h?h:g.errorCode,0!==g.status)throw g.message||(g.message=-1004===g.status?we.DEVICE_LIMIT:we.MEDIA_LICENSE),(m=we.serverError(g)).errorCode===we.PLAYREADY_CBC_ENCRYPTION_ERROR&&hasSessionStorage()&&window.sessionStorage.setItem("mk-playready-cbcs-unsupported","true"),m;return[2,g];case 4:throw _=b.sent(),this.startResponse=void 0,_;case 5:return[2]}}))}))},License.prototype.stop=function(){return __awaiter(this,void 0,void 0,(function(){var t,n,l;return __generator(this,(function(d){switch(d.label){case 0:if(!this.startResponse)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.startResponse];case 2:return d.sent(),[3,4];case 3:return d.sent(),[3,4];case 4:if(!this.mediaItem||!this.data)return[2];if(!this.mediaItem.isUTS)return[2];t=createLicenseChallengeBody("stop",this.mediaItem,this.data,this.keySystem,this.initiated),n=this.fetch(t),this.reset(),d.label=5;case 5:return d.trys.push([5,7,,8]),[4,n];case 6:return d.sent(),[3,8];case 7:return l=d.sent(),Mt.warn("license.stop request error",l),[3,8];case 8:return[2]}}))}))},License}();function shouldThrowLicenseError(t,n){var l=t.errorCode===we.PLAYREADY_CBC_ENCRYPTION_ERROR;return n&&!l}var Vo=function(t){function KeySession(){var n=t.call(this,[mn.playbackLicenseError,mn.playbackSessionError])||this;return n.initiated=!0,n.isLibrary=!1,n.keySystem=yt.FAIRPLAY,n._storage=window.sessionStorage,n.boundDispatchKeyError=n.dispatchKeyError.bind(n),n.boundDispatchSessionError=n.dispatchSessionError.bind(n),n.boundHandleSessionCreation=n.handleSessionCreation.bind(n),n.boundStartLicenseSession=n.startLicenseSession.bind(n),n.license=new Ko,n}return __extends(KeySession,t),Object.defineProperty(KeySession.prototype,"extID",{get:function(){if(this.extURI)return this.extURI.replace("data:;base64,","")},enumerable:!0,configurable:!0}),Object.defineProperty(KeySession.prototype,"isFairplay",{get:function(){return this.keySystem===yt.FAIRPLAY},enumerable:!0,configurable:!0}),Object.defineProperty(KeySession.prototype,"isPlayReady",{get:function(){return this.keySystem===yt.PLAYREADY},enumerable:!0,configurable:!0}),Object.defineProperty(KeySession.prototype,"isWidevine",{get:function(){return this.keySystem===yt.WIDEVINE},enumerable:!0,configurable:!0}),KeySession.prototype.acquirePlaybackLicense=function(t,n,l){return void 0===l&&(l=this.initiated),__awaiter(this,void 0,void 0,(function(){var d;return __generator(this,(function(p){switch(p.label){case 0:if(!this.keyServerURL||!this.developerToken||!this.userToken)return[2];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.license.start(this.keyServerURL,this.item,{challenge:n,keyuri:t},this.keySystem,this.initiated)];case 2:return[2,p.sent()];case 3:if(d=p.sent(),shouldThrowLicenseError(d,l))throw d;return this.dispatchEvent(mn.playbackLicenseError,d),[3,4];case 4:return[2]}}))}))},KeySession.prototype.cancelPendingRenewal=function(){this._pendingRenewal&&(clearTimeout(this._pendingRenewal),this._pendingRenewal=void 0)},KeySession.prototype.startLicenseSession=function(t){var n,l=this;Mt.debug("Starting License Session",t);var d=t.message,p=t.target;if(this.isPlayReady){var h=String.fromCharCode.apply(null,new Uint16Array(d.buffer||d)),f=(new DOMParser).parseFromString(h,"application/xml");n=f.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue}else n=ye(new Uint8Array(d));return this.acquirePlaybackLicense(p.extURI||this.extURI,n).then((function(t){l._handleLicenseJson(t,p,n)}))},KeySession.prototype.setKeyURLs=function(t){this.keyCertURL=t[this.isFairplay?"hls-key-cert-url":"widevine-cert-url"],this.keyServerURL=t["hls-key-server-url"]},KeySession.prototype.dispatchKeyError=function(t){console.error(we.MEDIA_KEY+" error in dispatchKeyError:",t),this.dispatchEvent(mn.playbackSessionError,new we(we.MEDIA_KEY,t))},KeySession.prototype.dispatchSessionError=function(t){this.dispatchEvent(mn.playbackSessionError,new we(we.MEDIA_SESSION,t))},KeySession.prototype.loadCertificateBuffer=function(){return __awaiter(this,void 0,void 0,(function(){var t,n,l,d,p,h,f,y,v,g,m,_,b;return __generator(this,(function(P){switch(P.label){case 0:if(!this.keyCertURL)return[2,Promise.reject(new we(we.MEDIA_SESSION,"No certificate URL"))];if((t=document.createElement("a")).href=this.keyCertURL,n=Date.now(),l=(""+t.hostname+t.pathname).replace(/[^a-z0-9.]/gi,"."),d=this._storage.getItem(l),p=parseInt(this._storage.getItem("com.ai.mk.vmcc.exp")||"",10),d&&p&&p>n){for(h=new Uint8Array(d.length),f=d.length;f--;)h[f]=d.charCodeAt(f);return[2,h.buffer]}return[4,fetch(this.keyCertURL+"?t="+Date.now())];case 1:return y=P.sent(),v=y.headers.get("cache-control"),g=86400,v&&At.test(v)&&(m=v.match(At))&&m[1]&&(g=parseInt(m[1],10)),[4,y.arrayBuffer()];case 2:return _=P.sent(),b=String.fromCharCode.apply(String,new Uint8Array(_)),/^\<\?xml/.test(b)?[2,Promise.reject(new we(we.MEDIA_CERTIFICATE,"Invalid certificate."))]:(this._storage.setItem(l,b),this._storage.setItem("com.ai.mk.vmcc.exp",(n+1e3*g).toString()),[2,_])}}))}))},KeySession.prototype.handleSessionCreation=function(t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(l){return[2,this.createSession(t).catch((function(t){n.dispatchSessionError(t)}))]}))}))},KeySession.prototype._handleLicenseJson=function(t,n,l){if(Mt.debug("handleLicenseResponse",t),null==t?void 0:t.license){var d=pe(t.license);return n.update(d)}},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],KeySession.prototype,"startLicenseSession",null),KeySession}(ge),$o=function(t){function EncryptedSession(){return null!==t&&t.apply(this,arguments)||this}return __extends(EncryptedSession,t),EncryptedSession.prototype.attachMedia=function(t,n){var l=this;return this.keySystem=n.keySystem,t.addEventListener("encrypted",this.boundHandleSessionCreation,!1),n.createMediaKeys().then((function(n){t.setMediaKeys(n)})).catch((function(t){return l.dispatchKeyError(t)}))},EncryptedSession.prototype.detachMedia=function(t){t.removeEventListener("encrypted",this.boundHandleSessionCreation)},EncryptedSession.prototype.createSession=function(t){var n=this;Mt.debug("Encrypted createSession",t);var l=t.initData,d=t.initDataType,p=t.target;return this._mediaKeysServerCertificate?this._createSession(p,l,d):this.loadCertificateBuffer().then((function(t){return p.mediaKeys.setServerCertificate(t).then((function(){return n._mediaKeysServerCertificate=t,n._createSession(p,l,d)}))}))},EncryptedSession.prototype.generatePSSH=function(t){for(var n=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),l=pe(t),d=0;d<l.length;d++)n[n.length-16+d]=l[d];return Mt.debug("generatePSSH",n),n},EncryptedSession.prototype._createSession=function(t,n,l){var d,p,h=t.mediaKeys.createSession();this._teardownCurrentSession(),Mt.debug("creating media key session",h);var f=this.isWidevine&&!(null===(d=this.item)||void 0===d?void 0:d.isLiveRadioStation);if(null===(p=this.item)||void 0===p?void 0:p.isLiveRadioStation){var y=new Uint8Array(n).slice(0,56),v=ye(y);Mt.debug("extracted uri",v),h.extURI=v}var g=f?this.generatePSSH(this.extID):n;return h.addEventListener("message",this.startLicenseSession),this._currentSession=h,h.generateRequest(l,g)},EncryptedSession.prototype._teardownCurrentSession=function(){this._currentSession&&(Mt.debug("tearing down media key session",this._currentSession),this._currentSession.removeEventListener("message",this.startLicenseSession),this._currentSession=void 0)},EncryptedSession}(Vo),Ho=/^(?:.*)(skd:\/\/.+)$/i,zo=function(t){function WebKitSession(){return null!==t&&t.apply(this,arguments)||this}return __extends(WebKitSession,t),WebKitSession.prototype.attachMedia=function(t,n){return this.target=t,t.addEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),t.addEventListener("webkitkeyerror",this.boundDispatchKeyError),t},WebKitSession.prototype.detachMedia=function(t){t&&(t.removeEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),t.removeEventListener("webkitkeyerror",this.boundDispatchKeyError))},WebKitSession.prototype.destroy=function(){Mt.debug("FPS destroy"),this.detachMedia(this.target),this.session&&(this.session.removeEventListener("webkitkeyerror",this.boundDispatchKeyError),this.session.removeEventListener("webkitkeymessage",this.boundStartLicenseSession))},WebKitSession.prototype.createSession=function(t){var n=this;Mt.debug("FPS createSession",t);var l=t.initData,d=t.target,p=this._extractAssetId(l);if(Mt.debug("extURI",p),!d.webkitKeys){var h=new window.WebKitMediaKeys(this.keySystem);d.webkitSetMediaKeys(h)}return this.loadCertificateBuffer().then((function(t){var h=n._concatInitDataIdAndCertificate(l,p,t),f="VIDEO"===d.tagName?_n.AVC1:_n.MP4,y=d.webkitKeys.createSession(f,h);n.session=y,y.extURI=p,y.addEventListener("webkitkeyerror",n.boundDispatchKeyError),y.addEventListener("webkitkeymessage",n.boundStartLicenseSession)}))},WebKitSession.prototype._extractAssetId=function(t){var n=String.fromCharCode.apply(null,new Uint16Array(t.buffer||t)),l=n.match(Ho);return l&&l.length>=2&&(n=l[1]),Mt.debug("Extracted assetId from EXT-X-KEY URI",n),n},WebKitSession.prototype._concatInitDataIdAndCertificate=function(t,n,l){"string"==typeof n&&(n=fe(n)),l=new Uint8Array(l);var d=0,p=new ArrayBuffer(t.byteLength+4+n.byteLength+4+l.byteLength),h=new DataView(p);new Uint8Array(p,d,t.byteLength).set(t),d+=t.byteLength,h.setUint32(d,n.byteLength,!0),d+=4;var f=new Uint8Array(p,d,n.byteLength);return f.set(n),d+=f.byteLength,h.setUint32(d,l.byteLength,!0),d+=4,new Uint8Array(p,d,l.byteLength).set(l),new Uint8Array(p,0,p.byteLength)},WebKitSession}(Vo),Wo=function(t){function MSSession(){return null!==t&&t.apply(this,arguments)||this}return __extends(MSSession,t),MSSession.prototype.attachMedia=function(t,n){return this.keySystem=n.keySystem,t.addEventListener("msneedkey",this.boundHandleSessionCreation,!1),t.addEventListener("mskeyerror",this.boundDispatchKeyError),t},MSSession.prototype.detachMedia=function(t){t.removeEventListener("msneedkey",this.boundHandleSessionCreation,!1),t.removeEventListener("mskeyerror",this.boundDispatchKeyError)},MSSession.prototype.createSession=function(t){var n=t.initData,l=t.target;if(!l.msKeys){var d=new MSMediaKeys(this.keySystem);l.msSetMediaKeys(d)}var p=l.msKeys.createSession(_n.MP4,n);return p.addEventListener("mskeyerror",this.dispatchKeyError),p.addEventListener("mskeymessage",this.startLicenseSession.bind(this)),p},MSSession}(Vo);var Yo=function(t){function MediaExtension(n,l){var d=t.call(this,[mn.playbackLicenseError,mn.playbackSessionError])||this;return d.audio=n,d.contentType=l,Ot.isIE||Ot.isSafari&&Ot.engineMajorVersion,d}return __extends(MediaExtension,t),Object.defineProperty(MediaExtension.prototype,"hasMediaKeySupport",{get:function(){return hasMediaKeySupport()},enumerable:!0,configurable:!0}),Object.defineProperty(MediaExtension.prototype,"hasMediaSession",{get:function(){return void 0!==this._session},enumerable:!0,configurable:!0}),Object.defineProperty(MediaExtension.prototype,"isFairplay",{get:function(){return this._session.isFairplay},enumerable:!0,configurable:!0}),Object.defineProperty(MediaExtension.prototype,"extURI",{set:function(t){this._session.extURI=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaExtension.prototype,"initiated",{set:function(t){this._session.initiated=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaExtension.prototype,"session",{get:function(){return this._session},enumerable:!0,configurable:!0}),MediaExtension.prototype.cancelPendingRenewal=function(){var t;null===(t=this._session)||void 0===t||t.cancelPendingRenewal()},MediaExtension.prototype.initializeKeySystem=function(){return __awaiter(this,void 0,void 0,(function(){var t,n=this;return __generator(this,(function(l){switch(l.label){case 0:return[4,this._attachSession()];case 1:return l.sent(),(t=this._session)?([mn.playbackLicenseError,mn.playbackSessionError].forEach((function(l){t.addEventListener(l,(function(t){n.dispatchEvent(l,t)}))})),[2]):[2]}}))}))},MediaExtension.prototype._attachSession=function(){var t,n,l;return __awaiter(this,void 0,void 0,(function(){var d,p,h,f,y,v;return __generator(this,(function(g){switch(g.label){case 0:return p=(d=this).audio,h=d.contentType,(null===(t=window.WebKitMediaKeys)||void 0===t?void 0:t.isTypeSupported(yt.FAIRPLAY+".1_0",_n.MP4))?(this._session=new zo,this._session.attachMedia(p,{keySystem:yt.FAIRPLAY}),[3,4]):[3,1];case 1:return(null===(n=window.MSMediaKeys)||void 0===n?void 0:n.isTypeSupported(yt.PLAYREADY,_n.MP4))?(this._session=new Wo,this._session.attachMedia(p,{keySystem:yt.PLAYREADY}),[3,4]):[3,2];case 2:return this.hasMediaKeySupport&&p.canPlayType(h)?(this._session=new $o,f=[{initDataTypes:["cenc","keyids"],audioCapabilities:[{contentType:h}],distinctiveIdentifier:"optional",persistentState:"required"}],[4,findMediaKeySystemAccess(potentialKeySystemsForAccess(),f)]):[3,4];case 3:y=__read.apply(void 0,[g.sent(),2]),(v=y[1])?null===(l=this._session)||void 0===l||l.attachMedia(p,v):Mt.warn("media-extension: No keysystem detected!"),g.label=4;case 4:return[2]}}))}))},MediaExtension.prototype.setMediaItem=function(t){!function(t,n){n.keyURLs&&(t.developerToken=vr.developerToken,t.userToken=vr.musicUserToken,t.item=n,t.adamId=n.songId,t.isLibrary=n.isCloudItem,t.setKeyURLs(n.keyURLs))}(this._session,t)},MediaExtension.prototype.destroy=function(t){this._session&&this._session.detachMedia(t)},MediaExtension}(ge),qo=function(){function ByteRangeSegment(t){var n=t.url,l=t.startByte,d=t.length;this.url=n,this.startByte=parseInt(l,10),this.length=parseInt(d,10),this.endByte=this.startByte+this.length-1,this.range="bytes="+this.startByte+"-"+this.endByte}return ByteRangeSegment.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var t,n,l,d,p;return __generator(this,(function(h){switch(h.label){case 0:return n=(t=this).url,l=t.range,n?((d=new Headers).append("Range",l),[4,fetch(n,{headers:d})]):[2,new Uint8Array];case 1:return[4,h.sent().arrayBuffer()];case 2:return p=h.sent(),[2,new Uint8Array(p)]}}))}))},ByteRangeSegment}(),Go=function(){function ContinuousSegment(t){this.url=t}return ContinuousSegment.prototype.load=function(){return __awaiter(this,void 0,void 0,(function(){var t,n;return __generator(this,(function(l){switch(l.label){case 0:return(t=this.url)?(Mt.debug("radio-segment: loading",t),[4,fetch(t)]):[2,new Uint8Array];case 1:return[4,l.sent().arrayBuffer()];case 2:return n=l.sent(),[2,new Uint8Array(n)]}}))}))},ContinuousSegment}(),Qo=/^#EXT-X-BYTERANGE:([^\n]+)\n/gim,Jo=/^#EXT-X-MAP:([^\n]+)\n/im,Xo=/#EXTINF:\d*\.\d*\,[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim;var Zo=function(){function SegmentList(){this._segments=[],this._addedSegments={}}return Object.defineProperty(SegmentList.prototype,"segments",{get:function(){return this._segments},enumerable:!0,configurable:!0}),SegmentList.prototype.addSegment=function(t,n){this._addedSegments[n]||(Mt.debug("Adding segment",n),this._segments.push(t),this._addedSegments[n]=!0)},SegmentList.prototype.extractLiveRadioSegments=function(t,n){if(!t||!Xo.test(t))return this;var l;for(Xo.lastIndex=0;l=Xo.exec(t);){var d,p=rewriteLastUrlPath(n,d=l[0].startsWith("#EXT-X-MAP")?l[2]:l[1]);this.addSegment(new Go(p),d)}},SegmentList.prototype.extractByteRangeSegments=function(t,n){var l,d,p=this;if(t&&Qo.test(t)){var h=function(t){if(t&&Jo.test(t))return __read(t.match(Jo),2)[1].split(",").reduce((function(t,n){var l=__read(n.split("="),2),d=l[0],p=l[1];return t[d.toLowerCase()]=p.replace(/\"/gi,""),t}),{})}(t),f=null!==(l=n.split("/").pop())&&void 0!==l?l:"",y=n.replace(f,h.uri),v=__read(h.byterange.split("@"),2),g=v[0],m=v[1],_=new qo({url:y,startByte:m,length:g});this.addSegment(_,_.range),(null!==(d=t.match(Qo))&&void 0!==d?d:[]).forEach((function(t){var n=__read(t.match(/^#EXT-X-BYTERANGE:(\d+)@(\d+)\n/),3),l=n[1],d=n[2],h=new qo({url:y,startByte:d,length:l});p.addSegment(h,h.range)}))}},SegmentList}(),ea=/^#EXT-X-TARGETDURATION:(\d+)/im,ta=/^#EXT-X-KEY:[^\n]+URI="([^"]+)"/im;function loadManifestData(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,fetch(t)];case 1:return[2,n.sent().text()]}}))}))}var ra=function(t){function Manifest(n,l){var d=t.call(this,[mn.manifestParsed])||this;if(d._downlink=0,d._segmentList=new Zo,d._data=n,d._item=l,d._url=l.assetURL,xo!==yt.FAIRPLAY)if(l.isLiveRadioStation){d._segmentList.extractLiveRadioSegments(n,l.assetURL);var p=__read(d._data.match(ea),2),h=(p[0],p[1]);Mt.debug("manifest: setting up manifest refresh interval at "+h+" seconds");var f=1e3*parseInt(h,10);d._manifestRefreshInterval=setInterval(d.liveRadioRefresh,f)}else d._segmentList.extractByteRangeSegments(n,l.assetURL);return d}return __extends(Manifest,t),Manifest.load=function(t,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,(function(){var l,d,p,h,f;return __generator(this,(function(y){switch(y.label){case 0:return l=t.assetURL,(p=!!window.sessionStorage&&n)&&(d=window.sessionStorage.getItem(l))?[2,new this(d,t)]:(h=(new Date).getTime(),[4,loadManifestData(l)]);case 1:return d=y.sent(),(f=new this(d,t)).downlink=function(t,n){return 8*n.length/(((new Date).getTime()-t)/1e3)/1024}(h,d),p&&window.sessionStorage.setItem(l,d),[2,Promise.resolve(f)]}}))}))},Object.defineProperty(Manifest.prototype,"downlink",{get:function(){return this._downlink},set:function(t){this._downlink=t},enumerable:!0,configurable:!0}),Object.defineProperty(Manifest.prototype,"mediaItem",{get:function(){return this._item},enumerable:!0,configurable:!0}),Manifest.prototype.liveRadioRefresh=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,loadManifestData(this._url)];case 1:return t=n.sent(),this._data=t,this._segmentList.extractLiveRadioSegments(t,this._url),this.dispatchEvent(mn.manifestParsed),[2]}}))}))},Object.defineProperty(Manifest.prototype,"segments",{get:function(){return this._segmentList.segments},enumerable:!0,configurable:!0}),Object.defineProperty(Manifest.prototype,"extURI",{get:function(){if(!this._extURI){var t=this._data.match(ta);Mt.debug("manifest: EXT_X_KEY_URI matches",t),this._extURI=t&&t[1]||void 0}return this._extURI},enumerable:!0,configurable:!0}),Manifest.prototype.stop=function(){this._manifestRefreshInterval&&clearInterval(this._manifestRefreshInterval)},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],Manifest.prototype,"liveRadioRefresh",null),Manifest}(ge),ia=isNodeEnvironment()?require("util").TextDecoder:self.TextDecoder;function encodedArrayToString(t,n){return void 0===n&&(n="utf-8"),"iso-8859-1"===n?String.fromCharCode.apply(String,__spread$1(t)):new ia(n).decode(t)}function readNullTerminatedString(t,n,l){void 0===n&&(n=0);var d=[];l=null!=l?l:t.length;for(var p=n;p<l;p++){var h=t[p];if("\0"===String.fromCharCode(h))break;d.push(String.fromCharCode(h))}return[d.join(""),d.length]}function isBitAtPositionOn(t,n){return 0!=(t&1<<n)}function readSynchSafeUint32(t){return 2097152*(127&t[0])+16384*(127&t[1])+128*(127&t[2])+(127&t[3])}var na={0:"iso-8859-1",1:"utf-16",2:"utf-16be",3:"utf-8"},oa={TPE1:!0,TIT2:!0,WXXX:!0,PRIV:!0,TALB:!0,CHAP:!0},aa=function(){function ID3(t){this.frames=[],this.unsynchronized=!1,this.hasExtendedHeader=!1,this.hasFooter=!1,this.isExperimental=!1;var n=0,l=de(t.subarray(n,n+3));if(n+=3,"ID3"===l){this.minor=t[n++],this.revision=t[n++];var d=t[n++];this._parseID3Flags(d);var p=readSynchSafeUint32(t.subarray(n,n+4));n+=4,this.frameLength=p;var h=n+p;if(this.endPos=h,this.hasExtendedHeader)n+=readSynchSafeUint32(t.subarray(n,n+4));this.minor>2&&this._parseID3Frames(this,t,n,h)}}return ID3.prototype._parseID3Flags=function(t){this.unsynchronized=isBitAtPositionOn(t,7),this.hasExtendedHeader=isBitAtPositionOn(t,6),this.isExperimental=isBitAtPositionOn(t,5),this.hasFooter=isBitAtPositionOn(t,4)},ID3.prototype._parseID3Frames=function(t,n,l,d){for(var p=new DataView(n.buffer,0,d),h=this.minor;l+8<=d;){var f=de(n.subarray(l,l+4));l+=4;var y=4===h?readSynchSafeUint32(n.subarray(l,l+4)):p.getUint32(l);l+=4;n[l++],n[l++];if(oa[f]){var v=l,g=this._extractID3FramePayload(n,f,y,v,d);if(g){var m=this.decodeID3Frame(g);m&&t.frames.push(m)}l+=y}else l+=y}},ID3.prototype._extractID3FramePayload=function(t,n,l,d,p){var h,f=d+l;return f<=p&&(h={type:n,size:l,data:t.slice(d,f)}),h},ID3.prototype.decodeID3Frame=function(t){if("TXXX"!==t.type)return"WXXX"===t.type?this.decodeWxxxFrame(t):"PRIV"===t.type?this.decodePrivFrame(t):"CHAP"===t.type?this.decodeChapFrame(t):"T"===t.type[0]?this.decodeTextFrame(t):{key:t.type,data:t.data}},ID3.prototype.decodeChapFrame=function(t){var n=t.data,l=new DataView(n.buffer),d={key:"CHAP",frames:[]},p=__read$1(readNullTerminatedString(n,0,n.length),2),h=p[0],f=p[1];return d.id=h,f++,d.startTime=l.getUint32(f),f+=4,d.endTime=l.getUint32(f),f+=4,f+=4,f+=4,this._parseID3Frames(d,n,f,n.length),d},ID3.prototype.decodeTextFrame=function(t){var n=t.data,l=na[n[0]],d=encodedArrayToString(n.subarray(1),l);return{key:t.type,data:d}},ID3.prototype.decodeWxxxFrame=function(t){var n=t.data,l=na[n[0]],d=1,p=encodedArrayToString(n.subarray(d),l);return d+=p.length+1,{key:"WXXX",description:p,data:encodedArrayToString(n.subarray(d))}},ID3.prototype.decodePrivFrame=function(t){var n=encodedArrayToString(t.data);if(n)return{key:"PRIV",info:n,data:t.data.slice(n.length+1)}},ID3}();function checkBoxName(t,n,l){return!(n+4>t.length)&&(t[n]===l[0]&&t[n+1]===l[1]&&t[n+2]===l[2]&&t[n+3]===l[3])}function findEmsgs(t){var n=t.length,l=[];if(function(t){return(null==t?void 0:t.length)>=8&&checkBoxName(t,4,[102,116,121,112])}(t))return l;for(var d=0;d<n;d++){if(checkBoxName(t,d,[109,111,111,102]))return l;if(checkBoxName(t,d,[101,109,115,103])){var p=d-4,h=new DataView(t.buffer,p).getUint32(0),f=t.subarray(p,p+h);d=d+h-1,l.push(f)}}return l}var sa=function(){function Emsg(t){this.data=t;var n=new DataView(t.buffer),l=8;if(1===t[l]){l+=4,this.timeScale=n.getUint32(l),l+=4;var d=n.getUint32(l);l+=4;var p=n.getUint32(l);if(l+=4,this.presentationTime=Math.pow(2,32)*d+p,!Number.isSafeInteger(this.presentationTime))throw this.presentationTime=Number.MAX_SAFE_INTEGER,new Error("Failed to create 64 bit integer");this.eventDuration=n.getUint32(l),l+=4,this.id=n.getUint32(l);var h=__read$1(readNullTerminatedString(t,l+=4),2),f=h[0];l+=h[1]+1,this.schemeIdUri=f;var y=__read$1(readNullTerminatedString(t,l),2);y[0];l+=y[1]+1,this.payload=t.subarray(l,t.byteLength),this.id3=new aa(this.payload)}}return Object.defineProperty(Emsg.prototype,"length",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),Object.defineProperty(Emsg.prototype,"elementPresentationTime",{get:function(){var t=this.presentationTime,n=this.timeScale;return t&&n?Math.round(t/n):NaN},enumerable:!0,configurable:!0}),Emsg}();var ua,ca=function(){function TimedMetadataManager(t,n){this._currentTime=t,this._onDidChange=n,this._emsgLookup={},this._getCurrentEmsg=this._getCurrentEmsg.bind(this)}return TimedMetadataManager.prototype.processEmsgs=function(t){var n=this,l=findEmsgs(t);l.length&&(this._currentEmsgInterval||(this._currentEmsgInterval=setInterval(this._getCurrentEmsg,1e3)),l.forEach((function(t){var l=new sa(t);n._emsgLookup[l.elementPresentationTime]=l})))},TimedMetadataManager.prototype.stop=function(){var t=this._currentEmsgInterval;t&&clearInterval(t)},TimedMetadataManager.prototype._getCurrentEmsg=function(){for(var t=this._currentTime,n=this._emsgLookup,l=Math.round(t()),d=[],p=Object.keys(n),h=0;h<p.length;h++){var f=parseInt(p[h],10);if(!(f<l))break;d.push(f)}var y=d.pop();if(y){var v=n[y];if(!v)return;var g=this._currentEmsg,m=this._onDidChange,_=null==g?void 0:g.payload,b=v.payload;_&&function(t,n){return!!t&&!!n&&t.length===n.length&&t.every((function(t,l){return t===n[l]}))}(_,b)||(this._currentEmsg=v,m(v)),this._cleanupEmsgs(y)}},TimedMetadataManager.prototype._cleanupEmsgs=function(t){var n=this._emsgLookup;Object.keys(n).forEach((function(l){parseInt(l,10)<t&&delete n[l]}))},TimedMetadataManager}(),la=function(){function Buffer(t){var n=this,l=t.dispatcher,d=t.element,p=t.mediaSource,h=t.manifest,f=t.currentTime,y=t.duration;this._currentBufferIndex=0,this.isBufferActionRunning=!1,this.isLiveRadioStation=!1,this.timeToTrim=10,this.hasLiveRadioStarted=!1,this.dispatcher=l,this.element=d,this.mediaSource=p,Mt.trace("mediasource",p),this.sourceBuffer=p.addSourceBuffer('audio/mp4;codecs="mp4a.40.2"'),this.timedMetadataManager=new ca((function(){return d.currentTime}),(function(t){n.dispatcher.publish(fr.timedMetadataDidChange,t)})),this.isLiveRadioStation=h.mediaItem.isLiveRadioStation,Mt.trace("sourcebuffer",this.sourceBuffer),this.manifest=h,this.manifest.addEventListener(mn.manifestParsed,(function(){n.currentBufferIndex=n.currentBufferIndex})),this._currentTime=f||0,this.duration=y,this.updateEndHandler=this.dequeueBufferAction.bind(this),this.bufferActionsQueue=[],this.sourceBuffer.addEventListener("updateend",this.updateEndHandler),this.addSegment(0)}return Object.defineProperty(Buffer.prototype,"currentTime",{get:function(){return this._currentTime},set:function(t){if(this._currentTime!==t){this._currentTime=t;var n=this.isOverBufferLimit,l=this.timeToTrim,d=t>this.timeToTrim;n&&d&&(this.removeToTime(l),this.addSegment(this.currentBufferIndex+1),this.timeToTrim+=10)}},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"segments",{get:function(){return this.manifest.segments||[]},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"currentBufferIndex",{get:function(){return this._currentBufferIndex},set:function(t){var n=this.segments,l=this.mediaSource,d=this.manifest;n.length&&t!==n.length-1?this.addSegment(t+1):d.mediaItem.isLiveRadioStation||this.addBufferAction(l.endOfStream.bind(l)),this._currentBufferIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"isBufferUpdating",{get:function(){return this.isBufferActionRunning||this.sourceBuffer.updating},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"startBufferedTime",{get:function(){return 0===this.sourceBuffer.buffered.length?0:this.sourceBuffer.buffered.start(0)},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"endBufferedTime",{get:function(){return 0===this.sourceBuffer.buffered.length?0:this.sourceBuffer.buffered.end(0)},enumerable:!0,configurable:!0}),Buffer.prototype.waitForSeekToLoad=function(t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(l){return[2,new Promise((function(l){n.addBufferAction(n._checkSeekFinished(t,l))}))]}))}))},Buffer.prototype._checkSeekFinished=function(t,n){var l=this;return function(){if(t>l.startBufferedTime&&t<l.endBufferedTime)return n();l.addBufferAction(l._checkSeekFinished(t,n))}},Buffer.prototype.seek=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d,p,h,f,y;return __generator(this,(function(v){switch(v.label){case 0:return l=(n=this).startBufferedTime,d=n.endBufferedTime,p=n.duration,h=n.segments,l<=t&&d>=t?[2]:t>p?[2]:(this.removeToTime(d),this.timeToTrim=10*Math.floor(t/10),f=t/p<.05?t/p:t/p-.05,y=Math.floor(h.length*f),this.addSegment(y),[4,this.waitForSeekToLoad(t)]);case 1:return v.sent(),[2]}}))}))},Buffer.prototype.stop=function(){var t=this.mediaSource;this.timedMetadataManager.stop();try{this.bufferActionsQueue.length=0,this.addBufferAction(t.endOfStream.bind(t))}catch(e){}},Buffer.prototype.remove=function(){this.sourceBuffer.removeEventListener("updateend",this.updateEndHandler);try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){return}},Buffer.prototype.dequeueBufferAction=function(){return __awaiter(this,void 0,void 0,(function(){var t,n;return __generator(this,(function(l){switch(l.label){case 0:return t=this.bufferActionsQueue,this.isBufferUpdating?[2]:(n=t.shift())?(this.isBufferActionRunning=!0,[4,n()]):[3,2];case 1:if(l.sent(),this.isLiveRadioStation&&this.kickstartLiveRadio(),this.isBufferActionRunning=!1,!this.isBufferUpdating)return[2,this.dequeueBufferAction()];l.label=2;case 2:return[2]}}))}))},Buffer.prototype.kickstartLiveRadio=function(){var t=this.hasLiveRadioStarted,n=this.element,l=n.buffered;!t&&l.length&&(n.currentTime=l.start(0),this.hasLiveRadioStarted=!0)},Buffer.prototype.addBufferAction=function(t){this.bufferActionsQueue.push(t),this.isBufferUpdating||asAsync(this.dequeueBufferAction())},Buffer.prototype.addSegment=function(t){var n=this;this.addBufferAction((function(){return __awaiter(n,void 0,void 0,(function(){var n,l,d,p;return __generator(this,(function(h){switch(h.label){case 0:if(n=this.segments,!(l=n[t]))return[2];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,l.load()];case 2:if(d=h.sent(),this.isLiveRadioStation)try{this.timedMetadataManager.processEmsgs(d)}catch(e){Mt.error("Error processing live radio segment for timed metadata",e)}try{this.sourceBuffer.appendBuffer(d),this.currentBufferIndex=t,this.isOverBufferLimit=!1}catch(f){"QuotaExceededError"===f.name?this.isOverBufferLimit=!0:Mt.warn("Error appending to source buffer",f)}return[3,4];case 3:return p=h.sent(),Mt.error("Error loading segment",p),[3,4];case 4:return[2]}}))}))}))},Buffer.prototype.removeToTime=function(t){var n=this;this.addBufferAction((function(){return t&&n.sourceBuffer.remove(0,t),new Promise((function(t){return t()}))}))},Buffer}(),da=fr.mediaPlaybackError,pa=function(n){function AudioPlayer(t){var l=n.call(this,t)||this;return l.currentAudioTrack=void 0,l.currentTextTrack=void 0,l.textTracks=[],l.audioTracks=[],l.mediaPlayerType="audio",l}return __extends(AudioPlayer,n),Object.defineProperty(AudioPlayer.prototype,"_targetElement",{get:function(){return this.audio},enumerable:!0,configurable:!0}),AudioPlayer.prototype.initializeExtension=function(){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(n){switch(n.label){case 0:return this.extension=new Yo(this.audio,'audio/mp4;codecs="mp4a.40.2"'),[4,this.extension.initializeKeySystem()];case 1:return n.sent(),this.extension.addEventListener(mn.playbackLicenseError,(function(n){t._licenseError(),t._dispatcher.publish(da,n)})),this.extension.addEventListener(mn.playbackSessionError,(function(n){t._dispatcher.publish(da,new we(we.MEDIA_SESSION,n))})),[2]}}))}))},AudioPlayer.prototype.initializeMediaElement=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){return(t=function(){var t=Lt.pop();return t?Mt.debug("dom-helpers: retrieving audio tag, "+Lt.length+" remain"):(Mt.debug("dom-helpers: no available audio tags, creating one"),t=document.createElement("audio")),t}()).autoplay=!1,t.id="apple-music-player",t.controls=!1,t.muted=!1,t.playbackRate=1,t.preload="metadata",t.volume=1,this.audio=t,document.body.appendChild(t),Mt.debug("initializedMediaElement",t),[2]}))}))},AudioPlayer.prototype.isPlayerSupported=function(){return!0},AudioPlayer.prototype._stopMediaElement=function(){var t,l;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(d){switch(d.label){case 0:return[4,n.prototype._stopMediaElement.call(this)];case 1:return d.sent(),null===(t=this.manifest)||void 0===t||t.stop(),null===(l=this._buffer)||void 0===l||l.stop(),[2]}}))}))},AudioPlayer.prototype.playItemFromEncryptedSource=function(n,l,d){return void 0===l&&(l=!1),__awaiter(this,void 0,void 0,(function(){var p,h,f,y,v=this;return __generator(this,(function(g){switch(g.label){case 0:return p=this._paused&&!l,n.playRawAssetURL?(n.playbackType=t.PlaybackType.unencryptedFull,this.nowPlayingItem=n,[2,this._playAssetURL(n.assetURL,p)]):(this.extension.initiated=l,this.extension.setMediaItem(n),n.playbackType=t.PlaybackType.encryptedFull,this.nowPlayingItem=n,n.state=kr.loading,[4,ra.load(n,!1)]);case 1:return h=g.sent(),this.manifest=h,n.isLiveRadioStation||(this.extension.extURI=h.extURI),n.state=kr.ready,this.extension.isFairplay?(f=n.assetURL,(null==d?void 0:d.startTime)&&(f+="#t="+d.startTime),[2,this._playAssetURL(f,p)]):[3,2];case 2:return this._buffer&&this._buffer.remove(),y=new MediaSource,[4,this._playAssetURL(window.window.URL.createObjectURL(y),!0)];case 3:g.sent(),y.addEventListener("sourceopen",(function(l){if(window.window.URL.revokeObjectURL(v._targetElement.src),0===y.activeSourceBuffers.length&&(v._buffer=new la({dispatcher:v._dispatcher,element:v._targetElement,duration:n.playbackDuration/1e3,mediaSource:y,manifest:h}),!p&&v.playbackState!==t.PlaybackStates.paused)){var f=Promise.resolve();return(null==d?void 0:d.startTime)&&v._buffer&&(f=v.seekToTime(d.startTime)),f.then((function(){return v._playMedia()}))}})),g.label=4;case 4:return[2]}}))}))},AudioPlayer.prototype.setPresentationMode=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,Promise.resolve()]}))}))},AudioPlayer}(io),ha=function(t){function MediaExtensionStub(n){var l=t.call(this,n)||this;return l.audioTracks=[],l.textTracks=[],l.extURI="",l.hasMediaKeySupport=!0,l.initiated=!0,l.isFairplay=!0,l.hasMediaKeySupport=!0,l.hasMediaSession=!0,l}return __extends(MediaExtensionStub,t),MediaExtensionStub.prototype.cancelPendingRenewal=function(){},MediaExtensionStub.prototype.destroy=function(t){},MediaExtensionStub.prototype.setMediaItem=function(t){},MediaExtensionStub.prototype.initializeKeySystem=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.session=new $o,[2]}))}))},MediaExtensionStub}(ge),fa=function(){function PlayerStub(n){this.bitrate=t.PlaybackBitrate.STANDARD,this.audioTracks=[],this.currentBufferedProgress=0,this.currentPlaybackDuration=0,this.currentPlaybackProgress=0,this.currentPlaybackTime=0,this.currentPlaybackTimeRemaining=0,this.formattedCurrentPlaybackDuration={hours:0,minutes:0},this.isPlaying=!1,this.isPrimaryPlayer=!0,this.isReady=!1,this.paused=!1,this.playbackRate=NaN,this.playbackState=t.PlaybackStates.none,this.playbackTargetAvailable=!1,this.playbackTargetIsWireless=!1,this.previewOnly=!1,this.textTracks=[],this.extension=new ha([]),this.hasAuthorization=!0,this.isDestroyed=!1,this._volume=1,this._dispatcher=n.services.dispatcher,this.windowHandlers=new Dn(this)}return Object.defineProperty(PlayerStub.prototype,"hasMediaElement",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerStub.prototype,"isEngagedInPlayback",{get:function(){return!this.paused},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerStub.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this._dispatcher.publish(fr.playbackVolumeDidChange,new Event("volumeChange"))},enumerable:!0,configurable:!0}),PlayerStub.prototype.destroy=function(){},PlayerStub.prototype.dispatch=function(){},PlayerStub.prototype.exitFullscreen=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.initialize=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.isPaused=function(){return this.paused},PlayerStub.prototype.mute=function(){},PlayerStub.prototype.newSeeker=function(){return new Rn(this)},PlayerStub.prototype.pause=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.playItemFromEncryptedSource=function(t,n,l){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.playItemFromUnencryptedSource=function(t,n,l){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.preload=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.prepareToPlay=function(t,n,l){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.seekToTime=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.requestFullscreen=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.setPresentationMode=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.showPlaybackTargetPicker=function(){},PlayerStub.prototype.stop=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.stopMediaAndCleanup=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2]}))}))},PlayerStub.prototype.supportsPictureInPicture=function(){return!1},PlayerStub.prototype.tsidChanged=function(){},PlayerStub}(),ya=function(){function MediaSessionManager(t,n){this.capabilities=t,this.dispatcher=n,this.session=navigator.mediaSession,this.session&&(this.dispatcher.subscribe(fr.nowPlayingItemDidChange,this.onNowPlayingItemDidChange),this.dispatcher.subscribe(fr.capabilitiesChanged,this.onCapabilitiesChanged),this._setMediaSessionHandlers())}return MediaSessionManager.prototype.onCapabilitiesChanged=function(){this._resetHandlers(),this._setMediaSessionHandlers()},MediaSessionManager.prototype.onNowPlayingItemDidChange=function(t,n){var l=n.item;this._setMediaSessionMetadata(l)},MediaSessionManager.prototype._setMediaSessionMetadata=function(t){var n,l;this.session&&"MediaMetadata"in window&&t&&(this.session.metadata=new window.MediaMetadata({title:t.title,artist:null!==(n=t.artistName)&&void 0!==n?n:null===(l=t.attributes)||void 0===l?void 0:l.showTitle,album:t.albumName,artwork:t.artwork?[96,128,192,256,384,512].map((function(n){return{src:formatArtworkURL(t.artwork,n,n),sizes:n+"x"+n,type:"image/jpeg"}})):[]}))},MediaSessionManager.prototype._setMediaSessionHandlers=function(){var t=this;this.session&&(this._resetHandlers(),this.session.setActionHandler("play",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.play()})),this.capabilities.canPause?this.session.setActionHandler("pause",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.pause()})):this.session.setActionHandler("pause",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.stop()})),this.capabilities.canSeek&&(this.session.setActionHandler("seekforward",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.seekForward()})),this.session.setActionHandler("seekbackward",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.seekBackward()}))),this.capabilities.canSkipToNextItem&&this.session.setActionHandler("nexttrack",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.skipToNextItem()})),this.capabilities.canSkipToPreviousItem&&this.session.setActionHandler("previoustrack",(function(){var n;return null===(n=t.controller)||void 0===n?void 0:n.skipToPreviousItem()})))},MediaSessionManager.prototype._resetHandlers=function(){this.session&&(this.session.setActionHandler("play",void 0),this.session.setActionHandler("pause",void 0),this.session.setActionHandler("seekforward",void 0),this.session.setActionHandler("seekbackward",void 0),this.session.setActionHandler("nexttrack",void 0),this.session.setActionHandler("previoustrack",void 0))},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],MediaSessionManager.prototype,"onCapabilitiesChanged",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],MediaSessionManager.prototype,"onNowPlayingItemDidChange",null),MediaSessionManager}();!function(t){t[t.PAUSE=0]="PAUSE",t[t.EDIT_QUEUE=1]="EDIT_QUEUE",t[t.SEEK=2]="SEEK",t[t.REPEAT=3]="REPEAT",t[t.SHUFFLE=4]="SHUFFLE",t[t.SKIP_NEXT=5]="SKIP_NEXT",t[t.SKIP_PREVIOUS=6]="SKIP_PREVIOUS",t[t.SKIP_TO_ITEM=7]="SKIP_TO_ITEM"}(ua||(ua={}));var va=function(){function Capabilities(t){this._dispatcher=t,this._checkCapability=function(t){return!1},this._mediaSession=new ya(this,t)}return Object.defineProperty(Capabilities.prototype,"controller",{set:function(t){this._mediaSession.controller=t},enumerable:!0,configurable:!0}),Capabilities.prototype.updateChecker=function(t){this._checkCapability!==t&&(this._checkCapability=t,this._dispatcher.publish(fr.capabilitiesChanged))},Object.defineProperty(Capabilities.prototype,"canEditPlaybackQueue",{get:function(){return this._checkCapability(ua.EDIT_QUEUE)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canPause",{get:function(){return this._checkCapability(ua.PAUSE)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSeek",{get:function(){return this._checkCapability(ua.SEEK)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSetRepeatMode",{get:function(){return this._checkCapability(ua.REPEAT)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSetShuffleMode",{get:function(){return this._checkCapability(ua.SHUFFLE)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSkipToNextItem",{get:function(){return this._checkCapability(ua.SKIP_NEXT)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSkipToMediaItem",{get:function(){return this._checkCapability(ua.SKIP_TO_ITEM)},enumerable:!0,configurable:!0}),Object.defineProperty(Capabilities.prototype,"canSkipToPreviousItem",{get:function(){return this._checkCapability(ua.SKIP_PREVIOUS)},enumerable:!0,configurable:!0}),Capabilities}(),isArrayOf=function(t,n){return Array.isArray(t)&&(0===t.length||n(t[0]))},loadLiveRadioAssets=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){var d,p,h,f,y,v,g,m,_,b,P,k;return __generator(this,(function(T){switch(T.label){case 0:return d=new Headers({Authorization:"Bearer "+n,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+l}),p=__assign(__assign({},t.playParams),{keyFormat:"web"}),h=urlEncodeParameters(p),f=mr.urls.mediaApi+"/play/assets?"+h,[4,fetch(f,{method:"GET",headers:d})];case 1:if(500!==(y=T.sent()).status)return[3,2];throw(m=new we(we.SERVER_ERROR)).data=t,m;case 2:if(403!==y.status)return[3,7];v=void 0,T.label=3;case 3:return T.trys.push([3,5,,6]),[4,y.json()];case 4:return v=T.sent(),v=null===(P=null==v?void 0:v.errors)||void 0===P?void 0:P[0],[3,6];case 5:return T.sent(),[3,6];case 6:throw g="40303"===(null==v?void 0:v.code)?we.SUBSCRIPTION_ERROR:we.ACCESS_DENIED,(m=new we(g,null!==(k=null==v?void 0:v.title)&&void 0!==k?k:null==v?void 0:v.detail)).data=t,m;case 7:if(!y.ok)throw(m=new we(we.CONTENT_UNAVAILABLE)).data=t,m;T.label=8;case 8:return[4,y.json()];case 9:return _=T.sent(),b=_.results.assets[0],Mt.debug("media-item: loaded data from "+f+": "+JSON.stringify(b)),[2,b]}}))}))},prepareMediaAPIItem=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(d){switch(d.label){case 0:return t.isLiveRadioStation?[4,prepareLiveRadioForEncryptedPlayback(t,n,l)]:[3,2];case 1:return d.sent(),[3,4];case 2:return[4,prepareItemWithMZPlay(t,n,l)];case 3:d.sent(),d.label=4;case 4:return[2]}}))}))},prepareLiveRadioForEncryptedPlayback=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){var d,p,h,f,y,v,g,m,_;return __generator(this,(function(b){switch(b.label){case 0:if(!mr.features["playready-live-radio"]&&xo===yt.PLAYREADY&&"video"!==t.attributes.mediaKind&&!mr.features["mse-live-radio"])throw new we(we.CONTENT_UNSUPPORTED,"LIVE_RADIO");return[4,loadLiveRadioAssets(t,n,l)];case 1:d=b.sent(),t.updateWithLoadedKeys({"hls-key-cert-url":d.fairPlayKeyCertificateUrl,"hls-key-server-url":d.keyServerUrl,"widevine-cert-url":d.widevineKeyCertificateUrl}),filterUnavailableLiveRadioUrls(d,t),b.label=2;case 2:return b.trys.push([2,4,,5]),[4,fetch(d.url)];case 3:return p=b.sent(),[3,5];case 4:throw b.sent(),makeContentUnavailableError(t);case 5:return[4,p.text()];case 6:for(h=b.sent(),f=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+),CODECS="(.*)"\s*\n(.*$)/gim;y=f.exec(h);)v=__read(y,4),v[0],g=v[1],m=v[2],_=v[3],/^http(s)?:\/\//.test(_)||(_=rewriteLastUrlPath(d.url,_)),t.assets.push({bandwidth:Number(g),codec:m,URL:_});return[2]}}))}))},filterUnavailableLiveRadioUrls=function(t,n){if(!new URL(t.url).host.endsWith(".apple.com"))throw makeContentUnavailableError(n)},makeContentUnavailableError=function(t){var n=new we(we.CONTENT_UNAVAILABLE);return n.data=t,n},prepareItemWithMZPlay=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){var d,p,h,f,y,v,g,m,_;return __generator(this,(function(b){switch(b.label){case 0:return Mt.debug("mk: loadWithMZPlay",t.playParams),"podcast-episodes"===t.type?(t.assetURL=t.attributes.assetUrl,[2]):[4,hasMusicSubscription()];case 1:return b.sent()?(d=t.playParams.id,p=new Headers({Authorization:"Bearer "+n,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+l}),h={salableAdamId:d},t.isCloudItem&&(h={},t.playParams.purchasedId&&(h.purchaseAdamId=t.playParams.purchasedId),t.playParams.catalogId&&(h.subscriptionAdamId=t.playParams.catalogId),(f=/^a\.(\d+)$/).test(d)?h.subscriptionAdamId=d.replace(f,"$1"):ae(d)&&(h.universalLibraryId=d)),[4,fetch(mr.urls.webPlayback,{method:"POST",body:JSON.stringify(h),headers:p})]):[2];case 2:return[4,b.sent().text()];case 3:return y=b.sent(),(v=JSON.parse(y))&&v.songList?(m=__read(v.songList,1),_=m[0],t.updateFromSongList(_),[2]):(g=we.serverError(v),t.updateFromLoadError(g),Mt.debug("mk: prepareItemWithMZPlay - rejecting with error",g),[2,Promise.reject(g)])}}))}))};function isStringNotEmpty(t){return!function(t){return void 0===t||""===t.trim()}(t)}var ga;function transform$1(t){return transform({"attributes.albumName":"metadata.playlistName","attributes.artistName":"metadata.artistName","attributes.artwork":function(){var n=get(t,"artworkURL");if(n)return function(t){var n=t.split("/").pop(),l=__read$1(!!n&&n.match(/\d+/g)||["100","100"],2),d=l[0],p=l[1];return{width:parseInt(d,10),height:parseInt(p,10),url:t.replace(d+"x"+p,"{w}x{h}")}}(n)},"attributes.composerName":"metadata.composerName","attributes.contentRating":function(){if(1===get(t,"metadata.explicit"))return"explicit"},"attributes.discNumber":function(){return get(t,"metadata.discNumber")||1},"attributes.durationInMillis":"metadata.duration","attributes.genreNames":function(){return[get(t,"metadata.genre")]},"attributes.isrc":function(){var n=get(t,"metadata.xid");if(n)return n.replace(/^([^:]+):isrc:/,"$1")},"attributes.name":"metadata.itemName","attributes.playParams.id":"metadata.itemId","attributes.playParams.kind":"metadata.kind","attributes.previews":function(){return[{url:get(t,"previewURL")}]},"attributes.releaseDate":"metadata.releaseDate","attributes.trackNumber":"metadata.trackNumber",assetURL:"URL",albumId:function(){return""+get(t,"metadata.playlistId")},artistId:function(){return""+get(t,"metadata.artistId")},cloudId:"metadata.cloud-id",id:function(){return""+get(t,"metadata.itemId")},flavor:"flavor",type:"metadata.kind"},t)}var ma,_a=new at("dev-mk-debug");!function(t){t[t.none=0]="none",t[t.loading=1]="loading",t[t.ready=2]="ready",t[t.playing=3]="playing",t[t.ended=4]="ended",t[t.unavailable=5]="unavailable",t[t.restricted=6]="restricted",t[t.error=7]="error",t[t.unsupported=8]="unsupported"}(ma||(ma={}));var ba=ma.none,Pa=ma.loading,ka=ma.ready,Ta=ma.playing,Sa=ma.ended,Aa=ma.unavailable,wa=ma.restricted,Ia=ma.error,Ea=ma.unsupported,Ra=((ga={})[ba]={allowed:[Pa],unknown:[Sa,Aa,wa,Ia,Ea]},ga[Pa]={allowed:[ka,wa,Ia,Ea],unknown:[]},ga[ka]={allowed:[Ta],unknown:[Ia]},ga[Ta]={allowed:[Sa,Ia],unknown:[Aa,wa,Ea]},ga[Sa]={allowed:[],unknown:[]},ga[Aa]={allowed:[],unknown:[]},ga[wa]={allowed:[],unknown:[]},ga[Ia]={allowed:[],unknown:[]},ga[Ea]={allowed:[],unknown:[]},ga),toName=function(t){return ma[t]},createMediaItemStateGuard=function(t){void 0===t&&(t=ba);var n={current:t,set:function(t){var l=n.current;if(!function(t,n){return Ra[t].allowed.includes(n)}(l,t)){var d=function(t,n){return Ra[t].unknown.includes(n)}(l,t);_a.debug("MediaItem.state was changed from "+toName(l)+" to "+toName(t),d?"but it is unknown whether it should be allowed or not.":"and it should not be happening")}n.current=t}};return n},Ca=fr.mediaItemStateDidChange,Oa=fr.mediaItemStateWillChange,Ma=function(n){function MediaItem(l){void 0===l&&(l={});var d=n.call(this,[Ca,Oa])||this;d.bingeWatching=!1,d.hlsMetadata={},d.playbackType=t.PlaybackType.none,d._assets=[],d._state=createMediaItemStateGuard(),Mt.debug("mk: creating Media Item with options:",l);return l.id&&l.attributes?(Object.assign(d,l),d.type=d.playParams&&d.playParams.kind?d.playParams.kind:d.type||"song"):(d.id=l.id||generateUUID(),d.type=l.type||"song",d.attributes={playParams:{id:d.id,kind:d.type}}),d._context=l.context||{},l.container?d._container=l.container:l.containerId&&l.containerType&&(d._container={id:l.containerId,type:l.containerType}),d}return __extends(MediaItem,n),Object.defineProperty(MediaItem.prototype,"albumInfo",{get:function(){var t=this.albumName,n=this.artistName,l=[];return n&&l.push(n),t&&l.push(t),l.join(" - ")},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"albumName",{get:function(){return this.attributes.albumName},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"artistName",{get:function(){return this.attributes.genreNames&&this.attributes.genreNames.indexOf("Classical")>-1&&this.attributes.composerName?this.attributes.composerName:this.attributes.artistName},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"artwork",{get:function(){var t,n;return null!==(t=this.attributes.artwork)&&void 0!==t?t:null===(n=this.attributes.images)||void 0===n?void 0:n.coverArt16X9},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"artworkURL",{get:function(){if(this.artwork&&this.artwork.url)return this.artwork.url},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"canPlay",{get:function(){return this.isPlayable&&this.isReady},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"contentRating",{get:function(){return this.attributes.contentRating},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"context",{get:function(){return this._context},set:function(t){this._context=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"discNumber",{get:function(){return this.attributes.discNumber},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"hasContainerArtwork",{get:function(){return this.container&&this.container.attributes&&this.container.attributes.artwork&&this.container.attributes.artwork.url},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"hasPlaylistContainer",{get:function(){return this.container&&"playlists"===this.container.type&&this.container.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isLiveRadioStation",{get:function(){return isLiveRadioStation(this)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"info",{get:function(){return this.title+" - "+this.albumInfo},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isCloudItem",{get:function(){return this.playParams&&this.playParams.isLibrary||ae(this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isCloudUpload",{get:function(){return-1===this._songId},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isExplicitItem",{get:function(){return"explicit"===this.contentRating},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isLoading",{get:function(){return this.state===kr.loading},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isPlayableMediaType",{get:function(){return-1!==mr.supportedMediaTypes.indexOf(this.type)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isPlayable",{get:function(){return!!this.isLiveRadioStation||!!this.isPlayableMediaType&&(this.needsPlayParams?!!this.playParams:this.isUTS?this.attributes.isEntitledToPlay:!!this.attributes.assetUrl)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isPlaying",{get:function(){return this.state===kr.playing},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isPreparedToPlay",{get:function(){if("song"===this.type)return!!this._assets&&!!this.keyURLs&&!!this._songId;if(this.isUTS){var t=isStringNotEmpty(this.assetURL),n=!!(this.keyURLs&&isStringNotEmpty(this.keyURLs["hls-key-cert-url"])&&isStringNotEmpty(this.keyURLs["hls-key-server-url"])&&isStringNotEmpty(this.keyURLs["widevine-cert-url"]));return t&&n}return!!isStringNotEmpty(this.assetURL)||this.playRawAssetURL&&!!isStringNotEmpty(this.attributes.assetUrl)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isrc",{get:function(){return this.attributes.isrc},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isReady",{get:function(){return this.state===kr.ready},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isRestricted",{get:function(){return this.state===kr.restricted},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isUTS",{get:function(){return["Episode","Movie","MusicMovie","Show","Vod"].includes(this.type)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"isUnavailable",{get:function(){return this.state===kr.unavailable},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"needsPlayParams",{get:function(){return["musicVideo","song"].includes(this.type)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"normalizedType",{get:function(){return t=this.type,(n=le[t])||(n=t.replace(/_|[A-Z]/g,(function(t,n){return"_"===t?"-":(t=t.toLowerCase(),0===n?t:"-"+t)})),t.endsWith("y")?n=n.substring(0,n.length-1)+"ies":n.endsWith("s")||(n+="s"),le[t]=n,n);var t,n},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playbackData",{set:function(t){if(void 0!==t){this.previewURL&&(t.previewURL=this.previewURL);var n=transform$1(t);this.artwork&&n.artwork&&delete n.artwork,n.id!==this.id&&delete n.id,this.playParams&&n.attributes.playParams&&(n.attributes.playParams=this.playParams),Object.assign(this,n),Mt.debug("media-item: item merged with playbackData",this),this.state=kr.ready}},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playbackDuration",{get:function(){return this.attributes.durationInMillis||this.attributes.durationInMilliseconds},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playlistArtworkURL",{get:function(){return this.hasPlaylistContainer&&this.hasContainerArtwork?get(this,"container.attributes.artwork.url"):this.artworkURL},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playlistName",{get:function(){return this.hasPlaylistContainer?get(this,"container.attributes.name"):this.albumName},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playParams",{get:function(){return this.attributes.playParams},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"playRawAssetURL",{get:function(){return!(!this.isCloudUpload&&!mr.unencryptedPlaybackTypes[this.type])},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"previewURL",{get:function(){return get(this,"attributes.previews.0.url")||get(this,"attributes.trailers.0.assets.hlsUrl")||get(this,"attributes.movieClips.0.hlsUrl")},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"rating",{get:function(){return this.attributes.rating},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"releaseDate",{get:function(){if(this._releaseDate)return this._releaseDate;if(this.attributes&&(this.attributes.releaseDate||this.attributes.releaseDateTime)){var t=this.attributes.releaseDate||this.attributes.releaseDateTime;return this._releaseDate=/^\d{4}-\d{1,2}-\d{1,2}/.test(t)?new Date(t):void 0,this._releaseDate}},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"songId",{get:function(){return this._songId&&-1!==this._songId?this._songId:this.id},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"state",{get:function(){return this._state.current},set:function(t){var n={oldState:this._state.current,state:t};this._stateWillChange&&this._stateWillChange(this),this.dispatchEvent(Oa,n),this._state.set(t),this._stateDidChange&&this._stateDidChange(this),this.dispatchEvent(Ca,n)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"title",{get:function(){return this.attributes.name||this.attributes.title},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItem.prototype,"trackNumber",{get:function(){return this.attributes.trackNumber},enumerable:!0,configurable:!0}),MediaItem.prototype.beginMonitoringStateDidChange=function(t){this._stateDidChange=t},MediaItem.prototype.beginMonitoringStateWillChange=function(t){this._stateWillChange=t},MediaItem.prototype.endMonitoringStateDidChange=function(){this._stateDidChange=void 0},MediaItem.prototype.endMonitoringStateWillChange=function(){this._stateWillChange=void 0},MediaItem.prototype.isEqual=function(t){return this.id===t.id&&this.type===t.type&&this.attributes===t.attributes},MediaItem.prototype.prepareToPlay=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:return n=t.store,l=n.developerToken,d=n.userToken,void 0===l||void 0===d?[2,Promise.reject(new we(we.AUTHORIZATION_ERROR,"Unable to prepare media item for play."))]:this.isPreparedToPlay?(Mt.warn("media-item: item is prepared to play"),[2]):(Mt.debug("media-item: item.prepareToPlay playParams",this.playParams),this.state=kr.loading,this.isUTS?[4,(h=this,f=t.utsAPI,__awaiter(void 0,void 0,void 0,(function(){var t,n,l,d,p,y,v,g;return __generator(this,(function(m){switch(m.label){case 0:return[4,f.viewProductPersonalized({id:h.id,reload:!0})];case 1:return t=m.sent(),h.playables=null!==(v=null==t?void 0:t.playables)&&void 0!==v?v:null===(g=null==t?void 0:t.currentEpisode)||void 0===g?void 0:g.playables,h.channels=null==t?void 0:t.channels,hasPlayables(h)?(void 0!==(n=getDefaultPlayable(h))&&(h.ageGatePolicy=n.ageGatePolicy,h.playEvent=n.playEvent),0===(l=h.playables.reduce((function(t,n){return void 0!==n.assets&&t.push(n.assets),t}),[])).length?[2]:(d=__read(l,1),p=d[0],y=p.hlsUrl,mr.features.xtrick&&(y=addQueryParamsToURL(y,{xtrick:!0})),mr.features.isWeb&&(y=addQueryParamsToURL(y,{webbrowser:!0})),h.bingeWatching&&(y=addQueryParamsToURL(y,{bingeWatching:!0}),h.bingeWatching=!1),h.updateWithLoadedAssets(l,y),h.updateWithLoadedKeys({"hls-key-cert-url":p.fpsCertificateUrl,"hls-key-server-url":p.fpsKeyServerUrl,"widevine-cert-url":p.wideVineCertificateUrl},p.fpsKeyServerQueryParameters),[4,fetchHLSMetadata(h)])):[2];case 2:return m.sent(),h.state=kr.ready,[2]}}))})))]:[3,2]);case 1:return p.sent(),[3,4];case 2:return[4,prepareMediaAPIItem(this,l,d)];case 3:p.sent(),p.label=4;case 4:return[2]}var h,f}))}))},MediaItem.prototype.resetState=function(){this.endMonitoringStateWillChange(),this.endMonitoringStateDidChange(),this.state=kr.none},MediaItem.prototype.restrict=function(){this.isExplicitItem&&(this.state=kr.restricted,this._removePlayableData())},MediaItem.prototype.notSupported=function(){this.state=kr.unsupported,this._removePlayableData()},MediaItem.prototype.updateFromLoadError=function(t){switch(t.errorCode){case we.CONTENT_RESTRICTED:this.state=kr.restricted;break;case we.CONTENT_UNAVAILABLE:this.state=kr.unavailable;break;default:this.state=kr.error}},MediaItem.prototype.updateFromSongList=function(t){"musicVideo"===this.type?this.updateWithLoadedAssets(void 0,t["hls-playlist-url"]):this.updateWithLoadedAssets(t.assets),this._songId=t.songId,this.updateWithLoadedKeys({"hls-key-cert-url":t["hls-key-cert-url"],"hls-key-server-url":t["hls-key-server-url"],"widevine-cert-url":t["widevine-cert-url"]})},MediaItem.prototype.updateWithLoadedKeys=function(t,n){this.keyURLs=t,n&&(this.keyServerQueryParameters=n)},MediaItem.prototype.updateWithLoadedAssets=function(t,n){t&&(this._assets=t),n&&(this.assetURL=n)},MediaItem.prototype._removePlayableData=function(){var t,n,l;null===(t=this.attributes)||void 0===t||delete t.playParams,null===(n=this.attributes)||void 0===n||delete n.previews,null===(l=this.attributes)||void 0===l||delete l.trailers},MediaItem}(ge);var Da={condition:function(){return!0},toOptions:function(t,n,l){return[__assign(__assign({},t),{context:l})]}},Na={condition:function(t){var n;return"stations"===t.type&&(null===(n=t.attributes)||void 0===n?void 0:n.isLive)},toOptions:function(t,n,l){return[__assign(__assign({},t),{context:l,container:{attributes:t.attributes,id:t.id,type:t.type,name:null==l?void 0:l.featureName}})]}},hasRelationship=function(t){return function(n){var l,d;return!!(null===(d=null===(l=n.relationships)||void 0===l?void 0:l[t])||void 0===d?void 0:d.data)}},typeIs=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(n){var l=n.type;return t.includes(l)}},withBagPrefix=function(t){if(void 0!==t&&""!==t){var n=mr.prefix;return n?n+":"+t:t}},getContainerName$1=function(t,n){var l,d;return null!==(d=null!=n?n:null===(l=null==t?void 0:t.container)||void 0===l?void 0:l.name)&&void 0!==d?d:Ie.SONG},La={toOptions:function(t,n,l){var d=__assign(__assign({id:t.id},n),{name:withBagPrefix(getContainerName$1(t,null==l?void 0:l.featureName))});return[{relationships:t.relationships,attributes:t.attributes,id:t.id,type:t.type,container:d,context:l}]},condition:typeIs("songs","library-songs","music-videos")},parseAssets=function(t){var n=t.type,l=t.attributes.assetTokens;return n.includes("udio")?function(t){if(void 0!==t)return t[__read(Object.keys(t),1)[0]]}(l):function(t){if(void 0!==t){var n=Object.keys(t);return t[n[n.length-1]]}}(l)},xa={condition:typeIs("uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo"),toOptions:function(t,n,l){var d,p,h=__assign(__assign({},t),{context:l,attributes:__assign(__assign({},t.attributes),{assetUrl:parseAssets(t),playParams:null!==(p=null===(d=null==t?void 0:t.attributes)||void 0===d?void 0:d.playParams)&&void 0!==p?p:{id:t.id,kind:t.type}})});return void 0!==n&&(h.container=n),void 0!==(null==l?void 0:l.featureName)&&(h.container=__assign(__assign({},h.container),{name:null==l?void 0:l.featureName})),[h]}},Ua={toOptions:function(t,n,l){return t.relationships.episodes.data.map((function(t){return __assign(__assign({},t),{context:l})}))},condition:hasRelationship("episodes")},Ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var l in n)n.hasOwnProperty(l)&&(t[l]=n[l])};function __extends$4(t,n){function __(){this.constructor=t}Ba(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}var ja=Object.assign||function(t){for(var n,l=1,d=arguments.length;l<d;l++)for(var p in n=arguments[l])Object.prototype.hasOwnProperty.call(n,p)&&(t[p]=n[p]);return t};function __decorate$2(t,n,l,d){var p,h=arguments.length,f=h<3?n:null===d?d=Object.getOwnPropertyDescriptor(n,l):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(t,n,l,d);else for(var y=t.length-1;y>=0;y--)(p=t[y])&&(f=(h<3?p(f):h>3?p(n,l,f):p(n,l))||f);return h>3&&f&&Object.defineProperty(n,l,f),f}function __metadata$2(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function __awaiter$4(t,n,l,d){return new(l||(l=Promise))((function(p,h){function fulfilled(t){try{step(d.next(t))}catch(e){h(e)}}function rejected(t){try{step(d.throw(t))}catch(e){h(e)}}function step(t){t.done?p(t.value):new l((function(n){n(t.value)})).then(fulfilled,rejected)}step((d=d.apply(t,n||[])).next())}))}function __generator$4(t,n){var l,d,p,h,f={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(h){return function(y){return function(h){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(p=d[2&h[0]?"return":h[0]?"throw":"next"])&&!(p=p.call(d,h[1])).done)return p;switch(d=0,p&&(h=[0,p.value]),h[0]){case 0:case 1:p=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,d=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(p=f.trys,(p=p.length>0&&p[p.length-1])||6!==h[0]&&2!==h[0])){f=0;continue}if(3===h[0]&&(!p||h[1]>p[0]&&h[1]<p[3])){f.label=h[1];break}if(6===h[0]&&f.label<p[1]){f.label=p[1],p=h;break}if(p&&f.label<p[2]){f.label=p[2],f.ops.push(h);break}p[2]&&f.ops.pop(),f.trys.pop();continue}h=n.call(t,f)}catch(e){h=[6,e],d=0}finally{l=p=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,y])}}}function __read$4(t,n){var l="function"==typeof Symbol&&t[Symbol.iterator];if(!l)return t;var d,p,h=l.call(t),f=[];try{for(;(void 0===n||n-- >0)&&!(d=h.next()).done;)f.push(d.value)}catch(error){p={error:error}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(p)throw p.error}}return f}function __spread$4(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(__read$4(arguments[n]));return t}function formatRatingsContentType(t,n){return ae(n)&&se(n)?t.replace(/^library-/,""):ae(n)&&!/^library-/.test(t)?"library-"+t:t}function normalizeAdamId(t){return t.replace(/^a\./,"")}function makeRequest(t,n,l,d){return void 0===d&&(d={}),__awaiter$4(this,void 0,void 0,(function(){var p,h,f,y,v,g,m,_,b,P,k,T,S,A,w;return __generator$4(this,(function(I){switch(I.label){case 0:h=n,f=l&&l.ids,d=Object.assign({},d),y=d.shouldCacheResults,v=void 0===y||y,g=d.returnRawJSONApiRecords,m=void 0!==g&&g,_=d.includePagination,b=void 0===_?t.defaultIncludePaginationMetadata:_,P=d.includeResponseMeta,k=void 0!==P&&P,delete d.shouldCacheResults,delete d.returnRawJSONApiRecords,delete d.includePagination,delete d.includeResponseMeta,"string"==typeof f&&(h=n+"/"+encodeURIComponent(f),l&&delete l.ids),I.label=1;case 1:return I.trys.push([1,3,,4]),(b||k)&&(d.useRawResponse=!0),[4,t.request(h,l,d)];case 2:return p=I.sent(),[3,4];case 3:return"status"in(T=I.sent())?404===T.status?[2,Promise.reject(new we(we.CONTENT_UNAVAILABLE,"The requested content is not available."))]:[2,Promise.reject(we.responseError(T))]:[2,Promise.reject(we.internalError(T))];case 4:try{if(S=p.results||p.data||p,"object"==typeof p&&"results"in p&&"meta"in p&&(S.meta=p.meta),0===S.length)return[2,Promise.reject(new we(we.CONTENT_UNAVAILABLE,"The requested content is not available."))];if(A=m?S:t.parseResultData(v,S),!b&&!k)return[2,A];if("results"in p){for(w in p.results)"meta"!==w&&(A[w]=paginateResultSet(p.results[w],A[w],t,l,d));return[2,A]}return[2,paginateResultSet(p,A,t,l,d)]}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))}function paginateResultSet(t,n,l,d,p){var h,f;void 0===p&&(p={}),p.includePagination=!0;var y=Object.assign({},p);return delete y.offset,t.next&&(h=function(){return makeRequest(l,formatPaginatedUrl(l.url,t.next),d,y)}),t.previous&&(f=function(){return makeRequest(l,formatPaginatedUrl(l.url,t.previous),d,y)}),{data:n,next:h,previous:f,meta:t.meta}}function mapRequestResult(t,n){return"data"in t?(t.data=n(t.data),t):n(t)}function formatPaginatedUrl(t,n){var l=new window.window.URL(t).pathname,d=new RegExp("^"+l+"/");return n.replace(d,"")}var Fa,getFeatureName=function(t,n){if(n)return n;var l,d=(void 0===(l=t.relationships.tracks.data)&&(l=[]),0!==l.length&&l.filter((function(t){var n=t.attributes;return!!n&&(n.workName||n.movementName||n.movementCount||n.movementNumber)})).length>0);return"albums"===t.type||"library-albums"===t.type?d?Ie.ALBUM_CLASSICAL:Ie.ALBUM:"playlists"===t.type||"library-playlists"===t.type?d?Ie.PLAYLIST_CLASSICAL:Ie.PLAYLIST:void 0},Ka=[{toOptions:function(t,n,l){var d={attributes:t.attributes,id:t.id,type:t.type,name:withBagPrefix(getFeatureName(t,null==l?void 0:l.featureName))};return t.relationships.tracks.data.map((function(t){return{attributes:t.attributes,id:t.id,type:t.type,container:d,context:l}}))},condition:hasRelationship("tracks")},Ua,La,Na,xa],isMediaAPIResource=function(t){return t&&void 0!==t.id&&void 0!==t.type},isMediaItem=function(t){return t&&void 0!==t.id},isMPMediaItem=function(t){return t&&void 0!==t.contentId&&void 0!==t.metadata&&void 0!==t.metadata.itemId&&void 0!==t.metadata.itemType},isQueueItems=function(t){return t&&t.items&&Array.isArray(t.items)},isQueueLoaded=function(t){return t&&t.loaded},isQueueURLOption=function(t){return t&&t.url},descriptorToMediaItems=function(t){return isQueueItems(t)||isQueueLoaded(t)?((n=isQueueLoaded(t)?loadedDescriptorToMediaItem(t):unloadedDescriptorToMediaItem(t)).forEach((function(n){return n.context=__assign(__assign({},t.context),n.context)})),n):[];var n},unloadedDescriptorToMediaItem=function(t){var n=t.items;return isArrayOf(n,isMPMediaItem)?n.map((function(t){return new Ma(function(t){var n=transform({id:"metadata.itemId",type:"metadata.itemType","attributes.contentRating":function(){if(1===get(t,"metadata.isExplicit"))return"explicit"},"attributes.playParams":function(){return 0!==get(t,"metadata.isPlayable")&&{id:get(t,"metadata.itemId"),kind:get(t,"metadata.itemType")}},"container.id":"metadata.containerId","container.name":"metadata.containerName","container.type":"metadata.containerType"},t);return __assign({attributes:{}},n)}(t))})):isArrayOf(n,isMediaItem)?n.map((function(t){return new Ma(t)})):[]},loadedDescriptorToMediaItem=function(t){var n=[],l=t.loaded,d=t.container,p=t.context;return void 0===l?[]:isArrayOf(l,isDataRecord)?(l.forEach((function(t){n.push.apply(n,__spread(dataRecordToMediaItems(t,d,p)))})),n):isArrayOf(l,isMediaAPIResource)?(l.forEach((function(t){n.push.apply(n,__spread(resourceToMediaItem(t,d,p)))})),n):isDataRecord(l)?dataRecordToMediaItems(l,d,p):isMediaAPIResource(l)?resourceToMediaItem(l,d,p):[]},dataRecordToMediaItems=function(t,n,l){void 0===l&&(l={});var d=t.serialize().data;return resourceToMediaItem(d,n,l)},resourceToMediaItem=function(t,n,l){return void 0===l&&(l={}),Mt.debug("_resourceToMediaItem",t),function(t,n,l){var d,p,h,f;return void 0===l&&(l={}),n=null!==(h=null===(p=null===(d=n)||void 0===d?void 0:d.serialize)||void 0===p?void 0:p.call(d).data)&&void 0!==h?h:n,(null!==(f=Ka.find((function(d){return d.condition(t,n,l)})))&&void 0!==f?f:Da).toOptions(t,n,l).map((function(t){return new Ma(t)}))}(t,n,l)},Va=function(){function BaseModifiableQueue(){this.canModifyQueue=!1}return BaseModifiableQueue.prototype.append=function(t){Mt.warn("Append is not supported for this type of playback")},BaseModifiableQueue.prototype.clear=function(){Mt.warn("Clear is not supported for this type of playback")},BaseModifiableQueue.prototype.prepend=function(t,n){Mt.warn("Prepend is not supported for this type of playback")},BaseModifiableQueue}(),$a=function(){function ModifiableQueue(t){this.canModifyQueue=!0,this.queue=t}return ModifiableQueue.prototype.append=function(t){var n=descriptorToMediaItems(t);this.queue.splice(this.queue.length,0,n)},ModifiableQueue.prototype.clear=function(){this.queue.length&&(this.queue.splice(0,this.queue.length),this.queue.reset())},ModifiableQueue.prototype.prepend=function(t,n){void 0===n&&(n=!1);var l=descriptorToMediaItems(t),d=(this.queue.position<0?0:this.queue.position)+1;n&&this.queue.splice(d,this.queue.length),this.queue.splice(d,0,l)},ModifiableQueue}();(Fa=t.PlayerRepeatMode||(t.PlayerRepeatMode={}))[Fa.none=0]="none",Fa[Fa.one=1]="one",Fa[Fa.all=2]="all";var Ha,za=function(){function BaseRepeatable(){this.canSetRepeatMode=!1}return Object.defineProperty(BaseRepeatable.prototype,"repeatMode",{get:function(){return t.PlayerRepeatMode.none},set:function(t){t!==this.repeatMode&&Mt.warn("setting repeatMode is not supported in this playback method")},enumerable:!0,configurable:!0}),BaseRepeatable}(),Wa=function(){function Repeatable(n){this.dispatcher=n,this.canSetRepeatMode=!0,this._mode=t.PlayerRepeatMode.none}return Object.defineProperty(Repeatable.prototype,"repeatMode",{get:function(){return this._mode},set:function(n){n in t.PlayerRepeatMode&&n!==this._mode&&(this._mode=n,this.dispatcher.publish(fr.repeatModeDidChange,this._mode))},enumerable:!0,configurable:!0}),Repeatable}(),Ya=function(){function BaseSeekable(t){this.mediaItemPlayback=t,this.canSeek=!1}return BaseSeekable.prototype.getSeekSeconds=function(t){return Mt.warn("Seeking by predetermined amounts are not supported in this playback method"),{BACK:0,FORWARD:0}},BaseSeekable.prototype.seekBackward=function(t){Mt.warn("seekBackward is not supported in this playback method")},BaseSeekable.prototype.seekForward=function(t){Mt.warn("seekForward is not supported in this playback method")},BaseSeekable.prototype.seekToTime=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return Mt.warn("seekToTime is not supported in this playback method"),[2]}))}))},BaseSeekable}(),qa=function(){function Seekable(t,n){this._dispatcher=t,this.mediaItemPlayback=n,this.canSeek=!0}return Seekable.prototype.getSeekSeconds=function(t){return function(t){switch(t.type){case"uploaded-videos":case"uploadedVideo":case"musicVideo":return{FORWARD:10,BACK:10};default:return{FORWARD:30,BACK:15}}}(t)},Seekable.prototype.seekBackward=function(t){return void 0===t&&(t=this._seekToBeginning),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return void 0===this.mediaItemPlayback.nowPlayingItem?(Mt.warn("Cannot seekBackward when nowPlayingItem is not yet set."),[2]):(n=this.mediaItemPlayback.currentPlaybackTime-this.getSeekSeconds(this.mediaItemPlayback.nowPlayingItem).BACK)<0?[4,t.call(this)]:[3,2];case 1:return l.sent(),[2];case 2:return[4,this.seekToTime(n,tn.Interval)];case 3:return l.sent(),[2]}}))}))},Seekable.prototype.seekForward=function(t){return void 0===t&&(t=this._seekToEnd),__awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return void 0===this.mediaItemPlayback.nowPlayingItem?(Mt.warn("Cannot seekForward when nowPlayingItem is not yet set."),[2]):(n=this.mediaItemPlayback.currentPlaybackTime+this.getSeekSeconds(this.mediaItemPlayback.nowPlayingItem).FORWARD)>this.mediaItemPlayback.currentPlaybackDuration?[4,t.call(this)]:[3,2];case 1:return l.sent(),[2];case 2:return[4,this.seekToTime(n,tn.Interval)];case 3:return l.sent(),[2]}}))}))},Seekable.prototype.seekToTime=function(t,n){return void 0===n&&(n=tn.Manual),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return l=this.mediaItemPlayback.currentPlaybackTime,d=Math.min(Math.max(0,t),this.mediaItemPlayback.currentPlaybackDuration-1),[4,this.mediaItemPlayback.seekToTime(d,n)];case 1:return p.sent(),this._dispatcher.publish(lr.playbackSeek,{startPosition:l,position:d,seekReasonType:n}),[2]}}))}))},Seekable.prototype._seekToBeginning=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.seekToTime(0,tn.Interval)];case 1:return t.sent(),[2]}}))}))},Seekable.prototype._seekToEnd=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.seekToTime(this.mediaItemPlayback.currentPlaybackDuration,tn.Interval)];case 1:return t.sent(),[2]}}))}))},Seekable}();!function(t){t[t.off=0]="off",t[t.songs=1]="songs"}(Ha||(Ha={}));var Ga,Qa="Shuffling is not supported in this playback method.",Ja=function(){function BaseShuffler(){this.canSetShuffleMode=!1}return Object.defineProperty(BaseShuffler.prototype,"shuffle",{set:function(t){Mt.warn(Qa)},enumerable:!0,configurable:!0}),Object.defineProperty(BaseShuffler.prototype,"shuffleMode",{get:function(){return Ha.off},set:function(t){Mt.warn(Qa)},enumerable:!0,configurable:!0}),BaseShuffler.prototype.checkAndReshuffle=function(t){Mt.warn(Qa)},BaseShuffler}(),Xa=function(){function Shuffler(t,n){var l=n.dispatcher;this.controller=t,this.canSetShuffleMode=!0,this.mode=Ha.off,this._unshuffledIDs=[],this.dispatcher=l,this.dispatcher.subscribe(lr.queueModified,this.queueModifiedHandler),this._queue=t.queue}return Object.defineProperty(Shuffler.prototype,"queue",{get:function(){return this._queue},set:function(t){this._queue=t,this._unshuffledIDs=t.items.map((function(t){return t.id})),this.checkAndReshuffle(!1)},enumerable:!0,configurable:!0}),Shuffler.prototype.queueModifiedHandler=function(t,n){var l,d=n.start,p=n.added,h=n.removed;if(h.length>0){var f=h.map((function(t){return t.id}));this._unshuffledIDs=this._unshuffledIDs.filter((function(t){return!f.includes(t)}))}p.length>0&&(l=this._unshuffledIDs).splice.apply(l,__spread([d,0],p.map((function(t){return t.id}))))},Object.defineProperty(Shuffler.prototype,"shuffle",{set:function(t){this.shuffleMode=t?Ha.songs:Ha.off},enumerable:!0,configurable:!0}),Object.defineProperty(Shuffler.prototype,"shuffleMode",{get:function(){return this.mode},set:function(t){t!==this.shuffleMode&&t in Ha&&(Mt.debug("mk: set shuffleMode from "+this.shuffleMode+" to "+t),this.mode=t,this.mode===Ha.songs?this.shuffleQueue():this.unshuffleQueue(),this.controller.nowPlayingItem&&(this._queue.position=this._queue.indexForItem(this.controller.nowPlayingItem.id)),this.dispatcher.publish(fr.shuffleModeDidChange,this.shuffleMode))},enumerable:!0,configurable:!0}),Shuffler.prototype.checkAndReshuffle=function(t){void 0===t&&(t=!1),this.shuffleMode===Ha.songs&&this.shuffleQueue(t)},Shuffler.prototype.shuffleQueue=function(t){void 0===t&&(t=!0);for(var n=this._queue.items.length,l=__spread(this._queue.items);n--;){var d=Math.floor(n*Math.random()),p=l[d];l[d]=l[n],l[n]=p}this._queue.replaceQueueItems(l,t)},Shuffler.prototype.unshuffleQueue=function(t){void 0===t&&(t=!0);var n=[],l=this._unshuffledIDs.reduce((function(t,n,l){return t[n]=l,t}),{}),d=[];this._queue.items.forEach((function(t){var p=l[t.id];void 0===p&&d.push(t),n[p]=t})),n=n.filter(Boolean),this._queue.replaceQueueItems(n.concat(d),t)},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",void 0)],Shuffler.prototype,"queueModifiedHandler",null),Shuffler}();!function(t){t.continuous="continuous",t.serial="serial"}(Ga||(Ga={}));var Za,es=fr.queueItemsDidChange,ts=function(){function PlaybackController(t){this._context={},this.onPlaybackStateDidChange=this.onPlaybackStateDidChange.bind(this),this._services=t.services,this._playerOptions=t,this.storekit=t.storekit,this._skipIntro=new Rr({controller:this,services:t.services}),this._upNext=new Cr({controller:this,services:t.services}),this._rollMonitor=new Er({controller:this,services:t.services}),this._queueModifier=new Va,this._shuffler=new Ja,this._seekable=new Ya(this._mediaItemPlayback),this._repeatable=new za}return Object.defineProperty(PlaybackController.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"continuous",{get:function(){return this._continuous||this.hasAuthorization},set:function(t){this._continuous=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"currentBufferedProgress",{get:function(){return this._mediaItemPlayback.currentBufferedProgress},set:function(t){this._mediaItemPlayback.currentBufferedProgress=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"currentPlaybackProgress",{set:function(t){this._mediaItemPlayback.currentPlaybackProgress=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"_dispatcher",{get:function(){return this._services.dispatcher},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"formattedCurrentPlaybackDuration",{get:function(){return this._mediaItemPlayback.formattedCurrentPlaybackDuration},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"hasAuthorization",{get:function(){return hasAuthorization(this.storekit)},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"isPlaying",{get:function(){return this._mediaItemPlayback.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"isPrimaryPlayer",{get:function(){return this._mediaItemPlayback.isPrimaryPlayer},set:function(t){this._mediaItemPlayback.isPrimaryPlayer=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"isReady",{get:function(){return this._mediaItemPlayback.isReady},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"_mediaItemPlayback",{get:function(){return this._services.mediaItemPlayback},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"nowPlayingItem",{get:function(){return this._mediaItemPlayback.nowPlayingItem},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"nowPlayingItemIndex",{get:function(){return this.queue?this.queue.position:-1},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"queue",{get:function(){return this._queue},set:function(t){this._prepareQueue(t),this._queue=t,this._shuffler.queue=this._queue,this._queueModifier.queue=this._queue,this._dispatcher.publish(es,t.items)},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"repeatMode",{get:function(){return this._repeatable.repeatMode},set:function(t){this._repeatable.repeatMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"seekSeconds",{get:function(){var t=this.nowPlayingItem;if(void 0!==t)return this._seekable.getSeekSeconds(t)},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"shuffle",{set:function(t){this._shuffler.shuffle=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"shuffleMode",{get:function(){return this._shuffler.shuffleMode},set:function(t){this._shuffler.shuffleMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(PlaybackController.prototype,"storekit",{get:function(){return this._storekit},set:function(n){var l=this;n&&(n.addEventListener(ur.authorizationStatusWillChange,(function(n){var d=n.authorizationStatus,p=n.newAuthorizationStatus;return __awaiter(l,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this.isPlaying?d>Zt.DENIED&&p<Zt.RESTRICTED?[4,this.stop({endReasonType:t.PlayActivityEndReasonType.PLAYBACK_SUSPENDED,userInitiated:!1})]:[3,2]:[3,4];case 1:return n.sent(),[3,4];case 2:return[4,this.stop({userInitiated:!1})];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))})),this._storekit=n)},enumerable:!0,configurable:!0}),PlaybackController.prototype.append=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return[4,this._dataForQueueOptions(t)];case 1:return n=l.sent(),this._queueModifier.append(n),[2,this.queue]}}))}))},PlaybackController.prototype._dataForQueueOptions=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,__assign(__assign({},t),{context:this.context})]}))}))},PlaybackController.prototype.clear=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this._queueModifier.clear(),[2,this.queue]}))}))},PlaybackController.prototype.changeToMediaAtIndex=function(t){var n,l,d;return void 0===t&&(t=0),__awaiter(this,void 0,void 0,(function(){var p,h,f,y;return __generator(this,(function(v){switch(v.label){case 0:return[4,this.stop()];case 1:return v.sent(),p=null===(n=this.queue.item(t))||void 0===n?void 0:n.id,h=null===(d=null===(l=this._mediaItemPlayback)||void 0===l?void 0:l.playOptions)||void 0===d?void 0:d.get(p),f=(null==h?void 0:h.startTime)||0,[4,this._changeToMediaAtIndex(t,!0)];case 2:return(y=v.sent())&&(y.id!==p&&(f=0),this._dispatcher.publish(lr.playbackPlay,{item:y,position:f})),[2]}}))}))},PlaybackController.prototype.changeToMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){return-1===(n=this.queue.indexForItem(t))?[2,Promise.reject(new we(we.MEDIA_DESCRIPTOR))]:[2,this.changeToMediaAtIndex(n)]}))}))},PlaybackController.prototype.activate=function(){Mt.debug("mk: base controller - activate"),this._dispatcher.unsubscribe(fr.playbackStateDidChange,this.onPlaybackStateDidChange),this._dispatcher.subscribe(fr.playbackStateDidChange,this.onPlaybackStateDidChange),this._skipIntro.activate(),this._upNext.activate(),this._rollMonitor.activate()},PlaybackController.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.stop()];case 1:return t.sent(),this._dispatcher.unsubscribe(fr.playbackStateDidChange,this.onPlaybackStateDidChange),this._skipIntro.deactivate(),this._upNext.deactivate(),this._rollMonitor.deactivate(),[2]}}))}))},PlaybackController.prototype.destroy=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.deactivate()];case 1:return t.sent(),[2]}}))}))},PlaybackController.prototype.hasCapabilities=function(t){switch(t){case ua.SEEK:return this._seekable.canSeek;case ua.REPEAT:return this._repeatable.canSetRepeatMode;case ua.SHUFFLE:return this._shuffler.canSetShuffleMode;case ua.EDIT_QUEUE:return this._queueModifier.canModifyQueue;case ua.PAUSE:case ua.SKIP_NEXT:case ua.SKIP_TO_ITEM:return!0;case ua.SKIP_PREVIOUS:default:return!1}},PlaybackController.prototype.pause=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this._mediaItemPlayback.pause(t)]}))}))},PlaybackController.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.nowPlayingItem?[2,this._mediaItemPlayback.play()]:!this._queue||this._queue.isEmpty?[2]:this.nowPlayingItemIndex>=0?[2,this.changeToMediaAtIndex(this.nowPlayingItemIndex)]:-1!==this.queue.nextPlayableItemIndex?[2,this.changeToMediaAtIndex(this.queue.nextPlayableItemIndex)]:[2]}))}))},PlaybackController.prototype.playSingleMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return[4,fetchHLSMetadata(t)];case 1:return l.sent(),this._dispatcher.publish(fr.queueItemsDidChange,[t]),[4,this._mediaItemPlayback.startMediaItemPlayback(t,!0)];case 2:return(n=l.sent())&&this._dispatcher.publish(lr.playbackPlay,{item:n,position:0,userInitiated:!0}),[2]}}))}))},PlaybackController.prototype.onPlaybackStateDidChange=function(n,l){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return l.state!==t.PlaybackStates.ended?[2]:this.continuous||this.repeatMode===t.PlayerRepeatMode.one?(this._dispatcher.publish(lr.applicationActivityIntent,{endReasonType:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),[4,this._next()]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},PlaybackController.prototype.preload=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._mediaItemPlayback.preload()]}))}))},PlaybackController.prototype.prepend=function(t,n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return[4,this._dataForQueueOptions(t)];case 1:return l=d.sent(),this._queueModifier.prepend(l,n),[2,this.queue]}}))}))},PlaybackController.prototype.prepareToPlay=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this._mediaItemPlayback.prepareToPlay(t)]}))}))},PlaybackController.prototype.showPlaybackTargetPicker=function(){this._mediaItemPlayback.showPlaybackTargetPicker()},PlaybackController.prototype.seekBackward=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._seekable.seekBackward()]}))}))},PlaybackController.prototype.seekForward=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._seekable.seekForward(this.skipToNextItem.bind(this))]}))}))},PlaybackController.prototype.skipToNextItem=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._next(!0)]}))}))},PlaybackController.prototype.getNewSeeker=function(){return this._mediaItemPlayback.getNewSeeker()},PlaybackController.prototype.seekToTime=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){switch(l.label){case 0:return[4,this._seekable.seekToTime(t,n)];case 1:return l.sent(),[2]}}))}))},PlaybackController.prototype.setQueue=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this.extractGlobalValues(t)];case 1:return n.sent(),[4,this._mediaItemPlayback.stop()];case 2:return n.sent(),[2,this.returnQueueForOptions(t)]}}))}))},PlaybackController.prototype.extractGlobalValues=function(t){var n;return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){return this._context=null!==(n=t.context)&&void 0!==n?n:{},void 0!==(l=t.featureName)&&(Mt.warn("featureName is deprecated, pass it inside context"),this._context.featureName=l),[2]}))}))},PlaybackController.prototype.stop=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._mediaItemPlayback.stop(t)];case 1:return n.sent(),[2]}}))}))},PlaybackController.prototype._changeToMediaAtIndex=function(t,n){return void 0===t&&(t=0),void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return this.queue.isEmpty?[2]:(this.queue.position=t,(l=this.queue.item(this.queue.position))?[4,this._mediaItemPlayback.startMediaItemPlayback(l,n)]:[2]);case 1:return(d=p.sent())||l.state!==kr.unsupported?[3,3]:[4,this.skipToNextItem()];case 2:return p.sent(),[2];case 3:return[2,d]}}))}))},PlaybackController.prototype._next=function(n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){var l,d,p,h;return __generator(this,(function(f){switch(f.label){case 0:return this.queue.isEmpty?[2]:(l=this._mediaItemPlayback,this.queue.nextPlayableItemIndex<0?(Mt.debug("controller/index._next no next item available, stopping playback"),[4,this.stop({userInitiated:n})]):[3,2]);case 1:return f.sent(),l.playbackState=t.PlaybackStates.completed,[2];case 2:return d=this.isPlaying,p=l.currentPlaybackTime,[4,this._changeToMediaAtIndex(this.queue.nextPlayableItemIndex,n)];case 3:return h=f.sent(),this._notifySkip(d,h,{userInitiated:n,position:p,direction:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS}),[2,h]}}))}))},PlaybackController.prototype._notifySkip=function(n,l,d){var p=d.userInitiated,h=d.direction,f=d.position;n?l?this._dispatcher.publish(lr.playbackSkip,{item:l,userInitiated:p,direction:h,position:f}):this._dispatcher.publish(lr.playbackStop,{userInitiated:p,position:f}):l&&this._dispatcher.publish(lr.playbackPlay,__assign({item:l,position:0},p?{endReasonType:t.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM}:{}))},PlaybackController.prototype._prepareQueue=function(t){Mt.debug("mk: _prepareQueue"),this.hasAuthorization&&(t.isRestricted=this.storekit.restrictedEnabled||!1),t.repeatable=this._repeatable},PlaybackController}(),parseQueueURLOption=function(t){if(isQueueURLOption(t)){var n=formattedMediaURL(t.url),l=n.contentId,d=n.kind,p=n.storefrontId;t[d]=l,vr.storefrontId=p,delete t.url,Mt.debug("parseQueueURLOption",t)}},rs=fr.queueItemsDidChange,is=fr.queuePositionDidChange,ns=function(){function Queue(t){this._itemIDs=[],this._items=[],this._isRestricted=!1,this._nextPlayableItemIndex=-1,this._position=-1,this._dispatcher=t.services.dispatcher,t.descriptor&&(this._items=descriptorToMediaItems(t.descriptor),this._reindex(),this.position=this._getStartItemPosition(t.descriptor.startWith))}return Object.defineProperty(Queue.prototype,"isEmpty",{get:function(){return 0===this.length},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"isRestricted",{get:function(){return this._isRestricted},set:function(t){this._isRestricted=t,this._isRestricted&&this._items&&(this._items=this._items.map((function(t){return t.restrict(),t})))},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"nextPlayableItem",{get:function(){if(-1!==this.nextPlayableItemIndex)return this.item(this.nextPlayableItemIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"nextPlayableItemIndex",{get:function(){return this._nextPlayableItemIndex=this._getNextPlayableItemIndex(),this._nextPlayableItemIndex},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"position",{get:function(){return this._position},set:function(t){this._updatePosition(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"previousPlayableItem",{get:function(){if(void 0!==this.previousPlayableItemIndex)return this.item(this.previousPlayableItemIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(Queue.prototype,"previousPlayableItemIndex",{get:function(){if(void 0===this._previousPlayableItemIndex)for(var t=this.position-1;t>-1;){var n=this.item(t);if(this._isItemPlayable(n)){this._previousPlayableItemIndex=t;break}t--}return this._previousPlayableItemIndex},enumerable:!0,configurable:!0}),Queue.prototype.indexForItem=function(t){return("string"==typeof t?this._itemIDs:this._items).indexOf(t)},Queue.prototype.item=function(t){return this._items&&this._items[t]},Queue.prototype.remove=function(t){if(logDeprecation("remove",{message:"The queue remove function has been deprecated"}),t===this.position)throw new we(we.INVALID_ARGUMENTS);this.splice(t,1)},Queue.prototype.splice=function(t,n,l){var d,p;void 0===l&&(l=[]);var h=(d=this._items).splice.apply(d,__spread([t,n],l));return(p=this._itemIDs).splice.apply(p,__spread([t,n],l.map((function(t){return t.id})))),this._dispatcher.publish(lr.queueModified,{start:t,added:l,removed:h}),this._dispatcher.publish(rs,this.items),h},Queue.prototype.replaceQueueItems=function(t,n){void 0===n&&(n=!0),this._isSameItems(t)?(this._items=t,this._reindex(),n&&this._dispatcher.publish(rs,t)):Mt.warn("Cannot use replaceQueueItems with different items.")},Queue.prototype.reset=function(){var t=this.position;this._position=-1,this._dispatcher.publish(is,{oldPosition:t,position:this.position})},Queue.prototype._isSameItems=function(t){if(t.length!==this.length)return!1;var n,l,d=t.map((function(t){return t.id})).sort(),p=__spread(this._itemIDs).sort();try{n=JSON.stringify(d),l=JSON.stringify(p)}catch(e){return!1}return n===l},Queue.prototype._reindex=function(){this._items&&(this._itemIDs=this._items.map((function(t){return t.id})))},Queue.prototype._updatePosition=function(t){if(t!==this._position){var n=this._position;this._position=this._getNextPlayableItemIndex(t),this._previousPlayableItemIndex=void 0,this._dispatcher.publish(is,{oldPosition:n,position:this._position})}},Queue.prototype._getNextPlayableItemIndex=function(n){var l;void 0===n&&(n=this.position+1);for(var d=n;d<this.length;){var p=this.item(d);if(this._isItemPlayable(p))return d;d++}if((null===(l=this.repeatable)||void 0===l?void 0:l.repeatMode)===t.PlayerRepeatMode.all)for(d=0;d<=n;){p=this.item(d);if(this._isItemPlayable(p))return d;d++}return-1},Queue.prototype._getStartItemPosition=function(t){if(void 0===t)return-1;if("object"==typeof t&&"id"in t&&(t=t.id),"string"==typeof t)return this.indexForItem(t);var n=parseInt(""+t,10);return n>=0&&n<this.length?n:-1},Queue.prototype._isItemPlayable=function(t){return(null==t?void 0:t.isPlayable)||(null==t?void 0:t.previewURL)},Queue}(),as=function(){function StationTrackLoader(t,n,l,d){var p=l.dispatcher,h=l.logger,f=l.apiManager;void 0===d&&(d={}),this.queue=t,this.station=n,this.context=d,this.isActive=!1,this.dispatcher=p,this.logger=h,this.apiManager=f}return StationTrackLoader.prototype.activate=function(){this.dispatcher.unsubscribe(fr.queuePositionDidChange,this.checkLoadMore),this.dispatcher.subscribe(fr.queuePositionDidChange,this.checkLoadMore),this.isActive=!0},StationTrackLoader.prototype.deactivate=function(){this.dispatcher.unsubscribe(fr.queuePositionDidChange,this.checkLoadMore),this.isActive=!1},StationTrackLoader.prototype.start=function(){return this.isActive||this.activate(),this.loadNextTracks()},StationTrackLoader.prototype.checkLoadMore=function(){if(!(this.queue.isEmpty||this.queue.nextPlayableItemIndex>=0))return this.loadNextTracks()},StationTrackLoader.prototype.loadNextTracks=function(){var t,n;return __awaiter(this,void 0,void 0,(function(){var l,d;return __generator(this,(function(p){switch(p.label){case 0:return[4,null===(t=this.apiManager.mediaAPI)||void 0===t?void 0:t.nextStationTracks(this.station.id)];case 1:if(0===(l=null!==(n=p.sent())&&void 0!==n?n:[]).length)throw this.logger.warn("No track data is available for the current station",{stationId:this.station.id}),new we(we.CONTENT_UNAVAILABLE,"No track data is available for the current station.");return d=descriptorToMediaItems({context:this.context,loaded:l,container:this.station}),this.queue.splice(this.queue.length,0,d),[2]}}))}))},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],StationTrackLoader.prototype,"checkLoadMore",null),StationTrackLoader}();!function(t){t.artist="artist",t.song="song",t.station="station",t.radioStation="radioStation"}(Za||(Za={}));var isIdentityQueue=function(t){return t&&void 0!==t.identity},isLiveStationQueue=function(t){return t&&void 0!==t.station&&!0===t.isLive},isLiveQueue=function(t){return isIdentityQueue(t)||isLiveStationQueue(t)},ss=function(t){function ContinuousPlaybackController(n){var l=t.call(this,n)||this;return l.type=Ga.continuous,l._isLive=!1,l._continuous=!0,l}return __extends(ContinuousPlaybackController,t),Object.defineProperty(ContinuousPlaybackController.prototype,"continuous",{get:function(){return!0},set:function(t){if(!0!==t)throw new we(we.UNSUPPORTED_ERROR,"Continuous playback cannot be disabled for station queues.")},enumerable:!0,configurable:!0}),Object.defineProperty(ContinuousPlaybackController.prototype,"context",{get:function(){return __assign({featureName:Ie.STATION},this._context)},enumerable:!0,configurable:!0}),Object.defineProperty(ContinuousPlaybackController.prototype,"isLive",{get:function(){return this._isLive},set:function(t){t!==this._isLive&&(this._isLive=t,this._dispatcher.publish(fr.capabilitiesChanged))},enumerable:!0,configurable:!0}),ContinuousPlaybackController.prototype.changeToMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.generateMethodNotAvailable("changeToMediaItem"),[2]}))}))},ContinuousPlaybackController.prototype.hasCapabilities=function(n){switch(n){case ua.PAUSE:case ua.SKIP_NEXT:return!this.isLive;case ua.SKIP_PREVIOUS:case ua.SKIP_TO_ITEM:return!1;default:return t.prototype.hasCapabilities.call(this,n)}},ContinuousPlaybackController.prototype.pause=function(n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this.isLive?(this.generateMethodNotAvailable("pause"),[2]):[2,t.prototype.pause.call(this,n)]}))}))},ContinuousPlaybackController.prototype.skipToPreviousItem=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.generateMethodNotAvailable("skipToPreviousItem"),[2]}))}))},ContinuousPlaybackController.prototype._dataForQueueOptions=function(n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return[4,t.prototype._dataForQueueOptions.call(this,n)];case 1:return l=d.sent(),this.isLive&&(l.loaded=this.station),[2,l]}}))}))},ContinuousPlaybackController.prototype.returnQueueForOptions=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:return this.isLive=isLiveQueue(t),this.isLive?isIdentityQueue(t)?[4,this.loadStationByIdentity(t.identity)]:[3,2]:[3,5];case 1:return n=p.sent(),[3,4];case 2:return isLiveStationQueue(t)?[4,this.loadStationByStationId(t.station)]:[3,4];case 3:n=p.sent(),p.label=4;case 4:return[3,7];case 5:return[4,this.loadStationByStationId(this.generateStationId(t))];case 6:n=p.sent(),p.label=7;case 7:return void 0===n?[2,Promise.reject(new we(we.UNSUPPORTED_ERROR,"Cannot load requested station"))]:(this.station=n,d={services:{dispatcher:this._dispatcher}},[4,this._dataForQueueOptions(t)]);case 8:return d.descriptor=p.sent(),l=d,this.queue=new ns(l),this.isLive?[3,10]:(this.trackLoader=new as(this.queue,n,{dispatcher:this._dispatcher,logger:Mt,apiManager:this._services.apiManager},this.context),[4,this.trackLoader.start()]);case 9:p.sent(),p.label=10;case 10:return this._seekable=this.isLive?new Ya(this._mediaItemPlayback):new qa(this._dispatcher,this._mediaItemPlayback),[2,this.queue]}}))}))},ContinuousPlaybackController.prototype.getNewSeeker=function(){return this.hasCapabilities(ua.SEEK)?t.prototype.getNewSeeker.call(this):new En},ContinuousPlaybackController.prototype.skipToNextItem=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this.isLive?(this.generateMethodNotAvailable("skipToNextItem"),[2]):[2,t.prototype.skipToNextItem.call(this)]}))}))},ContinuousPlaybackController.prototype.generateMethodNotAvailable=function(t){Mt.warn(t+" is not supported for this type of playback")},ContinuousPlaybackController.prototype.generateStationId=function(t){var n;if(isQueueURLOption(t)){var l=formattedMediaURL(t.url),d=l.contentId,p=l.kind,h=l.storefrontId;t[p]=d,vr.storefrontId=h,n=p}var f=t;if(f.artist)return"ra."+f.artist;if(f.song)return"ra."+f.song;if(f.station)return f.station;if(f.radioStation)return f.radioStation;throw new we(we.UNSUPPORTED_ERROR,n?n+" is not a supported option. Use setQueue instead.":"Unsupported options specified for setStationQueue. You may want setQueue instead.")},ContinuousPlaybackController.prototype.loadStationByIdentity=function(t){var n,l;return __awaiter(this,void 0,void 0,(function(){var d;return __generator(this,(function(p){switch(p.label){case 0:return[4,null===(l=null===(n=this._services.apiManager)||void 0===n?void 0:n.mediaAPI)||void 0===l?void 0:l.stations(void 0,{filter:{identity:t}})];case 1:return[2,(d=p.sent())&&d[0]]}}))}))},ContinuousPlaybackController.prototype.loadStationByStationId=function(t){var n,l;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(d){return[2,null===(l=null===(n=this._services.apiManager)||void 0===n?void 0:n.mediaAPI)||void 0===l?void 0:l.station(t)]}))}))},ContinuousPlaybackController.prototype.activate=function(){t.prototype.activate.call(this),this.trackLoader&&this.trackLoader.activate()},ContinuousPlaybackController.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.deactivate.call(this)];case 1:return n.sent(),this.trackLoader&&this.trackLoader.deactivate(),[2]}}))}))},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",Boolean)],ContinuousPlaybackController.prototype,"hasCapabilities",null),ContinuousPlaybackController}(ts);function loadRelationshipData(t,n,l,d){return void 0===d&&(d={}),__awaiter(this,void 0,void 0,(function(){var p,h,f,y;return __generator(this,(function(v){switch(v.label){case 0:return void 0===n?[2,l]:(void 0===d.limit&&(d.limit=100),void 0===d.offset&&(d.offset=0),p=n.relationship,h=n.method,f=t[h].bind(t),isDataRecord(l)?(void 0===l[p]&&l.setProperty(p,[],"relationships"),y=l[p]):(l.relationships=l.relationships||{},void 0===l.relationships[p]&&Object.defineProperty(l.relationships,p,{value:{data:[]},enumerable:!0}),y=l.relationships[p].data),[4,recursiveRelationshipLoad(f,[l.id,p,d],y)]);case 1:return v.sent(),[2,l]}}))}))}var us,cs,recursiveRelationshipLoad=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){var d,p,h,f,y,v,g;return __generator(this,(function(m){switch(m.label){case 0:if(d=__read(n,3),p=d[0],h=d[1],f=d[2],(y=l.length)>0&&y<f.limit+f.offset)return[2,l];(v=__assign({},f)).offset=y,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,t(p,h,v)];case 2:return g=m.sent(),[3,4];case 3:return m.sent(),[2,l];case 4:return l.push.apply(l,__spread(g)),g.length<v.limit?[2,l]:[2,recursiveRelationshipLoad(t,n,l)]}}))}))},getNamedQueueOptions=function(t,n){var l=[],d=t.namedQueueOptions;for(var p in n)Object.keys(d).includes(p)&&l.push([p,d[p]]);return l},loadNamedQueueData=function(t,n,l){return __awaiter(void 0,void 0,void 0,(function(){var d,p,h,f,y,v,g,m;return __generator(this,(function(_){switch(_.label){case 0:return d=__read(l,2),p=d[0],h=d[1],f=n[p],y=Array.isArray(f),v=y?""+f[0]:""+f,[4,t.getAPIForItem(v)];case 1:return[4,(g=_.sent())[h.apiMethod](f,n.parameters)];case 2:return m=_.sent(),y?[3,4]:[4,loadRelationshipData(g,h.relationshipMethod,m)];case 3:_.sent(),_.label=4;case 4:return[2,m]}}))}))},ls=function(){function PercentageWatcher(t,n,l){this.dispatcher=t,this.callback=n,this.percentage=l,this.threshold=-1}return PercentageWatcher.prototype.startMonitor=function(){this.dispatcher.unsubscribe(fr.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(fr.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(fr.playbackDurationDidChange,this.updateThreshold),this.dispatcher.subscribe(fr.playbackTimeDidChange,this.handleTimeChange)},PercentageWatcher.prototype.stopMonitor=function(){this.dispatcher.unsubscribe(fr.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(fr.playbackTimeDidChange,this.handleTimeChange),this.threshold=-1},PercentageWatcher.prototype.handleTimeChange=function(t,n){var l=n.currentPlaybackDuration,d=n.currentPlaybackTime;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this.threshold<0&&this.updateThreshold(t,{duration:l}),d<this.threshold?[2]:(this.stopMonitor(),[4,this.callback(d,this)]);case 1:return n.sent(),[2]}}))}))},PercentageWatcher.prototype.updateThreshold=function(t,n){var l=n.duration;this.threshold=l*this.percentage},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],PercentageWatcher.prototype,"handleTimeChange",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],PercentageWatcher.prototype,"updateThreshold",null),PercentageWatcher}(),ds=function(t){function Preloader(n){var l=t.call(this,n)||this;return l.watchers=[new ls(l.dispatcher,l.handlePlaybackThreshold,.3)],l}return __extends(Preloader,t),Preloader.prototype.handlePlaybackThreshold=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.playbackController.prepareToPlay(this._next,!0)];case 1:return t.sent(),[2]}}))}))},Preloader.prototype.shouldMonitor=function(){if(!t.prototype.shouldMonitor.call(this))return!1;if(!this.playbackController.hasAuthorization)return!1;var n=this.getNextPlayableItem();return void 0!==n&&!n.isPreparedToPlay},Preloader.prototype.startMonitor=function(){this._next=this.getNextPlayableItem(),t.prototype.startMonitor.call(this)},Preloader.prototype.clearMonitor=function(){t.prototype.clearMonitor.call(this),this._next=void 0},Preloader.prototype.getNextPlayableItem=function(){return this.playbackController.queue.nextPlayableItem},Preloader}(wr),ps=fr.queueIsReady;!function(t){t.album="album",t.musicVideo="musicVideo",t.playlist="playlist",t.song="song",t.episode="episode",t.podcast="podcast",t.uploadedAudio="uploadedAudio",t.uploadedVideo="uploadedVideo"}(us||(us={})),function(t){t.albums="albums",t.musicVideos="musicVideos",t.playlists="playlists",t.songs="songs",t.episodes="episodes",t.podcasts="podcasts",t.uploadedAudio="uploadedAudios",t.uploadedVideo="uploadedVideos"}(cs||(cs={}));var hs=function(n){function SerialPlaybackController(t){var l=n.call(this,t)||this;l.type=Ga.serial,l._queue=new ns(t),l._repeatable=new Wa(l._dispatcher);var d={controller:l,services:t.services};return l._seekable=new qa(l._dispatcher,l._mediaItemPlayback),l._preloader=new ds(d),l._shuffler=new Xa(l,{dispatcher:l._dispatcher}),l._queueModifier=new $a(l._queue),l}return __extends(SerialPlaybackController,n),SerialPlaybackController.prototype.activate=function(){n.prototype.activate.call(this),this._preloader.activate()},SerialPlaybackController.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,n.prototype.deactivate.call(this)];case 1:return t.sent(),this._preloader.deactivate(),[2]}}))}))},SerialPlaybackController.prototype.hasCapabilities=function(t){return t===ua.SKIP_PREVIOUS||n.prototype.hasCapabilities.call(this,t)},SerialPlaybackController.prototype.prepareToPlay=function(n,l){return void 0===l&&(l=!1),__awaiter(this,void 0,void 0,(function(){var d=this;return __generator(this,(function(p){return Mt.debug("mk: SerialController - prepareToPlay - ",{item:n,preload:l}),n.isPlayable?[2,this._mediaItemPlayback.prepareToPlay(n).catch((function(n){var p=!l&&-1===[we.DEVICE_LIMIT,we.STREAM_UPSELL].indexOf(n.errorCode);if(d.continuous&&p)return d._dispatcher.publish(lr.applicationActivityIntent,{endReasonType:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),d._next();throw n}))]:[2]}))}))},SerialPlaybackController.prototype.returnQueueForOptions=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:return parseQueueURLOption(t),void 0!==t.startPosition&&(logDeprecation("startPosition",{message:"startPosition has been deprecated in favor of startWith"}),void 0===t.startWith&&(t.startWith=t.startPosition)),[4,this._dataForQueueOptions(t)];case 1:if(n=p.sent(),l={services:{dispatcher:this._dispatcher},descriptor:n},void 0!==t.shuffleMode&&(this.shuffleMode=t.shuffleMode),this.queue=new ns(l),"number"==typeof t.startTime&&(d=this.queue.nextPlayableItem)&&this._mediaItemPlayback.playOptions.set(d.id,{startTime:t.startTime}),0===this.queue.length)throw Mt.warn("No item data is available for the current media queue",t),new we(we.CONTENT_UNAVAILABLE,"No item data is available for the current media queue.");return this._dispatcher.publish(ps,this.queue.items),[2,this.queue]}}))}))},SerialPlaybackController.prototype.skipToPreviousItem=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._previous(!0)]}))}))},SerialPlaybackController.prototype._dataForQueueOptions=function(t){return __awaiter(this,void 0,void 0,(function(){var l,d,p,h,f;return __generator(this,(function(y){switch(y.label){case 0:return l=t,void 0!==(d=function(t,n){var l=getNamedQueueOptions(t,n);if(l.length>1)throw new we(we.UNSUPPORTED_ERROR,"Queues with multiple media types are not supported.");if(0!==l.length){var d=__read(l,1)[0],p=__read(d,2),h=p[0],f=p[1];if(Array.isArray(n[h])!==f.isPlural)throw new we(we.UNSUPPORTED_ERROR,f.isPlural?"Queue option "+h+" must be an array of id values":"Queue option "+h+" must be a single id value");return d}}(this._services.apiManager.apiService,t))?[3,2]:(p=[{}],[4,n.prototype._dataForQueueOptions.call(this,t)]);case 1:return[2,__assign.apply(void 0,[__assign.apply(void 0,p.concat([y.sent()])),l])];case 2:return h=l,[4,loadNamedQueueData(this._services.apiManager.apiService,t,d)];case 3:return h.loaded=y.sent(),f=[{}],[4,n.prototype._dataForQueueOptions.call(this,t)];case 4:return[2,__assign.apply(void 0,[__assign.apply(void 0,f.concat([y.sent()])),l])]}}))}))},SerialPlaybackController.prototype._next=function(l){return void 0===l&&(l=!1),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(d){switch(d.label){case 0:return this.queue.isEmpty||this.repeatMode!==t.PlayerRepeatMode.one?[3,2]:[4,this.play()];case 1:return d.sent(),[2,this.nowPlayingItem];case 2:return[2,n.prototype._next.call(this,l)]}}))}))},SerialPlaybackController.prototype._previous=function(n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){var l,d,p,h;return __generator(this,(function(f){switch(f.label){case 0:return this.queue.isEmpty||-1===(l=this.queue).previousPlayableItemIndex?[2]:(d=this.isPlaying,p=this._mediaItemPlayback.currentPlaybackTime,[4,this._changeToMediaAtIndex(l.previousPlayableItemIndex,n)]);case 1:return h=f.sent(),this._notifySkip(d,h,{userInitiated:n,direction:t.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,position:p}),[2,h]}}))}))},SerialPlaybackController.prototype._prepareQueue=function(t){n.prototype._prepareQueue.call(this,t),this._shuffler.checkAndReshuffle()},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",Boolean)],SerialPlaybackController.prototype,"hasCapabilities",null),SerialPlaybackController}(ts);function playMediaItem(n,l,d,p,h){return __awaiter(this,void 0,void 0,(function(){var f,y,v,g,m;return __generator(this,(function(_){switch(_.label){case 0:return f=l.isPaused()&&!d,Mt.debug("playMediaItem",n,f),[4,shouldPlayPreview(n,l)];case 1:return y=_.sent(),Mt.debug("mk: shouldPreview",y),y?(supportsDrm()||l.dispatch(fr.drmUnsupported,{item:n}),n.playbackType=t.PlaybackType.preview,l.nowPlayingItem=n,[4,l.playItemFromUnencryptedSource(n.previewURL,f)]):[3,3];case 2:return _.sent(),[2,n];case 3:return function(t){return!(!t.playRawAssetURL||!t.attributes.assetUrl)}(n)?(Mt.debug("shouldPlayRawAsset",n),n.playbackType=t.PlaybackType.unencryptedFull,l.nowPlayingItem=n,[4,l.playItemFromUnencryptedSource(n.attributes.assetUrl,f,h)]):[3,5];case 4:return _.sent(),[2,n];case 5:if(!isBroadcastRadio(n))return[3,8];if(!mr.features["broadcast-radio"])throw(v=new we(we.CONTENT_UNAVAILABLE)).data=n,v;return[4,loadLiveRadioAssets(n,p.store.developerToken,p.store.userToken)];case 6:return g=_.sent(),n.playbackType=t.PlaybackType.unencryptedFull,l.nowPlayingItem=n,[4,l.playItemFromUnencryptedSource(g.url,f)];case 7:return _.sent(),[2,n];case 8:if(!n||!n.isPlayable)return[2,Promise.reject(new we(we.MEDIA_PLAYBACK,"Not Playable"))];_.label=9;case 9:return _.trys.push([9,11,,12]),[4,prepareForEncryptedPlayback(n,l,p)];case 10:return _.sent(),[3,12];case 11:return m=_.sent(),Mt.error("prepareForEncryptedPlayback Error: userInitiated "+d),d?[2,Promise.reject(m)]:(l.dispatch(fr.mediaPlaybackError,m),[2]);case 12:return[4,handleAgeGate(n)];case 13:return _.sent(),Mt.debug("About to play item as encrypted",n),[4,l.playItemFromEncryptedSource(n,d,h)];case 14:return _.sent(),[2,n]}}))}))}function shouldPlayPreview(t,n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return t.previewURL?n.previewOnly?[2,!0]:t.playRawAssetURL?[2,!1]:(l=!t.isUTS)?[4,hasMusicSubscription()]:[3,2]:[2,!1];case 1:l=!d.sent(),d.label=2;case 2:return l?[2,!0]:[2,!hasAuthorization()||!supportsDrm()||!t.isPlayable]}}))}))}function prepareForEncryptedPlayback(t,n,l){return __awaiter(this,void 0,void 0,(function(){var d,p;return __generator(this,(function(h){switch(h.label){case 0:if(Mt.debug("prepareForEncryptedPlayback"),!hasAuthorization())return n.destroy(),[2,Promise.reject(new we(we.AUTHORIZATION_ERROR,"Unable to prepare for playback."))];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,l.store.validateAgeVerification(t)];case 2:return h.sent(),[3,4];case 3:return(d=h.sent()).errorCode===we.CONTENT_RESTRICTED&&t.restrict(),n.destroy(),[2,Promise.reject(d)];case 4:return h.trys.push([4,6,,14]),[4,t.prepareToPlay(l)];case 5:return h.sent(),[3,14];case 6:return p=h.sent(),[we.AUTHORIZATION_ERROR].includes(p.errorCode)?[4,l.store.storekit.revokeUserToken()]:[3,8];case 7:return h.sent(),[3,13];case 8:if(p.errorCode!==we.TOKEN_EXPIRED)return[3,13];h.label=9;case 9:return h.trys.push([9,12,,13]),[4,l.store.storekit.renewUserToken()];case 10:return h.sent(),[4,t.prepareToPlay(l)];case 11:return h.sent(),t.playbackData=_playbackDataForItem(t,n),[2,t];case 12:return h.sent(),[3,13];case 13:return p?(n.destroy(),[2,Promise.reject(p)]):[3,14];case 14:return t.playbackData=_playbackDataForItem(t,n),[2,t]}}))}))}function _playbackDataForItem(n,l){if(Mt.debug("mk: _playbackDataForItem",n),n.isCloudUpload)return n.assets[0];if("musicVideo"!==n.type){if(!n.isLiveRadioStation)return __read(n.assets.filter((function(t){var n;if(!("flavor"in t))return!1;var d=new RegExp("\\d{1,2}\\:(c"+(l.extension.isFairplay?"bc":"tr")+"p)(\\d{2,3})","i"),p=d.test(t.flavor),h=null!==(n=t.flavor.match(d))&&void 0!==n?n:[];return p&&parseInt(h[2],0)<=l.bitrate})),1)[0];var d=n.assets.reduce((function(t,n){var l=n.bandwidth;return t[l]||(t[l]=[]),t[l].push(n),t}),{}),p=Object.keys(d).sort((function(t,n){return parseInt(t,10)-parseInt(n,10)})),h=l.bitrate===t.PlaybackBitrate.STANDARD?p[0]:p[p.length-1];n.assetURL=d[h][0].URL}}function handleAgeGate(t){return new Promise((function(n,l){var d=t.ageGatePolicy;if(!d||!d.age||!d.frequencyInMinutes)return Mt.debug("No ageGatePolicy. Resolving handleAgeGate()"),n();var p=window.localStorage.ageGatePolicyAge,h=window.localStorage.ageGatePolicyExpiration;if(p&&h&&parseInt(h,10)>Date.now()&&parseInt(p,10)>=d.age)return n();It.clientDialog({okButtonString:"Yes",okButtonAction:function(){return localStorage.setItem("ageGatePolicyAge",d.age.toString()),localStorage.setItem("ageGatePolicyExpiration",(Date.now()+60*d.frequencyInMinutes*1e3).toString()),n()},cancelButtonString:"No",cancelButtonAction:function(){return l(new we("AGE_GATE","Age Gate Declined"))},explanation:"This content may not be appropriate for ages younger than "+d.age+".",message:"Are you "+d.age+" or older?"}).present()}))}function getPlayerType(t){var n,l;switch(null==t?void 0:t.type){case"movie":case"musicVideo":case"musicMovie":case"trailer":case"tvEpisode":case"uploadedVideo":case"uploaded-videos":case"music-videos":case"music-movies":case"tv-episodes":return"video";case"podcast-episodes":return"audio";default:return null!==(l=null===(n=null==t?void 0:t.attributes)||void 0===n?void 0:n.mediaKind)&&void 0!==l?l:"audio"}}function requiresHlsJs(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:return null==t?[3,1]:(l=t,[3,3]);case 1:return[4,findKeySystemPreference()];case 2:l=p.sent(),p.label=3;case 3:return n=l,d=!(!0===mr.features["safari-native-hls"]||0===vr.realm),[2,supportsDrm()&&(n!==yt.FAIRPLAY||d)]}}))}))}var fs=function(){function RTCStreamingTracker(t){this.options=t}return RTCStreamingTracker.prototype.configure=function(t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this.instance=t,[4,loadScript(mr.urls.rtc)];case 1:return n.sent(),[2,this]}}))}))},RTCStreamingTracker.prototype.prepareReportingAgent=function(t){var n;this.clearReportingAgent();var l=t||this.instance.nowPlayingItem,d=l?getDefaultPlayable(l):void 0,p=window.rtc.RTCReportingAgentConfigKeys,h=p.Sender,f=p.ClientName,y=p.ServiceName,v=p.ApplicationName,g=p.ReportingStoreBag,m=p.DeviceName,_={firmwareVersion:this.generateBrowserVersion(),model:this.options.browserName};d&&d.mediaMetrics&&d.mediaMetrics.MediaIdentifier&&(_.MediaIdentifier=d.mediaMetrics.MediaIdentifier),void 0===this._storeBag&&(this._storeBag=this.generateStoreBag());var b=((n={})[h]="HLSJS",n[f]=this.options.clientName,n[y]=this.options.serviceName,n[v]=this.options.applicationName,n[g]=this._storeBag,n[m]=this.options.osVersion,n.userInfoDict=_,n);return Mt.debug("RTC: creating reporting agent with config",b),this.reportingAgent=new window.rtc.RTCReportingAgent(b),Mt.debug("RTC: created reporting agent",this.reportingAgent),this.reportingAgent},RTCStreamingTracker.prototype.shouldConfigure=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,requiresHlsJs()]}))}))},RTCStreamingTracker.prototype.shouldTrackPlayActivity=function(t,n){return!0},RTCStreamingTracker.prototype.cleanup=function(){this.clearReportingAgent()},RTCStreamingTracker.prototype.clearReportingAgent=function(){void 0!==this.reportingAgent&&(this.reportingAgent.destroy(),Mt.debug("RTC: called destroy on reporting agent",this.reportingAgent),this.reportingAgent=void 0)},RTCStreamingTracker.prototype.generateBrowserVersion=function(){return this.options.browserMajorVersion?this.options.browserMajorVersion+"."+(this.options.browserMinorVersion||0):"unknown"},RTCStreamingTracker.prototype.generateStoreBag=function(){var t,n=this.options,l=n.storeBagURL,d=n.clientName,p=n.applicationName,h=n.serviceName,f=n.browserName,y={HLSJSVersion:null===(t=null===window||void 0===window?void 0:window.Hls)||void 0===t?void 0:t.version},v=new window.rtc.RTCStorebag.RTCReportingStoreBag(l,d,h,p,f,y);return Mt.debug("RTC: created store bag",v),v},RTCStreamingTracker}(),ys=mn.audioTracksSwitched,vs=mn.audioTracksUpdated,gs=mn.textTracksSwitched,ms=mn.textTracksUpdated,_s=function(t){function HlsJsTracks(n){var l=t.call(this,[ys,vs,gs,ms])||this;return l.session=n,l._audioTracks=[],l._textTracks=[],l.session.on(window.Hls.Events.MANIFEST_LOADED,l.handleManifestLoaded.bind(l)),l.session.on(window.Hls.Events.AUDIO_TRACK_SWITCHED,l.handleAudioTrackSwitched.bind(l)),l.session.on(window.Hls.Events.SUBTITLE_TRACK_SWITCH,l.handleSubtitleTrackSwitch.bind(l)),l}return __extends(HlsJsTracks,t),Object.defineProperty(HlsJsTracks.prototype,"audioTracks",{get:function(){return this._audioTracks},enumerable:!0,configurable:!0}),Object.defineProperty(HlsJsTracks.prototype,"textTracks",{get:function(){return this._textTracks},enumerable:!0,configurable:!0}),Object.defineProperty(HlsJsTracks.prototype,"audioTrack",{set:function(t){this.session&&t&&t.id&&(this.session.audioSelectedPersistentID=t.id)},enumerable:!0,configurable:!0}),Object.defineProperty(HlsJsTracks.prototype,"textTrack",{set:function(t){var n;this.session.subtitleSelectedPersistentID=null!==(n=null==t?void 0:t.id)&&void 0!==n?n:-1},enumerable:!0,configurable:!0}),HlsJsTracks.prototype.selectForcedTrack=function(){var t=this.session;if(null==t?void 0:t.audioTracks){var n=this.session.audioTracks.filter((function(n){return n.id===t.audioTrack})),l=n&&n.length&&n[0];if(l){var d,p=t.subtitleMediaOptions.filter((function(t){return 0===t.MediaSelectionOptionsDisplaysNonForcedSubtitles&&t.MediaSelectionOptionsExtendedLanguageTag===l.lang})),h=null==p?void 0:p[0];return h?(Mt.debug("hlsjsTracks: found forced track for "+h.MediaSelectionOptionsExtendedLanguageTag),t.subtitleSelectedPersistentID=h.MediaSelectionOptionsPersistentID,d=this.normalizeTextTrack(h)):t.subtitleSelectedPersistentID=-1,d}}},HlsJsTracks.prototype.audioTracksUpdated=function(t,n){var l=n&&n.audioMediaSelectionGroup&&n.audioMediaSelectionGroup.MediaSelectionGroupOptions||[];window.hlsSession=this.session;var d=l.map(this.normalizeAudioTrack,this);this._audioTracks=d,this.dispatchEvent(vs,d)},HlsJsTracks.prototype.handleAudioTrackSwitched=function(){this.dispatchEvent(ys,{selectedId:this.session.audioSelectedPersistentID})},HlsJsTracks.prototype.handleManifestLoaded=function(t,n){this.audioTracksUpdated(t,n),this.subtitleTracksUpdated(t,n)},HlsJsTracks.prototype.handleSubtitleTrackSwitch=function(t,n){this.dispatchEvent(gs,n)},HlsJsTracks.prototype.subtitleTracksUpdated=function(t,n){var l=this,d=n&&n.subtitleMediaSelectionGroup&&n.subtitleMediaSelectionGroup.MediaSelectionGroupOptions||[],p=Array();d.forEach((function(t){0!==t.MediaSelectionOptionsDisplaysNonForcedSubtitles&&p.push(l.normalizeTextTrack(t))})),this._textTracks=p,this.dispatchEvent(ms,p)},HlsJsTracks.prototype.normalizeAudioTrack=function(t){var n,l="public.accessibility.describes-video"===(null===(n=t.MediaSelectionOptionsTaggedMediaCharacteristics)||void 0===n?void 0:n[0])?"description":"main";return __assign(__assign({},this.normalizeSelectionOption(t)),{enabled:!1,kind:l})},HlsJsTracks.prototype.normalizeTextTrack=function(t){var n,l;return l=(null===(n=t.MediaSelectionOptionsTaggedMediaCharacteristics)||void 0===n?void 0:n.includes("public.accessibility.describes-music-and-sound"))||"clcp"===t.MediaSelectionOptionsMediaType?"captions":"subtitles",__assign(__assign({},this.normalizeSelectionOption(t)),{mode:"disabled",kind:l})},HlsJsTracks.prototype.normalizeSelectionOption=function(t){return{id:t.MediaSelectionOptionsPersistentID,label:t.MediaSelectionOptionsName,language:t.MediaSelectionOptionsExtendedLanguageTag}},HlsJsTracks}(ge),bs={};bs[yt.FAIRPLAY]="fairplaystreaming",bs[yt.PLAYREADY]="playready",bs[yt.WIDEVINE]="widevine";var Ps=!1;"undefined"!=typeof localStorage&&(Ps=!!localStorage.getItem("mk-hlsjs-debug")),Ps||(window.globalHlsLogConfig=Ps);var ks,Ts=function(t){function HlsJsVideoPlayer(n){var l=t.call(this,n)||this;l._channelsByGroup={};var d=l.services;return void 0!==d&&void 0!==d.playActivity&&(l._rtcTracker=d.playActivity.getTrackerByType(fs)),l._license=new Ko,l}return __extends(HlsJsVideoPlayer,t),HlsJsVideoPlayer.prototype.initializeExtension=function(){return __awaiter(this,void 0,void 0,(function(){var t,n;return __generator(this,(function(l){switch(l.label){case 0:return t=this,[4,findKeySystemPreference()];case 1:t._keySystem=l.sent(),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,loadScript(mr.urls.hls)];case 3:return l.sent(),[3,5];case 4:throw n=l.sent(),Mt.error("hlsjs-video-player failed to load script "+mr.urls.hls,n),n;case 5:return[2]}}))}))},HlsJsVideoPlayer.prototype.destroy=function(){Mt.debug("hlsjs-video-player.destroy");var n=this._hls;n&&(n.stopLoad(),n.detachMedia(),n.destroy()),t.prototype.destroy.call(this),asAsync(this._license.stop())},HlsJsVideoPlayer.prototype.playHlsStream=function(t,n){Mt.debug("hlsjs-video-player.playHlsStream",t,n);var l=this._keySystem;if(l){this.createHlsPlayer();var d={platformInfo:{requiresCDMAttachOnStart:!0,maxSecurityLevel:l===yt.WIDEVINE?"WIDEVINE_SOFTWARE":void 0}},p=this._rtcTracker,h=this._hls;if(p){var f=p.prepareReportingAgent(n);void 0!==f&&(d.appData={reportingAgent:f})}Mt.debug("RTC: loadSource with load options",d),h.loadSource(t,d),h.attachMedia(this.video),n&&(this._licenseServerUrl=n.keyURLs["hls-key-server-url"],l===yt.FAIRPLAY?h.setProtectionData({fairplaystreaming:{serverCertUrl:n.keyURLs["hls-key-cert-url"]}}):h.setProtectionData({widevine:{serverCertUrl:n.keyURLs["widevine-cert-url"]}}))}},HlsJsVideoPlayer.prototype.createHlsPlayer=function(){var t=this._keySystem,n=new window.Hls({clearMediaKeysOnPromise:!1,customTextTrackCueRenderer:!0,debug:Ps,enablePerformanceLogging:Ps,enablePlayReadyKeySystem:!0,enableRtcReporting:void 0!==this._rtcTracker,keySystemPreference:bs[t],useMediaKeySystemAccessFilter:!0}),l=window.Hls.Events,d=l.ERROR,p=l.INTERNAL_ERROR,h=l.MANIFEST_PARSED,f=l.KEY_REQUEST_STARTED,y=l.LICENSE_CHALLENGE_CREATED,v=l.LEVEL_SWITCHED;n.on(d,this.handleHlsError),n.on(p,this.handleHlsError),n.on(h,this.handleManifestParsed),n.on(f,this.handleKeyRequestStarted),n.on(y,this.handleLicenseChallengeCreated),n.on(v,this.handleLevelSwitched),this._hls=n,this.setupTrackManagers(new _s(n))},HlsJsVideoPlayer.prototype.handleLevelSwitched=function(t,n){var l,d,p=n.level;if(p){var h=null===(l=this._levels)||void 0===l?void 0:l.find((function(t){return t.persistentId===p}));if(h&&(null===(d=this._currentLevel)||void 0===d?void 0:d.persistentId)!==(null==h?void 0:h.persistentId)){this._currentLevel=h;var f=void 0!==h.audioGroupId?this._channelsByGroup[h.audioGroupId]:void 0;this._dispatcher.publish(lr.hlsLevelUpdated,{level:h,channels:f})}}},HlsJsVideoPlayer.prototype.handleHlsError=function(t,n){if(Mt.warn("HLS.js error",n),n.fatal)throw this._hls.destroy(),"output-restricted"===n.reason?new we(we.OUTPUT_RESTRICTED,n.reason):new we(we.UNSUPPORTED_ERROR,n.reason)},HlsJsVideoPlayer.prototype.handleManifestParsed=function(t,n){var l,d;this._levels=null!==(l=n.levels)&&void 0!==l?l:[],this.nowPlayingItem.state=kr.ready,this._channelsByGroup=(null!==(d=n.audioTracks)&&void 0!==d?d:[]).reduce((function(t,n){return t[n.groupId]=n.channels,t}),{}),asAsync(this._playMedia())},HlsJsVideoPlayer.prototype.handleKeyRequestStarted=function(t,n){Mt.debug("hlsjs-video.handleKeyRequestStarted"),this._hls.generateKeyRequest(n.keyuri,{})},HlsJsVideoPlayer.prototype.handleLicenseChallengeCreated=function(t,n){var l;return __awaiter(this,void 0,void 0,(function(){var t,d,p,h,f,y,v,g,m;return __generator(this,(function(_){switch(_.label){case 0:d=(t=this)._licenseServerUrl,p=t.nowPlayingItem,h=t._keySystem,f=t.userInitiated,_.label=1;case 1:return _.trys.push([1,3,,4]),[4,null===(l=this._license)||void 0===l?void 0:l.start(d,p,n,h,f)];case 2:return(null==(y=_.sent())?void 0:y.license)&&(v={statusCode:y.status},h===yt.FAIRPLAY?v.ckc=pe(y.license):v.license=pe(y.license),(g=y["renew-after"])&&(v.renewalDate=new Date(Date.now()+1e3*g)),this._hls.setLicenseResponse(n.keyuri,v)),[3,4];case 3:if(m=_.sent(),shouldThrowLicenseError(m,f))throw m;return this.onPlaybackLicenseError(m),[3,4];case 4:return[2]}}))}))},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],HlsJsVideoPlayer.prototype,"handleLevelSwitched",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],HlsJsVideoPlayer.prototype,"handleHlsError",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],HlsJsVideoPlayer.prototype,"handleManifestParsed",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],HlsJsVideoPlayer.prototype,"handleKeyRequestStarted",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],HlsJsVideoPlayer.prototype,"handleLicenseChallengeCreated",null),HlsJsVideoPlayer}(Lo),Ss=fr.mediaPlaybackError,As=mn.playbackLicenseError,ws=mn.playbackSessionError,Is=function(t){function NativeSafariVideoPlayer(){return null!==t&&t.apply(this,arguments)||this}return __extends(NativeSafariVideoPlayer,t),NativeSafariVideoPlayer.prototype.initializeExtension=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=new Yo(this.video,'video/mp4;codecs="avc1.42E01E"'),this.extension=t,[4,t.initializeKeySystem()];case 1:return n.sent(),t.addEventListener(As,this.onPlaybackLicenseError),t.addEventListener(ws,this.onPlaybackSessionError),[2]}}))}))},NativeSafariVideoPlayer.prototype.destroy=function(){Mt.debug("native-safari-video-player.destroy");var n=this.extension;n&&(n.removeEventListener(As,this.onPlaybackLicenseError),n.removeEventListener(ws,this.onPlaybackSessionError),this.video.removeEventListener("loadedmetadata",this.onMetadataLoaded),t.prototype.destroy.call(this))},NativeSafariVideoPlayer.prototype.playHlsStream=function(t){var n;return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){return Mt.debug("native-safari-video-player.playHlsStream",t),this.setupTrackManagers(),this.video.src=t,(l=this.nowPlayingItem)&&(null===(n=this.extension)||void 0===n||n.setMediaItem(l)),this.video.addEventListener("loadedmetadata",this.onMetadataLoaded),[2]}))}))},NativeSafariVideoPlayer.prototype.onPlaybackSessionError=function(t){this._dispatcher.publish(Ss,new we(we.MEDIA_SESSION,t))},NativeSafariVideoPlayer.prototype.onMetadataLoaded=function(){Mt.debug("native-safari-video-player.onMetadataLoaded");var t=this.nowPlayingItem;t&&(t.state=kr.ready),asAsync(this._playMedia())},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],NativeSafariVideoPlayer.prototype,"onPlaybackSessionError",null),__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],NativeSafariVideoPlayer.prototype,"onMetadataLoaded",null),NativeSafariVideoPlayer}(Lo),Es=function(){function Factory(t){this._playersByType={},this._playerOptions=t}return Factory.prototype.getPlayerForMediaItem=function(t,n,l){return __awaiter(this,void 0,void 0,(function(){var d,p,h,f,y;return __generator(this,(function(v){switch(v.label){case 0:if(Mt.debug("mk: getPlayerForMediaItem",t,n),d=getPlayerType(t),(null==(p=this._playersByType[d])?void 0:p.isDestroyed)&&(Mt.debug("mk: existingPlayer was previously destroyed. Removing from factory."),p=void 0,delete this._playersByType[d]),p&&p===l)return[2,l];if(p)return this._applyPlayerState(p,n),[2,p];switch(h=this._playerOptions,d){case"audio":return[3,1];case"video":return[3,2]}return[3,4];case 1:return f=new pa(h),this._playersByType[d]=f,[3,5];case 2:return[4,requiresHlsJs()];case 3:return y=v.sent(),f=y?new Ts(h):new Is(h),[3,5];case 4:throw new Error("Invalid player type requested: "+d);case 5:return[4,f.initialize()];case 6:return v.sent(),this._applyPlayerState(f,n),[2,f]}}))}))},Factory.prototype.destroy=function(){Object.values(this._playersByType).forEach((function(t){return t.destroy()}))},Factory.prototype._applyPlayerState=function(t,n){return n?(Mt.debug("_applyPlayerState",n),Object.keys(n).forEach((function(l){void 0!==t[l]&&(t[l]=n[l])})),t):t},Factory}(),Rs=fr.playerTypeDidChange,Cs=mn.playbackLicenseError,Os=function(){function MediaItemPlayback(t){this.playerState={playbackRate:1,volume:1},this.playOptions=new Map,this._previewOnly=!1,this._dispatcher=t.services.dispatcher,this._apiManager=t.services.apiManager,this._playerFactory=new Es(t),this._currentPlayer=new fa(t),this._dispatcher.subscribe(Cs,this.onPlaybackLicenseError)}return Object.defineProperty(MediaItemPlayback.prototype,"currentPlaybackTime",{get:function(){return this._currentPlayer.currentPlaybackTime},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentPlaybackTimeRemaining",{get:function(){return this._currentPlayer.currentPlaybackTimeRemaining},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"audioTracks",{get:function(){return this._currentPlayer.audioTracks},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentAudioTrack",{get:function(){return this._currentPlayer.currentAudioTrack},set:function(t){this._currentPlayer.currentAudioTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentPlaybackDuration",{get:function(){return this._currentPlayer.currentPlaybackDuration},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentBufferedProgress",{get:function(){return this._currentPlayer.currentBufferedProgress},set:function(t){this._currentPlayer.currentBufferedProgress=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentPlaybackProgress",{get:function(){return this._currentPlayer.currentPlaybackProgress},set:function(t){this._currentPlayer.currentPlaybackProgress=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"currentTextTrack",{get:function(){return this._currentPlayer.currentTextTrack},set:function(t){this._currentPlayer.currentTextTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"previewOnly",{get:function(){return this._previewOnly},set:function(t){this._previewOnly=t,this._currentPlayer&&(this._currentPlayer.previewOnly=t)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"formattedCurrentPlaybackDuration",{get:function(){return this._currentPlayer.formattedCurrentPlaybackDuration},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"isPlaying",{get:function(){return this._currentPlayer.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"isPrimaryPlayer",{get:function(){return this._currentPlayer.isPrimaryPlayer},set:function(t){this._currentPlayer.isPrimaryPlayer=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"isReady",{get:function(){return this._currentPlayer.isReady},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"nowPlayingItem",{get:function(){return this._currentPlayer.nowPlayingItem},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"playbackRate",{get:function(){return this._currentPlayer.playbackRate},set:function(t){this._updatePlayerState("playbackRate",t)},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"playbackState",{get:function(){return this._currentPlayer.playbackState},set:function(t){this._currentPlayer.playbackState=t},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"playbackTargetAvailable",{get:function(){return this._currentPlayer.playbackTargetAvailable},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"playbackTargetIsWireless",{get:function(){return this._currentPlayer.playbackTargetIsWireless},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"textTracks",{get:function(){return this._currentPlayer.textTracks},enumerable:!0,configurable:!0}),Object.defineProperty(MediaItemPlayback.prototype,"volume",{get:function(){return this._currentPlayer.volume},set:function(t){this._updatePlayerState("volume",t)},enumerable:!0,configurable:!0}),MediaItemPlayback.prototype.destroy=function(){var t;this._playerFactory.destroy(),null===(t=this._dispatcher)||void 0===t||t.unsubscribe(Cs,this.onPlaybackLicenseError)},MediaItemPlayback.prototype.exitFullscreen=function(){return this._currentPlayer.exitFullscreen()},MediaItemPlayback.prototype.getNewSeeker=function(){return this._currentPlayer.newSeeker()},MediaItemPlayback.prototype.mute=function(){this._volumeAtMute=this.volume,this.volume=0},MediaItemPlayback.prototype.pause=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this._currentPlayer.pause(t)]}))}))},MediaItemPlayback.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._currentPlayer.play()]}))}))},MediaItemPlayback.prototype.preload=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._currentPlayer.preload()]}))}))},MediaItemPlayback.prototype.prepareToPlay=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,prepareForEncryptedPlayback(t,this._currentPlayer,this._apiManager)]}))}))},MediaItemPlayback.prototype.requestFullscreen=function(t){return this._currentPlayer.requestFullscreen(t)},MediaItemPlayback.prototype.showPlaybackTargetPicker=function(){this._currentPlayer.showPlaybackTargetPicker()},MediaItemPlayback.prototype.seekToTime=function(t,n){return void 0===n&&(n=tn.Manual),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){switch(l.label){case 0:return[4,this._currentPlayer.seekToTime(t,n)];case 1:return l.sent(),[2]}}))}))},MediaItemPlayback.prototype.setPresentationMode=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this._currentPlayer.setPresentationMode(t)]}))}))},MediaItemPlayback.prototype.startMediaItemPlayback=function(t,n){var l,d,p;return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){var h,f,y,v,g,m=this;return __generator(this,(function(_){switch(_.label){case 0:return Mt.debug("MediaItemPlayback: startMediaItemPlayback",t),(null===(d=null===(l=t.container)||void 0===l?void 0:l.attributes)||void 0===d?void 0:d.requiresSubscription)?[4,hasMusicSubscription()]:[3,2];case 1:if(!(_.sent()||!1))throw(h=new we(we.SUBSCRIPTION_ERROR)).data=t,h;_.label=2;case 2:return[4,this._getPlayerForMediaItem(t)];case 3:return f=_.sent(),[4,this.setCurrentPlayer(f)];case 4:if(_.sent(),!(null===(p=this._currentPlayer)||void 0===p?void 0:p.hasMediaElement))return Mt.warn("MediaItemPlayback: Could not play media of type "+t.type+", marking item as unsupported and skipping."),t.notSupported(),[2];_.label=5;case 5:return _.trys.push([5,7,,8]),t.beginMonitoringStateDidChange((function(t){var n;return null===(n=m._dispatcher)||void 0===n?void 0:n.publish(fr.mediaItemStateDidChange,t)})),t.beginMonitoringStateWillChange((function(t){var n;return null===(n=m._dispatcher)||void 0===n?void 0:n.publish(fr.mediaItemStateWillChange,t)})),(y=this.playOptions.get(t.id))&&this.playOptions.delete(t.id),[4,playMediaItem(t,this._currentPlayer,n,this._apiManager,y)];case 6:return v=_.sent(),this._currentPlayback={item:t,userInitiated:n},[2,v];case 7:throw g=_.sent(),Mt.error(g),g;case 8:return[2]}}))}))},MediaItemPlayback.prototype.stop=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._currentPlayer.stop(t)];case 1:return n.sent(),[2]}}))}))},MediaItemPlayback.prototype.unmute=function(){this.volume>0||(this.volume=this._volumeAtMute||1,this._volumeAtMute=void 0)},MediaItemPlayback.prototype._getPlayerForMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return Mt.debug("MediaItemPlayback:  _getPlayerForMediaItem",t.id),[4,this._playerFactory.getPlayerForMediaItem(t,this.playerState,this._currentPlayer)];case 1:return(n=l.sent()).previewOnly=this._previewOnly,[2,n]}}))}))},MediaItemPlayback.prototype.setCurrentPlayer=function(t){var n;return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){switch(l.label){case 0:return this._currentPlayer===t?[2]:(Mt.debug("MediaItemPlayback: setting currentPlayer",t),[4,this._currentPlayer.stop()]);case 1:return l.sent(),this._currentPlayer=t,null===(n=this._dispatcher)||void 0===n||n.publish(Rs,{player:t}),[2]}}))}))},MediaItemPlayback.prototype.onPlaybackLicenseError=function(t,n){return __awaiter(this,void 0,void 0,(function(){var t,l,d;return __generator(this,(function(p){switch(p.label){case 0:return n.errorCode!==we.PLAYREADY_CBC_ENCRYPTION_ERROR?[3,3]:(Mt.warn("MediaItemPlayback: PLAYREADY_CBC_ENCRYPTION_ERROR...retrying with different key system"),[4,this.stop()]);case 1:return p.sent(),(t=this._currentPlayback)?(l=t.item,d=t.userInitiated,l.resetState(),[4,this.startMediaItemPlayback(l,d)]):[3,3];case 2:p.sent(),p.label=3;case 3:return[2]}}))}))},MediaItemPlayback.prototype._updatePlayerState=function(t,n){this.playerState[t]=n,this._currentPlayer[t]=n},__decorate([Bind(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",Promise)],MediaItemPlayback.prototype,"onPlaybackLicenseError",null),MediaItemPlayback}();!function(t){t.UTS="uts-api",t.MEDIA="media-api"}(ks||(ks={}));var Ms,Ds=function(){function APIServiceManager(t,n){this.store=t,this._dispatcher=n,this._apisByType={}}return Object.defineProperty(APIServiceManager.prototype,"api",{get:function(){return this.getApiByType(this._defaultAPI)},enumerable:!0,configurable:!0}),Object.defineProperty(APIServiceManager.prototype,"apiService",{get:function(){if(void 0!==this._defaultAPI)return this._apisByType[this._defaultAPI];Mt.error("There is no API instance configured")},enumerable:!0,configurable:!0}),Object.defineProperty(APIServiceManager.prototype,"mediaAPI",{get:function(){return this.getApiByType(ks.MEDIA)},enumerable:!0,configurable:!0}),Object.defineProperty(APIServiceManager.prototype,"utsAPI",{get:function(){return this.getApiByType(ks.UTS)},enumerable:!0,configurable:!0}),APIServiceManager.prototype.getApiByType=function(t){var n;if(void 0!==t&&(n=this._apisByType[t]),void 0===n||void 0===n.api)throw new we(we.CONFIGURATION_ERROR,"There is no API instance configured for the requested type: "+t);return n.api},Object.defineProperty(APIServiceManager.prototype,"defaultApiType",{set:function(t){this._defaultAPI=t},enumerable:!0,configurable:!0}),APIServiceManager.prototype.registerAPIService=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d,p,h,f;return __generator(this,(function(y){switch(y.label){case 0:return n=t.apiType,l=t.configureFn,d=t.options,p=d.apiOptions||{},void 0===this._defaultAPI&&(this._defaultAPI=n),h=this._apisByType,f=n,[4,l.call(this,{apiOptions:p,store:this.store,dispatcher:this._dispatcher})];case 1:return h[f]=y.sent(),[2]}}))}))},APIServiceManager}(),Ns=function(){function BitrateCalculator(n,l){var d,p;void 0===l&&(l=t.PlaybackBitrate.STANDARD),this._downlinkSamples=[],this._bitrate=l,this._dispatcher=n,void 0!==(null===(p=null===(d=null===window||void 0===window?void 0:window.navigator)||void 0===d?void 0:d.connection)||void 0===p?void 0:p.downlink)&&this._recalculateBitrate(100*(window.navigator.connection.downlink||0))}return Object.defineProperty(BitrateCalculator.prototype,"bitrate",{get:function(){return this._bitrate},set:function(t){this._bitrate!==t&&(this._bitrate=t,this._dispatcher.publish(fr.playbackBitrateDidChange,{bitrate:t}))},enumerable:!0,configurable:!0}),BitrateCalculator.prototype._calculateAverageDownlink=function(){return 0===this._downlinkSamples.length?0:this._downlinkSamples.reduce((function(t,n){return t+n}),0)/this._downlinkSamples.length||0},BitrateCalculator.prototype._recalculateBitrate=function(n){Mt.debug("_recalculateBitrate",n),this._downlinkSamples.push(n),this._calculateAverageDownlink()>t.PlaybackBitrate.STANDARD?(Mt.debug("setting bitrate to",t.PlaybackBitrate.HIGH),this.bitrate=t.PlaybackBitrate.HIGH):(Mt.debug("setting bitrate to",t.PlaybackBitrate.STANDARD),this.bitrate=t.PlaybackBitrate.STANDARD)},BitrateCalculator}();!function(t){t[t.ACCURATE=0]="ACCURATE",t[t.ROUND=1]="ROUND"}(Ms||(Ms={}));var Ls,xs=function(){function TimingAccuracy(t){void 0===t&&(t=!1),this.mode=t?Ms.ACCURATE:Ms.ROUND}return TimingAccuracy.prototype.time=function(t){return void 0===t&&(t=0),this.mode===Ms.ROUND?Math.round(t):t},TimingAccuracy}(),Us=[we.AGE_VERIFICATION,we.CONTENT_EQUIVALENT,we.CONTENT_RESTRICTED,we.CONTENT_UNAVAILABLE,we.CONTENT_UNSUPPORTED,we.SERVER_ERROR,we.SUBSCRIPTION_ERROR,we.UNSUPPORTED_ERROR];(Ls=t.PlaybackMode||(t.PlaybackMode={}))[Ls.PREVIEW_ONLY=0]="PREVIEW_ONLY",Ls[Ls.MIXED_CONTENT=1]="MIXED_CONTENT",Ls[Ls.FULL_PLAYBACK_ONLY=2]="FULL_PLAYBACK_ONLY";var Bs=function(){function MKInstance(n,l){if(void 0===l&&(l={}),this.privateEnabled=!1,this.siriInitiated=!1,this.sourceType=je.MUSICKIT,this.version="2.2104.3",this._bag=mr,this._playbackControllers={},this._playbackErrorDialog=!0,this._playbackMode=t.PlaybackMode.MIXED_CONTENT,this._whenConfigured=void 0,"string"!=typeof n)throw new Error("MusicKit was initialized without an developerToken.");Object.assign(mr.features,function(t){void 0===t&&(t=[]);var n={};return t.forEach((function(t){"-"===t.charAt(0)?(t=t.substr(1),n[t]=!1):n[t]=!0})),n}(l.features)),this.context={};var d=new Ke;this.capabilities=new va(d);var p=new xs(!!mr.features["player-accurate-timing"]),h=new Ns(d,l.bitrate);this._services={dispatcher:d,timing:p,bitrateCalculator:h},void 0!==l.playActivityAPI&&(this._services.playActivity=new Lr(l.playActivityAPI,d)),l.services=this._services,this._configureLogger(l),mr.app=l.app||{},mr.store=new Pe({filter:getFilterFromFlags(l.storeFilterTypes||[])}),Object.assign(mr.urls,l.urls||{});var f=function(t,n){return vr=new _r(t,n)}(n,l);this._services.apiManager=new Ds(f,d);var y=new Os(this._createPlayerControllerOptions());if(this._services.mediaItemPlayback=y,l.sourceType&&(this.sourceType=l.sourceType),this._initializeEventHandling(),l.bitrate&&(this.bitrate=l.bitrate),l.prefix&&/^(?:web|preview)$/.test(l.prefix)&&(this.prefix=mr.prefix=l.prefix),l.suppressErrorDialog&&(this._playbackErrorDialog=!l.suppressErrorDialog),void 0!==l.playbackMode&&(this.playbackMode=l.playbackMode),this.privateEnabled=l.privateEnabled||!1,this.siriInitiated=l.siriInitiated||!1,this.id=generateUUID(),Mt.log("MusicKit JS Version: "+this.version),Mt.debug("Link Parameters",l.linkParameters),Mt.log("InstanceId",this.id),mr.app&&Mt.debug("App",mr.app),l.userToken){var v=l.userToken;"function"==typeof v?vr.dynamicMusicUserToken=v:this.musicUserToken=v}}return Object.defineProperty(MKInstance.prototype,"developerToken",{get:function(){return vr.developerToken},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"api",{get:function(){return this._services.apiManager.api},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"audioTracks",{get:function(){return this._mediaItemPlayback.audioTracks},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"authorizationStatus",{get:function(){return vr.authorizationStatus},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"bitrate",{get:function(){return this._services.bitrateCalculator.bitrate},set:function(t){this._services.bitrateCalculator.bitrate=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"browserSupportsPictureInPicture",{get:function(){return function(){if(Rt)return Mt.warn("dom-helpers: Browser checks are not supported in Node environments"),!1;var t=Dt,n=t&&t.webkitSupportsPresentationMode&&"function"==typeof t.webkitSetPresentationMode,l=document.pictureInPictureEnabled;return!(!n&&!l)}()},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"browserSupportsVideoDrm",{get:function(){return supportsDrm()},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"cid",{get:function(){return(2===this.realm||this.sourceType!==je.MUSICKIT)&&vr.cid},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"continuous",{get:function(){return this._playbackController.continuous},set:function(t){this._playbackController.continuous=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentAudioTrack",{get:function(){return this._mediaItemPlayback.currentAudioTrack},set:function(t){this._mediaItemPlayback.currentAudioTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentPlaybackDuration",{get:function(){return this._mediaItemPlayback.currentPlaybackDuration},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentPlaybackProgress",{get:function(){return this._mediaItemPlayback.currentPlaybackProgress},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentPlaybackTime",{get:function(){return this._mediaItemPlayback.currentPlaybackTime},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentPlaybackTimeRemaining",{get:function(){return this._mediaItemPlayback.currentPlaybackTimeRemaining},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"currentTextTrack",{get:function(){return this._mediaItemPlayback.currentTextTrack},set:function(t){this._mediaItemPlayback.currentTextTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"isAuthorized",{get:function(){return vr.isAuthorized},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"isPlaying",{get:function(){return this._playbackController.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"isRestricted",{get:function(){return vr.isRestricted},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"musicUserToken",{get:function(){return vr.musicUserToken},set:function(t){t&&vr.musicUserToken===t||(vr.musicUserToken=t)},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"needsGDPR",{get:function(){return vr.needsGDPR},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"nowPlayingItem",{get:function(){return this._mediaItemPlayback.nowPlayingItem},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"nowPlayingItemIndex",{get:function(){return this._playbackController.nowPlayingItemIndex},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"playbackMode",{get:function(){return this._playbackMode},set:function(n){if(-1!==Object.values(t.PlaybackMode).indexOf(n)){this._playbackMode=n;var l=n===t.PlaybackMode.PREVIEW_ONLY,d=this._services.mediaItemPlayback;d&&(d.previewOnly=l)}},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"playbackRate",{get:function(){return this._mediaItemPlayback.playbackRate},set:function(t){this._mediaItemPlayback.playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"playbackState",{get:function(){return this._mediaItemPlayback.playbackState},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"playbackTargetAvailable",{get:function(){return this._mediaItemPlayback.playbackTargetAvailable},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"playbackTargetIsWireless",{get:function(){return this._mediaItemPlayback.playbackTargetIsWireless},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"previewOnly",{get:function(){return this.playbackMode===t.PlaybackMode.PREVIEW_ONLY},set:function(n){this.playbackMode=n?t.PlaybackMode.PREVIEW_ONLY:t.PlaybackMode.MIXED_CONTENT},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"queue",{get:function(){return this._playbackController.queue},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"queueIsEmpty",{get:function(){return this._playbackController.queue.isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"realm",{get:function(){return vr.realm},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"repeatMode",{get:function(){return this._playbackController.repeatMode},set:function(t){this._playbackController.repeatMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"requestUserToken",{set:function(t){vr.requestUserToken=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"restrictedEnabled",{get:function(){return vr.restrictedEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"seekSeconds",{get:function(){return this._playbackController.seekSeconds},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"services",{get:function(){return this._services},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"shuffle",{set:function(t){this._playbackController.shuffle=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"shuffleMode",{get:function(){return this._playbackController.shuffleMode},set:function(t){this._playbackController.shuffleMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"storefrontCountryCode",{get:function(){return vr.storefrontCountryCode},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"subscribeURL",{get:function(){return vr.subscribeURL},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"subscribeFamilyURL",{get:function(){return vr.subscribeFamilyURL},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"subscribeIndividualURL",{get:function(){return vr.subscribeIndividualURL},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"subscribeStudentURL",{get:function(){return vr.subscribeStudentURL},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"textTracks",{get:function(){return this._mediaItemPlayback.textTracks},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"videoContainerElement",{get:function(){return this.context.videoContainerElement},set:function(t){this.context.videoContainerElement=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"volume",{get:function(){return this._mediaItemPlayback.volume},set:function(t){this._mediaItemPlayback.volume=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"storefrontId",{get:function(){return vr.storefrontId},set:function(t){vr.storefrontId=t},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"_mediaItemPlayback",{get:function(){return this._services.mediaItemPlayback},enumerable:!0,configurable:!0}),Object.defineProperty(MKInstance.prototype,"_playbackController",{get:function(){if(void 0!==this._playbackControllerInternal)return this._playbackControllerInternal;Mt.debug("setting _playbackController");var t=this._getPlaybackControllerByType(Ga.serial);return this._playbackController=t,t},set:function(t){this._playbackControllerInternal=t,this._playbackControllerInternal.activate(),this.capabilities.updateChecker(this._playbackControllerInternal.hasCapabilities),this.capabilities.controller=this._playbackControllerInternal},enumerable:!0,configurable:!0}),MKInstance.prototype.addEventListener=function(t,n,l){void 0===l&&(l={}),adaptAddEventListener(this._services.dispatcher,t,n,l)},MKInstance.prototype.authorize=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.deferPlayback(),[2,vr.authorize()]}))}))},MKInstance.prototype.canAuthorize=function(){return supportsDrm()&&!this.isAuthorized},MKInstance.prototype.canUnauthorize=function(){return supportsDrm()&&this.isAuthorized},MKInstance.prototype.changeToMediaAtIndex=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:return n.sent(),this._signalChangeItemIntent(),[4,this._playbackController.changeToMediaAtIndex(t)];case 2:return n.sent(),[2]}}))}))},MKInstance.prototype.changeToMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return Mt.debug("instance.changeToMediaItem",t),this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:return n.sent(),this._signalChangeItemIntent(),[4,this._playbackController.changeToMediaItem(t)];case 2:return n.sent(),[2]}}))}))},MKInstance.prototype.changeUserStorefront=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this.storefrontId=t,[2]}))}))},MKInstance.prototype.cleanup=function(){var n;return __awaiter(this,void 0,void 0,(function(){var l,d,p=this;return __generator(this,(function(h){switch(h.label){case 0:null===(n=this._services.mediaItemPlayback)||void 0===n||n.destroy(),this._signalIntent({endReasonType:t.PlayActivityEndReasonType.EXITED_APPLICATION}),l=Object.keys(this._playbackControllers).map((function(t){return p._playbackControllers[t].destroy()})),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.all(l)];case 2:return h.sent(),[3,4];case 3:return d=h.sent(),Mt.error("Error cleaning up controller",d),[3,4];case 4:return this._services.dispatcher.clear(),[2]}}))}))},MKInstance.prototype.configure=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this._whenConfigured=this._configure(t),[2,this._whenConfigured]}))}))},MKInstance.prototype._configure=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return[4,vr.storekit.whenAuthCompleted];case 1:return l.sent(),n=t.map(this._services.apiManager.registerAPIService,this._services.apiManager),[4,Promise.all(n)];case 2:return l.sent(),[4,this._configurePlayActivity()];case 3:return l.sent(),[2]}}))}))},MKInstance.prototype.deferPlayback=function(){Mt.debug("deferPlayback",this._playbackControllerInternal),deferPlayback()},MKInstance.prototype.getApiByType=function(t){var n;return null===(n=this._services.apiManager)||void 0===n?void 0:n.getApiByType(t)},MKInstance.prototype.me=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,vr.storekit.me()];case 1:return[2,t.sent()];case 2:return t.sent(),[2,Promise.reject(new we(we.AUTHORIZATION_ERROR,"Unauthorized"))];case 3:return[2]}}))}))},MKInstance.prototype.musicSubcriptionOffers=function(){return vr.storekit.musicSubscriptionOffers(this.storefrontId)},MKInstance.prototype.hasMusicSubscription=function(){return hasMusicSubscription(vr.storekit)},MKInstance.prototype.mute=function(){return this._mediaItemPlayback.mute()},MKInstance.prototype.pause=function(n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:if(!this._isPlaybackSupported())return[2];d.label=1;case 1:return d.trys.push([1,3,,4]),this._signalIntent({endReasonType:t.PlayActivityEndReasonType.PLAYBACK_MANUALLY_PAUSED}),[4,this._playbackController.pause(n)];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),this._handlePlaybackError(l),[3,4];case 4:return[2,Promise.resolve()]}}))}))},MKInstance.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return Mt.debug("instance.play()"),this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this._playbackController.play()];case 3:return n.sent(),[3,5];case 4:return t=n.sent(),this._handlePlaybackError(t),[3,5];case 5:return[2,Promise.resolve()]}}))}))},MKInstance.prototype.playMediaItem=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return Mt.debug("mk: playMediaItem",t),this.deferPlayback(),[2,this._playbackController.playSingleMediaItem(t)]}))}))},MKInstance.prototype.playNext=function(t,n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this._isPlaybackSupported()?this._playbackController.queue?(this.deferPlayback(),[2,this._playbackController.prepend(t,n)]):[2,this.setQueue(t)]:[2]}))}))},MKInstance.prototype.playLater=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this._isPlaybackSupported()?this._playbackController.queue?(this.deferPlayback(),[2,this._playbackController.append(t)]):[2,this.setQueue(t)]:[2]}))}))},MKInstance.prototype.clearQueue=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this._playbackController.clear()]}))}))},MKInstance.prototype.removeEventListener=function(t,n){!function(t,n,l){for(var d,p=getCallbacksForName(n),h=p.length-1;h>=0;h--){var f=__read(p[h],2),y=f[0],v=f[1];if(y===l){d=v,p.splice(h,1);break}}d&&t.unsubscribe(n,d)}(this._services.dispatcher,t,n)},MKInstance.prototype.shouldDisplayPrivacyLink=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,vr.shouldDisplayPrivacyLink(t)]}))}))},MKInstance.prototype.exitFullscreen=function(){return this._mediaItemPlayback.exitFullscreen()},MKInstance.prototype.requestFullscreen=function(t){return this._mediaItemPlayback.requestFullscreen(t)},MKInstance.prototype.getNewSeeker=function(){return this._playbackController.getNewSeeker()},MKInstance.prototype.seekToTime=function(t,n){return void 0===n&&(n=tn.Manual),__awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:d.sent(),d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this._playbackController.seekToTime(t,n)];case 3:return d.sent(),[3,5];case 4:return l=d.sent(),this._handlePlaybackError(l),[3,5];case 5:return[2,Promise.resolve()]}}))}))},MKInstance.prototype.setQueue=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return Mt.debug("instance.setQueue()",t),this._isPlaybackSupported()?this._isStationQueueOptions(t)?(Mt.warn("setQueue options contained a station queue request. Changing to setStationQueue mode."),[2,this.setStationQueue(t)]):(this._signalChangeItemIntent(),this.deferPlayback(),[4,this._updatePlaybackController(this._getPlaybackControllerByType(Ga.serial))]):(Mt.warn("Playback is not supported"),[2]);case 1:return l.sent(),[4,this._playbackController.setQueue(t)];case 2:return n=l.sent(),void 0!==t.repeatMode&&(this._playbackController.repeatMode=t.repeatMode),t.autoplay?[4,this.play()]:[3,4];case 3:l.sent(),l.label=4;case 4:return[2,n]}}))}))},MKInstance.prototype.setStationQueue=function(t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization(!0)]:[2];case 1:return l.sent(),this._signalChangeItemIntent(),this.deferPlayback(),parseQueueURLOption(t),[4,this._updatePlaybackController(this._getPlaybackControllerByType(Ga.continuous))];case 2:return l.sent(),n=this._playbackController.setQueue(t),t.autoplay?[4,this.play()]:[3,4];case 3:l.sent(),l.label=4;case 4:return[2,n]}}))}))},MKInstance.prototype.setPresentationMode=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,this._mediaItemPlayback.setPresentationMode(t)]}))}))},MKInstance.prototype.skipToNextItem=function(){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:l.sent(),this._signalIntent({endReasonType:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,direction:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS}),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this._playbackController.skipToNextItem()];case 3:return l.sent(),[3,5];case 4:return n=l.sent(),this._handlePlaybackError(n),[3,5];case 5:return[2]}}))}))},MKInstance.prototype.skipToPreviousItem=function(){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:l.sent(),this._signalIntent({endReasonType:t.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS,direction:t.PlayActivityEndReasonType.TRACK_SKIPPED_BACKWARDS}),l.label=2;case 2:return l.trys.push([2,4,,5]),[4,this._playbackController.skipToPreviousItem()];case 3:return l.sent(),[3,5];case 4:return n=l.sent(),this._handlePlaybackError(n),[3,5];case 5:return[2]}}))}))},MKInstance.prototype.seekForward=function(){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(l){switch(l.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:l.sent(),l.label=2;case 2:return l.trys.push([2,4,,5]),this._signalIntent({endReasonType:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS,direction:t.PlayActivityEndReasonType.TRACK_SKIPPED_FORWARDS}),[4,this._playbackController.seekForward()];case 3:return l.sent(),[3,5];case 4:return n=l.sent(),this._handlePlaybackError(n),[3,5];case 5:return[2]}}))}))},MKInstance.prototype.seekBackward=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return this._isPlaybackSupported()?[4,this._validateAuthorization()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this._playbackController.seekBackward()];case 3:return n.sent(),[3,5];case 4:return t=n.sent(),this._handlePlaybackError(t),[3,5];case 5:return[2]}}))}))},MKInstance.prototype.showPlaybackTargetPicker=function(){this._playbackController.showPlaybackTargetPicker()},MKInstance.prototype.stop=function(t){var n;return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:if(!this._isPlaybackSupported())return[2];this._signalIntent({endReasonType:null==t?void 0:t.endReasonType,userInitiated:null===(n=null==t?void 0:t.userInitiated)||void 0===n||n}),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this._playbackController.stop(t)];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),this._handlePlaybackError(l),[3,4];case 4:return[2]}}))}))},MKInstance.prototype.resetSubscribeViewEligibility=function(){vr.storekit.resetSubscribeViewEligibility()},MKInstance.prototype.unauthorize=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,vr.unauthorize()]}))}))},MKInstance.prototype.unmute=function(){return this._mediaItemPlayback.unmute()},MKInstance.prototype._createPlayerControllerOptions=function(){return{services:this._services,context:this.context,privateEnabled:this.privateEnabled,siriInitiated:this.siriInitiated,storekit:null==vr?void 0:vr.storekit}},MKInstance.prototype._getPlaybackControllerByType=function(t){var n,l=this._playbackControllers[t];if(l)return l;switch(t){case Ga.serial:n=new hs(this._createPlayerControllerOptions());break;case Ga.continuous:n=new ss(this._createPlayerControllerOptions());break;default:throw new we(we.UNSUPPORTED_ERROR,"Unsupported controller requested: "+t)}return this._playbackControllers[t]=n,n},MKInstance.prototype._handlePlaybackError=function(t){if(Mt.error("mediaPlaybackError",t),Us.includes(t.name))throw t;this._playbackErrorDialog&&!Rt&&It.presentError(t)},MKInstance.prototype._initializeEventHandling=function(){var n=this;[fr.authorizationStatusDidChange,fr.needsGDPRDidChange,fr.storefrontCountryCodeDidChange,fr.storefrontIdentifierDidChange,fr.userTokenDidChange,fr.eligibleForSubscribeView].forEach((function(t){vr.storekit.addEventListener(t,(function(l){return n._services.dispatcher.publish(t,l)}))})),vr.storekit.addEventListener(fr.userTokenDidChange,(function(){n._whenConfigured&&n._whenConfigured.then((function(){n._configurePlayActivity().catch()})).catch()})),this._services.dispatcher.subscribe(fr.mediaPlaybackError,(function(t,l){return n._handlePlaybackError(l)})),this._services.dispatcher.subscribe(fr.playbackStateDidChange,(function(l,d){d.state===t.PlaybackStates.paused&&(Mt.debug("mk: playbackStateDidChange callback - calling storekit.presentSubscribeViewForEligibleUsers"),vr.storekit.presentSubscribeViewForEligibleUsers({state:d.state,item:n.nowPlayingItem},!1))}))},MKInstance.prototype._configureLogger=function(t){t.debug&&(Mt.enabled=!0,Mt.level=parseInt(t.logLevel,10)||1)},MKInstance.prototype._configurePlayActivity=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return void 0===this._services.playActivity?[2]:[4,this._services.playActivity.configure(this,{services:this._services})];case 1:return t.sent(),[2]}}))}))},MKInstance.prototype._isPlaybackSupported=function(){return!Rt||(Mt.warn("Media playback is not supported in Node environments."),!1)},MKInstance.prototype._isStationQueueOptions=function(t){return parseQueueURLOption(t),!(!function(t){return!!t&&(!!isLiveQueue(t)||(!!isQueueURLOption(t)||Object.keys(Za).some((function(n){return void 0!==t[n]}))))}(t)||function(t){return!!t&&(!!isQueueURLOption(t)||(!!isQueueItems(t)||Object.keys(us).concat(Object.keys(cs)).some((function(n){return void 0!==t[n]}))))}(t))},MKInstance.prototype._updatePlaybackController=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return Mt.debug("mk: _updatePlaybackController",t),this._playbackControllerInternal===t?[2]:this._playbackControllerInternal?[4,this._playbackControllerInternal.deactivate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this._playbackController=t,[2]}}))}))},MKInstance.prototype._signalChangeItemIntent=function(){this._signalIntent({endReasonType:t.PlayActivityEndReasonType.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM})},MKInstance.prototype._signalIntent=function(t){this.services.dispatcher.publish(lr.userActivityIntent,__assign({userInitiated:!0},t))},MKInstance.prototype._validateAuthorization=function(n){return void 0===n&&(n=!1),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){switch(l.label){case 0:return n||this.playbackMode===t.PlaybackMode.FULL_PLAYBACK_ONLY?void 0!==this._playbackControllerInternal&&this._playbackControllerInternal.isReady?[3,2]:[4,this.authorize()]:[2];case 1:l.sent(),l.label=2;case 2:return[2]}}))}))},MKInstance}(),js="undefined"!=typeof window&&"undefined"!=typeof document,Fs=!1,Ks=[];function cleanupInstances(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=Ks.map((function(t){return t.cleanup()})),[4,Promise.all(t)];case 1:return n.sent(),Ks=[],[2]}}))}))}function dispatchDocumentEvent(t){if(!Rt){var n=document.createEvent("Event");n.initEvent(t,!0,!0),setTimeout((function(){return document.dispatchEvent(n)}))}}function configure$1(t,n){return void 0===n&&(n=Bs),__awaiter(this,void 0,void 0,(function(){var l,d,p,h;return __generator(this,(function(f){switch(f.label){case 0:if(!t)throw new we(we.INVALID_ARGUMENTS,"configuration required");if(l={},d=t.developerToken,p=t.mergeQueryParams,!d)throw new we(we.CONFIGURATION_ERROR,"Missing developer token");return p&&js&&window.location&&(l.linkParameters=__assign(__assign({},t.linkParameters||{}),parseQueryParams(window.location.href))),[4,findKeySystemPreference()];case 1:return f.sent(),h=new n(d,__assign(__assign({},t),l)),Fs?[3,3]:[4,cleanupInstances()];case 2:f.sent(),f.label=3;case 3:return Ks.push(h),dispatchDocumentEvent(fr.configured),[2,h]}}))}))}if(js){dispatchDocumentEvent(fr.loaded);var Vs=function(){function meta(t){if(!Rt){var n=document.head.querySelector("meta[name="+t+"]");return(null==n?void 0:n.content)||void 0}}var t,n=meta("apple-music-developer-token")||meta("JWT"),l=meta("apple-music-app-build")||meta("version"),d=meta("apple-music-app-name"),p=meta("apple-music-app-version");return(n||l||d||p)&&(t={},n&&(t.developerToken=n),(l||d||p)&&(t.app={},l&&(t.app.build=l),d&&(t.app.name=d),p&&(t.app.version=p))),t}(),$s=/interactive|complete|loaded/.test(document.readyState);Vs&&Vs.developerToken&&!$s&&0===Ks.length&&(Vs.declarativeMarkup=!0,document.addEventListener("DOMContentLoaded",(function(){return configure$1(Vs)})))}var Hs={HIDE:"none",SHOW:""},zs=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,16)},Ws=function(){function DOMSupport(t,n){var l=this;if(void 0===n&&(n=Hs),this.elements=t,this.classes=n,Rt||"function"!=typeof MutationObserver||!t)return this.elements=void 0,void(this.identifiers=[]);this.identifiers=Object.keys(t),this.identifiers.forEach((function(n){for(var d=l._nodesForDefinitionId(n),p=0;p<d.length;++p){var h=d[p];l.attach(h,t[n])}})),new MutationObserver(this._mutationDidOccur.bind(this)).observe(document.body,{attributes:!0,childList:!0,subtree:!0})}return DOMSupport.prototype.attach=function(t,n){void 0===n&&(n=this.elements[t.id]),!t.innerText&&n.defaultText&&(t.innerText=n.defaultText),n.click&&t.addEventListener("mouseup",n.click),this._renderDefinition(t,n)},DOMSupport.prototype.detach=function(t,n){void 0===n&&(n=this.elements[t.id]),n&&n.click&&t.removeEventListener("mouseup",n.click)},DOMSupport.prototype.update=function(t){var n=this;void 0===t&&(t=this.identifiers),this.elements&&zs((function(){t.forEach((function(t){for(var l=n.elements[t],d=n._nodesForDefinitionId(t),p=0;p<d.length;++p){var h=d[p];l&&h&&n._renderDefinition(h,l)}}))}))},DOMSupport.prototype._mutationDidOccur=function(t){var n=this;t.forEach((function(t){if("attributes"===t.type){var l=n.elements[t.attributeName];l&&n.attach(t.target,l)}for(var _loop_1=function(l){var d=t.addedNodes[l];if(!d.id&&!d.dataset)return"continue";d.id&&n.elements[d.id]&&n.attach(d,n.elements[d.id]),n.identifiers.forEach((function(t){d.getAttribute(t)&&n.attach(d,n.elements[t])}))},d=0;d<t.addedNodes.length;++d)_loop_1(d);for(var _loop_2=function(l){var d=t.removedNodes[l];if(!d.id&&!d.dataset)return"continue";d.id&&n.elements[d.id]&&n.detach(d,n.elements[d.id]),n.identifiers.forEach((function(t){d.getAttribute(t)&&n.detach(d,n.elements[t])}))},p=0;p<t.removedNodes.length;++p)_loop_2(p)}))},DOMSupport.prototype._nodesForDefinitionId=function(t){var n=/^data-/.test(t)?"["+t+"]":"#"+t;return document.querySelectorAll(n)},DOMSupport.prototype._renderDefinition=function(t,n){var l=this,d="function"==typeof n.enabled?n.enabled(t):n.enabled||!0,p="function"==typeof n.display?n.display(t):n.display||!0;zs((function(){d?t.removeAttribute("disabled"):t.setAttribute("disabled",!0),t.style.display=p?l.classes.SHOW:l.classes.HIDE,p&&0===t.children.length&&n.content&&(t.innerText=n.content(t))}))},DOMSupport}(),Ys="apple-music-now-playing";function isPlayingContainerOrItem(t,n){if(!t||!n)return!1;if(br.test(t)){var l=formattedMediaURL(t).contentId;l&&(t=l)}return t===n.id||n.container&&n.container.id===t}var ChunkedIdApi=function(t,n){return void 0===n&&(n=1e3),function(l,d,p){if(void 0===p||"function"!=typeof p.value)throw new TypeError("Only methods can be decorated with @ChunkedIdApi, but "+d+" is not a method.");return{configurable:!0,get:function(){var l=p.value;function chunkedIdApi(){for(var d=[],p=0;p<arguments.length;p++)d[p]=arguments[p];return __awaiter$4(this,void 0,void 0,(function(){var p,h,f,y,v,g,m,_,b,P,k,T,S,A;return __generator$4(this,(function(w){switch(w.label){case 0:if(!(p=d[t])||!Array.isArray(p))return[3,2];if(h=p[0].length||20,f=Math.floor(n/h),!((y=Math.ceil(p.length/f))>1))return[3,2];for(v=d.slice(0,t),g=d.slice(t+1),m=[],_=0,b=1;b<=y;b++)P=Math.min(b*f,p.length),k=p.slice(_,P),T=__spread$4(v,[k],g),m.push(l.apply(this,T)),_+=f;return[4,Promise.all(m)];case 1:return S=w.sent(),[2,(A=[]).concat.apply(A,S)];case 2:return[2,l.apply(this,d)]}}))}))}return Object.defineProperty(this,d,{value:chunkedIdApi,configurable:!0,writable:!0}),chunkedIdApi}}}};function transformParameters(t,n){if(void 0===n&&(n=25),t)return t.limit&&(t.limit=t.limit>n?n:t.limit),t}function transformStoreData(t){var n=Object.assign({},t),l=n.href;return void 0!==l&&(delete n.href,n.attributes=ja(ja({},n.attributes),{href:l})),n}function transformTrackParameters(t){return t.map((function(t){return"string"==typeof t?{id:t,type:"songs"}:{id:t.id,type:t.type||"songs"}}))}function transformDescriptorsToIdMap(t){var n,l,d={};if(!t)return d;try{for(var p=function(t){var n="function"==typeof Symbol&&t[Symbol.iterator],l=0;return n?n.call(t):{next:function(){return t&&l>=t.length&&(t=void 0),{value:t&&t[l++],done:!t}}}}(t),h=p.next();!h.done;h=p.next()){var f=h.value;if(f){var y=f.type,v=f.id;y in d||(d[y]=[]),d[y].push(v)}}}catch(g){n={error:g}}finally{try{h&&!h.done&&(l=p.return)&&l.call(p)}finally{if(n)throw n.error}}return d}var qs=["extend","include","l","platform","views"],Gs=function(){function LocalDataStore(t){void 0===t&&(t={}),this.enableDataStore=!1,t.features&&t.features.hasOwnProperty("api-data-store")&&(this.enableDataStore=!!t.features["api-data-store"]),this.enableDataStore&&(this._store=t.store||new Pe,this._store.mapping=transformStoreData)}return Object.defineProperty(LocalDataStore.prototype,"hasDataStore",{get:function(){return this.enableDataStore&&void 0!==this._store},enumerable:!0,configurable:!0}),LocalDataStore.prototype.delete=function(t,n){this.hasDataStore&&this._store.remove(t,n)},LocalDataStore.prototype.read=function(t,n,l,d){d||"function"!=typeof l||(d=l,l=void 0);var p={},h=!1;if(l&&(h=Object.keys(l).some((function(t){return/^(fields|extend)/.test(t)})),l.views&&(p.views=l.views),l.include&&(p.relationships=l.include)),this.hasDataStore&&!h){var f=[];l&&(f=Object.keys(l).reduce((function(t,n){return-1===qs.indexOf(n)&&t.push([n,l[n]]),t}),f));var y=void 0;if(y=f&&1===f.length?this._store.query(f[0][0],f[0][1]):this._store.peek(t,n,p),Array.isArray(y)){if(!l&&y.length)return y}else if(y)return y}if("function"==typeof d)return d()},LocalDataStore.prototype.write=function(t){var n=this;return this._prepareDataForDataStore(t,(function(t){return n._store.save(t)}))},LocalDataStore.prototype.parse=function(t){var n=this;return this._prepareDataForDataStore(t,(function(t){return n._store.populateDataRecords(t,{})}))},LocalDataStore.prototype._prepareDataForDataStore=function(t,n){return this.hasDataStore?Array.isArray(t)?n({data:t}):Object.keys(t).reduce((function(l,d){var p=t[d];return p.hasOwnProperty("data")&&(l[d]=n({data:p.data})),"meta"===d&&(l[d]=t[d]),l}),{}):t},LocalDataStore}();function dasherize(t){return t.replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}function makeAlbumKey(t){var n;return(null===(n=t.artwork)||void 0===n?void 0:n.url)+"ï£¿"+t.artistName+"ï£¿"+t.name}var Qs,Js,Xs=function(){function ServerLedger(t,n,l){this._data=this._initData(),this._catalogApi=n,this._storageKey="ï£¿ï£¿mk-server-ledger:"+(t||""),this._sessionStorage=l||("undefined"!=typeof sessionStorage?sessionStorage:void 0),this.load()}return ServerLedger.prototype._initData=function(){return{lastTimestamp:0,albums:{added:Object.create(null),removed:Object.create(null)},playlists:{added:Object.create(null),removed:Object.create(null)}}},ServerLedger.prototype._checkTimestamp=function(){var t=this._data.lastTimestamp;t&&t+24e5<Date.now()&&(this._data=this._initData(),this._sessionStorage&&this._sessionStorage.removeItem(this._storageKey))},ServerLedger.prototype.added=function(t){var n=this;this.load();var l=null==t?void 0:t.playlists,d=null==t?void 0:t.albums;return l||d?(l&&l.forEach((function(t){var l=Date.now();n._data.playlists.added[t]=l,n._data.lastTimestamp=l})),d&&d.forEach((function(t){var l=Date.now();n._data.albums.added[t]=l,n._data.lastTimestamp=l})),this.save(),t):t},ServerLedger.prototype.removed=function(t){var n=this;this.load();var l=null==t?void 0:t.playlists;return l?(ensureArray(l).forEach((function(t){if(0!==t.indexOf("pl.")){var l=Date.now();n._data.playlists.removed[t]=l,n._data.lastTimestamp=l}})),this.save(),t):t},ServerLedger.prototype.reconcile=function(t,n,l,d,p){var h,f;return __awaiter$4(this,void 0,void 0,(function(){var p,y,v,g,m,_,b,P,k,T,S,A,w,I,E,R,C,O,M=this;return __generator$4(this,(function(D){switch(D.label){case 0:if(this._checkTimestamp(),!(p=n.data||n)||!Array.isArray(p)||Array.isArray(l))return[2,n];if(y=this._data.albums.added,v=this._data.playlists.removed,g=this._data.playlists.added,m=[],_=d&&!d.offset||!!l&&(void 0===l.offset||0===l.offset),b=!1,"all"!==t&&"playlists"!==t)return[3,2];for(w=p.length-1;w>=0;w--)I=p[w],E=null===(h=I.playParams)||void 0===h?void 0:h.globalId,"library-playlists"===I.type&&(v[I.id]?p.splice(w,1):E&&g[E]&&(delete g[E],b=!0,_||p.splice(w,1)));return _&&this._catalogApi&&(P=Object.keys(g)).length?[4,this._catalogApi.playlists(P)]:[3,2];case 1:k=D.sent(),m.splice.apply(m,__spread$4([0,0],k)),D.label=2;case 2:return!this._catalogApi||"all"!==t&&"albums"!==t?[3,4]:(T=Object.keys(y)).length?[4,this._catalogApi.albums(T)]:[3,4];case 3:for(S=D.sent(),A=Object.create(null),S.forEach((function(t,n){var l=makeAlbumKey(t);A[l]={catalogId:T[n],album:t}})),w=p.length-1;w>=0;w--)I=p[w],E=null===(f=I.playParams)||void 0===f?void 0:f.globalId,"library-albums"===I.type&&(R=makeAlbumKey(I),(C=A[R])&&(delete y[C.catalogId],b=!0,_?delete A[R]:p.splice(w,1)));_&&(O=Object.keys(A).map((function(t){return A[t].album}))).length&&m.splice.apply(m,__spread$4([0,0],O)),D.label=4;case 4:return b&&this.save(),_&&m.length&&(m.sort((function(t,n){var l=M._data.albums.added[t.id]||M._data.playlists.added[t.id]||0;return(M._data.albums.added[n.id]||M._data.playlists.added[n.id]||0)-l})),p.splice.apply(p,__spread$4([0,0],m))),[2,n]}}))}))},ServerLedger.prototype.load=function(){if(this._sessionStorage){var t=this._sessionStorage.getItem(this._storageKey);if(t)try{this._data=JSON.parse(t),this._data.albums&&this._data.playlists||(this._data=this._initData())}catch(e){this._data||(this._data=this._initData())}else this._data=this._initData()}},ServerLedger.prototype.save=function(){if(this._sessionStorage){var t=this._data,n=0===Object.keys(t.albums.added).length&&0===Object.keys(t.albums.removed).length&&0===Object.keys(t.playlists.added).length&&0===Object.keys(t.playlists.removed).length;try{if(n)this._sessionStorage.getItem(this._storageKey)&&this._sessionStorage.removeItem(this._storageKey);else{var l=JSON.stringify(this._data);this._sessionStorage.setItem(this._storageKey,l)}}catch(e){}}},ServerLedger}(),Zs="me/library",eu=function(t){function Library(n,l,d,p,h,f){void 0===p&&(p={});var y=t.call(this,n,l,ja(ja({},f),{userToken:d}))||this;return y._last=0,y._store=new Gs(p),y._serverLedger=new Xs(d,h),y.defaultIncludePaginationMetadata=p.features&&p.features.hasOwnProperty("api-pagination-metadata"),y}return __extends$4(Library,t),Library.prototype.add=function(t){return __awaiter$4(this,void 0,void 0,(function(){var n,l,d,p,h,f;return __generator$4(this,(function(y){switch(y.label){case 0:if(n=transformKeys(t,dasherize),(l=Date.now())-this._last<1e3)return[2,Promise.reject(new we(we.QUOTA_EXCEEDED))];d=new Headers({Authorization:"Bearer "+this.developerToken,"Music-User-Token":this.userToken}),p=Object.keys(n).map((function(t){return"ids["+t+"]="+n[t].join(",")})).join("&"),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,fetch(this.url+"/"+Zs+"?"+p,{method:"POST",headers:d})];case 2:return(h=y.sent()).ok?(this._last=l,[2,this._serverLedger.added(n)]):[2,Promise.reject(we.responseError(h))];case 3:return f=y.sent(),[2,Promise.reject(we.responseError(f))];case 4:return[2]}}))}))},Library.prototype.remove=function(t){return __awaiter$4(this,void 0,void 0,(function(){var n,l,d,p,h,f;return __generator$4(this,(function(y){switch(y.label){case 0:if(!this.developerToken||!this.userToken)return[2,Promise.reject("Invalid tokens")];n=new Headers({Authorization:"Bearer "+this.developerToken,"Music-User-Token":this.userToken}),l=transformKeys(t,dasherize),d=Object.keys(l)[0],p=Object.values(l)[0],y.label=1;case 1:return y.trys.push([1,3,,4]),[4,fetch(this.url+"/"+Zs+"/"+d+"/"+p,{method:"DELETE",headers:n})];case 2:return(h=y.sent()).ok?[2,this._serverLedger.removed(l)]:[2,Promise.reject(we.responseError(h))];case 3:return f=y.sent(),[2,Promise.reject(we.responseError(f))];case 4:return[2]}}))}))},Library.prototype.album=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource("albums",t,n,l)]}))}))},Library.prototype.albumRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection("albums/"+t+"/"+n,void 0,l,d)]}))}))},Library.prototype.albums=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){switch(p.label){case 0:return[4,this.collection("albums",t,n,ja(ja({},l),{shouldCacheResults:!1}))];case 1:return d=p.sent(),[2,this._serverLedger.reconcile("albums",d,t,n,l)]}}))}))},Library.prototype.artist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource("artists",t,n,l)]}))}))},Library.prototype.artistRelationship=function(t,n,l,d){return void 0===n&&(n="albums"),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection("artists/"+t+"/"+n,void 0,l,d)]}))}))},Library.prototype.artists=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection("artists",t,n,l)]}))}))},Library.prototype.createPlaylist=function(t,n){return void 0===t&&(t={}),__awaiter$4(this,void 0,void 0,(function(){var l,d,p,h,f,y,v,g,m;return __generator$4(this,(function(_){switch(_.label){case 0:d=t.name,p=t.description,h=t.tracks,f=transformTrackParameters(void 0===h?[]:h),y={attributes:{name:d,description:p},relationships:{tracks:{data:f}}},v=JSON.stringify(y),_.label=1;case 1:return _.trys.push([1,3,,4]),[4,this.request(Zs+"/playlists",n,{body:v,method:"POST"})];case 2:return l=_.sent(),[3,4];case 3:return g=_.sent(),[2,Promise.reject(we.responseError(g))];case 4:try{return m=__read$4(this._store.write(l),1),[2,m[0]]}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))},Library.prototype.deletePlaylist=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){var l,d;return __generator$4(this,(function(p){switch(p.label){case 0:l=Zs+"/playlists/"+t,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.request(l,n,{method:"DELETE"})];case 2:return p.sent(),[3,4];case 3:return d=p.sent(),[2,Promise.reject(we.responseError(d))];case 4:return this.purgePlaylistFromCaches(t),[2]}}))}))},Library.prototype.editPlaylist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p,h;return __generator$4(this,(function(f){switch(f.label){case 0:d=JSON.stringify({attributes:n}),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.request(Zs+"/playlists/"+t,l,{body:d,method:"PATCH"})];case 2:return f.sent(),[3,4];case 3:return p=f.sent(),[2,Promise.reject(we.responseError(p))];case 4:try{return h=n,"library-playlists",this._store.write({data:[{type:"library-playlists",id:t,attributes:h}]}),[2,n]}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))},Library.prototype.updatePlaylistTracklist=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){switch(l.label){case 0:return[4,this.putPlaylistTracklisting(t,n,"PUT")];case 1:return l.sent(),this.purgePlaylistFromCaches(t),[2]}}))}))},Library.prototype.appendTracksToPlaylist=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){switch(l.label){case 0:return[4,this.putPlaylistTracklisting(t,n,"POST")];case 1:return l.sent(),this.purgePlaylistFromCaches(t),[2]}}))}))},Library.prototype.playlistFolder=function(t,n,l){return this.resource("playlist-folders",t,n,l)},Library.prototype.playlistFolders=function(t,n,l){return this.collection("playlist-folders",t,n,l)},Library.prototype.playlistFoldersRoot=function(t,n){return t=ja(ja({},t),{filter:ja(ja({},null==t?void 0:t.filter),{identity:"playlistsroot"})}),this.playlistFolders(void 0,t,n)},Library.prototype.playlistFolderChildren=function(t,n,l){var d="playlist-folders/"+t+"/children";return this.collection(d,void 0,n,l)},Library.prototype.musicVideo=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource("music-videos",t,n,l)]}))}))},Library.prototype.musicVideos=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection("music-videos",t,n,l)]}))}))},Library.prototype.parseResultData=function(t,n){return t?this._store.write(n):this._store.parse(n)},Library.prototype.playlist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=Object.assign({include:"tracks"},n),[2,this.resource("playlists",t,n,l)]}))}))},Library.prototype.createCatalogPlaylist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return l=ja({method:"POST"},l),[2,this.resource("playlists/"+t+"/catalog",void 0,n,l)]}))}))},Library.prototype.playlistRelationship=function(t,n,l,d){return void 0===n&&(n="tracks"),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection("playlists/"+t+"/"+n,void 0,l,d)]}))}))},Library.prototype.playlists=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p=this;return __generator$4(this,(function(h){switch(h.label){case 0:return t&&t.length>0?[4,Promise.all(t.map((function(t){return p.playlist(t,n,l)})))]:[3,2];case 1:return d=h.sent(),[3,4];case 2:return[4,this.collection("playlists",t,n,ja(ja({},l),{shouldCacheResults:!1}))];case 3:d=h.sent(),h.label=4;case 4:return[2,this._serverLedger.reconcile("playlists",d,t,n,l)]}}))}))},Library.prototype.recentlyAdded=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){var l,d;return __generator$4(this,(function(p){switch(p.label){case 0:return l=null==t?void 0:t.limit,[4,this.collection("recently-added",void 0,transformParameters(t,l||10),ja(ja({},n),{shouldCacheResults:!1}))];case 1:return d=p.sent(),[2,this._serverLedger.reconcile("all",d,void 0,t,n)]}}))}))},Library.prototype.search=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return n=this._denormalizeLibraryTypes(n),d=Object.assign({term:t,types:"library-albums"},n),[2,this.collection("search",void 0,d,ja(ja({},l),{shouldCacheResults:!1}))]}))}))},Library.prototype.song=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource("songs",t,n,l)]}))}))},Library.prototype.songRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection("songs/"+t+"/"+n,void 0,l,d)]}))}))},Library.prototype.songs=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection("songs",t,n,l)]}))}))},Library.prototype.collection=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p;return __generator$4(this,(function(h){return!n||n.length||l||(l=transformParameters(n,100),n=void 0),p=n?Object.assign({ids:n},l):l,[2,makeRequest(this,Zs+"/"+t,p,d)]}))}))},Library.prototype.resource=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p,h,f;return __generator$4(this,(function(y){switch(y.label){case 0:return!(null==d?void 0:d.reload)&&(p=this._store.read(t,n,l))?[2,p]:(h=Zs+"/"+t,n&&(h=h+"/"+n),[4,makeRequest(this,h,l,d)]);case 1:return f=__read$4.apply(void 0,[y.sent(),1]),[2,f[0]]}}))}))},Library.prototype.purgePlaylistFromCaches=function(t){this._store.delete("library-playlists",t),this.networkCache.removeItemsMatching(this.constructURL(Zs+"/playlists/"+t,{}),!1)},Library.prototype.putPlaylistTracklisting=function(t,n,l){return void 0===l&&(l="PUT"),__awaiter$4(this,void 0,void 0,(function(){var d,p,h;return __generator$4(this,(function(f){switch(f.label){case 0:d=transformTrackParameters(n),p=JSON.stringify({data:d}),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.request(Zs+"/playlists/"+t+"/tracks",void 0,{body:p,method:l})];case 2:return f.sent(),[3,4];case 3:return h=f.sent(),[2,Promise.reject(we.responseError(h))];case 4:return[2]}}))}))},Library.prototype._denormalizeLibraryTypes=function(t,n){void 0===t&&(t={}),void 0===n&&(n="types");var l=t[n];return l?("string"==typeof l&&(l=l.split(",")),t[n]=l.map((function(t){return t.replace(/^(albums|music-videos|playlists|songs)$/,"library-$1")})),t):t},__decorate$2([ChunkedIdApi(1),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[String,Object,Object,Object]),__metadata$2("design:returntype",Promise)],Library.prototype,"collection",null),Library}(pt),tu=function(t){function Books(n,l,d,p,h,f){void 0===h&&(h={});var y=t.call(this,"https://api.books.apple.com/v1",n,ja(ja({},f),{userToken:l,storage:p}))||this;return y.storefrontId=or.ID,d&&(y.storefrontId=d),y._store=new Gs(h),y.defaultIncludePaginationMetadata=h.features&&h.features.hasOwnProperty("api-pagination-metadata"),y}return __extends$4(Books,t),Books.prototype.audioBook=function(t,n,l){return this.resource("audio-books",t,n,l)},Books.prototype.audioBooks=function(t,n,l){return this.collection("audio-books",t,n,l)},Books.prototype.collection=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p;return __generator$4(this,(function(h){return p="catalog/"+this.storefrontId+"/"+t,n&&((l=l||{}).ids=n),[2,makeRequest(this,p,l,d)]}))}))},Books.prototype.parseResultData=function(t,n){return t?this._store.write(n):this._store.parse(n)},Books.prototype.resource=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p,h;return __generator$4(this,(function(f){switch(f.label){case 0:return!(null==d?void 0:d.reload)&&(p=this._store.read(t,n,l))?[2,p]:[4,this.collection(t,n,l,d)];case 1:return h=__read$4.apply(void 0,[f.sent(),1]),[2,h[0]]}}))}))},__decorate$2([ChunkedIdApi(1),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[String,Object,Object,Object]),__metadata$2("design:returntype",Promise)],Books.prototype,"collection",null),Books}(pt),formatTimezoneOffset=function(t){void 0===t&&(t=new Date);var n=t.getTimezoneOffset(),l=Math.floor(Math.abs(n)/60),d=Math.round(Math.abs(n)%60),p="+";return 0!==n&&(p=n>0?"-":"+"),""+p+leadingZeros(l,2)+":"+leadingZeros(d,2)},leadingZeros=function(t,n){void 0===n&&(n=2);for(var l=""+t;l.length<n;)l="0"+l;return l},ru=function(t){function Podcasts(n,l,d,p,h,f){void 0===d&&(d=or.ID),void 0===h&&(h={});var y=t.call(this,"https://amp-api.podcasts.apple.com/v1",n,ja(ja({},f),{userToken:l,storage:p}))||this;return y.storefrontId=d,y._store=new Gs(h),y.defaultIncludePaginationMetadata=h.features&&h.features.hasOwnProperty("api-pagination-metadata"),y}return __extends$4(Podcasts,t),Podcasts.prototype.artist=function(t,n,l){return this.resource("artists",t,n,l)},Podcasts.prototype.artists=function(t,n,l){return this.collection("artists",t,n,l)},Podcasts.prototype.artistRelationship=function(t,n,l,d){return this.collection("artists/"+t+"/"+n,void 0,l,d)},Podcasts.prototype.charts=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection("charts",t,n,l)]}))}))},Podcasts.prototype.podcast=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return d=Object.assign({include:"episodes"},n),[2,this.resource("podcasts",t,d,l)]}))}))},Podcasts.prototype.podcasts=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return d=Object.assign({include:"episodes"},n),[2,this.collection("podcasts",t,d,l)]}))}))},Podcasts.prototype.podcastRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection("podcasts/"+t+"/"+n,void 0,l,d)]}))}))},Podcasts.prototype.search=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return d=Object.assign({term:t,types:"podcasts"},n),[2,this.collection("search",void 0,d,l)]}))}))},Podcasts.prototype.episode=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource("podcast-episodes",t,n,l)]}))}))},Podcasts.prototype.episodes=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection("podcast-episodes",t,n,l)]}))}))},Podcasts.prototype.collection=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p,h;return __generator$4(this,(function(f){return n?((h={})["charts"===t?"types":"ids"]=n,p=Object.assign(h,l)):p=l,[2,makeRequest(this,"catalog/"+this.storefrontId+"/"+t,p,d)]}))}))},Podcasts.prototype.parseResultData=function(t,n){return t?this._store.write(n):this._store.parse(n)},Podcasts.prototype.resource=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){var p,h;return __generator$4(this,(function(f){switch(f.label){case 0:return!(null==d?void 0:d.reload)&&(p=this._store.read(t,n,l))?[2,p]:[4,this.collection(t,n,l,d)];case 1:return h=__read$4.apply(void 0,[f.sent(),1]),[2,h[0]]}}))}))},__decorate$2([ChunkedIdApi(1),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[String,Object,Object,Object]),__metadata$2("design:returntype",Promise)],Podcasts.prototype,"collection",null),Podcasts}(pt),iu=function(t){function TVLibrary(n,l,d,p,h){void 0===p&&(p={});var f=t.call(this,"https://amp-api.videos.apple.com/v1",n,ja(ja({},h),{userToken:l,storage:d}))||this;return f._store=new Gs(p),f.defaultIncludePaginationMetadata=p.features&&p.features.hasOwnProperty("api-pagination-metadata"),f}return __extends$4(TVLibrary,t),TVLibrary.prototype.genres=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection("genres",ja({types:"tv-episodes,movies"},t),n)]}))}))},TVLibrary.prototype.movies=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection("movies",t,n)]}))}))},TVLibrary.prototype.purchases=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection("",ja({types:"tv-episodes,movies"},t),n)]}))}))},TVLibrary.prototype.tvEpisodes=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection("tv-episodes",t,n)]}))}))},TVLibrary.prototype.collection=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,makeRequest(this,"me/purchases/"+t,n,l)];case 1:return[2,p.sent()];case 2:if((d=p.sent()).name===we.CONTENT_UNAVAILABLE)return[2,(null==l?void 0:l.includePagination)?{data:[],meta:{}}:[]];throw d;case 3:return[2]}}))}))},TVLibrary.prototype.parseResultData=function(t,n){return t?this._store.write(n):this._store.parse(n)},__decorate$2([ChunkedIdApi(1),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[String,Object,Object]),__metadata$2("design:returntype",Promise)],TVLibrary.prototype,"collection",null),TVLibrary}(pt),RecommendationUpdate=function(){return function(t,n,l){if(void 0===l||"function"!=typeof l.value)throw new TypeError("Only methods can be decorated with @RecommendationUpdate, but "+n+" is not a method.");return{configurable:!0,get:function(){var t=l.value;function recommendationUpdate(){for(var n=[],l=0;l<arguments.length;l++)n[l]=arguments[l];return __awaiter$4(this,void 0,void 0,(function(){var l,d,p,h,f,y,v,g,m;return __generator$4(this,(function(_){switch(_.label){case 0:return[4,t.apply(this,n)];case 1:return l=_.sent(),d=new Map,p=[],h=new Date,l&&Array.isArray(l)?(l.forEach((function(t,n){var l,f,y=t.id,v=null!==(l=t.nextUpdateDate)&&void 0!==l?l:null===(f=t.attributes)||void 0===f?void 0:f.nextUpdateDate;y&&v&&(new Date(v)<h&&(p.push(y),d.set(y,n)))})),p.length?(f=__read$4(n),f[0],y=f[1],v=f[2],g=f.slice(3),v=ja(ja({},v),{reload:!0}),m=__spread$4([p,y,v],g),[4,t.apply(this,m)]):[2,l]):[2,l];case 2:return _.sent().forEach((function(t){var n=d.get(t.id);void 0!==n&&(l[n]=t)})),[2,l]}}))}))}return Object.defineProperty(this,n,{value:recommendationUpdate,configurable:!0,writable:!0}),recommendationUpdate}}}};!function(t){t[t.Global=0]="Global",t.Lyrics="lyrics",t.Catalog="catalog",t.Personalized="me",t.Editorial="editorial",t.Engagement="engagement",t.Social="social"}(Qs||(Qs={})),function(t){t.songs="songs",t.albums="albums",t.playlists="playlists",t.stations="stations",t["music-videos"]="music-videos",t["library-music-videos"]="library-music-videos",t["library-playlists"]="library-playlists",t["library-songs"]="library-songs"}(Js||(Js={}));var nu,ou=function(t){function API(n,l,d,p,h,f,y,v){void 0===y&&(y={});var g=t.call(this,n,l,ja(ja({},v),{userToken:p,storage:f}))||this;return g.storefrontId=or.ID,g.resourceRelatives={artists:{albums:{include:"tracks"},playlists:{include:"tracks"},songs:null}},g.defaultIncludePaginationMetadata=y.features&&y.features.hasOwnProperty("api-pagination-metadata"),g._store=new Gs(y),g.useStorefrontRecommendations=y.features&&y.features.hasOwnProperty("use-storefront-recommendations"),d&&(g.storefrontId=d.toLowerCase()),p&&h&&(g.userStorefrontId=h.toLowerCase()),g._podcastsAPI=new ru(l,p,d,f,y,ja({},v)),g.tvLibrary=new iu(l,p,f,y,ja({},v)),g.library=new eu(n,l,p,y,g,ja({},v)),g.books=new tu(l,p,d,f,y,ja({},v)),g}return __extends$4(API,t),Object.defineProperty(API.prototype,"needsEquivalents",{get:function(){var t=this.userStorefrontId;return void 0!==t&&""!==t&&t!==this.storefrontId},enumerable:!0,configurable:!0}),API.prototype.activity=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"activities",t,n,l)]}))}))},API.prototype.activities=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"activities",t,n,l)]}))}))},API.prototype.album=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"albums",t,n,l)]}))}))},API.prototype.albumRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection(Qs.Catalog,"albums/"+t+"/"+n,void 0,l,d)]}))}))},API.prototype.albums=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"albums",t,n,l)]}))}))},API.prototype.appleCurator=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"apple-curators",t,n,l)]}))}))},API.prototype.appleCurators=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"apple-curators",t,n,l)]}))}))},API.prototype.artist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"artists",t,n,l)]}))}))},API.prototype.artistRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection(Qs.Catalog,"artists/"+t+"/"+n,void 0,l,d)]}))}))},API.prototype.artistView=function(t,n,l,d){return this.collection(Qs.Catalog,"artists/"+t+"/view/"+n,void 0,l,d)},API.prototype.artists=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"artists",t,n,l)]}))}))},API.prototype.audioBook=function(t,n,l){return this.books.audioBook(t,n,l)},API.prototype.audioBooks=function(t,n,l){return this.books.audioBooks(t,n,l)},API.prototype.catalogResources=function(t,n,l){void 0===n&&(n={});var d=transformDescriptorsToIdMap(t);return n=ja(ja({},n),{ids:d}),makeRequest(this,Qs.Catalog+"/"+this.storefrontId,n,l)},API.prototype.changeStation=function(t,n,l){return void 0===l&&(l={}),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){switch(d.label){case 0:return[4,makeRequest(this,"me/stations/change-station/"+t,n,ja(ja({},l),{reload:!0,method:"POST",shouldCacheResults:!1}))];case 1:return[2,d.sent()]}}))}))},API.prototype.charts=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"charts",t,n,ja(ja({},l),{returnRawJSONApiRecords:!0}))]}))}))},API.prototype.contents=function(t,n,l){return this.collection(Qs.Catalog,"contents",t,n,l)},API.prototype.curator=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"contents",t,n,l)]}))}))},API.prototype.curators=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"contents",t,n,l)]}))}))},API.prototype.episode=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this._podcastsAPI.episode(t,n,l)]}))}))},API.prototype.episodes=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this._podcastsAPI.episodes(t,n,l)]}))}))},API.prototype.genre=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"genres",t,n,l)]}))}))},API.prototype.genres=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"genres",t,n,l)]}))}))},API.prototype.grouping=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return!n&&isObject(t)&&(n=t,t=void 0),d=ja(ja({},{platform:"desktop"}),n),[2,this.resource(Qs.Editorial,"groupings",t,d,ja(ja({},l),{shouldCacheResults:!1}))]}))}))},API.prototype.groupings=function(t,n,l){return void 0===n&&(n={}),__awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return d=ja(ja({},{platform:"desktop"}),n),[2,this.collection(Qs.Editorial,"groupings",t,d,ja(ja({},l),{shouldCacheResults:!1}))]}))}))},API.prototype.lyric=function(t,n,l){return this.resource(Qs.Catalog,"songs/"+t+"/lyrics","",n,ja({reload:!0},l))},API.prototype.lyricSnippet=function(t,n,l){return this.collection(Qs.Lyrics,"snippet/songs",t,n,ja(ja({},l),{returnRawJSONApiRecords:!0}))},API.prototype.historyHeavyRotation=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection(Qs.Personalized,"history/heavy-rotation",void 0,transformParameters(t,10),n)]}))}))},API.prototype.multiplex=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return(d=this._store.read("multiplex",t,n))?[2,d]:(l=Object.assign({returnRawJSONApiRecords:!0},l),[2,makeRequest(this,Qs.Editorial+"/"+this.storefrontId+"/multiplex/"+t,n,l)])}))}))},API.prototype.multiroom=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p;return __generator$4(this,(function(h){switch(h.label){case 0:return(d=this._store.read("multirooms",t,n))?[2,d]:[4,this.collection(Qs.Editorial,"multirooms/"+t,void 0,n,l)];case 1:return p=__read$4.apply(void 0,[h.sent(),1]),[2,p[0]]}}))}))},API.prototype.musicMovie=function(t,n,l){return this.resource(Qs.Catalog,"music-movies",t,n,l)},API.prototype.musicMovies=function(t,n,l){return this.collection(Qs.Catalog,"music-movies",t,n,l)},API.prototype.musicVideo=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"music-videos",t,n,l)]}))}))},API.prototype.musicVideos=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"music-videos",t,n,l)]}))}))},API.prototype.nextStationTracks=function(t,n,l){return void 0===l&&(l={}),__awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){switch(p.label){case 0:return d={},(null==n?void 0:n.clean)&&(d.clean=n.clean,delete n.clean),(null==n?void 0:n.limit)&&(d.limit=n.limit,delete n.limit),[4,makeRequest(this,"me/stations/next-tracks/"+t,n,ja(ja({},l),{reload:!0,method:"POST",queryParameters:d,shouldCacheResults:!1}))];case 1:return[2,p.sent()]}}))}))},API.prototype.playlist=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"playlists",t,n,l)]}))}))},API.prototype.playlistRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection(Qs.Catalog,"playlists/"+t+"/"+n,void 0,l,d)]}))}))},API.prototype.playlists=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Catalog,"playlists",t,n,l)]}))}))},API.prototype.podcast=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this._podcastsAPI.podcast(t,n,l)]}))}))},API.prototype.podcastRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this._podcastsAPI.podcastRelationship(t,n,l,d)]}))}))},API.prototype.podcasts=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this._podcastsAPI.podcasts(t,n,l)]}))}))},API.prototype.recentPlayed=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection(Qs.Personalized,"recent/played",void 0,transformParameters(t,10),n)]}))}))},API.prototype.recentRadioStations=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection(Qs.Personalized,"recent/radio-stations",void 0,transformParameters(t,10),n)]}))}))},API.prototype.recordLabel=function(t,n,l){return this.resource(Qs.Catalog,"record-labels",t,n,l)},API.prototype.recordLabels=function(t,n,l){return this.collection(Qs.Catalog,"record-labels",t,n,l)},API.prototype.recordLabelView=function(t,n,l,d){return this.collection(Qs.Catalog,"record-labels/"+t+"/view/"+n,void 0,l,d)},API.prototype.personalRecommendation=function(t,n,l,d){return void 0===d&&(d=!0),__awaiter$4(this,void 0,void 0,(function(){var p,h;return __generator$4(this,(function(f){switch(f.label){case 0:return[4,this.personalRecommendations(t,n,l,d)];case 1:return p=f.sent(),h=__read$4(p,1),[2,h[0]]}}))}))},API.prototype.refreshPersonalRecommendation=function(t,n,l){var d=formatTimezoneOffset();return n=ja({timezone:d},n),l=ja(ja({},l),{method:"POST",queryParameters:n}),this.resource(Qs.Personalized,"recommendations",t,void 0,l)},API.prototype.personalRecommendations=function(t,n,l,d){return void 0===l&&(l={}),void 0===d&&(d=!0),__awaiter$4(this,void 0,void 0,(function(){var p,h,f=this;return __generator$4(this,(function(y){switch(y.label){case 0:return p=formatTimezoneOffset(),[4,this.collection(Qs.Personalized,"recommendations",t,ja({timezone:p},n),ja(ja({},l),{shouldCacheResults:d,returnRawJSONApiRecords:!0}))];case 1:h=y.sent(),this._reindexRelationships(h,"recommendations");try{return[2,mapRequestResult(h,(function(t){return f.parseResultData(!1,t)}))]}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))},API.prototype.personalRecommendationView=function(t,n,l,d){return void 0===d&&(d={}),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection(Qs.Personalized,"recommendations/"+t+"/view/"+n,void 0,l,d)]}))}))},API.prototype.recommendations=function(t,n,l,d){return void 0===l&&(l={}),void 0===d&&(d=!0),__awaiter$4(this,void 0,void 0,(function(){var p,h,f=this;return __generator$4(this,(function(y){switch(y.label){case 0:return p=formatTimezoneOffset(),this.useStorefrontRecommendations?[4,this.collection(Qs.Global,"recommendations/"+this.storefrontId,t,ja({timezone:p},n),ja(ja({},l),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}))]:[2,this.personalRecommendations(t,n,l,d)];case 1:h=y.sent(),this._reindexRelationships(h,"recommendations");try{return[2,mapRequestResult(h,(function(t){return f.parseResultData(!1,t)}))]}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))},API.prototype.recommendedFriends=function(t,n,l){return void 0===l&&(l={}),l=ja(ja({},l),{method:"POST",body:JSON.stringify(ja({ids:{socialProfiles:t}},l.body))}),this.collection(Qs.Global,"social/recommended-friends",void 0,n,ja(ja({},l),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}))},API.prototype.room=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p,h;return __generator$4(this,(function(f){switch(f.label){case 0:return(d=this._store.read("rooms",t,n))&&d.hasAttributes("title")?[2,d]:[4,this.collection(Qs.Editorial,"rooms/"+t,void 0,n,l)];case 1:return p=f.sent(),h=__read$4(p,1),[2,h[0]]}}))}))},API.prototype.roomContents=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Editorial,"rooms/"+t+"/contents",void 0,n,l)]}))}))},API.prototype.search=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){return d=Object.assign({term:t},transformParameters(n)),l=ja(ja({},l),{useRawResponse:!0}),[2,this.collection(Qs.Catalog,"search",void 0,d,ja(ja({},l),{shouldCacheResults:!1}))]}))}))},API.prototype.searchHints=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p;return __generator$4(this,(function(h){switch(h.label){case 0:return d=Object.assign({term:t},transformParameters(n)),[4,this.collection(Qs.Catalog,"search/hints",void 0,d,ja(ja({},l),{returnRawJSONApiRecords:!0}))];case 1:return p=h.sent(),"topResults"===(null==d?void 0:d.with)&&"topResults"in p&&(p.topResults=this.parseResultData(!0,p.topResults)),[2,p]}}))}))},API.prototype.searchQuery=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return n=ja(ja({},n),{useRawResponse:!0}),[2,this.collection(Qs.Catalog,"search/query",void 0,t,ja(ja({},n),{shouldCacheResults:!1}))]}))}))},API.prototype.searchSuggestions=function(t,n,l){var d;return __awaiter$4(this,void 0,void 0,(function(){var p,h=this;return __generator$4(this,(function(f){switch(f.label){case 0:return n=ja({term:t},n),[4,this.collection(Qs.Catalog,"search/suggestions",void 0,n,ja(ja({},l),{returnRawJSONApiRecords:!0}))];case 1:return p=f.sent(),Array.isArray(null===(d=p)||void 0===d?void 0:d.suggestions)&&p.suggestions.forEach((function(t){"topResults"===t.kind&&(t.content=h.parseResultData(!0,[t.content])[0])})),[2,p]}}))}))},API.prototype.socialBadgingMap=function(t,n){return this.collection(Qs.Global,"social/badging-map",void 0,t,ja(ja({},n),{returnRawJSONApiRecords:!0}))},API.prototype.socialProfile=function(t,n,l){return this.resource(Qs.Social,"social-profiles",t,n,l)},API.prototype.socialProfiles=function(t,n,l){return this.collection(Qs.Social,"social-profiles",t,n,l)},API.prototype.personalSocialProfile=function(t,n){return this.resource(Qs.Personalized,"social-profile",void 0,t,n)},API.prototype.socialPost=function(t,n,l){return void 0===n&&(n={}),__awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){switch(p.label){case 0:return t.startsWith("sa.")?n.filter={post:t}:n.ids=t,[4,this.collection(Qs.Catalog,"contents","",n,l)];case 1:return d=__read$4.apply(void 0,[p.sent(),1]),[2,d[0]]}}))}))},API.prototype.socialSearch=function(t,n,l){return void 0===n&&(n={}),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=ja(ja({},n),{term:t}),[2,this.collection(Qs.Social,"search",void 0,n,l)]}))}))},API.prototype.song=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"songs",t,n,l)]}))}))},API.prototype.songRelationship=function(t,n,l,d){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(p){return[2,this.collection(Qs.Catalog,"songs/"+t+"/"+n,void 0,l,d)]}))}))},API.prototype.songs=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return!n&&isObject(t)&&(n=t,t=void 0),[2,this.collection(Qs.Catalog,"songs",t,n,l)]}))}))},API.prototype.tastePreferences=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection(Qs.Personalized,"taste/taste-preferences",void 0,t,ja(ja({},n),{shouldCacheResults:!1}))]}))}))},API.prototype.saveTastePreferences=function(t){return __awaiter$4(this,void 0,void 0,(function(){var n,l;return __generator$4(this,(function(d){switch(d.label){case 0:t=t.map((function(t){return t instanceof be?t.serialize().data:t})),n={method:"POST",body:JSON.stringify({data:t}),shouldCacheResults:!0},d.label=1;case 1:return d.trys.push([1,3,,4]),[4,makeRequest(this,"me/taste/taste-preferences",void 0,n)];case 2:return[2,d.sent()];case 3:return(l=d.sent()).name===we.CONTENT_UNAVAILABLE?[2,[]]:[2,Promise.reject(we.parseError(l))];case 4:return[2]}}))}))},API.prototype.tvEpisode=function(t,n,l){return this.resource(Qs.Catalog,"tv-episodes",t,ja({include:"seasons"},n),l)},API.prototype.tvEpisodes=function(t,n,l){return this.collection(Qs.Catalog,"tv-episodes",t,ja({include:"seasons"},n),l)},API.prototype.tvSeason=function(t,n,l){return this.resource(Qs.Catalog,"tv-seasons",t,ja({include:"episodes"},n),l)},API.prototype.tvSeasons=function(t,n,l){return this.collection(Qs.Catalog,"tv-seasons",t,ja({include:"episodes"},n),l)},API.prototype.tvShow=function(t,n,l){return this.resource(Qs.Catalog,"tv-shows",t,n,l)},API.prototype.tvShows=function(t,n,l){return this.collection(Qs.Catalog,"tv-shows",t,n,l)},API.prototype.uploadedAudio=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=Object.assign({include:"curator,artists"},n),[2,this.resource(Qs.Catalog,"uploaded-audios",t,n,l)]}))}))},API.prototype.uploadedAudios=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=Object.assign({include:"curator,artists"},n),[2,this.collection(Qs.Catalog,"uploaded-audios",t,n,l)]}))}))},API.prototype.uploadedVideo=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=Object.assign({include:"curator,artists"},n),[2,this.resource(Qs.Catalog,"uploaded-videos",t,n,l)]}))}))},API.prototype.uploadedVideos=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return n=Object.assign({include:"curator,artists"},n),[2,this.collection(Qs.Catalog,"uploaded-videos",t,n,l)]}))}))},API.prototype.upsellMarketingItems=function(t,n){return this.collection(Qs.Engagement,"upsell/marketing-items",void 0,t,n)},API.prototype.station=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Catalog,"stations",t,n,l)]}))}))},API.prototype.stations=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return!n&&isObject(t)&&(n=t,t=void 0),[2,this.collection(Qs.Catalog,"stations",t,n,l)]}))}))},API.prototype.storefront=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Global,"storefronts",t,n,l)]}))}))},API.prototype.storefronts=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.collection(Qs.Global,"storefronts",t,n,l)]}))}))},API.prototype.musicSummary=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(d){return[2,this.resource(Qs.Personalized,"music-summaries",t,n,l)]}))}))},API.prototype.musicSummarySearch=function(t,n){return void 0===t&&(t={}),__awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(l){return[2,this.collection(Qs.Personalized,"music-summaries/search",void 0,t,n)]}))}))},API.prototype.addToLibrary=function(t){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(n){return this.developerToken&&this.userToken&&this.library?[2,this.library.add(t)]:[2,Promise.reject("Invalid tokens")]}))}))},API.prototype.rating=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d;return __generator$4(this,(function(p){switch(p.label){case 0:return[4,this.ratings(t,n,l)];case 1:return d=__read$4.apply(void 0,[p.sent(),1]),[2,d[0]]}}))}))},API.prototype.ratings=function(t,n,l){if(!this.developerToken||!this.userToken)return Promise.reject("Invalid tokens");var d=__read$4(Object.keys(t),1)[0],p=t[d],h=Array.isArray(p);if(h&&0===p.length)return Promise.resolve([]);var f="me/ratings/"+formatRatingsContentType(d,h?p[0]:p);return h?n=ja(ja({},n),{ids:p.map(normalizeAdamId)}):f=f+"/"+normalizeAdamId(p),makeRequest(this,f,n,ja({shouldCacheResults:!1,reload:!0,includePagination:!1},l))},API.prototype.putRating=function(t,n,l){return __awaiter$4(this,void 0,void 0,(function(){var d,p,h,f,y,v,g;return __generator$4(this,(function(m){switch(m.label){case 0:return this.developerToken&&this.userToken?(d=__read$4(Object.keys(t),1),p=d[0],h=t[p],f=formatRatingsContentType(p,h),y={method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:n}}),includePagination:!1},[4,makeRequest(this,"me/ratings/"+f+"/"+normalizeAdamId(h),l,Object.assign({shouldCacheResults:!1},y))]):[2,Promise.reject("Invalid tokens")];case 1:return v=m.sent(),g=__read$4(v,1),[2,g[0]]}}))}))},API.prototype.deleteRating=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){var l,d,p,h,f=this;return __generator$4(this,(function(y){switch(y.label){case 0:return this.developerToken&&this.userToken?(l=__read$4(Object.keys(t),1),d=l[0],p=t[d],h=formatRatingsContentType(d,p),Array.isArray(p)?[2,Promise.all(p.map((function(t){var l;return f.deleteRating(((l={})[d]=t,l),n)}))).then((function(){}))]:[4,makeRequest(this,"me/ratings/"+h+"/"+p,n,{method:"DELETE",shouldCacheResults:!1,returnRawJSONApiRecords:!0})]):[2,Promise.reject("Invalid tokens")];case 1:y.sent();try{this._store.delete(h,p)}catch(error){return[2,Promise.reject(we.parseError(error))]}return[2]}}))}))},API.prototype.equivalent=function(t,n){return __awaiter$4(this,void 0,void 0,(function(){var l,d;return __generator$4(this,(function(p){switch(l="catalog/"+this.userStorefrontId+"/"+t,d={},t){case"albums":case"songs":d={"filter[equivalents]":n};break;case"artists":case"playlists":l=l+"/"+n;break;default:return[2,Promise.reject(new we(we.INVALID_ARGUMENTS,"Invalid equivalent type"))]}return[2,this.resource(Qs.Global,l,"",d)]}))}))},API.prototype.collection=function(t,n,l,d,p){return __awaiter$4(this,void 0,void 0,(function(){var h,f,y,v,g;return __generator$4(this,(function(m){switch(y=null==p?void 0:p.shouldCacheResults,h=l?ja(((g={})["charts"===n?"types":"ids"]=l,g),d):d,t){case Qs.Catalog:case Qs.Editorial:case Qs.Engagement:case Qs.Social:case Qs.Lyrics:v=this.storefrontId,f=t+"/"+v+"/"+n;break;case Qs.Global:f=n;break;case Qs.Personalized:f=t+"/"+n,y=!1}return[2,makeRequest(this,f,h,ja(ja({},p),{shouldCacheResults:y}))]}))}))},API.prototype.parseResultData=function(t,n){return t?this._store.write(n):this._store.parse(n)},API.prototype.resource=function(t,n,l,d,p){return __awaiter$4(this,void 0,void 0,(function(){var h,f;return __generator$4(this,(function(y){switch(y.label){case 0:return!(null==p?void 0:p.reload)&&(h=this._store.read(n,l,d))?[2,h]:[4,this.collection(t,n,l,d,p)];case 1:return f=__read$4.apply(void 0,[y.sent(),1]),[2,f[0]]}}))}))},API.prototype._reindexRelationships=function(t,n){("data"in t?t.data:t).forEach((function(t){t.hasOwnProperty("relationships")&&t.relationships.hasOwnProperty(n)&&t.relationships[n].hasOwnProperty("data")&&Array.isArray(t.relationships[n].data)&&t.relationships[n].data.forEach((function(t,n){t.id=t.id+"-"+n}))}))},__decorate$2([RecommendationUpdate(),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[Object,Object,Object,Object]),__metadata$2("design:returntype",Promise)],API.prototype,"personalRecommendations",null),__decorate$2([RecommendationUpdate(),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[Object,Object,Object,Object]),__metadata$2("design:returntype",Promise)],API.prototype,"recommendations",null),__decorate$2([ChunkedIdApi(2),__metadata$2("design:type",Function),__metadata$2("design:paramtypes",[Object,String,Object,Object,Object]),__metadata$2("design:returntype",Promise)],API.prototype,"collection",null),API}(pt),configure$2=function(t,n){return void 0===n&&(n=!1),__awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(l){if(nu&&!n){if(void 0===t.storefrontId||t.storefrontId===nu.storefrontId)return[2,nu];nu.clear()}return[2,(nu=new su(t.dispatcher)).configure(t)]}))}))},au={album:{isPlural:!1,apiMethod:"album",relationshipMethod:{method:"albumRelationship",relationship:"tracks"}},albums:{isPlural:!0,apiMethod:"albums"},audioBook:{isPlural:!1,apiMethod:"audioBook"},audioBooks:{isPlural:!0,apiMethod:"audioBooks"},episode:{isPlural:!1,apiMethod:"episode"},episodes:{isPlural:!0,apiMethod:"episodes"},musicVideo:{isPlural:!1,apiMethod:"musicVideo"},musicVideos:{isPlural:!0,apiMethod:"musicVideos"},musicMovie:{isPlural:!1,apiMethod:"musicMovie"},musicMovies:{isPlural:!0,apiMethod:"musicMovies"},podcast:{isPlural:!1,apiMethod:"podcast"},podcasts:{isPlural:!0,apiMethod:"podcasts"},playlist:{isPlural:!1,apiMethod:"playlist",relationshipMethod:{method:"playlistRelationship",relationship:"tracks"}},playlists:{isPlural:!0,apiMethod:"playlists"},song:{isPlural:!1,apiMethod:"song"},songs:{isPlural:!0,apiMethod:"songs"},tvEpisode:{isPlural:!1,apiMethod:"tvEpisode"},tvEpisodes:{isPlural:!0,apiMethod:"tvEpisodes"},uploadedAudio:{isPlural:!1,apiMethod:"uploadedAudio"},uploadedAudios:{isPlural:!0,apiMethod:"uploadedAudios"},uploadedVideo:{isPlural:!1,apiMethod:"uploadedVideo"},uploadedVideos:{isPlural:!0,apiMethod:"uploadedVideos"}},su=function(){function MediaAPIService(t){var n=this;this._dispatcher=t,this.url=mr.urls.mediaApi,this.namedQueueOptions=au,this._dispatcher.subscribe(lr.apiStorefrontChanged,(function(t,l){var d=l.storefrontId;return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._updateStorefrontId(d)];case 1:return t.sent(),[2]}}))}))}))}return Object.defineProperty(MediaAPIService.prototype,"api",{get:function(){if(void 0===this._api)throw new we(we.CONFIGURATION_ERROR,"The API cannot be accessed before it is configured.");return this._api},enumerable:!0,configurable:!0}),Object.defineProperty(MediaAPIService.prototype,"storefrontId",{get:function(){return this.store&&this.store.storefrontId},enumerable:!0,configurable:!0}),MediaAPIService.prototype.configure=function(t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(l){return void 0===t.store?[2]:(this.store=t.store,[fr.userTokenDidChange,fr.storefrontIdentifierDidChange].forEach((function(t){n.store.storekit.addEventListener(t,(function(){return n.resetAPI()}))})),this._initializeAPI(t),[2,this])}))}))},MediaAPIService.prototype.clear=function(){this.api&&this.api.clearNetworkCache()},MediaAPIService.prototype.getAPIForItem=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return ae(t)?[4,this.store.authorize()]:[3,2];case 1:return n.sent(),[2,this.api.library];case 2:return[2,this.api]}}))}))},MediaAPIService.prototype.resetAPI=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.clear(),this._initializeAPI(),[2]}))}))},MediaAPIService.prototype._initializeAPI=function(t){if(void 0===(null==t?void 0:t.api)){var n=t&&t.store||this.store;if(void 0!==n){var l=mr.features["api-session-storage"]?sessionStorage:void 0,d=t&&t.storefrontId||n.storefrontId;this._api=new ou(this.url,n.developerToken,d,n.storekit.userToken,n.storekit.storefrontCountryCode,l,mr,t&&t.apiOptions&&t.apiOptions.sessionOptions)}}else this._api=t.api},MediaAPIService.prototype._updateStorefrontId=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this.api&&t===this.api.storefrontId?[2]:[4,this.configure({dispatcher:this._dispatcher,store:this.store,storefrontId:t})];case 1:return n.sent(),[2]}}))}))},MediaAPIService}();function loadLinksData(){return __awaiter$4(this,void 0,void 0,(function(){var t;return __generator$4(this,(function(n){return t=[{feature:"album-song",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<album>\\d+)$",requiredQueryParams:{i:"(?<identifier>\\d+)"},mediaAPI:{resources:["songs"]}},{feature:"albums",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/albums?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["albums"]}},{feature:"algo-stations",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/(?:[^/]+/)?(?<identifier>(?:ra|st).\\d+)",mediaAPI:{resources:["stations"]}},{feature:"artist-default-playable-content",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/artists?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["artists","default-playable-content"]}},{feature:"genre-stations",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/genre-stations?",mediaAPI:{resources:["stations"],parameterMapping:{genres:"filter[genres]",eras:"filter[eras]",tags:"filter[tags]",moods:"filter[moods]"}}},{feature:"library-playlists",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/library/playlists?/(?:[^/]+/)?(?<identifier>(?:p).[a-zA-Z0-9-]+)$",mediaAPI:{resources:["playlists"]}},{feature:"music-videos",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/music-videos?/(?:[^/]+/)?(?<identifier>\\d+)$",mediaAPI:{resources:["musicVideos"]}},{feature:"personal-general-radio",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/stations?/me$",mediaAPI:{resources:["stations"],parameters:{"filter[identity]":"personal"}}},{feature:"personal-mixes",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/(?:personal-)?mix/(?:[^/]+/)?(?<identifier>mx.(?:\\d{1,2}|rp-\\d{4}))$",mediaAPI:{resources:["playlists"]}},{feature:"playlists",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/(?<storefront>\\w{2})/playlists?/(?:[^/]+/)?(?<identifier>(?:pl).[a-zA-Z0-9-]+)$",mediaAPI:{resources:["playlists"]}},{feature:"steering-request",regex:"http(?:s)?://(?<realm>itunes|music).apple.com/me/stations?/change-station/?$",mediaAPI:{resources:["stations"]}}].map((function(t){return t.regex=new RegExp(t.regex),t.requiredQueryParams&&(t.requiredQueryParams=Object.keys(t.requiredQueryParams).reduce((function(n,l){return n[l]=new RegExp(t.requiredQueryParams[l]),n}),{})),t})),[2,Promise.resolve(t)]}))}))}function filterLinks(t){return __awaiter$4(this,void 0,void 0,(function(){var n,l;return __generator$4(this,(function(d){switch(d.label){case 0:return[4,loadLinksData()];case 1:return n=d.sent(),l=parseQueryParams(t),[2,n.reduce((function(n,d){if(function(t,n,l){void 0===l&&(l={});var d=__read$4(t.split(/\?|\#|\&/),1)[0],p=n.regex.test(d);return p&&n.requiredQueryParams?Object.keys(n.requiredQueryParams).every((function(t){var d=l[t];return n.requiredQueryParams[t].test(d)})):p}(t,d,l)){if(n.length>0)if(d.requiredQueryParams)n=n.filter((function(t){return t.requiredQueryParams}));else if(n.some((function(t){return t.requiredQueryParams})))return n;d.requiredQueryParams?d.mediaAPI.parameters=Object.keys(d.requiredQueryParams).reduce((function(t,n){return t[n]=l[n],t}),{}):d.mediaAPI.parameterMapping&&(d.mediaAPI.parameters=transform(d.mediaAPI.parameterMapping,l,!0)),n.push(d)}return n}),[])]}}))}))}var uu=/^http(?:s)?\:\/\/(?:itunes|(embed\.)?(music|podcasts))\.apple\.com/i,cu=["allow-forms","allow-popups","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation-by-user-activation"],lu=["autoplay *","encrypted-media *","fullscreen *"];var du=we.errors,pu=function(t){function MusicKitInstance(){return null!==t&&t.apply(this,arguments)||this}return __extends(MusicKitInstance,t),MusicKitInstance.prototype.addToLibrary=function(t,n){return __awaiter(this,void 0,void 0,(function(){var l;return __generator(this,(function(d){switch(d.label){case 0:return[4,this.authorize()];case 1:return d.sent(),n||(n=/[a-z]{2}\.[a-z0-9\-]+/i.test(t)?"playlists":"albums"),(l={})[n]=[t],[2,this.api.addToLibrary(l)]}}))}))},MusicKitInstance.prototype.changeToMediaItem=function(n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this._checkNeedsEquivalent(),[2,t.prototype.changeToMediaItem.call(this,n)]}))}))},MusicKitInstance.prototype.play=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this._checkNeedsEquivalent(),[2,t.prototype.play.call(this)]}))}))},MusicKitInstance.prototype.playMediaItem=function(n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this._checkNeedsEquivalent(),[2,t.prototype.playMediaItem.call(this,n)]}))}))},MusicKitInstance.prototype.setQueue=function(n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(l){return this._checkNeedsEquivalent(),[2,t.prototype.setQueue.call(this,n)]}))}))},MusicKitInstance.prototype._checkNeedsEquivalent=function(){var t;if(!this.previewOnly&&(null===(t=this.api)||void 0===t?void 0:t.needsEquivalents))throw new we(we.CONTENT_EQUIVALENT)},MusicKitInstance}(Bs);t.Events=fr,t.MKError=we,t.MediaItem=Ma,t.MusicKitInstance=pu,t.VideoTypes={movie:!0,musicVideo:!0,musicMovie:!0,trailer:!0,tvEpisode:!0,uploadedVideo:!0,"uploaded-videos":!0,"music-videos":!0,"music-movies":!0,"tv-episodes":!0,Episode:!0,Movie:!0,Show:!0,Vod:!0,EditorialVideoClip:!0,RealityVideo:!0},t.configure=function(t){return __awaiter(this,void 0,void 0,(function(){var n,l,d;return __generator(this,(function(p){switch(p.label){case 0:return n=new Mr,t.playActivityAPI=n,[4,configure$1(t,pu)];case 1:return l=p.sent(),(d={apiType:ks.MEDIA,configureFn:configure$2,options:{}}).options.apiOptions=t.apiOptions,[4,l.configure([d])];case 2:return p.sent(),t.declarativeMarkup&&function(t){var n=t.services.dispatcher,l={defaultText:"Sign In to Apple Music",click:t.authorize.bind(t),display:function(){return t.canAuthorize()}},d={content:function(){return formatMediaTime(t.currentPlaybackDuration)},display:function(){return t.nowPlayingItem}},p={content:function(){return Math.round(100*t.currentPlaybackProgress)+"%"},display:function(){return t.nowPlayingItem}},h={content:function(){return formatMediaTime(t.currentPlaybackTime)},display:function(){return t.nowPlayingItem}},f={click:function(t){var n=t.target;n.togglePlaybackTime=!n.togglePlaybackTime},content:function(n){return formatMediaTime(n.togglePlaybackTime?t.currentPlaybackDuration:t.currentPlaybackTimeRemaining)},display:function(){return t.nowPlayingItem}},y={defaultText:"Sign Out of Apple Music",click:t.unauthorize.bind(t),display:function(){return t.canUnauthorize()}},v=new Ws({"apple-music-authorize":l,"apple-music-current-playback-duration":d,"apple-music-current-playback-progress":p,"apple-music-current-playback-time":h,"apple-music-current-playback-time-remaining":f,"apple-music-unauthorize":y,"data-apple-music-authorize":l,"data-apple-music-add-to-library":{click:function(n){var l=n.target.dataset,d=l.appleMusicAddToLibrary,p=l.appleMusicType;t.addToLibrary(d,p)}},"data-apple-music-current-playback-duration":d,"data-apple-music-current-playback-progress":p,"data-apple-music-current-playback-time":h,"data-apple-music-current-playback-time-remaining":f,"data-apple-music-now-playing":{content:function(n){var l=n.dataset.appleMusicNowPlaying||"info",d=get(t.nowPlayingItem,l);if(!(/artworkurl$/i.test(l)&&n.height&&n.width))return d;n.src=formatArtworkURL({url:d},n.height,n.width)},display:function(){return t.nowPlayingItem}},"data-apple-music-skip-to-next-item":{defaultText:"Next",click:t.skipToNextItem.bind(t),enabled:function(){return!t.queueIsEmpty}},"data-apple-music-seek-forward":{defaultText:"Seek Forward",click:t.seekForward.bind(t),enabled:function(){return!t.queueIsEmpty}},"data-apple-music-seek-backward":{defaultText:"Seek Backward",click:t.seekBackward.bind(t),enabled:function(){return!t.queueIsEmpty}},"data-apple-music-pause":{defaultText:"Pause",click:t.pause.bind(t),display:function(){return t.isPlaying}},"data-apple-music-play":{defaultText:"Play",click:t.play.bind(t),display:function(){return!t.isPlaying},enabled:function(){return!t.queueIsEmpty}},"data-apple-music-set-queue":{click:function(n){var l=n.target.dataset,d=l.appleMusicAutoplay,p=l.appleMusicSetQueue,h=l.appleMusicType;if(isPlayingContainerOrItem(p,t.nowPlayingItem))return t.isPlaying?t.pause():t.play();h||(h=br.test(p)?"url":/^pl\./i.test(p)?"playlist":"album");var f={};f[h]=p,t.setQueue(f).then((function(){if("false"!==d)return t.play()}))},display:function(n){t.nowPlayingItem&&(isPlayingContainerOrItem(n.dataset.appleMusicSetQueue,t.nowPlayingItem)?n.classList.add(Ys):n.classList.remove(Ys));return!0}},"data-apple-music-skip-to-previous-item":{defaultText:"Previous",click:t.skipToPreviousItem.bind(t),enabled:function(){return!t.queueIsEmpty}},"data-apple-music-unauthorize":y});n.subscribe(fr.authorizationStatusDidChange,(function(){v.update(["apple-music-authorize","apple-music-unauthorize","data-apple-music-authorize","data-apple-music-unauthorize"])})),n.subscribe(fr.playbackStateDidChange,(function(){v.update(["data-apple-music-pause","data-apple-music-play","data-apple-music-skip-to-next-item","data-apple-music-skip-to-previous-item","data-apple-music-seek-forward","data-apple-music-seek-backward"])})),n.subscribe(fr.nowPlayingItemDidChange,(function(){v.update(["data-apple-music-now-playing","data-apple-music-set-queue"])})),n.subscribe(fr.playbackDurationDidChange,(function(){v.update(["apple-music-current-playback-duration","data-apple-music-current-playback-duration"])})),n.subscribe(fr.playbackProgressDidChange,(function(){v.update(["apple-music-current-playback-progress","data-apple-music-current-playback-progress"])})),n.subscribe(fr.playbackTimeDidChange,(function(){v.update(["apple-music-current-playback-time","apple-music-current-playback-time-remaining","data-apple-music-current-playback-time","data-apple-music-current-playback-time-remaining"])})),n.subscribe(fr.queueItemsDidChange,(function(){v.update(["data-apple-music-pause","data-apple-music-play","data-apple-music-skip-to-next-item","data-apple-music-skip-to-previous-item","data-apple-music-seek-forward","data-apple-music-seek-backward"])}))}(l),[2,l]}}))}))},t.enableMultipleInstances=function(){Fs=!0},t.errors=du,t.formatArtworkURL=formatArtworkURL,t.formatMediaTime=formatMediaTime,t.formattedMediaURL=formattedMediaURL,t.formattedMilliseconds=function(t){return formattedSeconds(t/1e3)},t.formattedSeconds=formattedSeconds,t.generateEmbedCode=function(t,n){var l,d;if(void 0===n&&(n={height:"450",width:"660"}),!uu.test(t))throw new Error("Invalid content url");var p=null!==(l=n.height)&&void 0!==l?l:"450",h=null!==(d=n.width)&&void 0!==d?d:"660",f=formattedMediaURL(t),y=f.kind,v=f.isUTS;"song"===y?p="150":"episode"===y?p="175":"post"===y&&(p=""+Math.round(.5625*parseInt(h,10))),p=(""+p).replace(/(\d+)px/i,"$1");var g="width:100%;"+((h=(""+h).replace(/^(\d+)(?!px)%?$/i,"$1px"))?"max-width:"+h:"")+";overflow:hidden;background:transparent;",m="https://embed.music.apple.com";["podcast","episode"].includes(y)&&!v&&(m="https://embed.podcasts.apple.com");var _=window.localStorage.getItem("mk-generate-swizzle")||m;return"<iframe "+['allow="'+lu.join("; ")+'"','frameborder="0"',p?'height="'+p+'"':"",'style="'+g+'"','sandbox="'+cu.join(" ")+'"','src="'+t.replace(uu,_)+'"'].join(" ")+"></iframe>"},t.getHlsJsCdnConfig=getHlsJsCdnConfig,t.getInstance=function(t){if(0===Ks.length)throw new we(we.CONFIGURATION_ERROR,"No configured instance");if(void 0===t)return Ks[Ks.length-1];var n=Ks.find((function(n){return n.id===t}));if(!n)throw new we("No instance with id "+t+" found");return n},t.getInstances=function(){return Ks},t.getPlayerType=getPlayerType,t.prepareMediaAPIItem=prepareMediaAPIItem,t.resolveCanonical=function(t){return __awaiter$4(this,void 0,void 0,(function(){return __generator$4(this,(function(n){switch(n.label){case 0:return[4,filterLinks(t)];case 1:return[2,{results:{links:n.sent()},meta:{originalUrl:t,originalQueryParams:parseQueryParams(t)}}]}}))}))},t.supportedMediaTypes=wt,t.version="2.2104.3",Object.defineProperty(t,"__esModule",{value:!0})}));
