# 1 IPv4

* IP는 패킷 헤더의 IP 주소를 기준으로 소스 호스트에서 목적지 호스트로 패킷을 전달하는 작업을 한다



# 2 IP Address

* 컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신을 하기 위해서 사용하는 특수한 번호이다.
* 네트워크에 연결된 장치가 라우터이든 일반 서버이든, 모든 기계는 이 특수한 번호를 가지고 있어야 한다.
* 3계층인 Network Layer(OSI Model)에서 쓰이는 주소체계
* 주소의 범위는 32비트
* IPv4의 주소체계는 총 12자리이며 네 부분으로 나뉜다. 
  * 각 부분은 0~255까지 3자리의 수로 표현된다
  * 이 표현 방식을 **dotted-decimal format**이라 한다.
  * 예) `192.0.2.1`



## 2.1 Subnet Mask(부분망)

* IP 주소의 `Network Part`와 `Host Part`를 구분하기 위해 사용된다.
* 두개의 장치가 같은 서브넷에 있는지 아닌지 판별하기 위해 사용된다.
  * 네트워크 접두사를 비교해 같으면 같은 서브넷에 있다
  * Remote Network(다른 서브넷)
    * default gateway가 필요함
  * Local Subnet(같은 서브넷)
    * default gateway가 필요없다.

* 이진 형태로 1로 시작해서 연속적으로 1이 있어야한다.



**네트워크 접두사 결정**

|                 |               이진 형태               | 닷 데시멀 노테이션 |
| :-------------: | :-----------------------------------: | :----------------: |
|     IP 주소     | `11000000.10101000.00000101.10000010` |  `192.168.5.130`   |
|  서브넷 마스크  | `11111111.11111111.11111111.00000000` |  `255.255.255.0`   |
| 네트워크 접두사 | `11000000.10101000.00000101.00000000` |   `192.168.5.0`    |
|   호스트 부분   | `00000000.00000000.00000000.10000010` |    `0.0.0.130`     |



## 2.2 게이트웨이

* 다른 서브넷으로 패킷을 전달해야 할 경우 해당 패킷은 게이트웨이으로 전달된다
  * 서브넷 마스크를 통해 같은 서브넷인지 아닌지 알 수 있다
  * 같은 서브넷이라면 게이트웨이를 통해 밖으로 나가지 않고 통신이 가능하다
* 일반적으로 게이트웨이의 호스트 부분 주소는 가장 작은 수로 설정
  * 예) `192.168.0.1`



## 2.3 Private and Public IP addresses



## 2.4 특수한 주소

**`0.0.0.0`**

**127.0.0.1**

* 호스트 자신을 가리키는 주소



# 3 Packet structure

* IP는 Packet을 source 호스트에서 destination 호스트로 전달하는 기능을 한다
* Packet은 헤더와 페이로드로 구성된다
  * checksum이나 footer를 가지고 있지 않다



## 3.1 Header

![image-20220720222402974](./images/1.png)

* 14개의 필드로 구성되어 있다



**Source address**

* packet 발송자의 IPv4 address
* NAT로 인해 전달 중 Source address가 바뀔 수 있다

**Destination address**

* packet 목적지의 IPv4 address 