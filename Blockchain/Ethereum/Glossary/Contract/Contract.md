# 1 Contract

* 스마트 컨트랙트란?
  * `당사자들이 다른 약속에 따라 수행하는 프로토콜을 포함하여 디지털 형식으로 지정된 일련의 약속` - 닉 사보

* 이더리움에서 컨트랙트(스마트 컨트랙트)란 불변적인 컴퓨터 프로그램을 말한다.
  * 이 프로그램은 이더리움 네트워크 프로토콜의 일부인 이더리움 가상 머신의 컨텍스트상에서 결정론적으로 작동한다.

* 컨트랙트는, 수행되거나 컴파일 되어야 할 어떤 것이라기 보다는이더리움의 실행 환경안에 살아있는 일종의 자율 에이전트이다
* 컨트랙트는 자신이 소유한 ether balance와 key/valuce store 대한 직접적인 통제권을 가지고 있다.



**Contract의 정의**

* 컴퓨터 프로그램
  * 스마트 컨트랙트는 단순히 컴퓨터 프로그램이다
  * `컨트랙트` 라는 단어에 법적인 의미는 없다
* immutable
  * 스마트 컨트랙트 코드는 일단 배포되면 변경할 수 없다
  * 스마트 컨트랙트를 수정하는 유일한 방법은 새로운 인스턴스를 배포하는 것이다
* 결정론적(deterministic)
  * 스마트 컨트랙트를 실행한 결과는 실행한 모든 이에게 동일하다
* EVM 컨텍스트
  * 스마트 컨트랙트는 매우 제한적인 실행 컨텍스트에서 작동된다
  * 자신의 상태 호출한 트랜잭션의 컨테스트 및 가장 최근 블록의 일부 정보에만 접근할 수 있다
* 탈중앙화된 월드 컴퓨터(decentralized world computer)
  * EVM은 모든 이더리움 노드에서 로컬 인스턴스로 실행된다.
  * EVM의 모든 인스턴스 동일한 초기 상태에서 동작하고 동일한 최종 상태를 생성하기 때문에 시스템 전체가 단일 월드 컴퓨터로 작동한다.

# 2 컨트랙트의 생명주기









**컨트랙트 코드 작성**

```solidity
contract Faucet {
    function () public payable {}

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount <= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
}
```

* `msg`
  * 모든 컨트랙트에서 접근할 수 있는 입력 중 하나
  * 이 컨트랙트의 실행을 시작한 트랜잭션을 나타낸다.
* `msg.sender`
  * 트랜잭션의 발신자 주소
* `msg.sender.transfer()`
  * 이더를 현재 컨트랙트에서 발신자의 주소로 전송한다는 뜻이다
* `receive() external payable {}`
  * 소위 폴백 또는 기본함수
  * 컨트랙트를 실행한 트랜잭션이 컨트랙트에 선언된 함수 또는 어떤한 함수도 지정하지 않거나 데이터를 포함하지 않을 경우 호출된다.
  * 컨트랙트는 하나의 기본 함수를 가질 수 있다
  * 일반적으로 이더를 받는 함수이다.



**Contract의 생성**

* 솔리디티로 작성한 스마트 컨트랙트는 [EVM](#evm)에서 사용되는 바이트 코드로 컴파일되어야 한다.
* 컴파일된 컨트랙트 코드는 특수한 형태의 [트랜잭션](#transaction)을 통해 이더리움 블록체인에 배포가 되고 이때부터 공개된다.
  * 스마트 계약의 배포를 위해서는 수신자의 주소가 0으로 지정된 특수한 형태의 트랜잭션을 발생시켜야 한다.
* 컨트랙트가 생성되면 지갑과 마찬가지로 주소를 가지게된다.



**Contract의 실행**

* 컨트랙트는 메시지나 [트랜잭션](#transaction)을 트리거로 항상 특정 코드를 실행하는 자동화된 에이전트이다
* 트랜잭션의 목적지가 컨트랙트 주소일 때 트랜잭션과 트랜잭션 데이터를 입력으로 사용하여 컨트랙트가 EVM에서 실행된다.
* 트랜잭션에는 이더, 데이터가 포함된다
  * 이더가 포함되어 있으면 컨트랙트 잔액에 예치된다.
  * 데이터가 포함되어 있으면 데이터에서는 컨트랙트에서 명명된 함수를 지정하고 호출하여 함수에 인수를 전달할 수 있다
* 이렇게 트랜잭션은 컨트랙트 내의 함수를 호출할 수 있다.