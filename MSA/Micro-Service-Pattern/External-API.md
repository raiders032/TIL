# 1 External API

- 마이크로서비스를 배포하면 서비스마다 API를 가지고 있어 어떤 종류의 API를 클라이언트에 표출해야 할지 결정해야 한다.
- External API는 클라이언트 종류가 다양한 만큼 설계가 어렵다.
	- 클라이언트 마다 다른 종류의 데이터를 요구하기 때문이다.
	- 서비스에 접근하는 네트워크 경로가 클라이언트마다 다르다.
		- 방화벽 내부 클라이언트는 고성능 LAN을 통해 접속하지만 방화벽 외부의 클라이언트는 성능이 낮은 인터넷이나 모바일 네트워크를 통해 들어온다.
	- 따라서 만능 API 같은 것은 없다.

<br>

## 1.1 External API 설계 이슈

- 웹 애플리케이션은 방화벽 내부에서 실행되어 대역폭이 높고 지연 시간이 낮은 LAN을 통해 서비스에 접근한다.
- 반면에 다른 클라이언트는 방화벽 외부에 있어 상대적으로 대역폭이 낮고 지연이 높은 인터넷 또는 모바일 네트워크 환경에서 접근한다.
- 모노리식 애플리케이션 API는 클라이언트가 서비스를 직접 호출하는 방식을 사용한다.

<br>

**마이크로서비스에서 클라이언트 직접 호출 방식을 사용하지 않는 이유**

-  서비스 API가 잘게 나눠져 있으면 여러 번 요청해야 하고 그만큼 효율이 떨어진다.
	- 특히 인터넷 모바일 네트워크로 접속하는 클라이언트는 LAN 보다 대역폭이 훨씬 낮고 지연 시간이 길다.
	- 일반적으로 모바일 네트워크 지연 시간이 LAN 보다 100배는 더 길다.
	- 물론 모바일 앱은 동시에 요청을 보내 지연을 최소화하기 때문에 문제가 되지 않을 수 있다.
	- 하지만 클라이언트 요청을 순차 실행할 수밖에 없는 상황에서는 UX가 나빠질 것이다.
-  클라이언트가 서비스 및 API를 잘 알아야하는 구조라서 캡슐화가 꺠진다. 
	- 따라서 나중에 아키텍처와 API를 변경하기 어렵게 된다.
	- 캡슐화가 되지 않아 프론트엔드 개발자가 백엔드 코드와 맞물려 코드를 변경해야 한다.

<br>

# 2 API Gateway Pattern

- API Gateway는 방화벽 외부의 클라이언트가 애플리케이션에 API를 요청하는 단일 창구 역할을 하는 서비스다.
- 퍼사드 패턴을 떠올리면 이해가 빠르다.
	- 퍼사드처럼 내부 애플리케이션 아키텍처를 캡슐화하고 자신의 클라이언트에는 API를 제공한다.
- 인증, 모니터링, 사용량 제한 등 부수적인 일도 담당한다.

<br>

# 3 API Gateway의 역할

- API Gateway는 요청 라우팅, API 조합, 프로토콜 변환을 관장한다.


## 3.1 요청 라우팅

- 요청 라우팅은 API Gateway의 주요 기능 중 하나다.
	- 요청이 들어오면 라우팅 맵을 찾아 어느 서비스로 요청을 보낼지 결정한다.
	- 엔진엑스 같은 웹 서버 리버스 프록시와 똑같다.
- 요청을 HTTP 메서드, 경로에 따라 서비스로 라우팅한다.
- 커맨드와 쿼리는 각각 별도의 서비스로 처리한다.
- 적절한 CQRS 쿼리 서비스로 라우팅해야 한다.

<br>

## 3.2 API 조합

- API 게이트웨이는 단순 리버스 프록시보다 더 많은 일을 한다.
- 클라이언트가 요청 한 번으로 필요한 데이터를 조회할 수 있도록 대단위 API를 제공한다.

<br>

## 3.3 프로토콜 변환

- 서비스가 사용하는 클라이언트 친화적인 프로토콜과 비친화적인 프로토콜을 상호 변환